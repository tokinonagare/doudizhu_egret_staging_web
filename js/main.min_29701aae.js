var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},__awaiter=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))(function(n,o){function i(e){try{d(r.next(e))}catch(t){o(t)}}function s(e){try{d(r["throw"](e))}catch(t){o(t)}}function d(e){e.done?n(e.value):new a(function(t){t(e.value)}).then(i,s)}d((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function a(e){return function(t){return r([e,t])}}function r(a){if(n)throw new TypeError("Generator is already executing.");for(;d;)try{if(n=1,o&&(i=o[2&a[0]?"return":a[0]?"throw":"next"])&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[0,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return d.label++,{value:a[1],done:!1};case 5:d.label++,o=a[1],a=[0];continue;case 7:a=d.ops.pop(),d.trys.pop();continue;default:if(i=d.trys,!(i=i.length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){d=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){d.label=a[1];break}if(6===a[0]&&d.label<i[1]){d.label=i[1],i=a;break}if(i&&d.label<i[2]){d.label=i[2],d.ops.push(a);break}i[2]&&d.ops.pop(),d.trys.pop();continue}a=t.call(e,d)}catch(r){a=[6,r],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var n,o,i,s,d={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},DDZBaseComponent=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.Component);__reflect(DDZBaseComponent.prototype,"DDZBaseComponent");var DDZGameServiceMessageBaseData=function(){function e(e){this.action=e.action,e.room&&(this.roomId=e.room.id)}return e}();__reflect(DDZGameServiceMessageBaseData.prototype,"DDZGameServiceMessageBaseData");var DDZPlayCardSet=function(){function e(e){this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND,this.singles=[],this.pairs=[],this.trioes=[],this.bombs=[],this.attachedBombs=[],this.cards=e}return e.prototype.reset=function(){this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND},e.prototype.listCardsCodes=function(){return this.cards.map(function(e){return e.code})},e.prototype.isEmpty=function(){return 1===this.cardTypeName},e.prototype.isBomb=function(){return 14===this.cardTypeName},e.prototype.isHuoJian=function(){return 15===this.cardTypeName},e.prototype.isFourTakes=function(){return 12===this.cardTypeName||13===this.cardTypeName?!0:!1},e.prototype.canBeBiggerConsetutive=function(e,t,a){return t.value-e.value===a-1&&this.value<e.value},e.prototype.isLegal=function(){return 0!==this.cardTypeName&&1!==this.cardTypeName},e.prototype.isTypeEqualTo=function(e){return e?this.cardTypeName===e.cardTypeName&&this.countCards()===e.countCards():!1},e.prototype.setPlayerId=function(e){this.playerId=e},e.prototype.countCards=function(){return this.cards.length},e.prototype.isBiggerThan=function(e){if(!e)throw new Error("用于比较的cardSet不能为空");return this.isHuoJian()?!0:e.isHuoJian()?!1:this.isTypeEqualTo(e)?this.value>e.value:this.isBomb()?!0:e.isBomb()?!1:!1},e.prototype.isEqualTo=function(e){if(!e)throw new Error("用于比较的cardSet不能为空");return this.isTypeEqualTo(e)&&this.value===e.value?!0:!1},e.prototype.listBiggerLegalCardSet=function(e){throw new Error("需要子类重写实现此方法")},e.prototype.getSoundEffectName=function(){throw new Error("需要子类重写此方法获取音效名字")},e.prototype.classifyCards=function(e){this.cleanCards();for(var t=0,a=Object.keys(e);t<a.length;t++){var r=a[t],n=e[r];n.isSingle()?this.singles.push(n):n.isPair()?this.pairs.push(n):n.isTrio()?this.trioes.push(n):n.isBomb()&&this.bombs.push(n)}},e.prototype.cleanCards=function(){this.singles=[],this.pairs=[],this.trioes=[],this.bombs=[],this.attachedBombs=[]},e}();__reflect(DDZPlayCardSet.prototype,"DDZPlayCardSet");var DDZBaseCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="",t}return __extends(t,e),t.prototype.setImage=function(e){this.image.source=e},t.prototype.dataChanged=function(){this.setImage(this.data.getImageName())},t}(eui.ItemRenderer);__reflect(DDZBaseCardView.prototype,"DDZBaseCardView");var QPLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){for(var e=this.numChildren,a=0;e>a;a+=1){var r=this.getChildAt(a);r instanceof t&&r.onEnter()}},t.prototype.onExit=function(){for(var e=this.numChildren,a=0;e>a;a+=1){var r=this.getChildAt(a);r instanceof t&&r.onExit()}},t}(DDZBaseComponent);__reflect(QPLayer.prototype,"QPLayer");var DDZPlayCardTrioTakes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findBiggerTrioCards=function(e){this.classifyCards(e);var t=this.trioes.concat(this.bombs).sort(function(e,t){return e.value-t.value}),a=t.length;if(1===a){var r=t[0];return r.value<this.value?[]:[r.cards[0],r.cards[1],r.cards[2]]}for(var n=0;a>n;n+=1){var r=t[n];if(this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND&&this.value<r.value)return this.lastFoundIndex=n,[r.cards[0],r.cards[1],r.cards[2]];if(this.lastFoundIndex<n&&this.value<r.value)return this.lastFoundIndex=n,n===a-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),[r.cards[0],r.cards[1],r.cards[2]]}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var r=t[this.lastFoundIndex];return[r.cards[0],r.cards[1],r.cards[2]]}return[]},t}(DDZPlayCardSet);__reflect(DDZPlayCardTrioTakes.prototype,"DDZPlayCardTrioTakes");var BaseUserAttributeModel=function(){function e(){}return e.prototype.setId=function(e){this._id=e},e.prototype.getId=function(){return this._id},e.prototype.setServiceId=function(e){this._serviceId=e},e.prototype.getServiceId=function(){return this._serviceId},e.prototype.setBalanceAmount=function(e){this._balance=e},e.prototype.getBalanceAmount=function(){return this._balance},e.prototype.setProfileImage=function(e){this._profileImage=e},e.prototype.getProfileImage=function(){return this._profileImage},e.prototype.setTotalScore=function(e){this._totalScore=e},e.prototype.getTotalScore=function(){return this._totalScore},e.prototype.setNickname=function(e){this._nickname=e},e.prototype.getNickname=function(){return this._nickname},e.prototype.setUsername=function(e){this._username=e},e.prototype.getUsername=function(){return this._username},e.prototype.setTotalGameAmount=function(e){this._totalGameAmount=e},e.prototype.getTotalGameAmount=function(){return this._totalGameAmount},e.prototype.setWinningRate=function(e){this._winningRate=e},e.prototype.getWinningRate=function(){return this._winningRate},e.prototype.setEscapeRate=function(e){this._escapeRate=e},e.prototype.getEscapeRate=function(){return this._escapeRate},e.prototype.setWinningGameAmount=function(e){this._winningGameAmount=e},e.prototype.getWinningGameAmount=function(){return this._winningGameAmount},e.prototype.setContinuousWinningAmount=function(e){this._continuousWinningAmount=e},e.prototype.getContinuousWinningAmount=function(){return this._continuousWinningAmount},e.prototype.setHasSignUp=function(e){this.hasSignUp=e},e.prototype.getHasSignUp=function(){return this.hasSignUp},e.prototype.setHasBindPhoneNumber=function(e){this.hasBindPhoneNumber=e},e.prototype.getHasBindPhoneNumber=function(){return this.hasBindPhoneNumber},e.prototype.setAccessToken=function(e){this.accessToken=e},e.prototype.getAccessToken=function(){return this.accessToken},e.prototype.setChannel=function(e){this.channel=e},e.prototype.getChannel=function(){return this.channel},e.prototype.setTimestamp=function(e){this.timestamp=e},e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.setInfo=function(e){this.info=e},e.prototype.getInfo=function(){return this.info},e.prototype.setToken=function(e){this.token=e},e.prototype.getToken=function(){return this.token},e.prototype.setHashDigest=function(e){this.hashDigest=e},e.prototype.getHashDigest=function(){return this.hashDigest},e.prototype.setExpireISOTime=function(e){this.expireISOTime=e},e.prototype.getExpireISOTime=function(){return this.expireISOTime},e.prototype.cleanCommunicationAttribute=function(){this.accessToken=void 0,this.channel=void 0,this.timestamp=void 0,this.info=void 0,this.token=void 0,this.hashDigest=void 0,this.expireISOTime=void 0},e}();__reflect(BaseUserAttributeModel.prototype,"BaseUserAttributeModel",["IUserAttribute","IUserCacheAttribute","ICommunicationAttribute"]);var BLACK_JOKER_CODE="bw",RED_JOKER_CODE="rw",DDZCard=function(){function e(e){this.shouldShowLandlordTag=!1,this.isLastOne=!1,this.code=e,this.setImageNameByCode(e),this.decode(e),this.calculateIndex(),this.isSelect=!1}return e.prototype.showLandlordTag=function(e){this.shouldShowLandlordTag=e},e.prototype.getImageName=function(){return this.imageName},e.prototype.isValueEqualTo=function(e){return this.value===e.value},e.prototype.isExactlySameTo=function(e){return this.index===e.index},e.prototype.setImageNameByCode=function(e){this.imageName="poker_"+e+"@2x_png"},e.prototype.calculateIndex=function(){var e=4*(this.value-3);1===this.suit?e+=3:2===this.suit?e+=2:3===this.suit?e+=1:4===this.suit&&(e+=0),this.code===BLACK_JOKER_CODE?e=52:this.code===RED_JOKER_CODE&&(e=53),this.index=e},e.prototype.decode=function(e){if(e===BLACK_JOKER_CODE)return void(this.value=16);if(e===RED_JOKER_CODE)return void(this.value=17);var t=e.charAt(0),a=e.slice(-1);this.decodeSuit(a),this.decodeValue(t)},e.prototype.decodeValue=function(e){switch(e){case"3":this.value=3;break;case"4":this.value=4;break;case"5":this.value=5;break;case"6":this.value=6;break;case"7":this.value=7;break;case"8":this.value=8;break;case"9":this.value=9;break;case"t":this.value=10;break;case"j":this.value=11;break;case"q":this.value=12;break;case"k":this.value=13;break;case"a":this.value=14;break;case"2":this.value=15;break;default:this.value=18}},e.prototype.decodeSuit=function(e){switch(e){case"s":this.suit=1;break;case"h":this.suit=2;break;case"c":this.suit=3;break;case"d":this.suit=4;break;default:this.suit=0}},e}();__reflect(DDZCard.prototype,"DDZCard");var DDZPlayCardAirplaneTakes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findBiggerAirplaneCards=function(e,t){this.classifyCards(e);var a=this.trioes.concat(this.bombs).sort(function(e,t){return e.value-t.value}),r=a.length;if(t>r)return[];for(var n=0;r>n;n+=1){var o=n+t-1;if(o>r-1)return[];var i=a[o];if(15<=i.value)return[];var s=a[n];if(this.canBeBiggerConsetutive(s,i,t)){if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND&&n<=this.lastFoundIndex)continue;if(this.lastFoundIndex=n,r-1>o){var d=a[o+1];(d.value-i.value!==1||15<=d.value)&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND)}else o===r-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND);for(var l=a.slice(n,o+1),c=[],h=0,u=l;h<u.length;h++){var p=u[h];c=c.concat([p.cards[0],p.cards[1],p.cards[2]])}return c}}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var y=this.lastFoundIndex,s=a[y],f=this.lastFoundIndex+t-1,i=a[f];if(f>=r)return[];if(15<=i.value)return[];if(i.value-s.value!==t-1)return[];for(var g=a.slice(y,f+1),c=[],m=0,v=g;m<v.length;m++){var C=v[m];c=c.concat([C.cards[0],C.cards[1],C.cards[2]])}return c}return[]},t}(DDZPlayCardSet);__reflect(DDZPlayCardAirplaneTakes.prototype,"DDZPlayCardAirplaneTakes");var DDZPlayCardFourTakes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findBiggerBombCards=function(e){this.classifyCards(e);var t=this.bombs.length;if(0===t)return[];if(1===t){var a=this.bombs[0];return a.value<this.value?[]:a.cards}for(var r,n=0;t>n;n+=1){var a=this.bombs[n];this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND&&this.value<a.value?(this.lastFoundIndex=n,r=a):!r&&this.lastFoundIndex<n&&this.value<a.value?(this.lastFoundIndex=n,this.lastFoundIndex===t-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),r=a):this.attachedBombs.push(a)}return r?r.cards:[]},t}(DDZPlayCardSet);__reflect(DDZPlayCardFourTakes.prototype,"DDZPlayCardFourTakes");var QPScene=function(e){function t(){var t=e.call(this)||this;return t.loadingScene=new QPLoadingScene,QPApplication.sharedInstance().isWebOnReactNative()&&Device.sharedInstance().autoAdjustResolutioin(t),t}return __extends(t,e),t.prototype.onEnter=function(){for(var e=this.numChildren,t=0;e>t;t+=1){var a=this.getChildAt(t);a instanceof QPLayer&&a.onEnter()}this.addRealtimeConnetListeners(),window.document.addEventListener("message",function(e){var t=JSON.parse(e.data);"app_state_changed"===t.command&&("active"===t.payload?(QPAudioManager.sharedInstance().setBackgroundMusicEnable(!0),QPAudioManager.sharedInstance().setSoundEffectEnable(!0),QPAudioManager.sharedInstance().playBackgroundMusic(QPAudioSouce.PLAY_GAME_BACKGROUND,-1)):"background"===t.payload&&(QPAudioManager.sharedInstance().setBackgroundMusicEnable(!1),QPAudioManager.sharedInstance().setSoundEffectEnable(!1),QPAudioManager.sharedInstance().stopPlayBackgroundMusic()))})},t.prototype.onExit=function(){for(var e=this.numChildren,t=0;e>t;t+=1){var a=this.getChildAt(t);a instanceof QPLayer&&a.onExit()}this.hideLostRealtimeServiceConnetInfo(),this.removeRealtimeConnetListeners(),window.document.removeEventListener("message",function(e){})},t.prototype.disableTouchLoading=function(){this.loadingScene.touchEnabled=!0,this.loadingScene.touchChildren=!0},t.prototype.enableTouchLoading=function(){this.loadingScene.touchEnabled=!1,this.loadingScene.touchChildren=!1},t.prototype.addRealtimeConnetListeners=function(){DDZEventCenter.sharedInstance().addEventListener(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT,this.hideLostRealtimeServiceConnetInfo,this),DDZEventCenter.sharedInstance().addEventListener(DDZNetworkEvent.DISCONNECT_SERVER_EVENT,this.showLostRealtimeServiceConnectInfo,this)},t.prototype.removeRealtimeConnetListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT,this.hideLostRealtimeServiceConnetInfo,this),DDZEventCenter.sharedInstance().removeEventListener(DDZNetworkEvent.DISCONNECT_SERVER_EVENT,this.showLostRealtimeServiceConnectInfo,this)},t.prototype.hideLostRealtimeServiceConnetInfo=function(){this.loadingScene&&this.loadingScene.hide()},t.prototype.showLostRealtimeServiceConnectInfo=function(){this.loadingScene||(this.loadingScene=new QPLoadingScene),this.loadingScene.show("努力重连中...")},t}(DDZBaseComponent);__reflect(QPScene.prototype,"QPScene");var LaunchBaseLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.joinRoomById=function(e){return __awaiter(this,void 0,void 0,function(){var t,a,r,n,o;return __generator(this,function(i){switch(i.label){case 0:t=UserModel.sharedInstance().actionDataFactory.makeJoinPersonalRoomData(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,UserModel.sharedInstance().actionModel.joinPersonalRoomById(t)];case 2:return a=i.sent(),"gaming"===a.status?(this.backToExistGame(),[2]):(UserModel.sharedInstance().roomModel.setId(a.id),UserModel.sharedInstance().roomModel.setPlayers(a.players),r=DDZPlayerFactory.make(a.players),n=new DDZGameModel(a.id),n.setPlayers(r),qp.SceneManager.sharedInstance().replaceScene(new DDZPlayGameScene(n)),[3,4]);case 3:throw o=i.sent();case 4:return[2]}})})},t.prototype.backToExistGame=function(){var e=this;DDZGameState.Model.sharedInstance().fetch(function(e){if(egret.log("LaunchGameBaseLayer fetch user state #########################################"),egret.log(e),egret.log("\n\n"),DDZGameState.Model.sharedInstance().room&&DDZServerMessageMonitor.sharedInstance().setUpdatedAt(DDZGameState.Model.sharedInstance().room.updatedAt),DDZGameState.Model.sharedInstance().isInGame()||DDZGameState.Model.sharedInstance().isWaiting()){e.room.pin&&UserModel.sharedInstance().roomModel.setPin(e.room.pin);var t=DDZGameState.Model.sharedInstance().room,a=new DDZGameModel(t.id);a.setPlayers(t.players),a.setBaseScore(t.baseScore),DDZServerMessageMonitor.sharedInstance().setLatestReceivedMessageDate(new Date),qp.SceneManager.sharedInstance().replaceScene(new DDZPlayGameScene(a))}},function(t){return egret.log("是否在等待中",DDZGameState.Model.sharedInstance().isWaiting()),t?void e.handleError(t):void 0})},t.prototype.handleError=function(e){QPAlert.sharedInstance().showOKButtonAt(this,e.message),QPAlert.sharedInstance().pressedOKHandler=function(){QPCrossPlatformCommunication.closeH5Game()}},t}(QPLayer);__reflect(LaunchBaseLayer.prototype,"LaunchBaseLayer");var DDZBaseButtons=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setVisible=function(e){this.visible=e},t}(QPLayer);__reflect(DDZBaseButtons.prototype,"DDZBaseButtons");var DDZCardListView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZCardListUI",t}return __extends(t,e),t.prototype.setAnimation=function(e){this.animation=e},t.prototype.playAnimation=function(){this.animation.play()},t.prototype.setCards=function(e){this.cardList.dataProvider=new eui.ArrayCollection(e),this.width=e.length<=14?65+25*(e.length-1):400},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setupCardList()},t.prototype.setupCardList=function(){this.cardList.itemRenderer=DDZCardView,this.cardList.allowMultipleSelection=!0,this.height=177},t}(QPLayer);__reflect(DDZCardListView.prototype,"DDZCardListView");var DDZGameServiceMessageStartGameData=function(e){function t(t){var a=e.call(this,t)||this;return a.playerIds=[],a.playerIds=t.player_ids,a.startedAt=t.started_at,a.gameMatchId=t.game_match_id,a.initLandlord=t.init_landlord,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageStartGameData.prototype,"DDZGameServiceMessageStartGameData");var DDZCardView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.landlordSignImage.visible=!1},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.isLastOne&&(this.landlordSignImage.visible=this.data.shouldShowLandlordTag)},t}(DDZBaseCardView);__reflect(DDZCardView.prototype,"DDZCardView");var DDZPlayerGameInfoBaseView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.hideAllState=function(){this.playerStateView.hideAllState()},t.prototype.setRemainCardsCount=function(e){this.remainCardView.visible=!0,this.remainCardView.setAmount(e)},t.prototype.showWarningLightView=function(){this.warningLightView.show()},t.prototype.hideWarningLightView=function(){this.warningLightView.hide()},t.prototype.reset=function(){this.hideWarningLightView(),this.playerStateView.hideAllState()},t.prototype.hideRemainCardsView=function(){this.remainCardView.visible=!1},t.prototype.setCallLandlordPoint=function(e){1===e?this.playerStateView.setState(1):2===e?this.playerStateView.setState(2):3===e&&this.playerStateView.setState(3)},t.prototype.showNotPlayCard=function(){this.playerStateView.setState(7)},t.prototype.showNotCallLandlord=function(){this.playerStateView.setState(4)},t.prototype.showWaitForReady=function(e){this.playerStateView.showWaitForReady(e)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.remainCardView.visible=!1},t}(QPLayer);__reflect(DDZPlayerGameInfoBaseView.prototype,"DDZPlayerGameInfoBaseView");var QPTestCase=function(){function e(e){this.name=e}return e.prototype.startTest=function(){throw new Error("需要子类实现")},e.prototype.assertEquals=function(e,t,a){return t===a?void this.testSuccessLog(e):void egret.log("❌ "+e+": expectValue "+t+" not equals to subject "+a)},e.prototype.assert=function(e,t){return t?void this.testSuccessLog(e):void egret.log("❌ "+e)},e.prototype.testSuccessLog=function(e){egret.log("✅  SUCCESS : "+e)},e}();__reflect(QPTestCase.prototype,"QPTestCase");var HttpActionData=function(){function e(e){this.body={application:"doudizhu"},this.validate(e)}return e.prototype.validate=function(e){throw new Error("需要子类实现")},e}();__reflect(HttpActionData.prototype,"HttpActionData",["IHttpActionData"]),egret.HttpRequest.prototype.setRequestTimeout=function(e,t){return setTimeout(function(){e()},t)};var QPNetworkApi=function(){function e(){}return e.prototype.fetchImage=function(e){var t=this;return new Promise(function(a,r){var n=new egret.ImageLoader,o=e.url+t.buildParams(e.parameters);n.crossOrigin="anonymous",n.once(egret.Event.COMPLETE,function(e){a(n.data)},t),n.once(egret.IOErrorEvent.IO_ERROR,function(e){egret.log("fetchImage IOErrorEvent ........."),egret.log(e),egret.log("\n"),r(new QPNetworkError({message:"网络图片获取失败"}))},t),n.load(o)})},e.prototype.fetchJson=function(e,t,a){var r=e;return r.method=egret.HttpMethod.GET,this.request(r,3,t,a)},e.prototype.postReturnJson=function(e,t,a){var r=e;r.method=egret.HttpMethod.POST,this.request(r,3,t,a)},e.prototype.headerWithoutAuthorization=function(){return{Accept:"application/json","Content-Type":"application/json"}},e.prototype.headerWithAuthorization=function(){var e=this.headerWithoutAuthorization();return e.Authorization="Bearer "+UserModel.sharedInstance().attributeModel.getAccessToken(),e},e.prototype.getResponseError=function(e){if(e.errors){if(e.errors.length<=0)return new QPNetworkError({message:"服务器请求错误返回格式不对。"});var t=e.errors[0],a=t.message;return t.field&&(a=a+" ("+t.field+")"),new QPNetworkError({message:a,error_type:e.errors[0].error_type})}return new QPNetworkError({message:e.message,error_type:e.error_type})},e.prototype.buildParams=function(e){if(!e)return"";var t="?";for(var a in e)a&&(t=t+a+"="+e[a]+"&");return t=t.slice(0,-1)},e.prototype.buildBody=function(e){return JSON.stringify(e)},e.prototype.request=function(e,t,a,r){var n=this,o=t,i=e.url;e.method===egret.HttpMethod.GET&&(i+=this.buildParams(e.parameters));var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,s.open(i,e.method);for(var d=0,l=Object.keys(e.header);d<l.length;d++){var c=l[d];s.setRequestHeader(c,e.header[c])}var h=s.setRequestTimeout(function(){s&&(s.abort(),s=void 0),o-=1,0>=o?(QPHostModel.sharedInstance().switchNextAvailableHost(),r(new QPNetworkError({message:"网络请求超时",error_type:"request_time_out"}))):n.request(e,o,a,r),n.resetRequestTimeout(h)},5e3);if(s.once(egret.Event.COMPLETE,function(e){n.resetRequestTimeout(h);var t=e.currentTarget.response;if(!t)return void r(new QPNetworkError({message:"HTTP GET response is null"}));var o=JSON.parse(t);return o.server_load?void a(o):void(o.ok?a(o.result):r(n.getResponseError(o)))},this),s.once(egret.IOErrorEvent.IO_ERROR,function(e){egret.log("================================================ egret.HTTP GET IOErrorEvent.IO_ERROR "),egret.log(i),egret.log(e),egret.log("================================================ egret.HTTP GET IOErrorEvent.IO_ERROR \n"),n.resetRequestTimeout(h),QPHostModel.sharedInstance().switchNextAvailableHost(),r(new QPNetworkError({message:"无法连接到服务器"}))},this),e.method===egret.HttpMethod.POST&&e.body){var u=this.buildBody(e.body);s.send(u)}else s.send();return s},e.prototype.resetRequestTimeout=function(e){var t=e;t&&(clearTimeout(t),t=void 0)},e}();__reflect(QPNetworkApi.prototype,"QPNetworkApi");var QPPopupLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(QPLayer);__reflect(QPPopupLayer.prototype,"QPPopupLayer");var DDZPlayerModel=function(e){function t(t){var a=e.call(this)||this;return a.setId(t.id),a.handCardModel=new DDZHandCardModel,a}return __extends(t,e),t.prototype.reset=function(){this.handCardModel.setCards([]),this.setCharacter(2),this.setCardsAmount(0),this.setLatestPlayedCards([]),this.setScore(0),this.setCalledLandlordScore(-1),this.setHasCalledLandlord(!1),this.setHasPlayedCards(!1)},t.prototype.resetTotalScore=function(){this.setTotalScore(0)},t.prototype.setId=function(e){this._id=e},t.prototype.getId=function(){return this._id},t.prototype.setServiceId=function(e){this._serviceId=e},t.prototype.getServiceId=function(){return this._serviceId},t.prototype.setBalanceAmount=function(e){this._balance=e},t.prototype.getBalanceAmount=function(){return this._balance},t.prototype.setProfileImage=function(e){this._profileImage=e},t.prototype.getProfileImage=function(){return this._profileImage},t.prototype.setTotalScore=function(e){this._totalScore=e},t.prototype.getTotalScore=function(){return this._totalScore},t.prototype.setNickname=function(e){this._nickname=e},t.prototype.getNickname=function(){return this._nickname},t.prototype.setUsername=function(e){this._username=e},t.prototype.getUsername=function(){return this._username},t.prototype.setTotalGameAmount=function(e){this._totalGameAmount=e},t.prototype.getTotalGameAmount=function(){return this._totalGameAmount},t.prototype.setWinningRate=function(e){this._winningRate=e},t.prototype.getWinningRate=function(){return this._winningRate},t.prototype.setEscapeRate=function(e){this._escapeRate=e},t.prototype.getEscapeRate=function(){return this._escapeRate},t.prototype.setWinningGameAmount=function(e){this._winningGameAmount=e},t.prototype.getWinningGameAmount=function(){return this._winningGameAmount},t.prototype.setContinuousWinningAmount=function(e){this._continuousWinningAmount=e},t.prototype.getContinuousWinningAmount=function(){return this._continuousWinningAmount},t.prototype.setActive=function(e){this._isActive=e},t.prototype.getActive=function(){return this._isActive},t.prototype.setTimerValue=function(e){this._timerValue=e},t.prototype.getTimerValue=function(){return this._timerValue},t.prototype.setCardsAmount=function(e){this._cardsAmount=e},t.prototype.getCardsAmount=function(){return this._cardsAmount},t.prototype.setCards=function(e){var t=this;e?this._cards=e.map(function(e){return new DDZCard(e)}):this._cards=[],this._cards.forEach(function(e){e.showLandlordTag(t.getIsLandlord())}),this.handCardModel.setCards(this._cards)},t.prototype.getCards=function(){return this._cards},t.prototype.setCalledLandlordScore=function(e){this._calledLandlordScore=e},t.prototype.getCalledLandlordScore=function(){return this._calledLandlordScore},t.prototype.setHasCalledLandlord=function(e){this._hasCalledLandlord=e},t.prototype.getHasCalledLandlord=function(){return this._hasCalledLandlord},t.prototype.setLatestPlayedCards=function(e){var t=this;this._latestPlayedCards=e.slice(),this._latestPlayedCards.sort(function(e,t){return t.index-e.index});var a=this._latestPlayedCards.length;this._latestPlayedCards.forEach(function(e,r){e.showLandlordTag(t.getIsLandlord()),e.isLastOne=r===a-1})},t.prototype.getLatestPlayedCards=function(){return this._latestPlayedCards},t.prototype.setHasPlayedCards=function(e){this._hasPlayedCards=e},t.prototype.getHasPlayedCards=function(){return this._hasPlayedCards},t.prototype.setSeat=function(e){this._seat=e},t.prototype.getSeat=function(){return this._seat},t.prototype.setSeatId=function(e){this._seatId=e},t.prototype.getSeatId=function(){return this._seatId},t.prototype.setIsReady=function(e){this._isReady=e},t.prototype.getIsReady=function(){return this._isReady},t.prototype.setCharacter=function(e){this._character=e},t.prototype.getCharacter=function(){return this._character},t.prototype.setScore=function(e){this._scoreInARound=e},t.prototype.getScore=function(){return this._scoreInARound},t.prototype.getIsLandlord=function(){return 1===this._character},t.prototype.setIsWinner=function(e){return this._isWinner=e},t.prototype.getIsWinner=function(){return this._isWinner},t.prototype.isIdEqualTo=function(e){return this._id===e},t.prototype.characterEqualTo=function(e){return this._character===e},t.prototype.hasCards=function(){return this.handCardModel.hasCards()},t.prototype.getCallLandlordSoundByPoint=function(e){if(0===e)return this.getNotCallLandlordSoundName();if(1===e)return this.getCallOnePointSoundName();if(2===e)return this.getCallTwoPointSoundName();if(3===e)return this.getCallThreePointSoundName();throw new Error("Fatal Error，你需要传一个分数进来，获取叫地主的音效")},t.prototype.initialHandCardsAmount=function(){this.setCardsAmount(this.getIsLandlord()?DDZConstant.DEFAULT_LANDLORD_CARDS_AMOUNT:DDZConstant.DEFAULT_FARMER_CARDS_AMOUNT)},t.prototype.callLandlord=function(e){this.setCalledLandlordScore(e);var t={body:{score:e},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/become_landlord"};this.postCallLandlordData(t)},t.prototype.notCallLandlord=function(){var e={body:{score:0},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/become_landlord"};this.postCallLandlordData(e)},t.prototype.leaveRoom=function(e){var t={header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/leave"};this.postReturnJson(t,function(t){e&&e()},function(t){e&&e(t)})},t.prototype.addLandlordCards=function(e){this.handCardModel.addLandlordCards(e)},t.prototype.addLandlordTagToHandCards=function(){this.handCardModel.addLandlordTag()},t.prototype.listHandCards=function(){return this.handCardModel.listCards()},t.prototype.listSelectedCards=function(){return this.handCardModel.listSelectedCards()},t.prototype.listAutoPlayCards=function(e){var t=this.handCardModel.findBiggerCardSetThanTarget(e);return t?t.cards:[]},t.prototype.cancelSelectedCards=function(){this.handCardModel.cancelSelectedCards()},t.prototype.isHaveBiggerCards=function(e){if(!e&&this.handCardModel.hasCards())return!0;if(e.isEmpty()&&this.handCardModel.hasCards())return!0;var t=this.handCardModel.findBiggerCardSetThanTarget(e);return e.reset(),t?!0:!1},t.prototype.playPlayedCardsAudio=function(){1!==this.getCardsAmount()||this.isJust1CardAudioPlayed?2!==this.getCardsAmount()||this.isJust2CardsAudioPlayed?this.playCardSetAudio():this.playJust2CardsAudio():this.playJust1CardAudio()},t.prototype.fetchAvatar=function(){var e={url:QPApiConfig.MediaHost+"/"+this._id+"/"+this._id+".jpg",parameters:{size:118},header:this.headerWithAuthorization()};return this.fetchImage(e)},t.prototype.listLatestPlayedCards=function(){return this._latestPlayedCards},t.prototype.dropPlayedCards=function(e){this.handCardModel.dropPlayedCards(e),this.setCardsAmount(this.handCardModel.countCards())},t.prototype.postCallLandlordData=function(e){var t=this;this.postReturnJson(e,function(){egret.log("call landlord "+e.body.score+" success #######")},function(a){return a.mustBeHandled()?void egret.log("发送斗地主数据出错了，这不应该发生，请查看 "+a.message):(t.postCallLandlordData(e),void egret.log("call landlord failed now reCall ##########"))})},t.prototype.playCardSetAudio=function(){var e=this.getLatestPlayedCards(),t=DDZPlayCardSetFactory.createCardSet(e),a=t.getSoundEffectName();t.isEmpty()||QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.SEND_CARD,1),QPAudioManager.sharedInstance().playEffectSound(a,1)},t.prototype.playJust1CardAudio=function(){var e="quick_wj1zpl_mp3";QPAudioManager.sharedInstance().playEffectSound(e,1),this.isJust1CardAudioPlayed=!0},t.prototype.playJust2CardsAudio=function(){var e="quick_wj2zpl_mp3";QPAudioManager.sharedInstance().playEffectSound(e,1),this.isJust2CardsAudioPlayed=!0},t.prototype.getNotCallLandlordSoundName=function(){return"grab_bu_jiao_mp3"},t.prototype.getCallOnePointSoundName=function(){return"grab_1_point_mp3"},t.prototype.getCallTwoPointSoundName=function(){return"grab_2_point_mp3"},t.prototype.getCallThreePointSoundName=function(){return"grab_3_point_mp3"},t.CALL_LANDLORD_TIME=15,t.PLAY_CARD_TIME=25,t.NO_BIGGER_CARDS_TIME=10,t.OBVIOUS_NO_BIGGER_CARDS_TIME=4,t}(QPNetworkApi);__reflect(DDZPlayerModel.prototype,"DDZPlayerModel",["IUserAttribute","IPlayerPlayGameAttribute"]);var DDZHandCardEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.TOUCHED="event.hand.card.touched",t.TOUCH_END="event.hand.card.touch.end",t
}(egret.Event);__reflect(DDZHandCardEvent.prototype,"DDZHandCardEvent");var DDZMusicEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.PLAY_MUSIC_EVENT="event.play.game.music",t.STOP_MUSIC_EVENT="event.stop.game.music",t}(egret.Event);__reflect(DDZMusicEvent.prototype,"DDZMusicEvent");var DDZNetworkEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.DISCONNECT_SERVER_EVENT="event.disconnect.with.server",t.CONNECT_TO_SERVER_EVENT="event.connect.to.server",t}(egret.Event);__reflect(DDZNetworkEvent.prototype,"DDZNetworkEvent");var DDZUserEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.SIGN_IN_SUCCESS="ddz.user.event.sign.in.success",t}(egret.Event);__reflect(DDZUserEvent.prototype,"DDZUserEvent");var DDZWebsocketEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.MISS_MESSAGE_EVENT="event.miss.websocket.message",t}(egret.Event);__reflect(DDZWebsocketEvent.prototype,"DDZWebsocketEvent");var LaunchGameScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameLaunchSceneUI",t.launchGameModel=new LaunchGameModel,t.launchGameModel.queriedScreenSizeHandler=t.setScreenSize.bind(t),t.launchGameModel.queryScreenSize(),t.launchGameModel.updatePlatformNameHandler=t.setPlatformName.bind(t),t.launchGameModel.queryPlatformName(),t.showPlatformAfter2Seconds(),t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),this.progress.visible=!1,this.enableTouchLoading()},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.launchGameModel.removeWindowEventListeners(),this.disableTouchLoading()},t.prototype.setProgress=function(e,t){this.progress.setProgressValue(e/t)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.launchOnPureWebLayer.show(!1),this.launchOnReactNativeLayer.show(!1)},t.prototype.showPlatformAfter2Seconds=function(){var e=this;this.showPlatformTimeout=setTimeout(function(){e.showPlatform(),e.clearShowPlatformTimeout()},2e3)},t.prototype.clearShowPlatformTimeout=function(){this.showPlatformTimeout&&(clearTimeout(this.showPlatformTimeout),this.showPlatformTimeout=void 0)},t.prototype.showPlatform=function(){QPApplication.sharedInstance().isWebOnReactNative()?(this.showCloseButton(),this.launchOnReactNativeLayer.show(!0),this.launchOnReactNativeLayer.setup(this.launchGameModel)):(this.progress.visible=!0,this.launchOnPureWebLayer.show(!0))},t.prototype.setScreenSize=function(e){Device.sharedInstance().setWidth(e.width),Device.sharedInstance().setHeight(e.height),Device.sharedInstance().autoAdjustResolutioin(this),this.stage.setContentSize(2*e.width,2*e.height)},t.prototype.setPlatformName=function(e){var t=this;QPApplication.sharedInstance().setPlatform(e),this.clearShowPlatformTimeout(),QPHostModel.sharedInstance().sortProxyHostByConnectSpeed(function(){t.showPlatform()})},t.prototype.showCloseButton=function(){this.topToolbar.pressCloseButtonHandler=this.closeGame.bind(this),this.topToolbar.showCloseButton()},t.prototype.closeGame=function(){QPCrossPlatformCommunication.closeH5Game()},t}(QPScene);__reflect(LaunchGameScene.prototype,"LaunchGameScene");var LaunchGameModel=function(){function e(){this.QUERY_ROOM_ID_COMMAND="query_room_id",this.addWindowEventListeners()}return e.prototype.removeWindowEventListeners=function(){window.document.removeEventListener("message",function(e){egret.log("LaunchGameModel removeWindowEventListeners.......")})},e.prototype.queryPlatformName=function(){window.postMessage(JSON.stringify({command:"query_platform_name"}),"*")},e.prototype.queryUserData=function(){window.postMessage(JSON.stringify({command:"query_user_data"}),"*")},e.prototype.queryScreenSize=function(){window.postMessage(JSON.stringify({command:"query_screen_size"}),"*")},e.prototype.queryRoomId=function(){window.postMessage(JSON.stringify({command:this.QUERY_ROOM_ID_COMMAND}),"*")},e.prototype.queryClubInfo=function(){window.postMessage(JSON.stringify({command:"query_club_info"}),"*")},e.prototype.addWindowEventListeners=function(){var e=this;window.document.addEventListener("message",function(t){var a=JSON.parse(t.data);switch(a.command){case"query_platform_name":e.updatePlatformNameHandler&&e.updatePlatformNameHandler(a.payload);break;case"query_user_data":e.queriedUserDataHandler&&e.queriedUserDataHandler(a.payload);break;case"query_screen_size":e.queriedScreenSizeHandler&&e.queriedScreenSizeHandler(a.payload);break;case e.QUERY_ROOM_ID_COMMAND:e.queriedRoomIdHandler&&e.queriedRoomIdHandler(a.payload);break;case"query_club_info":e.queriedClubInfoHandler&&e.queriedClubInfoHandler(a.payload)}})},e}();__reflect(LaunchGameModel.prototype,"LaunchGameModel");var GetVerificationCodeTimerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="GetVerificationCodeTimerUI",t}return __extends(t,e),t.prototype.show=function(){this.startTimer(),this.visible=!0},t.prototype.hide=function(){this.stopTimer(),this.visible=!1},t.prototype.startTimer=function(){this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.remainTimerValue=t.TIMER_VALUE,this.updateTimerLabel(),this.timer.start()},t.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timer=void 0)},t.prototype.timerFunc=function(){return this.remainTimerValue-=1,this.remainTimerValue<=0?(this.countDownCompleteHandler(),void this.hide()):void this.updateTimerLabel()},t.prototype.updateTimerLabel=function(){this.timerLabel.text=this.remainTimerValue+"秒后重新获取"},t.TIMER_VALUE=60,t}(QPLayer);__reflect(GetVerificationCodeTimerView.prototype,"GetVerificationCodeTimerView");var InputPhoneView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputPhoneUI",t.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressNextButton,t),t}return __extends(t,e),t.prototype.onPressNextButton=function(){return QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.phoneInput.text.isValidPhoneNumber()?void this.getVerificationCode():void QPAlert.sharedInstance().showOKButtonAt(this,"请输入正确的电话号码","电话号码错误")},t.prototype.getVerificationCode=function(){var e=this,t=new QPLoadingScene;t.show("获取验证码中..."),UserModel.sharedInstance().inputtedAttributeModel.setPhoneNumber(this.phoneInput.text);var a=UserModel.sharedInstance().actionDataFactory.makeSendVerificationCodeData();UserModel.sharedInstance().actionModel.sendVerificationCode(a,function(a){t.hide(),UserModel.sharedInstance().attributeModel.setHashDigest(a.hash_digest),UserModel.sharedInstance().attributeModel.setExpireISOTime(a.expire_iso_time),qp.SceneManager.sharedInstance().removeChildLayer(e),qp.SceneManager.sharedInstance().addChildLayer(new InputVerificationCodeView)},function(a){t.hide(),QPAlert.sharedInstance().showOKButtonAt(e,a.message)})},t}(QPLayer);__reflect(InputPhoneView.prototype,"InputPhoneView");var InputVerificationCodeView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputVerificationCodeUI",t.okButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressOkButton,t),t}return __extends(t,e),t.prototype.onExit=function(){e.prototype.onExit.call(this),this.verificationCodeInput.reset()},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.descriptionLabel.text="已发送到："+UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber(),this.verificationCodeInput.pressGetVerificationCodeButtonHandler=this.getVerificationCode.bind(this)},t.prototype.getVerificationCode=function(){var e=this,t=UserModel.sharedInstance().actionDataFactory.makeSendVerificationCodeData();UserModel.sharedInstance().actionModel.sendVerificationCode(t,function(e){UserModel.sharedInstance().attributeModel.setHashDigest(e.hash_digest),UserModel.sharedInstance().attributeModel.setExpireISOTime(e.expire_iso_time)},function(t){QPAlert.sharedInstance().showOKButtonAt(e,t.message)})},t.prototype.onPressOkButton=function(){var e=this;QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var t=this.verificationCodeInput.text;if(t.isValidVerificationCode()){var a=new QPLoadingScene;a.show("登录中..."),UserModel.sharedInstance().inputtedAttributeModel.setVerificationCode(t);var r=UserModel.sharedInstance().actionDataFactory.makePhoneAndCodeSignInData();return void UserModel.sharedInstance().actionModel.signIn(r,function(t){QPCookie.set(QPCOOKIE_USER_ORIGIN_DATA_KEY,JSON.stringify(t),7),UserModel.sharedInstance().saveUserInformation(t),UserModel.sharedInstance().connectRealtimeGameService(function(t){if(a.hide(),t)return void QPAlert.sharedInstance().showOKButtonAt(e,t.message,"连接服务器失败");qp.SceneManager.sharedInstance().removeChildLayer(e);var r=new DDZUserEvent(DDZUserEvent.SIGN_IN_SUCCESS);DDZEventCenter.sharedInstance().dispatchEvent(r)})},function(t){a.hide(),QPAlert.sharedInstance().showOKButtonAt(e,t.message,"登录失败")})}QPAlert.sharedInstance().showOKButtonAt(this,"请输入验证码")},t}(QPLayer);__reflect(InputVerificationCodeView.prototype,"InputVerificationCodeView");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,a){function r(r){t.call(a,r,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?r(n):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var PureWebLayerButtonType;!function(e){e[e.SignIn=0]="SignIn",e[e.StartGame=1]="StartGame"}(PureWebLayerButtonType||(PureWebLayerButtonType={}));var LaunchOnPureWebLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="LaunchOnPureWebLayerUI",t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),this.signInButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressSignInButton,this),this.startButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressStartButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZUserEvent.SIGN_IN_SUCCESS,this.signInSuccess,this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),DDZEventCenter.sharedInstance().removeEventListener(DDZUserEvent.SIGN_IN_SUCCESS,this.signInSuccess,this)},t.prototype.show=function(e){this.visible=e},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.readCookie()},t.prototype.handleError=function(e){var t=this;QPAlert.sharedInstance().showOKButtonAt(this,e.message),QPAlert.sharedInstance().pressedOKHandler=function(){t.showButtonByType(PureWebLayerButtonType.StartGame)}},t.prototype.readCookie=function(){var e=QPCookie.getByName(QPCOOKIE_USER_ORIGIN_DATA_KEY);if(e){var t=JSON.parse(e);if(UserModel.sharedInstance().isDataValid(t))return void this.showButtonByType(PureWebLayerButtonType.StartGame);QPCookie.eraseCookie(QPCOOKIE_USER_ORIGIN_DATA_KEY)}this.showButtonByType(PureWebLayerButtonType.SignIn)},t.prototype.hideAllButtons=function(){this.signInButton.visible=!1,this.startButton.visible=!1},t.prototype.showButtonByType=function(e){this.hideAllButtons(),e===PureWebLayerButtonType.SignIn?this.signInButton.visible=!0:e===PureWebLayerButtonType.StartGame&&(this.startButton.visible=!0)},t.prototype.onPressSignInButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),qp.SceneManager.sharedInstance().addChildLayer(new InputPhoneView)},t.prototype.onPressStartButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=QPCookie.getByName(QPCOOKIE_USER_ORIGIN_DATA_KEY);this.parseUserCookie(e)},t.prototype.parseUserCookie=function(e){var t=this;try{var a=JSON.parse(e);a&&(UserModel.sharedInstance().saveUserInformation(a),UserModel.sharedInstance().connectRealtimeGameService(function(e){return e?void QPAlert.sharedInstance().showOKButtonAt(t,e.message,"连接服务器失败"):void t.parseRoomNumberFromURL()}))}catch(r){QPAlert.sharedInstance().showOKButtonAt(this,r.message)}},t.prototype.parseRoomNumberFromURL=function(){return __awaiter(this,void 0,void 0,function(){var e,t,a,r,n,o;return __generator(this,function(i){switch(i.label){case 0:if(e=window.location.href,t="?id=",a=e.indexOf(t),r=a+t.length,n=e.slice(r),!n||a===DDZConstant.INDEX_NOT_FOUND)return[3,5];UserModel.sharedInstance().roomModel.setPin(n),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.joinRoomById(n)];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),this.handleError(o),[3,4];case 4:return[3,6];case 5:QPAlert.sharedInstance().showAt(this,"没有找到可用的房间号","无法加入游戏"),i.label=6;case 6:return[2]}})})},t.prototype.signInSuccess=function(){this.showButtonByType(PureWebLayerButtonType.StartGame),this.parseRoomNumberFromURL()},t}(LaunchBaseLayer);__reflect(LaunchOnPureWebLayer.prototype,"LaunchOnPureWebLayer");var LaunchOnReactNativeLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="LaunchOnReactNativeLayerUI",t}return __extends(t,e),t.prototype.setup=function(e){this.launchGameModel=e,this.launchGameModel.queriedUserDataHandler=this.parseUserData.bind(this),this.launchGameModel.queriedRoomIdHandler=this.parseRoomId.bind(this),this.launchGameModel.queriedClubInfoHandler=this.saveClubInfo.bind(this),this.launchGameModel.queryUserData(),this.launchGameModel.queryClubInfo()},t.prototype.show=function(e){this.visible=e},t.prototype.setDescriptionText=function(e){this.descriptionLabel.text=e+"..."},t.prototype.parseUserData=function(e){var t=this,a=JSON.parse(e);this.setDescriptionText("正在查找房间"),UserModel.sharedInstance().saveUserInformation(a),UserModel.sharedInstance().connectRealtimeGameService(function(e){return e?void t.handleError(e):void t.launchGameModel.queryRoomId()})},t.prototype.parseRoomId=function(e){return __awaiter(this,void 0,void 0,function(){var t,a,r;return __generator(this,function(n){switch(n.label){case 0:if(t=e.room_id,a=e.house_number,UserModel.sharedInstance().roomModel.setPin(t),UserModel.sharedInstance().roomModel.setHouseNumber(String(a)),"join_room_by_room_id"!==e.type)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.joinRoomById(t)];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),this.handleError(r),[3,4];case 4:return[3,6];case 5:"back_to_exist_game"===e.type&&(this.setDescriptionText("正在查询游戏信息"),this.backToExistGame()),n.label=6;case 6:return[2]}})})},t.prototype.saveClubInfo=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return UserModel.sharedInstance().roomModel.setClubName(e.club_name),UserModel.sharedInstance().roomModel.setRoomName(e.room_name),[2]})})},t}(LaunchBaseLayer);__reflect(LaunchOnReactNativeLayer.prototype,"LaunchOnReactNativeLayer");var VerificationCodeTextInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="VerificationCodeTextInputUI",t}return __extends(t,e),t.prototype.reset=function(){this.getVerificationCodeButton.visible=!0,this.timerView.hide()},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.getVerificationCodeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressGetVerificationCodeButton,this),this.getVerificationCodeButton.visible=!1,this.timerView.show(),this.timerView.countDownCompleteHandler=this.showGetVerificationCodeButton.bind(this)},t.prototype.showGetVerificationCodeButton=function(){this.getVerificationCodeButton.visible=!0},t.prototype.onPressGetVerificationCodeButton=function(){this.getVerificationCodeButton.visible=!1,this.timerView.show(),this.pressGetVerificationCodeButtonHandler()},t}(eui.TextInput);__reflect(VerificationCodeTextInput.prototype,"VerificationCodeTextInput");var DDZCentrifuge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Centrifuge);__reflect(DDZCentrifuge.prototype,"DDZCentrifuge");var DDZGameServiceModel=function(){function e(){this.ddzCentrifuge=void 0,this.needExecuteCallback=!1}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.isSupportWSS=function(e,t){var a=new egret.WebSocket;a.type=egret.WebSocket.TYPE_BINARY,a.addEventListener(egret.Event.CONNECT,function(e){t(!0),a.close()},this),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){t(!1)},this),a.connectByUrl(e)},e.prototype.start=function(e,t){var a=this;if(this.needExecuteCallback=!0,this.ddzCentrifuge)return void(this.needExecuteCallback&&(this.ddzCentrifuge.connect(),t(),this.needExecuteCallback=!1));var r={isNative:Device.sharedInstance().isNative(),url:e.host,version:e.version,accessToken:e.access_token,user:e.user_id,info:e.info,timestamp:e.timestamp,token:e.token};this.ddzCentrifuge=new DDZCentrifuge(r),this.ddzCentrifuge.connect(),this.ddzCentrifuge.on("connect",function(e){t&&a.needExecuteCallback&&(t(),a.needExecuteCallback=!1);var r=new DDZNetworkEvent(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(r),egret.log("game service connect ....")}),this.ddzCentrifuge.on("disconnect",function(e){var t=new DDZNetworkEvent(DDZNetworkEvent.DISCONNECT_SERVER_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(t),egret.log("game service disconnect ......"),egret.log(e)}),this.ddzCentrifuge.on("error",function(e){egret.log("game service error ......"),egret.log(e)})},e.prototype.stop=function(){this.ddzCentrifuge.disconnect(),this.ddzCentrifuge=void 0},e.prototype.subscribe=function(e,t){return this.ddzCentrifuge.subscribe(e,t)},e}();__reflect(DDZGameServiceModel.prototype,"DDZGameServiceModel",["IUserWebsocketAction"]);var DDZUserChannelModel=function(){function e(){this.needExecuteCallback=!1}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setMessageCounter=function(e){this.messageCounter=e},e.prototype.resetMessageCounter=function(){this.messageCounter.reset()},e.prototype.subscribe=function(e,t){var a=this;if(this.needExecuteCallback=!0,this.userChannel)return egret.log("callback without subscribe..........."),void t();var r={message:function(e){egret.log("["+JSON.stringify(e.data)+"]\n"),DDZServerMessageMonitor.sharedInstance().setLatestReceivedMessageDate(new Date),a.needResetMessageCounter(e)&&a.resetMessageCounter();var t=new Date(e.data.payload.updated_at);DDZServerMessageMonitor.sharedInstance().getUpdatedAt()<t&&a.handleReceivedMessage(e),a.checkMessageMissed(e)},join:function(e){egret.log("user channel someone joined channel")},leave:function(e){egret.log("user channel someone left channel")},subscribe:function(e){a.needExecuteCallback&&(t(),a.needExecuteCallback=!1)},error:function(e){a.needExecuteCallback&&(t(new Error("订阅用户频道出错")),a.needExecuteCallback=!1),a.unsubscribe(),egret.log("subscribe userChannel failed ......."),egret.log(e)},unsubscribe:function(e){egret.log("unsubscribe userChannel success .......")}};this.userChannel=DDZGameServiceModel.sharedInstance().subscribe(e,r)},e.prototype.unsubscribe=function(){this.userChannel&&(this.userChannel.unsubscribe(),this.userChannel=void 0)},e.prototype.handleReceivedMessage=function(e){"doudizhu_room"===e.data.stream?this.handleRoomMessage(e):"doudizhu"===e.data.stream&&this.handleGameMessage(e)},e.prototype.handleRoomMessage=function(e){var t=new DDZGameServiceMessage(e);DDZServerMessageMonitor.sharedInstance().setUpdatedAt(t.updatedAt),this.roomMessageReceivedHandler&&this.roomMessageReceivedHandler(t.data)},e.prototype.handleGameMessage=function(e){var t=new DDZGameServiceMessage(e);DDZServerMessageMonitor.sharedInstance().setUpdatedAt(t.updatedAt),this.userMessageReceivedHandler&&this.userMessageReceivedHandler(t.data)},e.prototype.needResetMessageCounter=function(e){var t=e.data.payload.action;return t===DDZGameServiceAction.RestartGame?!0:t===DDZGameServiceAction.GameOver?!0:t===DDZGameServiceAction.ForceGameOver?!0:!1},e.prototype.checkMessageMissed=function(e){if(e.data.payload.action!==DDZGameServiceAction.GameOver&&(this.messageCounter.addMessage(e.data.payload.sequence),this.messageCounter.isMessageMissed())){var t=new DDZWebsocketEvent(DDZWebsocketEvent.MISS_MESSAGE_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(t)}},e.INITIAL_MESSAGE_SEQUENCE=-1,e}();__reflect(DDZUserChannelModel.prototype,"DDZUserChannelModel");var DDZGameServiceAction=function(){function e(){}return e.JoinRoom="join_room",e.LeaveRoom="leave_room",e.StartGame="start_game",e.DealCards="deal_cards",e.Match="match",e.CallLandlord="become_landlord",e.ConfirmLandlord="finish_landlord",e.RestartGame="restart_game",e.Deal="deal",e.PlayCard="play_card",e.GameOver="end_game",e.ForceGameOver="force_end_game_by_leaving",e.Ready="ready",e}();__reflect(DDZGameServiceAction.prototype,"DDZGameServiceAction");var DDZGameServiceMessage=function(){function e(e){this.uid=e.uid,this.channel=e.channel,this.data=DDZGameServiceMessageDataFactory.createMessageData(e.data.payload),this.updatedAt=new Date(e.data.payload.updated_at)}return e}();__reflect(DDZGameServiceMessage.prototype,"DDZGameServiceMessage");var Main=function(e){function t(){var t=e.call(this)||this;return t.isThemeLoadEnd=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.hasAddToStage,t),t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.setupResourceGroupLoaderCallBacks();var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigFinish,this),RES.loadConfig("resource/default.res.json","resource/"),this.initUserModel()},t.prototype.hasAddToStage=function(e){Device.sharedInstance().isPCBrowser()&&(this.stage.orientation=egret.OrientationMode.LANDSCAPE,this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL)},t.prototype.setupResourceGroupLoaderCallBacks=function(){QPResource.LaunchGameGroup.sharedInstance().loadCompleteHandler=this.loadLaunchGameGroupFinish.bind(this),QPResource.PlayGameGroup.sharedInstance().loadCompleteHandler=this.loadPlayGameGroupFinish.bind(this),QPResource.PlayGameGroup.sharedInstance().loadProgressHandler=this.loadResourceProgress.bind(this),QPResource.CommonImagesGroup.sharedInstance().loadCompleteHandler=this.loadCommonImagesGroupFinish.bind(this),QPResource.CommonMusicGroup.sharedInstance().loadCompleteHandler=this.loadCommonMusicGroupFinish.bind(this)},t.prototype.initUserModel=function(){UserModel.sharedInstance().setInputtedAttributeModel(new InputtedAttributeModel),UserModel.sharedInstance().setActionDataFactory(new PhoneUserActionDataFactory),UserModel.sharedInstance().setAttributeModel(new PhoneUserAttributeModel),UserModel.sharedInstance().setRoomModel(new RoomModel)},t.prototype.onLoadConfigFinish=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigFinish,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onLoadThemeFinish,this)},t.prototype.onLoadThemeFinish=function(){egret.ExternalInterface.call("RuntimeInterface","load resource complete"),this.isThemeLoadEnd=!0,QPResource.LaunchGameGroup.sharedInstance().load()},t.prototype.loadLaunchGameGroupFinish=function(e){this.launchGameScene=new LaunchGameScene,qp.SceneManager.sharedInstance().addRootStage(this),qp.SceneManager.sharedInstance().pushScene(this.launchGameScene),QPResource.PlayGameGroup.sharedInstance().load()},t.prototype.loadPlayGameGroupFinish=function(e){QPResource.PlayGameGroup.sharedInstance().isLoaded=!0,QPResource.CommonMusicGroup.sharedInstance().load()},t.prototype.loadCommonMusicGroupFinish=function(e){QPResource.CommonMusicGroup.sharedInstance().isLoaded=!0,QPResource.CommonImagesGroup.sharedInstance().load()},t.prototype.loadCommonImagesGroupFinish=function(e){QPResource.CommonImagesGroup.sharedInstance().isLoaded=!0},t.prototype.isAllRequiredResourcesLoaded=function(){return this.isThemeLoadEnd&&QPResource.PlayGameGroup.sharedInstance().isLoaded&&QPResource.CommonImagesGroup.sharedInstance().isLoaded&&QPResource.CommonMusicGroup.sharedInstance().isLoaded?!0:!1},t.prototype.loadResourceProgress=function(e){this.launchGameScene.setProgress(e.itemsLoaded,e.itemsTotal)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DDZGameServiceMessageCallLandlordData=function(e){function t(t){var a=e.call(this,t)||this;return a.nextPlayer=t.next_player_id,a.playerId=t.player_id,a.score=t.score,a.currentLandlordScore=t.current_landlord_score,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageCallLandlordData.prototype,"DDZGameServiceMessageCallLandlordData");var DDZGameServiceMessageConfirmLandlordData=function(e){function t(t){var a=e.call(this,t)||this;a.landlord=t.landlord,a.bottomCards=[];for(var r=0,n=t.bottom_cards;r<n.length;r++){var o=n[r],i=new DDZCard(o);a.bottomCards.push(i)}return a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageConfirmLandlordData.prototype,"DDZGameServiceMessageConfirmLandlordData");var DDZGameServiceMessageCounter=function(){function e(){this.DefaultMessageSequence=-11111,this.reset()}return e.prototype.addMessage=function(e){void 0!==e&&(this.previousMessageSequence===this.DefaultMessageSequence?this.missMessage=!1:e-this.previousMessageSequence!==1&&(this.missMessage=!0),this.previousMessageSequence=e)},e.prototype.isMessageMissed=function(){return this.missMessage},e.prototype.reset=function(){this.previousMessageSequence=this.DefaultMessageSequence,this.missMessage=!1},e}();__reflect(DDZGameServiceMessageCounter.prototype,"DDZGameServiceMessageCounter",["IDDZMessageCounter"]);var DDZGameServiceMessageDataFactory=function(){function e(){}return e.createMessageData=function(e){switch(e.action){case DDZGameServiceAction.JoinRoom:return new DDZGameServiceMessageRoomPlayerChangedData(e);case DDZGameServiceAction.LeaveRoom:return new DDZGameServiceMessageRoomPlayerChangedData(e);case DDZGameServiceAction.DealCards:return new DDZGameServiceMessageDealCardsData(e);case DDZGameServiceAction.CallLandlord:return new DDZGameServiceMessageCallLandlordData(e);case DDZGameServiceAction.ConfirmLandlord:return new DDZGameServiceMessageConfirmLandlordData(e);case DDZGameServiceAction.StartGame:return new DDZGameServiceMessageStartGameData(e);case DDZGameServiceAction.RestartGame:return new DDZGameServiceMessageRestartGameData(e);case DDZGameServiceAction.PlayCard:return new DDZGameServiceMessagePlayCardData(e);case DDZGameServiceAction.GameOver:return new DDZGameServiceMessageGameOverData(e);case DDZGameServiceAction.ForceGameOver:return new DDZGameServiceMessageForceGameOverData(e);case DDZGameServiceAction.Ready:return new DDZGameServiceMessageRoomPlayerChangedData(e)}throw new Error("create game service message data fatal error ...")},e}();__reflect(DDZGameServiceMessageDataFactory.prototype,"DDZGameServiceMessageDataFactory");var DDZGameServiceMessageDealCardsData=function(e){function t(t){var a=e.call(this,t)||this;a.cards=[];for(var r=0,n=t.cards;r<n.length;r++){var o=n[r],i=new DDZCard(o);a.cards.push(i)}return a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageDealCardsData.prototype,"DDZGameServiceMessageDealCardsData");var DDZGameServiceMessageForceGameOverData=function(e){function t(t){var a=e.call(this,t)||this;return a.leftPlayerName=t.left_player.nickname,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageForceGameOverData.prototype,"DDZGameServiceMessageForceGameOverData");var DDZGameServiceMessageGameOverData=function(e){function t(t){var a=e.call(this,t)||this;return a.gameOverPlayerInformations=t.players.map(function(e){return new DDZGameOverPlayerInformation(e)}),a.isSpring=t.is_slam,a.endDateString=t.ended_at,a.settlement=t.settlement,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageGameOverData.prototype,"DDZGameServiceMessageGameOverData");var DDZGameOverPlayerInformation=function(){function e(e){if(this.playerId=e.id,this.remainCards=[],this.score=e.score,e.remain_cards)for(var t=0,a=e.remain_cards;t<a.length;t++){var r=a[t],n=new DDZCard(r);this.remainCards.push(n)}}return e.prototype.isWinner=function(){return 0===this.remainCards.length},e}();__reflect(DDZGameOverPlayerInformation.prototype,"DDZGameOverPlayerInformation");var DDZGameServiceMessagePlayCardData=function(e){function t(t){var a=e.call(this,t)||this;if(a.playerId=t.player_id,a.remainCardsAmount=t.remain_cards_amount,a.nextPlayerId=t.next_player_id,0===t.played_cards.length)a.playedCards=[];else{var r=t.played_cards.map(function(e){return new DDZCard(e)});a.playedCards=r.sort(function(e,t){return t.index-e.index})}return a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessagePlayCardData.prototype,"DDZGameServiceMessagePlayCardData");var DDZGameServiceMessageRestartGameData=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(DDZGameServiceMessageStartGameData);__reflect(DDZGameServiceMessageRestartGameData.prototype,"DDZGameServiceMessageRestartGameData");var DDZGameServiceMessageRoomPlayerChangedData=function(e){function t(t){var a=e.call(this,t)||this;return a.playerId=t.player_id,a.playerModels=DDZPlayerFactory.make(t.room.players),a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageRoomPlayerChangedData.prototype,"DDZGameServiceMessageRoomPlayerChangedData");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var TestDDZUserChannelModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.startTest=function(){this.testMissMessage(),this.testNoMessageMissed(),this.testMissedMessageAndCountAgain()},t.prototype.testMissMessage=function(){var e=new DDZGameServiceMessageCounter;this.assertEquals("期待初始丢失消息状态为 false",!1,e.isMessageMissed()),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(6),this.assertEquals("监测到丢失消息",!0,e.isMessageMissed())},t.prototype.testNoMessageMissed=function(){var e=new DDZGameServiceMessageCounter;this.assertEquals("期待初始丢失消息状态为 false",!1,e.isMessageMissed()),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(5),e.addMessage(6),e.addMessage(7),e.addMessage(8),e.addMessage(9),e.addMessage(10),e.addMessage(11),e.addMessage(12),e.addMessage(13),e.addMessage(14),e.addMessage(15),this.assertEquals("测试连续收到15条消息",!1,e.isMessageMissed())},t.prototype.testMissedMessageAndCountAgain=function(){var e=new DDZGameServiceMessageCounter;this.assertEquals("测试缺失消息然后重新检测 --- 期待初始丢失消息状态为 false",!1,e.isMessageMissed()),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(6),this.assertEquals("测试缺失消息然后重新检测 --- 监测到消息丢失",!0,e.isMessageMissed()),e.reset(),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(5),this.assertEquals("测试缺失消息然后重新检测 --- 消息丢失后重新检测没有丢失情况",!1,e.isMessageMissed()),e.reset(),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(6),this.assertEquals("测试缺失消息然后重新检测 --- 消息丢失后重新检测又有消息丢失情况",!0,e.isMessageMissed())},t}(QPTestCase);__reflect(TestDDZUserChannelModel.prototype,"TestDDZUserChannelModel");var DDZGameState;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.forceFetch=function(e,t){this.isFetching=!1,this.fetch(e,t)
},t.prototype.fetch=function(e,t){var r=this;if(!this.isFetching){this.isFetching=!0;var n={url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/player_state",header:this.headerWithAuthorization()};this.httpRequest=this.fetchJson(n,function(t){r.isFetching=!1,r.setGameState(t.state),t.room&&(r.room=new a(t.room)),e(t)},function(e){r.isFetching=!1,t(e)})}},t.prototype.cancelFetch=function(){this.httpRequest&&(this.httpRequest.abort(),this.httpRequest=void 0)},t.prototype.setGameState=function(e){this.gameState=e},t.prototype.isWaiting=function(){return this.gameState===r.WAITING},t.prototype.isInGame=function(){return this.gameState===r.BECOMING_LANDLORD||this.gameState===r.PLAYING_CARD},t.prototype.isIdling=function(){return this.gameState===r.IDLING},t.prototype.isPlayingGame=function(){return this.gameState===r.PLAYING_CARD},t.prototype.isBecomingLandlord=function(){return this.gameState===r.BECOMING_LANDLORD},t.prototype.getPlayerModelById=function(e){for(var t=0,a=this.room.players;t<a.length;t++){var r=a[t];if(r.isIdEqualTo(e))return r}},t.prototype.getActivePlayerTimerValue=function(){return this.room.activePlayer.getTimerValue()},t.instance=void 0,t}(QPNetworkApi);e.Model=t,__reflect(t.prototype,"DDZGameState.Model");var a=function(){function e(e){if(this.lastPlayedCards=[],this.calledLandlordScore=0,this.id=e.id,this.gameMatchId=e.game_match_id,this.startedAt=e.started_at,this.updatedAt=new Date(e.updated_at),this.baseScore=e.base_score,this.bottomCards=[],e.bottom_cards)for(var t=0,a=e.bottom_cards;t<a.length;t++){var r=a[t],n=new DDZCard(r);this.bottomCards.push(n)}this.confirmedLandlord=e.landlord,this.initLandlord=e.init_landlord,this.playerIds=e.player_ids,this.players=this.createPlayers(e.players)}return e.prototype.createPlayers=function(e){for(var t=[],a=0,r=e;a<r.length;a++){var n=r[a],o=new DDZPlayerModel({id:n.id});o.setServiceId(n.service_id),o.setActive(n.is_active),o.setTimerValue(0);var i=this.confirmedLandlord&&n.id===this.confirmedLandlord?1:2;o.setCharacter(i),o.setCardsAmount(n.remain_cards_amount),o.setCards(n.cards),o.setCalledLandlordScore(n.become_landlord_record?n.become_landlord_record.score:0),o.setHasCalledLandlord(null!==n.become_landlord_record);var s=n.last_play_card_record,d=[];s&&0!==s.played_cards.length&&(d=s.played_cards.map(function(e){return new DDZCard(e)})),o.setLatestPlayedCards(d),o.setHasPlayedCards(!!n.last_play_card_record),o.setSeatId(String(n.seat)),o.setNickname(n.nickname),o.setProfileImage(n.profile_image),o.setBalanceAmount(n.balance),o.setIsReady(n.ready),o.setTotalScore(n.score),n.last_play_card_record&&this.setLastPlayedCardsCards(n),this.setLastCalledLandlordScore(n),o.getActive()&&(this.activePlayer=o),t.push(o)}return t},e.prototype.setLastCalledLandlordScore=function(e){var t=e.become_landlord_record;t&&this.calledLandlordScore<t.score&&(this.calledLandlordScore=t.score)},e.prototype.setLastPlayedCardsCards=function(e){var t=e.last_play_card_record;if(this.lastPlayedCardsDate){var a=new Date(t.created_at);if(this.lastPlayedCardsDate<a){var r=t.played_cards.map(function(e){return new DDZCard(e)});0!==r.length&&(this.lastPlayedCardsDate=a,this.lastPlayedCards=r,this.lastPlayedCardsPlayer=e.id)}}else{var r=t.played_cards.map(function(e){return new DDZCard(e)});0!==r.length&&(this.lastPlayedCardsDate=new Date(t.created_at),this.lastPlayedCards=r,this.lastPlayedCardsPlayer=e.id)}},e}();e.Room=a,__reflect(a.prototype,"DDZGameState.Room");var r=function(){function e(){}return e.BECOMING_LANDLORD="becoming_landlord",e.PLAYING_CARD="playing_card",e.WAITING="waiting",e.IDLING="idling",e.GAME_BEEN_RESTORED="game_has_been_restored",e}();e.Type=r,__reflect(r.prototype,"DDZGameState.Type")}(DDZGameState||(DDZGameState={}));var DDZPlayerFactory=function(){function e(){}return e.make=function(e){return e.map(function(e){var t=new DDZPlayerModel({id:e.id});return t.setServiceId(e.service_id||""),t.setActive(!1),t.setTimerValue(0),t.setCardsAmount(0),t.setCards([]),t.setCalledLandlordScore(0),t.setHasCalledLandlord(!1),t.setLatestPlayedCards([]),t.setSeatId(String(e.seat)),t.setNickname(e.nickname),t.setProfileImage(e.profile_image),t.setBalanceAmount(e.balance),t.setIsReady(e.ready),t})},e.makeLeftPlayerModel=function(t,a){switch(t){case"1":return e.getPlayerModelBySeatId("3",a);case"2":return e.getPlayerModelBySeatId("1",a);case"3":return e.getPlayerModelBySeatId("2",a);default:return}},e.makeRightPlayerModel=function(t,a){switch(t){case"1":return e.getPlayerModelBySeatId("2",a);case"2":return e.getPlayerModelBySeatId("3",a);case"3":return e.getPlayerModelBySeatId("1",a);default:return}},e.getPlayerModelBySeatId=function(e,t){for(var a=0,r=t;a<r.length;a++){var n=r[a];if(n.getSeatId()===e)return n}},e}();__reflect(DDZPlayerFactory.prototype,"DDZPlayerFactory");var DDZServerMessageMonitor=function(){function e(){this.reset()}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.reset=function(){this.updatedAt=new Date(-864e13),this.latestReceivedMessageDate=new Date},e.prototype.setUpdatedAt=function(e){this.updatedAt=e},e.prototype.getUpdatedAt=function(){return this.updatedAt},e.prototype.setLatestReceivedMessageDate=function(e){this.latestReceivedMessageDate=e},e.prototype.isLatestMessageMoreThan30s=function(){var e=new Date,t=(e.getTime()-this.latestReceivedMessageDate.getTime())/1e3;return t>30},e}();__reflect(DDZServerMessageMonitor.prototype,"DDZServerMessageMonitor");var TestMain=function(e){function t(){var t=e.call(this)||this,a=new TestGameModel("test_game_model");a.startTest();var r=new TestUserActionModel("test.user.http.action.model");r.startTest();var n=new TestDDZUserChannelModel("test.user.channel.model");return n.startTest(),t}return __extends(t,e),t}(eui.UILayer);__reflect(TestMain.prototype,"TestMain");var HttpActionModel=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.executeGet=function(e,t,a){},t.prototype.executePost=function(e,t,a){var r={url:e.url,header:e.needAuthorization?this.headerWithAuthorization():this.headerWithoutAuthorization(),body:e.body};this.postReturnJson(r,function(e){t(e)},function(e){a(e)})},t}(QPNetworkApi);__reflect(HttpActionModel.prototype,"HttpActionModel",["IHttpAction"]);var QPApiConfig=function(){function e(){}return Object.defineProperty(e,"Host",{get:function(){return QPHostModel.sharedInstance().getFatestProxyHost()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MediaHost",{get:function(){return QPHostModel.sharedInstance().getImageHost()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WSS_HOST",{get:function(){var e=QPHostModel.sharedInstance().getFatestProxyHost(),t=/https/gi;return e?e.replace(t,"wss"):void 0},enumerable:!0,configurable:!0}),e.DownloadHost="https://www.laiwan.io/download",e.V1="v1",e.WEBSOCKET_V1="v1",e}();__reflect(QPApiConfig.prototype,"QPApiConfig");var STAGING_IMAGE_HOST="https://avatar.staging.laiwan.shafayouxi.com",PRODUCTION_IMAGE_HOST="https://avatar.production.laiwan.shafayouxi.com",INTERNAL_STAGING_PROXY_HOSTS=["https://1.cn.api.staging.laiwan.shafayouxi.com","https://3.cn.api.staging.laiwan.shafayouxi.com","https://6.cn.api.staging.laiwan.shafayouxi.com","https://7.cn.api.staging.laiwan.shafayouxi.com","https://8.cn.api.staging.laiwan.shafayouxi.com","https://9.cn.api.staging.laiwan.shafayouxi.com","https://10.us.api.staging.laiwan.shafayouxi.com","https://12.nl.api.staging.laiwan.shafayouxi.com","https://16.jp.api.staging.laiwan.shafayouxi.com"],INTERNAL_PRODUCTION_PROXY_HOST=["https://1.cn.api.production.laiwan.shafayouxi.com","https://3.cn.api.production.laiwan.shafayouxi.com","https://6.cn.api.production.laiwan.shafayouxi.com","https://7.cn.api.production.laiwan.shafayouxi.com","https://8.cn.api.production.laiwan.shafayouxi.com","https://9.cn.api.production.laiwan.shafayouxi.com","https://10.us.api.production.laiwan.shafayouxi.com","https://12.nl.api.production.laiwan.shafayouxi.com","https://16.jp.api.production.laiwan.shafayouxi.com"],QPHostModel=function(e){function t(){var t=e.call(this)||this;t.availableHosts=[],t.occupiedHostIndex=0;var a=RES.getRes("app_version_json");return t.isStagingEnvironment=a.is_staging,t}return __extends(t,e),t.sharedInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.getImageHost=function(){return this.isStagingEnvironment?STAGING_IMAGE_HOST:PRODUCTION_IMAGE_HOST},t.prototype.getFatestProxyHost=function(){return 0!==this.availableHosts.length?(this.availableHosts.length<=this.occupiedHostIndex&&(this.occupiedHostIndex=0),this.availableHosts[this.occupiedHostIndex]):void 0},t.prototype.switchNextAvailableHost=function(){this.occupiedHostIndex+=1},t.prototype.sortProxyHostByConnectSpeed=function(e){var t=this,a=this.listProxyHosts(),r=a.length,n=0,o=!1;a.forEach(function(a){t.connectHost(a,function(i,s){n+=1,i?console.log("connectProcyHost error ",i.message):s&&"normal"===s.server_load&&(t.availableHosts.push(a),o||(e(),o=!0)),o||n!==r||(e(),o=!0)})})},t.prototype.connectHost=function(e,t){var a={url:e+"/node/v1/status",header:{}};this.fetchJson(a,function(e){t(null,e)},function(e){t(e,null)})},t.prototype.listProxyHosts=function(){return this.isStagingEnvironment?INTERNAL_STAGING_PROXY_HOSTS:INTERNAL_PRODUCTION_PROXY_HOST},t}(QPNetworkApi);__reflect(QPHostModel.prototype,"QPHostModel");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,a,r){function n(e){t.call(r,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),a.call(r))}var i=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,a){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},i)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var d=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(d,function(a){window.JSONParseClass.setData(a),egret.callLater(function(){t.call(r,generateJSON.paths[e])},i)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var QPNetworkErrorType;!function(e){e[e.None=0]="None",e[e.UserNotFound=1]="UserNotFound",e[e.NotThisPlayerTurn=2]="NotThisPlayerTurn",e[e.WrongCardType=3]="WrongCardType",e[e.ClientCheckedWrongCardType=4]="ClientCheckedWrongCardType",e[e.RoomDurationExpired=5]="RoomDurationExpired",e[e.TimeOut=6]="TimeOut"}(QPNetworkErrorType||(QPNetworkErrorType={}));var QPNetworkError=function(){function e(e){this.message=e.message,"user_not_found"===e.error_type?this.type=QPNetworkErrorType.UserNotFound:"not_this_player_turn"===e.error_type?this.type=QPNetworkErrorType.NotThisPlayerTurn:"wrong_card_type"===e.error_type?this.type=QPNetworkErrorType.WrongCardType:"client_checked_wrong_card_type"===e.error_type?this.type=QPNetworkErrorType.ClientCheckedWrongCardType:"request_time_out"===e.error_type?this.type=QPNetworkErrorType.TimeOut:"room_duration_expired"===e.error_type?this.type=QPNetworkErrorType.RoomDurationExpired:this.type=QPNetworkErrorType.None}return e.prototype.mustBeHandled=function(){return this.type===QPNetworkErrorType.NotThisPlayerTurn?!0:this.type===QPNetworkErrorType.WrongCardType?!0:this.type===QPNetworkErrorType.UserNotFound?!0:!1},e}();__reflect(QPNetworkError.prototype,"QPNetworkError");var UserModel=function(e){function t(){var t=e.call(this)||this;return t.actionModel=new UserActionModel,t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.setActionDataFactory=function(e){this.actionDataFactory=e},t.prototype.setAttributeModel=function(e){this.attributeModel=e},t.prototype.setInputtedAttributeModel=function(e){this.inputtedAttributeModel=e},t.prototype.setRoomModel=function(e){this.roomModel=e},t.prototype.signOut=function(e,t){DDZUserChannelModel.sharedInstance().unsubscribe(),DDZGameServiceModel.sharedInstance().stop(),this.attributeModel.cleanCommunicationAttribute(),t()},t.prototype.deleteAccount=function(){this.attributeModel.setId(void 0),this.attributeModel.setHasSignUp(!1),this.attributeModel.setHasBindPhoneNumber(!1)},t.prototype.verifyIAPReceipt=function(e,t){var a={url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/iap/transaction",header:this.headerWithAuthorization(),body:{user_id:this.attributeModel.getId(),receipt_data:e}};this.postReturnJson(a,function(e){t()},function(e){t(e)})},t.prototype.joinGame=function(e,t){var a=this,r={url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/doudizhu/basic/join",header:this.headerWithAuthorization()};this.postReturnJson(r,function(e){egret.log("加入房间http请求成功")},function(e){t(e)}),DDZUserChannelModel.sharedInstance().roomMessageReceivedHandler=function(t){for(var r={roomId:t.roomId,baseScore:0,playerModels:t.playerModels},n=0,o=t.playerModels;n<o.length;n++){var i=o[n];i.getId()===a.attributeModel.getId()&&a.setBalance(i.getBalanceAmount())}e(r)}},t.prototype.modifyUserInformation=function(e,t){var a=this;if(e.nickname.countByte()<6)return void t(new QPNetworkError({message:"您的用户名不能少于2个中文或者6个英文字母"}));if(21<e.nickname.countByte())return void t(new QPNetworkError({message:"您的用户名不能多余7个中文或者21个英文字母"}));var r={header:this.headerWithAuthorization(),body:{nickname:e.nickname},url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/profile/"};this.postReturnJson(r,function(e){a.attributeModel.setNickname(e.nickname),t()},function(e){t(e)})},t.prototype.connectRealtimeGameService=function(e){var t=this,a={user_id:this.attributeModel.getId(),timestamp:this.attributeModel.getTimestamp(),host:QPApiConfig.WSS_HOST,version:QPApiConfig.WEBSOCKET_V1,access_token:this.attributeModel.getAccessToken(),info:this.attributeModel.getInfo(),token:this.attributeModel.getToken()};DDZGameServiceModel.sharedInstance().start(a,function(){DDZUserChannelModel.sharedInstance().subscribe(t.attributeModel.getChannel(),function(t){return t?void e(new QPNetworkError({message:t.message})):(DDZUserChannelModel.sharedInstance().setMessageCounter(new DDZGameServiceMessageCounter),void e())})})},t.prototype.addBalance=function(e){this.wallet.add(e),this.attributeModel.setBalanceAmount(this.wallet.getAvailableAmount())},t.prototype.isDataValid=function(e){return!!e.websocket_token.channels},t.prototype.saveUserInformation=function(e){this.attributeModel.setAccessToken(e.auth.access_token),this.attributeModel.setId(e.user.id),this.attributeModel.setServiceId(e.user.service_id),this.attributeModel.setNickname(e.user.nickname),e.user.wallet&&(this.wallet=new UserWallet(e.user.wallet[0]),this.attributeModel.setBalanceAmount(this.wallet.getAvailableAmount())),e.websocket_token.channels?this.attributeModel.setChannel(e.websocket_token.channels.doudizhu):this.attributeModel.setChannel(e.websocket_token.user_channel),this.attributeModel.setInfo(e.websocket_token.info),this.attributeModel.setTimestamp(e.websocket_token.timestamp),this.attributeModel.setToken(e.websocket_token.token)},t.prototype.setBalance=function(e){this.wallet.setAvailableAmount(e),this.attributeModel.setBalanceAmount(this.wallet.getAvailableAmount())},t.instance=void 0,t}(QPNetworkApi);__reflect(UserModel.prototype,"UserModel");var UserWallet=function(){function e(e){this.name=e.currency,this.availableAmount=Number(e.balance),this.frozenAmount=Number(e.frozen_amount),this.totalAmount=Number(e.total_amount)}return e.prototype.add=function(e){this.availableAmount+=e,this.update()},e.prototype.setAvailableAmount=function(e){this.availableAmount=e,this.update()},e.prototype.getAvailableAmount=function(){return this.availableAmount},e.prototype.update=function(){this.totalAmount=this.availableAmount+this.frozenAmount;var e=new DDZDataEvent(DDZDataEvent.UPDATE);DDZEventCenter.sharedInstance().dispatchEvent(e)},e}();__reflect(UserWallet.prototype,"UserWallet",["IWallet"]);var PhoneUserActionDataFactory=function(){function e(){}return e.prototype.makeSendVerificationCodeData=function(){return new SendVerificationCodeData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber()})},e.prototype.makeSignUpData=function(){return new PhoneSignUpData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber(),password:UserModel.sharedInstance().inputtedAttributeModel.getPassword(),username:UserModel.sharedInstance().inputtedAttributeModel.getUsername(),nickname:UserModel.sharedInstance().inputtedAttributeModel.getNickname(),birthday:UserModel.sharedInstance().inputtedAttributeModel.getBirthday(),verification_code:UserModel.sharedInstance().inputtedAttributeModel.getVerificationCode(),hash_digest:UserModel.sharedInstance().attributeModel.getHashDigest(),expire_iso_time:UserModel.sharedInstance().attributeModel.getExpireISOTime()})},e.prototype.makeSignInData=function(){return new PhoneAndPasswordSignInData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber(),password:UserModel.sharedInstance().inputtedAttributeModel.getPassword()})},e.prototype.makeSignOutData=function(){},e.prototype.makeBindPhoneData=function(){throw new Error("电话登录用户不用绑定手机号")},e.prototype.makeCreatePersonalRoomData=function(){return new CreatePersonalRoomData({})},e.prototype.makeJoinPersonalRoomData=function(e){return new JoinPersonalRoomData({room_id:e})},e.prototype.makeReadyGameData=function(){return new ReadyGameData({})},e.prototype.makePhoneAndCodeSignInData=function(){return new PhoneAndVerifyCodeSignInData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber(),verification_code:UserModel.sharedInstance().inputtedAttributeModel.getVerificationCode(),hash_digest:UserModel.sharedInstance().attributeModel.getHashDigest(),expire_iso_time:UserModel.sharedInstance().attributeModel.getExpireISOTime()})},e}();__reflect(PhoneUserActionDataFactory.prototype,"PhoneUserActionDataFactory",["IUserActionDataFactory"]);var UserActionModel=function(){function e(){this.httpAction=new HttpActionModel,this.isAgreementReaded=DDZCacheModel.sharedInstance().booleanForKey(e.SAVE_READ_AGREEMENT_KEY),this.isAgreementApproved=DDZCacheModel.sharedInstance().booleanForKey(e.SAVE_APPROVED_AGREEMENT_KEY)}return e.prototype.readAgreement=function(){this.isAgreementReaded=!0,DDZCacheModel.sharedInstance().setBoolean(e.SAVE_READ_AGREEMENT_KEY,this.isAgreementReaded)},e.prototype.approveAgreement=function(t){this.isAgreementApproved=t,DDZCacheModel.sharedInstance().setBoolean(e.SAVE_APPROVED_AGREEMENT_KEY,this.isAgreementApproved)},e.prototype.sendVerificationCode=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},e.prototype.signUp=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},e.prototype.signIn=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},e.prototype.signOut=function(e,t,a){},e.prototype.bindPhone=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},e.prototype.createPersonalRoom=function(e,t,a){this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)})},e.prototype.joinPersonalRoomById=function(e){var t=this;return new Promise(function(a,r){return e.isLegal?void t.httpAction.executePost(e,function(e){a(e)},function(e){r(e)}):void r(new QPNetworkError({message:e.validateMessage}))})},e.prototype.readyGame=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},e.SAVE_READ_AGREEMENT_KEY="save.user.is.read.agreement.key",e.SAVE_APPROVED_AGREEMENT_KEY="save.user.is.approved.agreement.key",e}();__reflect(UserActionModel.prototype,"UserActionModel",["IUserAction"]);var BindPhoneData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.password=t.password,a.body.verification_code=t.verification_code,a.body.hash_digest=t.hash_digest,a.body.expire_iso_time=t.expire_iso_time,a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/bind_phone/",a}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.phone_number?e.phone_number.length<11?void(this.validateMessage="请输入正确的电话号码"):e.password?e.password.length<6?void(this.validateMessage="密码长度不能小于6"):50<e.password.length?void(this.validateMessage="密码长度不能大于50"):e.verification_code?6!==e.verification_code.length?void(this.validateMessage="请输入6位数验证码"):void(this.isLegal=!0):void(this.validateMessage="请输入验证码"):void(this.validateMessage="请输入密码"):void(this.validateMessage="请输入电话号码")},t}(HttpActionData);__reflect(BindPhoneData.prototype,"BindPhoneData");var SendVerificationCodeData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.application="laiwan",a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/sms/code/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.phone_number?e.phone_number.length<11?(this.validateMessage="请输入正确的电话号码",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入电话号码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(SendVerificationCodeData.prototype,"SendVerificationCodeData");var CreatePersonalRoomData=function(e){function t(t){var a=e.call(this,t)||this;return a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/room",a}return __extends(t,e),t.prototype.validate=function(e){this.isLegal=!0},t}(HttpActionData);__reflect(CreatePersonalRoomData.prototype,"CreatePersonalRoomData");var JoinPersonalRoomData=function(e){function t(t){var a=e.call(this,t)||this;return a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/room/"+t.room_id+"/join",a}return __extends(t,e),t.prototype.validate=function(e){return e.room_id?void(this.isLegal=!0):(this.validateMessage="请提供房间号",void(this.isLegal=!1))},t}(HttpActionData);__reflect(JoinPersonalRoomData.prototype,"JoinPersonalRoomData");var ReadyGameData=function(e){function t(t){var a=e.call(this,t)||this;return a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/ready",a}return __extends(t,e),t.prototype.validate=function(e){this.isLegal=!0},t}(HttpActionData);__reflect(ReadyGameData.prototype,"ReadyGameData");var PhoneAndPasswordSignInData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.password=t.password,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/login/phone/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.phone_number?e.phone_number.length<11?(this.validateMessage="请输入正确的电话号码",void(this.isLegal=!1)):e.password?e.password.length<6?(this.validateMessage="密码长度不能小于6",void(this.isLegal=!1)):50<e.password.length?(this.validateMessage="密码长度不能大于50",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入密码",void(this.isLegal=!1)):(this.validateMessage="请输入电话号码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(PhoneAndPasswordSignInData.prototype,"PhoneAndPasswordSignInData");var PhoneAndVerifyCodeSignInData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.verification_code=t.verification_code,a.body.hash_digest=t.hash_digest,a.body.expire_iso_time=t.expire_iso_time,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/login/web/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.country_code?e.phone_number?String(e.phone_number).isValidPhoneNumber()?e.verification_code?String(e.verification_code).isValidVerificationCode()?void(this.isLegal=!0):void(this.validateMessage="请输入正确的验证码"):void(this.validateMessage="请输入验证码"):void(this.validateMessage="请输入正确的电话号码"):void(this.validateMessage="请输入电话号码"):void(this.validateMessage="请输入国家代码")},t}(HttpActionData);__reflect(PhoneAndVerifyCodeSignInData.prototype,"PhoneAndVerifyCodeSignInData");var TouristSignInData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.user_id=t.user_id,a.body.password=t.password,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/login/anonymous/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.user_id?e.password?e.password.length<6?(this.validateMessage="密码长度不能小于6",void(this.isLegal=!1)):50<e.password.length?(this.validateMessage="密码长度不能大于50",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入密码",void(this.isLegal=!1)):(this.validateMessage="没有用户名",void(this.isLegal=!1))},t}(HttpActionData);__reflect(TouristSignInData.prototype,"TouristSignInData");var PhoneSignUpData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.username=t.username,a.body.nickname=t.nickname,a.body.birthday=t.birthday,a.body.password=t.password,a.body.verification_code=t.verification_code,a.body.hash_digest=t.hash_digest,a.body.expire_iso_time=t.expire_iso_time,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/register/phone/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.phone_number?e.phone_number.length<11?void(this.validateMessage="请输入正确的电话号码"):e.password?e.password.length<6?void(this.validateMessage="密码长度不能小于6"):50<e.password.length?void(this.validateMessage="密码长度不能大于50"):e.verification_code?6!==e.verification_code.length?void(this.validateMessage="请输入6位数验证码"):void(this.isLegal=!0):void(this.validateMessage="请输入验证码"):void(this.validateMessage="请输入密码"):void(this.validateMessage="请输入电话号码")},t}(HttpActionData);__reflect(PhoneSignUpData.prototype,"PhoneSignUpData");var TouristRegisterData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.password=t.password,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/register/anonymous/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.password?e.password.length<6?(this.validateMessage="密码长度不能小于6",void(this.isLegal=!1)):50<e.password.length?(this.validateMessage="密码长度不能大于50",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入密码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(TouristRegisterData.prototype,"TouristRegisterData");var InputtedAttributeModel=function(){function e(){this.countryCode="86"}return e.prototype.setCountryCode=function(e){this.countryCode=e},e.prototype.getCountryCode=function(){return this.countryCode},e.prototype.setPhoneNumber=function(e){this.phoneNumber=e},e.prototype.getPhoneNumber=function(){return this.phoneNumber},e.prototype.setPassword=function(e){this.password=e},e.prototype.getPassword=function(){return this.password},e.prototype.setVerificationCode=function(e){this.verificationCode=e},e.prototype.getVerificationCode=function(){return this.verificationCode},e.prototype.setFirstName=function(e){this.firstName=e},e.prototype.getFirstName=function(){return this.firstName},e.prototype.setLastName=function(e){this.lastName=e},e.prototype.getLastName=function(){return this.lastName},e.prototype.hasAccountAndPassword=function(){return this.phoneNumber&&this.password?!0:!1},e.prototype.hasNickname=function(){return this.firstName||this.lastName?!0:!1},e.prototype.getNickname=function(){var e="";return this.firstName&&(e+=this.firstName),this.lastName&&(e+=this.lastName),e},e.prototype.setUsername=function(e){this.username=e},e.prototype.getUsername=function(){return this.username},e.prototype.setBirthday=function(e){this.birthday=e},e.prototype.getBirthday=function(){return this.birthday},e}();__reflect(InputtedAttributeModel.prototype,"InputtedAttributeModel",["IInputtedAttribute"]);var PhoneUserAttributeModel=function(e){function t(){var a=e.call(this)||this;return a.hasSignUp=DDZCacheModel.sharedInstance().booleanForKey(t.SIGN_UP_STATE_KEY),a}return __extends(t,e),t.prototype.setHasSignUp=function(e){this.hasSignUp=e,DDZCacheModel.sharedInstance().setBoolean(t.SIGN_UP_STATE_KEY,e)},t.SIGN_UP_STATE_KEY="phone.user.register.state.key",t}(BaseUserAttributeModel);__reflect(PhoneUserAttributeModel.prototype,"PhoneUserAttributeModel");var RoomModel=function(){function e(){}return e.prototype.setPin=function(e){QPCrossPlatformCommunication.transformPin(e),this.pin=e},e.prototype.getPin=function(){return this.pin},e.prototype.setHouseNumber=function(e){this._houseNumber=e},e.prototype.getHouseNumber=function(){return this._houseNumber},e.prototype.setId=function(e){this.id=e},e.prototype.getId=function(){return this.id},e.prototype.setPlayers=function(e){this.players=[];for(var t=0,a=e;t<a.length;t++){var r=a[t],n=new DDZPlayerModel({id:r.id});n.setServiceId(r.username),n.setNickname(r.nickname),n.setSeatId(String(r.seat)),n.setIsReady(r.ready),this.players.push(n)}},e.prototype.getPlayers=function(){return this.players},e.prototype.setClubName=function(e){this.clubName=e},e.prototype.getClubName=function(){return this.clubName},e.prototype.setRoomName=function(e){this.roomName=e},e.prototype.getRoomName=function(){return this.roomName},e}();__reflect(RoomModel.prototype,"RoomModel",["IRoom","IClubRoom"]);var TestUserActionModel=function(e){function t(t){var a=e.call(this,t)||this;return a.actionModel=new UserActionModel,a}return __extends(t,e),t.prototype.startTest=function(){this.testGetVerificationCode(),this.testPhoneSignIn(),this.testCreatePersonalRoom(),this.testJoinPersonalRoomById(),this.testContinueGame()},t.prototype.testGetVerificationCode=function(){var e=this,t=new SendVerificationCodeData({country_code:"86",phone_number:"65535000000000"});this.actionModel.sendVerificationCode(t,function(t){e.assert("测试请求发送验证码",!0),e.hashDigest=t.hash_digest,e.expireISOTime=t.expire_iso_time,e.testPhoneSignUp()},function(t){e.assert("测试请求发送验证码",!1)})},t.prototype.testPhoneSignUp=function(){var e=this,t=new PhoneSignUpData({country_code:"86",phone_number:"65535000000000",password:"qwerty",verification_code:"123456",hash_digest:this.hashDigest,expire_iso_time:this.expireISOTime,username:"ieffffff",nickname:"David Lee",birthday:"2000-01-01"});this.actionModel.signUp(t,function(t){e.assert("测试用户手机注册",!0)},function(t){e.assert("测试用户手机注册 "+t.message,!1)})},t.prototype.testPhoneSignIn=function(){var e=this,t=new PhoneAndPasswordSignInData({country_code:"86",phone_number:"65535000000000",password:"123456"});this.actionModel.signIn(t,function(t){e.assert("手机密码登录",!0)},function(t){e.assert("手机密码登录 : "+t.message,!1)})},t.prototype.testCreatePersonalRoom=function(){var e=this,t=new CreatePersonalRoomData({});this.actionModel.createPersonalRoom(t,function(t){UserModel.sharedInstance().roomModel.setPin(t.pin),UserModel.sharedInstance().roomModel.setId(t.id),UserModel.sharedInstance().roomModel.setPlayers(t.players),e.assertEquals("房间的pin应该是 "+t.pin,t.pin,UserModel.sharedInstance().roomModel.getPin()),e.assertEquals("房间的id应该是 "+t.id,t.id,UserModel.sharedInstance().roomModel.getId()),e.assertEquals("房间的玩家数应该是 "+t.players.length,t.players.length,UserModel.sharedInstance().roomModel.getPlayers().length)
},function(t){e.assert("创建私人房间出错，错误是："+t.message,!1)})},t.prototype.testJoinPersonalRoomById=function(){return __awaiter(this,void 0,void 0,function(){var e,t,a;return __generator(this,function(r){switch(r.label){case 0:e=new JoinPersonalRoomData({pin:UserModel.sharedInstance().roomModel.getPin()}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.actionModel.joinPersonalRoomById(e)];case 2:return t=r.sent(),UserModel.sharedInstance().roomModel.setPlayers(t.players),this.assertEquals("房间的玩家数应该是 "+t.players.length,t.players.length,UserModel.sharedInstance().roomModel.getPlayers().length),this.assertEquals("房间邀请码应该是 "+t.pin,t.pin,UserModel.sharedInstance().roomModel.getPin()),[3,4];case 3:return a=r.sent(),this.assert("加入个人房间出错，错误是："+a.message,!1),[3,4];case 4:return[2]}})})},t.prototype.testContinueGame=function(){var e=this,t=new ReadyGameData({});this.actionModel.readyGame(t,function(t){e.assertEquals("返回的数据ok应该为true",!0,t.ok)},function(t){e.assert("继续游戏发生错误 : "+t.message,!1)})},t}(QPTestCase);__reflect(TestUserActionModel.prototype,"TestUserActionModel");var DDZPlayGameDebugWindow=function(e){function t(){var t=e.call(this)||this;return t.messageCount=0,t}return __extends(t,e),t.prototype.setRoomId=function(e){this.roomIdLabel.text="房间："+e},t.prototype.setServerAddress=function(e){this.serverLabel.text="服务器: "+e},t.prototype.setGameMatchId=function(e){e&&(this.gameMatchIdLabel.text="游戏："+e)},t.prototype.addMessage=function(e){if(e){var t=JSON.stringify(e),a=new eui.Label(t);a.textColor=16777215,a.size=25,a.y=50*this.messageCount,this.contentGroup.addChild(a),this.messageCount+=1}},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.contentScroller.viewport=this.contentGroup;var t=RES.getRes("app_version_json");this.setAppVersion(t.version)},t.prototype.setAppVersion=function(e){this.appVersionLabel.text="版本："+e},t}(QPLayer);__reflect(DDZPlayGameDebugWindow.prototype,"DDZPlayGameDebugWindow");var DDZPlayGameScene=function(e){function t(t){var a=e.call(this)||this;return a.skinName="DDZPlayGameSceneUI",a.gameModel=t,a.setup(),a}return __extends(t,e),t.prototype.onEnter=function(){var t=this;e.prototype.onEnter.call(this),QPResource.AsyncLoader.sharedInstance().start(),this.addListeners(),this.loopPlayerState(),window.document.addEventListener("message",function(e){var a=JSON.parse(e.data);"query_game_is_started"===a.command&&QPCrossPlatformCommunication.postGameIsStarted(t.gameModel.isStarted)})},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.gameModel.removeGameService(),this.gameModel=void 0,this.removeListeners(),this.matchPlayerView.hide(),this.stopLoopPlayerState(),window.document.removeEventListener("message",function(e){})},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.playMusic(),this.setPlayersCharacterImage(),this.bottomPlayerStateView.hideAllState(),this.setLeftPlayerViewVisible(!1),this.leftPlayerView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showLeftPlayerDetailInfo,this),this.setRightPlayerViewVisible(!1),this.rightPlayerView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRightPlayerDetailInfo,this),this.bottomPlayerView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showBottomPlayerDetailInfo,this),this.showPlayers();var t=UserModel.sharedInstance().roomModel.getHouseNumber().replace(/(.{3})/g,"$1 ");UserModel.sharedInstance().roomModel.getRoomName()?(this.clubNameLabel.text="俱乐部："+UserModel.sharedInstance().roomModel.getClubName(),this.roomLabel.text="牌局："+UserModel.sharedInstance().roomModel.getRoomName()):(this.clubNameLabel.text="",this.roomLabel.text="房间："+t)},t.prototype.childrenCreated=function(){if(e.prototype.childrenCreated.call(this),DDZGameState.Model.sharedInstance().isInGame()){var t={playCardGameRestored:this.playCardGameRestored.bind(this),becomeLandlordGameRestored:this.becomeLandlordGameRestored.bind(this)};this.gameModel.restoreGame(t)}DDZGameState.Model.sharedInstance().isWaiting()&&!this.gameModel.bottomPlayerModel.getIsReady()&&this.showGameOverLayer(),this.updateDebugWindowContent(),this.showInvitePlayerPopup()},t.prototype.updateDebugWindowContent=function(){this.debugWindow.setRoomId(this.gameModel.game.roomId),this.debugWindow.setServerAddress(QPApiConfig.Host),this.debugWindow.setGameMatchId(this.gameModel.game.getMatchId())},t.prototype.showInvitePlayerPopup=function(){this.gameModel.isPlayersFull()||this.isPlayerLeaveAlertShow||(this.resetAll(),this.removeGameOverLayer(),QPCrossPlatformCommunication.showInviteFriends(!0))},t.prototype.resetAll=function(){this.reset(),this.gameModel.resetScore(),this.gameModel.isLeftPlayerExist()&&this.leftPlayerView.setScore(0),this.gameModel.isRightPlayerExist()&&this.rightPlayerView.setScore(0),this.bottomPlayerView.setScore(0)},t.prototype.hideInvitePlayerPopup=function(){QPCrossPlatformCommunication.showInviteFriends(!1)},t.prototype.addListeners=function(){DDZEventCenter.sharedInstance().addEventListener(DDZHandCardEvent.TOUCHED,this.handCardTouched,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.PLAY_CARD,this.playCard,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.HINT,this.hint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.NOT_PLAY_CARD,this.notPlayCardButtonPressed,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.NOT_CALL_LANDLORD,this.notCallLandlord,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.CALL_ONE_POINT,this.callOnePoint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.CALL_TWO_POINT,this.callTwoPoint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.CALL_THREE_POINT,this.callThreePoint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.START_GAME,this.startMatchPlayer,this),DDZEventCenter.sharedInstance().addEventListener(DDZDebugEvent.DEBUG_ROOM_CHANNEL,this.receiveDebugMessage,this),DDZEventCenter.sharedInstance().addEventListener(DDZMusicEvent.PLAY_MUSIC_EVENT,this.playMusic,this),DDZEventCenter.sharedInstance().addEventListener(DDZMusicEvent.STOP_MUSIC_EVENT,this.stopMusic,this),DDZEventCenter.sharedInstance().addEventListener(DDZWebsocketEvent.MISS_MESSAGE_EVENT,this.forceFetchPlayerState,this)},t.prototype.removeListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZHandCardEvent.TOUCHED,this.handCardTouched,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.PLAY_CARD,this.playCard,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.HINT,this.hint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.NOT_PLAY_CARD,this.notPlayCardButtonPressed,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.NOT_CALL_LANDLORD,this.notCallLandlord,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.CALL_ONE_POINT,this.callOnePoint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.CALL_TWO_POINT,this.callTwoPoint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.CALL_THREE_POINT,this.callThreePoint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.START_GAME,this.startMatchPlayer,this),DDZEventCenter.sharedInstance().removeEventListener(DDZDebugEvent.DEBUG_ROOM_CHANNEL,this.receiveDebugMessage,this),DDZEventCenter.sharedInstance().removeEventListener(DDZMusicEvent.PLAY_MUSIC_EVENT,this.playMusic,this),DDZEventCenter.sharedInstance().removeEventListener(DDZMusicEvent.STOP_MUSIC_EVENT,this.stopMusic,this),DDZEventCenter.sharedInstance().removeEventListener(DDZWebsocketEvent.MISS_MESSAGE_EVENT,this.forceFetchPlayerState,this)},t.prototype.receiveDebugMessage=function(e){this.debugWindow.addMessage(e.messageObject)},t.prototype.setLeftPlayerViewVisible=function(e){e?this.leftPlayerView.showLandlordSign(this.gameModel.leftPlayerModel.getIsLandlord()):this.leftPlayerPlayedCardListView.visible=!1,this.leftPlayerView.visible=e,this.leftPlayerGameInfoView.visible=e},t.prototype.setRightPlayerViewVisible=function(e){e?this.rightPlayerView.showLandlordSign(this.gameModel.rightPlayerModel.getIsLandlord()):this.rightPlayerPlayedCardListView.visible=!1,this.rightPlayerView.visible=e,this.rightPlayerGameInfoView.visible=e},t.prototype.setup=function(){this.leftPlayerPlayedCardListView.setAnimation(new DDZCardListLeftToRightAnimation({target:this.leftPlayerPlayedCardListView.cardList})),this.rightPlayerPlayedCardListView.setAnimation(new DDZCardListRightToLeftAnimation({target:this.rightPlayerPlayedCardListView.cardList})),this.bottomPlayerHandCardsView.dealCardAnimationDidFinishedHandler=this.startCallingLandlord.bind(this),this.gameModel.showPlayerHandler=this.showPlayers.bind(this),this.gameModel.playerJoinRoomHandler=this.playerJoinRoom.bind(this),this.gameModel.hidePlayerHandler=this.hidePlayer.bind(this),this.gameModel.playerPlayedCardsHandler=this.playerPlayedCards.bind(this),this.gameModel.nextPlayCardPlayerHandler=this.nextPlayCardPlayer.bind(this),this.gameModel.nextCallLandlordPlayerHandler=this.nextCallLandlordPlayer.bind(this),this.gameModel.playerCalledLandlordHandler=this.showPlayerCallLandlordResult.bind(this),this.gameModel.dealCardsHandler=this.dealCards.bind(this),this.gameModel.resetGameHandler=this.reset.bind(this),this.gameModel.gameLandlordConfirmedHandler=this.gameLandlordHasBeenConfirmed.bind(this),this.gameModel.playerReadyStateChangedHandler=this.updatePlayerReadyState.bind(this),this.gameModel.gameOverHandler=this.gameOver.bind(this),this.gameModel.forceGameOverHandler=this.forceGameOver.bind(this)},t.prototype.leaveGamePressed=function(){var e=this;return this.gameModel.isStarted?(QPAlert.sharedInstance().showCancelAndOkButtonAt(this,"退出后，其他玩家将无法继续本局游戏。","确定退出游戏吗？"),void(QPAlert.sharedInstance().pressedOKHandler=function(){e.leaveGame()})):void this.leaveGame()},t.prototype.leaveGame=function(){var e=this,t=new QPLoadingScene;this.hideInvitePlayerPopup(),t.show("离开房间中"),this.gameModel.bottomPlayerModel.leaveRoom(function(a){return t.hide(),a?void QPAlert.sharedInstance().showOKButtonAt(e,a.message):void QPCrossPlatformCommunication.closeH5Game()})},t.prototype.handCardTouched=function(){if(this.gameModel.bottomPlayerModel.handCardModel.isSelectedCardLegal())this.dispatchEnablePlayCardButtonEvent();else{var e=new DDZButtonEvent(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON);DDZEventCenter.sharedInstance().dispatchEvent(e)}},t.prototype.dispatchEnablePlayCardButtonEvent=function(){var e=new DDZButtonEvent(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.startCallingLandlord=function(){this.gameModel.isBottomPlayerCallingLandlord()?(this.playGameButtonsContainer.showCallLandlordButtons(),this.activePlayerSignView.rotateToBottomPlayer(),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE)):this.gameModel.isLeftPlayerCallingLandlord()?(this.leftPlayerGameInfoView.hideAllState(),this.activePlayerSignView.rotateToLeftPlayer(),this.leftPlayerClock.startCountDown(t.THINK_TIME_VALUE)):this.gameModel.isRightPlayerCallingLandlord()&&(this.rightPlayerGameInfoView.hideAllState(),this.activePlayerSignView.rotateToRightPlayer(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE))},t.prototype.playerPlayedCards=function(e){1===e?this.bottomPlayerPlayedCards():2===e?this.leftPlayerPlayedCards():3===e&&this.rightPlayerPlayedCards()},t.prototype.bottomPlayerPlayedCards=function(){var e=this.gameModel.bottomPlayerModel.listLatestPlayedCards();this.bottomPlayerPlayedCardListView.setCards(e),this.bottomPlayerPlayedCardListView.visible=!0,this.bottomPlayerClock.stopCountDown(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),0===e.length&&this.gameModel.bottomPlayerModel.getHasPlayedCards()?this.bottomPlayerStateView.setState(7):this.bottomPlayerStateView.hideAllState(),this.playGameButtonsContainer.hideAllButtons(),this.dispatchEnablePlayCardButtonEvent()},t.prototype.leftPlayerPlayedCards=function(){if(this.gameModel.isLeftPlayerExist()){this.leftPlayerGameInfoView.reset(),this.leftPlayerClock.stopCountDown(),this.showLeftPlayerPlayedCards();var e=this.gameModel.countLeftPlayerCardsAmount();this.leftPlayerGameInfoView.setRemainCardsCount(e),3>e&&this.leftPlayerGameInfoView.showWarningLightView(),0===e&&this.leftPlayerGameInfoView.hideRemainCardsView()}},t.prototype.showLeftPlayerPlayedCards=function(){if(this.gameModel.isLeftPlayerExist()){var e=this.gameModel.leftPlayerModel.listLatestPlayedCards();if(0===e.length&&this.gameModel.leftPlayerModel.getHasPlayedCards())return void this.leftPlayerGameInfoView.showNotPlayCard();this.leftPlayerPlayedCardListView.visible=!0,this.leftPlayerPlayedCardListView.setCards(e),this.leftPlayerPlayedCardListView.playAnimation()}},t.prototype.rightPlayerPlayedCards=function(){if(this.gameModel.isRightPlayerExist()){this.rightPlayerGameInfoView.reset(),this.rightPlayerClock.stopCountDown(),this.showRightPlayerPlayedCards();var e=this.gameModel.countRightPlayerCardsAmount();this.rightPlayerGameInfoView.setRemainCardsCount(e),3>e&&this.rightPlayerGameInfoView.showWarningLightView(),0===e&&this.rightPlayerGameInfoView.hideRemainCardsView()}},t.prototype.showRightPlayerPlayedCards=function(){if(this.gameModel.isRightPlayerExist()){var e=this.gameModel.rightPlayerModel.listLatestPlayedCards();if(0===e.length&&this.gameModel.rightPlayerModel.getHasPlayedCards())return void this.rightPlayerGameInfoView.showNotPlayCard();this.rightPlayerPlayedCardListView.visible=!0,this.rightPlayerPlayedCardListView.setCards(e),this.rightPlayerPlayedCardListView.playAnimation()}},t.prototype.gameLandlordHasBeenConfirmed=function(){var e=this;this.bottomPlayerHandCardsView.playHideBottomCardsAnimation(function(){e.leftPlayerGameInfoView.reset(),e.rightPlayerGameInfoView.reset(),e.updatePlayersStateAndCards(),e.startPlayingCard()})},t.prototype.updatePlayerReadyState=function(){this.gameModel.isLeftPlayerExist()&&this.leftPlayerGameInfoView.showWaitForReady(!this.gameModel.leftPlayerModel.getIsReady()),this.gameModel.isRightPlayerExist()&&this.rightPlayerGameInfoView.showWaitForReady(!this.gameModel.rightPlayerModel.getIsReady())},t.prototype.updatePlayersStateAndCards=function(){this.matchPlayerView.hide(),this.gameModel.bottomPlayerModel.getHasPlayedCards()?0===this.gameModel.bottomPlayerModel.listLatestPlayedCards().length&&this.bottomPlayerStateView.setState(7):this.bottomPlayerStateView.hideAllState(),this.landlordCardsView.setCards(this.gameModel.game.landlordCards),this.setPlayersCharacterImage(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.bottomPlayerHandCardsView.hideBottomCards(),this.leftPlayerGameInfoView.setRemainCardsCount(this.gameModel.countLeftPlayerCardsAmount()),this.rightPlayerGameInfoView.setRemainCardsCount(this.gameModel.countRightPlayerCardsAmount())},t.prototype.setPlayersCharacterImage=function(){this.gameModel.isLeftPlayerExist()&&this.leftPlayerView.showLandlordSign(this.gameModel.leftPlayerModel.getIsLandlord()),this.gameModel.isRightPlayerExist()&&this.rightPlayerView.showLandlordSign(this.gameModel.rightPlayerModel.getIsLandlord()),this.bottomPlayerView.showLandlordSign(this.gameModel.bottomPlayerModel.getIsLandlord())},t.prototype.playCardGameRestored=function(e){this.updatePlayersStateAndCards(),this.updatePlayerReadyState(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),1===e?(this.makeBottomPlayerPlayCardState(),this.activePlayerSignView.pointToBottomPlayer(),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE)):2===e?(this.makeLeftPlayerPlayCardState(),this.activePlayerSignView.pointToLeftPlayer(),this.leftPlayerClock.startCountDown(t.THINK_TIME_VALUE)):3===e?(this.makeRightPlayerPlayCardState(),this.activePlayerSignView.pointToRightPlayer(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE)):(this.leftPlayerGameInfoView.hideAllState(),this.rightPlayerGameInfoView.hideAllState()),this.updateDebugWindowContent()},t.prototype.becomeLandlordGameRestored=function(e,a){this.updatePlayersStateAndCards(),this.updatePlayerReadyState(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.bottomPlayerHandCardsView.showBottomCards(),1===e?(this.bottomPlayerStateView.hideAllState(),this.showBottomPlayerCallLandlordButtons(a),this.activePlayerSignView.pointToBottomPlayer(),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE)):2===e?(this.leftPlayerGameInfoView.hideAllState(),this.leftPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.activePlayerSignView.pointToLeftPlayer()):3===e&&(this.rightPlayerGameInfoView.hideAllState(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.activePlayerSignView.pointToRightPlayer()),this.gameModel.bottomPlayerModel.getHasCalledLandlord()&&this.showBottomPlayerCallLandlord(this.gameModel.bottomPlayerModel.getCalledLandlordScore()),this.gameModel.leftPlayerModel.getHasCalledLandlord()&&this.showLeftPlayerCallLandlord(this.gameModel.leftPlayerModel.getCalledLandlordScore()),this.gameModel.rightPlayerModel.getHasCalledLandlord()&&this.showRightPlayerCallLandlord(this.gameModel.rightPlayerModel.getCalledLandlordScore()),this.updateDebugWindowContent()},t.prototype.showBottomPlayerCallLandlordButtons=function(e){this.playGameButtonsContainer.showCallLandlordButtons(),1===e?this.playGameButtonsContainer.disableCallOnePointButton():2===e&&(this.playGameButtonsContainer.disableCallOnePointButton(),this.playGameButtonsContainer.disableCallTwoPointButton())},t.prototype.nextCallLandlordPlayer=function(e,a){1===e?(this.bottomPlayerStateView.hideAllState(),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.showBottomPlayerCallLandlordButtons(a),this.activePlayerSignView.rotateToBottomPlayer()):2===e?(this.leftPlayerGameInfoView.hideAllState(),this.leftPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.activePlayerSignView.rotateToLeftPlayer()):3===e&&(this.rightPlayerGameInfoView.hideAllState(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE))},t.prototype.showPlayerCallLandlordResult=function(e,t){2===e?(this.leftPlayerClock.stopCountDown(),this.showLeftPlayerCallLandlord(t),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.leftPlayerModel.getCallLandlordSoundByPoint(t),1)):3===e&&(this.rightPlayerClock.stopCountDown(),this.showRightPlayerCallLandlord(t),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.rightPlayerModel.getCallLandlordSoundByPoint(t),1))},t.prototype.showBottomPlayerCallLandlord=function(e){1===e?this.bottomPlayerStateView.setState(1):2===e?this.bottomPlayerStateView.setState(2):3===e?this.bottomPlayerStateView.setState(3):0===e&&this.bottomPlayerStateView.setState(4),this.bottomPlayerClock.stopCountDown(),this.playGameButtonsContainer.hideAllButtons()},t.prototype.showLeftPlayerCallLandlord=function(e){this.leftPlayerGameInfoView.reset(),0===e?this.leftPlayerGameInfoView.showNotCallLandlord():this.leftPlayerGameInfoView.setCallLandlordPoint(e)},t.prototype.showRightPlayerCallLandlord=function(e){this.rightPlayerGameInfoView.reset(),0===e?this.rightPlayerGameInfoView.showNotCallLandlord():this.rightPlayerGameInfoView.setCallLandlordPoint(e)},t.prototype.makeBottomPlayerPlayCardState=function(){this.bottomPlayerPlayedCardListView.visible=!1,this.bottomPlayerStateView.setState(0),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.gameModel.isBottomPlayerWinInARound()?(this.gameModel.resetLastPlayedCards(),this.playGameButtonsContainer.showMustPlayCardButtons()):this.gameModel.doesBottomPlayerHaveBiggerCards()?this.playGameButtonsContainer.showPlayCardButtons():this.playGameButtonsContainer.showNoBiggerCardsButtons(),this.gameModel.bottomPlayerModel.handCardModel.isSelectedCardLegal()&&this.dispatchEnablePlayCardButtonEvent()},t.prototype.makeLeftPlayerPlayCardState=function(){this.leftPlayerPlayedCardListView.visible=!1,this.leftPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.leftPlayerGameInfoView.hideAllState()},t.prototype.makeRightPlayerPlayCardState=function(){this.rightPlayerPlayedCardListView.visible=!1,this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE),this.rightPlayerGameInfoView.hideAllState()},t.prototype.nextPlayCardPlayer=function(e){switch(this.bottomPlayerHandCardsView.hideBottomCards(),e){case 1:this.makeBottomPlayerPlayCardState(),this.activePlayerSignView.rotateToBottomPlayer();break;case 2:this.makeLeftPlayerPlayCardState(),this.activePlayerSignView.rotateToLeftPlayer();break;case 3:break;case 0:this.leftPlayerGameInfoView.hideAllState(),this.rightPlayerGameInfoView.hideAllState();break;default:throw new Error("玩家类型出错了")}},t.prototype.startMatchPlayer=function(){var e=this,a=new QPLoadingScene;a.show("正在匹配玩家"),UserModel.sharedInstance().joinGame(function(e){var r=e.roomId,n=e.baseScore,o=e.playerModels;a.hide();var i=new DDZGameModel(r);i.setPlayers(o),i.setBaseScore(n),qp.SceneManager.sharedInstance().replaceScene(new t(i))},function(t){a.hide(),QPAlert.sharedInstance().showAt(e,t.message),e.playGameButtonsContainer.showStartGameButton()})},t.prototype.startPlayingCard=function(){this.leftPlayerGameInfoView.hideAllState(),this.rightPlayerGameInfoView.hideAllState(),this.gameModel.isBottomPlayerLandlord()?(this.playGameButtonsContainer.showMustPlayCardButtons(),this.activePlayerSignView.pointToBottomPlayer(),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE)):this.gameModel.isLeftPlayerLandlord()?(this.activePlayerSignView.pointToLeftPlayer(),this.leftPlayerClock.startCountDown(t.THINK_TIME_VALUE)):this.gameModel.isRightPlayerLandlord()&&(this.activePlayerSignView.pointToRightPlayer(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE))},t.prototype.showPlayers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.gameModel.isPlayersFull()&&(this.hideInvitePlayerPopup(),this.removeGameOverLayer(),QPAlert.sharedInstance().hide(),this.updateAllPlayerTotalScore()),this.gameModel.isLeftPlayerExist()&&this.showLeftPlayer(),this.gameModel.isRightPlayerExist()&&this.showRightPlayer(),this.showBottomPlayer(),this.gameModel.isPlayersFull()&&(this.matchPlayerView.showWaitForStartGame(),this.autoReady()),[2]})})},t.prototype.showLeftPlayer=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(a){switch(a.label){case 0:this.leftPlayerView.setName(this.gameModel.leftPlayerModel.getNickname()),this.leftPlayerView.setScore(this.gameModel.leftPlayerModel.getTotalScore()),this.leftPlayerGameInfoView.showWaitForReady(!this.gameModel.leftPlayerModel.getIsReady()),this.setLeftPlayerViewVisible(!0),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.gameModel.leftPlayerModel.fetchAvatar()];case 2:return e=a.sent(),this.leftPlayerView.setAvatar(e),[3,4];case 3:return t=a.sent(),egret.log(t),[3,4];case 4:return[2]}})})},t.prototype.showRightPlayer=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(a){switch(a.label){case 0:this.rightPlayerView.setName(this.gameModel.rightPlayerModel.getNickname()),this.rightPlayerView.setScore(this.gameModel.rightPlayerModel.getTotalScore()),this.rightPlayerGameInfoView.showWaitForReady(!this.gameModel.rightPlayerModel.getIsReady()),this.setRightPlayerViewVisible(!0),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.gameModel.rightPlayerModel.fetchAvatar()];case 2:return e=a.sent(),this.rightPlayerView.setAvatar(e),[3,4];case 3:return t=a.sent(),egret.log(t),[3,4];case 4:return[2]}})})},t.prototype.showBottomPlayer=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(a){switch(a.label){case 0:this.bottomPlayerView.setName(this.gameModel.bottomPlayerModel.getNickname()),this.bottomPlayerView.setScore(this.gameModel.bottomPlayerModel.getTotalScore()),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.gameModel.bottomPlayerModel.fetchAvatar()];case 2:return e=a.sent(),this.bottomPlayerView.setAvatar(e),[3,4];case 3:return t=a.sent(),egret.log(t),[3,4];case 4:return[2]}})})},t.prototype.playerJoinRoom=function(){this.gameModel.isPlayersFull()&&this.autoReady()},t.prototype.autoReady=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(a){switch(a.label){case 0:if(this.gameModel.bottomPlayerModel.getIsReady())return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.ready()];case 2:return a.sent(),[3,4];case 3:return e=a.sent(),QPAlert.sharedInstance().showAt(this,e.message),QPAlert.sharedInstance().pressedOKHandler=function(){return e.type===QPNetworkErrorType.RoomDurationExpired?void t.leaveGame():void t.autoReady()},[3,4];case 4:return[2]}})})},t.prototype.hidePlayer=function(e){2===e?this.setLeftPlayerViewVisible(!1):3===e&&this.setRightPlayerViewVisible(!1),this.showInvitePlayerPopup()},t.prototype.dealCards=function(){this.bottomPlayerHandCardsView.dealCards(this.gameModel.bottomPlayerModel.listHandCards()),this.matchPlayerView.hide(),this.leftPlayerGameInfoView.setRemainCardsCount(this.gameModel.DefaultCardsCount),this.leftPlayerGameInfoView.showWaitForReady(!1),this.rightPlayerGameInfoView.setRemainCardsCount(this.gameModel.DefaultCardsCount),this.rightPlayerGameInfoView.showWaitForReady(!1),this.updateDebugWindowContent()},t.prototype.gameOver=function(){this.leftPlayerGameInfoView.reset(),this.rightPlayerGameInfoView.reset(),this.gameModel.isLeftPlayerPlayedAllCards()||(this.leftPlayerPlayedCardListView.setCards(this.gameModel.leftPlayerModel.listHandCards()),this.leftPlayerPlayedCardListView.visible=!0),this.gameModel.isRightPlayerPlayedAllCards()||(this.rightPlayerPlayedCardListView.setCards(this.gameModel.rightPlayerModel.listHandCards()),this.rightPlayerPlayedCardListView.visible=!0),this.bottomPlayerStateView.hideAllState(),this.playGameButtonsContainer.hideAllButtons();var e=new egret.Timer(2e3,1);e.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.showGameOverLayer,this),e.start()},t.prototype.forceGameOver=function(e){var t=this;this.hideInvitePlayerPopup(),this.isPlayerLeaveAlertShow=!0,this.reset(),QPAlert.sharedInstance().showOKButtonAt(this,e+" 已经离开游戏，游戏结束"),QPAlert.sharedInstance().pressedOKHandler=function(){t.isPlayerLeaveAlertShow=!1,t.showInvitePlayerPopup()}},t.prototype.showGameOverLayer=function(){var e=this;if(this.gameOverLayer||(this.gameOverLayer=new DDZGameOverLayer),Device.sharedInstance().autoAdjustResolutioin(this.gameOverLayer),this.gameModel.bottomPlayerModel.getIsWinner()?this.gameOverLayer.showWinner():this.gameOverLayer.showLoser(),this.gameModel.isLeftPlayerExist()&&this.gameModel.isRightPlayerExist()){this.updateAllPlayerTotalScore();var t=this.gameModel.leftPlayerModel.getScore(),a=this.gameModel.rightPlayerModel.getScore(),r=this.gameModel.bottomPlayerModel.getScore();this.gameOverLayer.updateSettlementResult(t,a,r)}this.gameOverLayer.pressedContinueGameHandler=function(){e.continueGame(function(t){QPAlert.sharedInstance().showAt(e,t.message),QPAlert.sharedInstance().pressedOKHandler=function(){t.type===QPNetworkErrorType.RoomDurationExpired&&e.leaveGame()}})},this.gameOverLayer.pressedCloseButtonHandler=this.leaveGamePressed.bind(this),this.gameOverLayer.touchEnabled=!1,this.addChild(this.gameOverLayer)},t.prototype.updateAllPlayerTotalScore=function(){this.bottomPlayerView.setScore(this.gameModel.bottomPlayerModel.getTotalScore()),this.leftPlayerView.setScore(this.gameModel.leftPlayerModel.getTotalScore()),this.rightPlayerView.setScore(this.gameModel.rightPlayerModel.getTotalScore())},t.prototype.removeGameOverLayer=function(){this.gameOverLayer&&(this.removeChild(this.gameOverLayer),this.gameOverLayer=void 0)},t.prototype.continueGame=function(e){return __awaiter(this,void 0,void 0,function(){var t,a;return __generator(this,function(r){switch(r.label){case 0:t=new QPLoadingScene,t.show(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.ready()];case 2:return r.sent(),t.hide(),this.reset(),this.removeGameOverLayer(),[3,4];case 3:return a=r.sent(),t.hide(),e(a),[3,4];case 4:return[2]}})})},t.prototype.ready=function(){var e=UserModel.sharedInstance().actionDataFactory.makeReadyGameData();return new Promise(function(t,a){UserModel.sharedInstance().actionModel.readyGame(e,function(){t()},function(e){a(e)})})},t.prototype.reset=function(){this.gameModel.reset(),this.landlordCardsView.hide(),this.bottomPlayerHandCardsView.hideBottomCards(),this.gameModel.isLeftPlayerExist()&&(this.leftPlayerGameInfoView.hideRemainCardsView(),this.leftPlayerView.showLandlordSign(!1),this.leftPlayerPlayedCardListView.visible=!1,this.leftPlayerGameInfoView.hideAllState(),this.leftPlayerGameInfoView.hideWarningLightView(),this.leftPlayerClock.stopCountDown(),this.leftPlayerGameInfoView.showWaitForReady(!this.gameModel.leftPlayerModel.getIsReady())),this.gameModel.isRightPlayerExist()&&(this.rightPlayerGameInfoView.hideRemainCardsView(),this.rightPlayerView.showLandlordSign(!1),this.rightPlayerPlayedCardListView.visible=!1,this.rightPlayerGameInfoView.hideAllState(),this.rightPlayerClock.stopCountDown(),this.rightPlayerGameInfoView.hideWarningLightView(),this.rightPlayerGameInfoView.showWaitForReady(!this.gameModel.rightPlayerModel.getIsReady())),this.bottomPlayerPlayedCardListView.visible=!1,this.playGameButtonsContainer.hideAllButtons(),this.bottomPlayerStateView.hideAllState(),this.bottomPlayerClock.stopCountDown(),this.bottomPlayerView.showLandlordSign(!1),this.bottomPlayerHandCardsView.setCards([]),this.activePlayerSignView.hide(),DDZServerMessageMonitor.sharedInstance().reset()},t.prototype.playCard=function(){var e=this,t=this.gameModel.bottomPlayerModel.listSelectedCards();this.gameModel.playCards(t,function(t){return t?void e.handlePlayCardError(t):(e.gameModel.bottomPlayerModel.handCardModel.hasCards()&&(e.activePlayerSignView.rotateToRightPlayer(),e.makeRightPlayerPlayCardState()),void e.bottomPlayerPlayedCards())})},t.prototype.handlePlayCardError=function(e){this.gameModel.bottomPlayerModel.cancelSelectedCards(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.dispatchEnablePlayCardButtonEvent(),e.type===QPNetworkErrorType.ClientCheckedWrongCardType?this.showWrongCardTypeMessage():this.forceFetchPlayerState()},t.prototype.notPlayCard=function(){var e=this;this.gameModel.bottomPlayerModel.cancelSelectedCards(),this.gameModel.notPlayCard(function(t){return t?void e.handlePlayCardError(t):void e.bottomPlayerPlayedCards()})},t.prototype.showWrongCardTypeMessage=function(){var e=this;this.wrongTypeCardImage.visible=!0;var t=new egret.Timer(2e3,1);t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.wrongTypeCardImage.visible=!1,t=void 0},this),t.start()},t.prototype.loopPlayerState=function(){var e=this;this.playerStateInterval=setInterval(function(){DDZServerMessageMonitor.sharedInstance().isLatestMessageMoreThan30s()&&e.fetchPlayerState()},3e3)},t.prototype.stopLoopPlayerState=function(){clearInterval(this.playerStateInterval),this.playerStateInterval=0},t.prototype.fetchPlayerState=function(){var e=this;DDZGameState.Model.sharedInstance().fetch(function(t){DDZServerMessageMonitor.sharedInstance().setLatestReceivedMessageDate(new Date),DDZGameState.Model.sharedInstance().room&&DDZGameState.Model.sharedInstance().room.updatedAt<=DDZServerMessageMonitor.sharedInstance().getUpdatedAt()||e.gameModel.getIsGameOver()||e.handleUserGameData(t)},function(e){e&&egret.log("DDZPlayGameScene fetchPlayerState error happened : "+e.message)})},t.prototype.handleUserGameData=function(e){egret.log("DDZPlayGameScene handle.UserGameData #########"),egret.log(e),egret.log("\n\n"),DDZGameState.Model.sharedInstance().room&&!DDZGameState.Model.sharedInstance().isWaiting()&&DDZServerMessageMonitor.sharedInstance().setUpdatedAt(DDZGameState.Model.sharedInstance().room.updatedAt),e.room&&e.room.pin&&UserModel.sharedInstance().roomModel.setPin(e.room.pin),DDZGameState.Model.sharedInstance().room&&this.gameModel.setPlayers(DDZGameState.Model.sharedInstance().room.players);
var t={playCardGameRestored:this.playCardGameRestored.bind(this),becomeLandlordGameRestored:this.becomeLandlordGameRestored.bind(this)};this.gameModel.restoreGame(t),DDZUserChannelModel.sharedInstance().resetMessageCounter()},t.prototype.forceFetchPlayerState=function(){var e=this;DDZGameState.Model.sharedInstance().forceFetch(function(t){e.handleUserGameData(t)},function(t){e.forceFetchPlayerState()})},t.prototype.hint=function(){this.gameModel.hint(),this.gameModel.bottomPlayerModel.handCardModel.hasSelectedCards()&&(this.dispatchEnablePlayCardButtonEvent(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()))},t.prototype.notPlayCardButtonPressed=function(){this.makeRightPlayerPlayCardState(),this.activePlayerSignView.rotateToRightPlayer(),this.notPlayCard()},t.prototype.notCallLandlord=function(){this.gameModel.bottomPlayerModel.notCallLandlord(),this.showBottomPlayerCallLandlord(0),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.bottomPlayerModel.getCallLandlordSoundByPoint(0),1),this.activePlayerSignView.rotateToRightPlayer(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE)},t.prototype.callOnePoint=function(){this.gameModel.bottomPlayerModel.callLandlord(1),this.showBottomPlayerCallLandlord(1),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.bottomPlayerModel.getCallLandlordSoundByPoint(1),1),this.checkCallResult()},t.prototype.callTwoPoint=function(){this.gameModel.bottomPlayerModel.callLandlord(2),this.showBottomPlayerCallLandlord(2),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.bottomPlayerModel.getCallLandlordSoundByPoint(2),1),this.checkCallResult()},t.prototype.callThreePoint=function(){this.gameModel.bottomPlayerModel.callLandlord(3),this.showBottomPlayerCallLandlord(3),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.bottomPlayerModel.getCallLandlordSoundByPoint(3),1)},t.prototype.checkCallResult=function(){this.gameModel.isClientConfirmBottomPlayerAsLandlord()?(this.activePlayerSignView.pointToBottomPlayer(),this.bottomPlayerClock.startCountDown(t.THINK_TIME_VALUE)):(this.activePlayerSignView.rotateToRightPlayer(),this.rightPlayerClock.startCountDown(t.THINK_TIME_VALUE))},t.prototype.playMusic=function(){QPAudioManager.sharedInstance().playBackgroundMusic(QPAudioSouce.PLAY_GAME_BACKGROUND,-1)},t.prototype.stopMusic=function(){QPAudioManager.sharedInstance().stopPlayBackgroundMusic()},t.prototype.showLeftPlayerDetailInfo=function(){},t.prototype.showRightPlayerDetailInfo=function(){},t.prototype.showBottomPlayerDetailInfo=function(){},t.THINK_TIME_VALUE=30,t}(QPScene);__reflect(DDZPlayGameScene.prototype,"DDZPlayGameScene");var DDZGame=function(){function e(e){this.phase=0,this.baseScore=0,this.bombAmount=0,this.isSpring=!1,this.landlordCards=[],this.roomId=e}return e.prototype.reset=function(){this.phase=0,this.baseScore=0,this.bombAmount=0,this.isSpring=!1,this.landlordId=void 0,this.callingLandlordPlayerSeat=0,this.multiple=0,this.landlordCards=[],this.setMatchId(void 0)},e.prototype.setMatchId=function(e){this.matchId=e},e.prototype.getMatchId=function(){return this.matchId},e.prototype.setPhase=function(e){this.phase=e},e.prototype.getMultiple=function(){return this.multiple=1,this.bombAmount&&(this.multiple*=this.bombAmount),this.isSpring&&(this.multiple*=2),this.multiple},e.prototype.addBombAmount=function(){this.bombAmount+=1},e.prototype.setIsSpring=function(e){this.isSpring=e},e.prototype.setLandlordId=function(e){this.landlordId=e},e.prototype.setLandlordCards=function(e){this.landlordCards=e},e.prototype.setCallingLandlordPlayerSeat=function(e){this.callingLandlordPlayerSeat=e},e}();__reflect(DDZGame.prototype,"DDZGame");var DDZGameModel=function(e){function t(t){var a=e.call(this)||this;return a.DefaultCardsCount=17,a.bottomPlayerModel=void 0,a.leftPlayerModel=void 0,a.rightPlayerModel=void 0,a.winner=void 0,a.isGameOver=!1,a.game=new DDZGame(t),a.createBottomPlayer(),a.registerGameService(),a}return __extends(t,e),t.prototype.reset=function(){this.resetLastPlayedCards(),this.isStarted=!1,this.isGameOver=!1,this.game.reset(),this.leftPlayerModel&&this.leftPlayerModel.reset(),this.rightPlayerModel&&this.rightPlayerModel.reset(),this.bottomPlayerModel.reset()},t.prototype.resetScore=function(){this.leftPlayerModel&&this.leftPlayerModel.resetTotalScore(),this.rightPlayerModel&&this.rightPlayerModel.resetTotalScore(),this.bottomPlayerModel.resetTotalScore()},t.prototype.registerGameService=function(){var e=this;DDZUserChannelModel.sharedInstance().roomMessageReceivedHandler=function(t){return t.action===DDZGameServiceAction.ForceGameOver?void e.handleForceGameOver(t):t.action===DDZGameServiceAction.Ready?(e.updatePlayersReadyState(t.playerModels),void(e.playerReadyStateChangedHandler&&e.playerReadyStateChangedHandler())):(e.setPlayers(t.playerModels),t.action===DDZGameServiceAction.LeaveRoom&&DDZGameState.Model.sharedInstance().cancelFetch(),void(t.action===DDZGameServiceAction.JoinRoom&&e.playerJoinRoomHandler&&e.playerJoinRoomHandler()))},DDZUserChannelModel.sharedInstance().userMessageReceivedHandler=function(t){t.action===DDZGameServiceAction.CallLandlord?e.handleCallLandlord(t):t.action===DDZGameServiceAction.PlayCard?e.handlePlayCard(t):t.action===DDZGameServiceAction.DealCards?e.handleServerDealCards(t):t.action===DDZGameServiceAction.StartGame?e.handleStartGame(t):t.action===DDZGameServiceAction.RestartGame?e.handleRestartGame(t):t.action===DDZGameServiceAction.ConfirmLandlord?e.handleConfirmLandlord(t):t.action===DDZGameServiceAction.GameOver&&e.handleGameOver(t)}},t.prototype.removeGameService=function(){DDZUserChannelModel.sharedInstance().roomMessageReceivedHandler=void 0,DDZUserChannelModel.sharedInstance().userMessageReceivedHandler=void 0},t.prototype.restoreGame=function(e){DDZGameState.Model.sharedInstance().isPlayingGame()?(this.isStarted=!0,this.setGamePhase(2),this.restorePlayCardGame(function(t){e.playCardGameRestored&&e.playCardGameRestored(t)})):DDZGameState.Model.sharedInstance().isBecomingLandlord()&&(this.isStarted=!0,this.setGamePhase(1),this.restoreBecomLandlordGame(function(t,a){e.becomeLandlordGameRestored&&e.becomeLandlordGameRestored(t,a)})),DDZGameState.Model.sharedInstance().room&&this.game.setMatchId(DDZGameState.Model.sharedInstance().room.gameMatchId),DDZGameState.Model.sharedInstance().setGameState(DDZGameState.Type.GAME_BEEN_RESTORED)},t.prototype.setPlayers=function(e){var t=this.getPlayerModelByPlayerId(this.bottomPlayerModel.getId(),e);t&&(this.bottomPlayerModel=t,this.bottomPlayerModel.setSeat(1)),this.setLeftPlayer(DDZPlayerFactory.makeLeftPlayerModel(this.bottomPlayerModel.getSeatId(),e)),this.setRightPlayer(DDZPlayerFactory.makeRightPlayerModel(this.bottomPlayerModel.getSeatId(),e))},t.prototype.isPlayersFull=function(){return this.leftPlayerModel&&this.rightPlayerModel?!0:!1},t.prototype.resetLastPlayedCards=function(){this.lastPlayedCardSet=void 0},t.prototype.isClientConfirmBottomPlayerAsLandlord=function(){return this.leftPlayerModel.getHasCalledLandlord()&&this.rightPlayerModel.getHasCalledLandlord()?this.bottomPlayerModel.getCalledLandlordScore()<this.leftPlayerModel.getCalledLandlordScore()?!1:this.bottomPlayerModel.getCalledLandlordScore()<this.rightPlayerModel.getCalledLandlordScore()?!1:!0:!1},t.prototype.doesBottomPlayerHaveBiggerCards=function(){return this.bottomPlayerModel.isHaveBiggerCards(this.lastPlayedCardSet)},t.prototype.hint=function(){this.bottomPlayerModel.handCardModel.hint(this.lastPlayedCardSet)},t.prototype.isLeftPlayerExist=function(){return this.leftPlayerModel?!0:!1},t.prototype.isRightPlayerExist=function(){return this.rightPlayerModel?!0:!1},t.prototype.isBottomPlayerLandlord=function(){return this.bottomPlayerModel.getIsLandlord()},t.prototype.isLeftPlayerLandlord=function(){return this.leftPlayerModel.getIsLandlord()},t.prototype.isRightPlayerLandlord=function(){return this.rightPlayerModel.getIsLandlord()},t.prototype.isLeftPlayerPlayedAllCards=function(){return 0===this.leftPlayerModel.getCardsAmount()},t.prototype.isRightPlayerPlayedAllCards=function(){return 0===this.rightPlayerModel.getCardsAmount()},t.prototype.isBottomPlayerWinInARound=function(){return this.lastPlayedCardSet?this.bottomPlayerModel.isIdEqualTo(this.lastPlayedCardSet.playerId)?!0:!1:!0},t.prototype.setBaseScore=function(e){this.game.baseScore=e},t.prototype.listAutoPlayCards=function(){return this.bottomPlayerModel.listAutoPlayCards(this.lastPlayedCardSet)},t.prototype.playCards=function(e,t){if(!this.isGameOver){var a=DDZPlayCardSetFactory.createCardSet(e);if(a.setPlayerId(this.bottomPlayerModel.getId()),!a.isLegal())return void t(new QPNetworkError({message:"您的出牌不符合规则",error_type:"client_checked_wrong_card_type"}));if(this.lastPlayedCardSet&&!a.isBomb()&&!a.isHuoJian()&&!a.isTypeEqualTo(this.lastPlayedCardSet))return void t(new QPNetworkError({message:"您的出牌不符合规则",error_type:"client_checked_wrong_card_type"}));if(this.lastPlayedCardSet&&!a.isBiggerThan(this.lastPlayedCardSet))return void t(new QPNetworkError({message:"您的出牌不符合规则",error_type:"client_checked_wrong_card_type"}));(a.isBomb()||a.isHuoJian())&&this.game.addBombAmount(),a.isEmpty()||(this.lastPlayedCardSet=a),this.bottomPlayerModel.dropPlayedCards(e),this.bottomPlayerModel.setLatestPlayedCards(e),this.bottomPlayerModel.setHasPlayedCards(!0),this.bottomPlayerModel.playPlayedCardsAudio(),t();var r=a.listCardsCodes(),n={body:{played_cards:r},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/play_card"};this.postCards(n,t)}},t.prototype.notPlayCard=function(e){var t={body:{played_cards:[]},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/play_card"};this.bottomPlayerModel.dropPlayedCards([]),this.bottomPlayerModel.setLatestPlayedCards([]),this.bottomPlayerModel.setHasPlayedCards(!0),this.bottomPlayerModel.playPlayedCardsAudio(),e(),this.postCards(t,e)},t.prototype.getIsGameOver=function(){return this.isGameOver},t.prototype.setDefaultLandlordId=function(e){var t=this.getSeatByPlayerId(e);this.game.setCallingLandlordPlayerSeat(t)},t.prototype.getSeatByPlayerId=function(e){var t=0;return this.bottomPlayerModel.isIdEqualTo(e)?t=1:this.leftPlayerModel&&this.leftPlayerModel.isIdEqualTo(e)?t=2:this.rightPlayerModel&&this.rightPlayerModel.isIdEqualTo(e)&&(t=3),t},t.prototype.isBottomPlayerCallingLandlord=function(){return 1===this.game.callingLandlordPlayerSeat},t.prototype.isLeftPlayerCallingLandlord=function(){return 2===this.game.callingLandlordPlayerSeat},t.prototype.isRightPlayerCallingLandlord=function(){return 3===this.game.callingLandlordPlayerSeat},t.prototype.countLeftPlayerCardsAmount=function(){return this.isLeftPlayerExist()?this.leftPlayerModel.getCardsAmount():0},t.prototype.countRightPlayerCardsAmount=function(){return this.isRightPlayerExist()?this.rightPlayerModel.getCardsAmount():0},t.prototype.postCards=function(e,t){var a=this;this.postReturnJson(e,function(){},function(r){r.mustBeHandled()?t(r):a.postCards(e,t)})},t.prototype.handleCallLandlord=function(e){this.setGamePhase(1);var t=this.getSeatByPlayerId(e.nextPlayer);this.nextCallLandlordPlayerHandler&&this.nextCallLandlordPlayerHandler(t,e.currentLandlordScore);var a=this.getSeatByPlayerId(e.playerId),r=e.score;2===a?(this.leftPlayerModel.setCalledLandlordScore(r),this.leftPlayerModel.setHasCalledLandlord(!0)):3===a&&(this.rightPlayerModel.setCalledLandlordScore(r),this.rightPlayerModel.setHasCalledLandlord(!0)),this.playerCalledLandlordHandler&&this.playerCalledLandlordHandler(a,r)},t.prototype.handlePlayCard=function(e){this.setGamePhase(2);var t=this.getSeatByPlayerId(e.playerId),a=this.getSeatByPlayerId(e.nextPlayerId),r=e.playedCards,n=e.remainCardsAmount,o=DDZPlayCardSetFactory.createCardSet(r);o.isEmpty()||(this.lastPlayedCardSet=o,this.lastPlayedCardSet.setPlayerId(e.playerId)),t===this.bottomPlayerModel.getSeat()?(this.bottomPlayerModel.dropPlayedCards(r),this.bottomPlayerModel.setLatestPlayedCards(r),this.bottomPlayerModel.setHasPlayedCards(!0),this.bottomPlayerModel.setCardsAmount(n),this.playerPlayedCardsHandler&&this.playerPlayedCardsHandler(1)):t===this.leftPlayerModel.getSeat()?(this.leftPlayerModel.dropPlayedCards(r),this.leftPlayerModel.setLatestPlayedCards(r),this.leftPlayerModel.setHasPlayedCards(!0),this.leftPlayerModel.setCardsAmount(n),this.leftPlayerModel.playPlayedCardsAudio(),this.playerPlayedCardsHandler&&this.playerPlayedCardsHandler(2)):t===this.rightPlayerModel.getSeat()&&(this.rightPlayerModel.dropPlayedCards(r),this.rightPlayerModel.setLatestPlayedCards(r),this.rightPlayerModel.setHasPlayedCards(!0),this.rightPlayerModel.setCardsAmount(n),this.rightPlayerModel.playPlayedCardsAudio(),this.playerPlayedCardsHandler&&this.playerPlayedCardsHandler(3)),this.nextPlayCardPlayerHandler&&this.nextPlayCardPlayerHandler(a)},t.prototype.handleGameOver=function(e){for(var t=e.gameOverPlayerInformations,a=0,r=t;a<r.length;a++){var n=r[a],o=void 0;n.isWinner()&&(o=this.getWinnerCharacter(n.playerId),this.bottomPlayerModel.setIsWinner(this.bottomPlayerModel.characterEqualTo(o)),this.leftPlayerModel.setIsWinner(this.leftPlayerModel.characterEqualTo(o)),this.rightPlayerModel.setIsWinner(this.rightPlayerModel.characterEqualTo(o))),this.leftPlayerModel.isIdEqualTo(n.playerId)?(this.leftPlayerModel.handCardModel.setCards(n.remainCards),this.leftPlayerModel.setScore(e.settlement[n.playerId]),this.leftPlayerModel.setTotalScore(n.score)):this.rightPlayerModel.isIdEqualTo(n.playerId)?(this.rightPlayerModel.handCardModel.setCards(n.remainCards),this.rightPlayerModel.setScore(e.settlement[n.playerId]),this.rightPlayerModel.setTotalScore(n.score)):(this.bottomPlayerModel.handCardModel.setCards(n.remainCards),this.bottomPlayerModel.setScore(e.settlement[n.playerId]),this.bottomPlayerModel.setTotalScore(n.score))}this.isGameOver=!0,this.gameOverHandler&&this.gameOverHandler()},t.prototype.handleForceGameOver=function(e){this.forceGameOverHandler&&this.forceGameOverHandler(e.leftPlayerName)},t.prototype.handleStartGame=function(e){this.resetGameHandler&&this.resetGameHandler(),this.setGameData(e)},t.prototype.handleRestartGame=function(e){this.resetGameHandler&&this.resetGameHandler(),this.setGameData(e)},t.prototype.handleServerDealCards=function(e){this.bottomPlayerModel.handCardModel.setCards(e.cards),this.dealCardsHandler&&this.dealCardsHandler()},t.prototype.handleConfirmLandlord=function(e){this.game.setLandlordCards(e.bottomCards),this.game.setLandlordId(e.landlord),this.setPlayersCharacters(this.game.landlordId),this.bottomPlayerModel.getIsLandlord()&&(this.bottomPlayerModel.addLandlordCards(this.game.landlordCards),this.bottomPlayerModel.addLandlordTagToHandCards()),this.setGamePhase(2),this.bottomPlayerModel.initialHandCardsAmount(),this.leftPlayerModel.initialHandCardsAmount(),this.rightPlayerModel.initialHandCardsAmount(),this.gameLandlordConfirmedHandler&&this.gameLandlordConfirmedHandler()},t.prototype.setGameData=function(e){this.isStarted=!0,this.setDefaultLandlordId(e.initLandlord),this.game.setMatchId(e.gameMatchId),this.setGamePhase(1)},t.prototype.setPlayersCharacters=function(e){this.bottomPlayerModel.setCharacter(this.bottomPlayerModel.isIdEqualTo(e)?1:2),this.isLeftPlayerExist()&&this.leftPlayerModel.setCharacter(this.leftPlayerModel.isIdEqualTo(e)?1:2),this.isRightPlayerExist()&&this.rightPlayerModel.setCharacter(this.rightPlayerModel.isIdEqualTo(e)?1:2)},t.prototype.createBottomPlayer=function(){this.bottomPlayerModel||(this.bottomPlayerModel=new DDZPlayerModel({id:UserModel.sharedInstance().attributeModel.getId()}),this.bottomPlayerModel.setNickname(UserModel.sharedInstance().attributeModel.getNickname()),this.bottomPlayerModel.setServiceId(UserModel.sharedInstance().attributeModel.getServiceId()),this.bottomPlayerModel.setBalanceAmount(UserModel.sharedInstance().attributeModel.getBalanceAmount()),this.bottomPlayerModel.setSeat(1),this.bottomPlayerModel.setIsReady(!1),this.showPlayerHandler&&this.showPlayerHandler(this.bottomPlayerModel))},t.prototype.setRightPlayer=function(e){return e?void(this.rightPlayerModel?this.rightPlayerModel.setIsReady(e.getIsReady()):(this.rightPlayerModel=e,this.rightPlayerModel.setSeat(3),this.showPlayerHandler&&this.showPlayerHandler(this.rightPlayerModel))):(this.rightPlayerModel=void 0,void(this.hidePlayerHandler&&this.hidePlayerHandler(3)))},t.prototype.setLeftPlayer=function(e){return e?void(this.leftPlayerModel?this.leftPlayerModel.setIsReady(e.getIsReady()):(this.leftPlayerModel=e,this.leftPlayerModel.setSeat(2),this.showPlayerHandler&&this.showPlayerHandler(this.leftPlayerModel))):(this.leftPlayerModel=void 0,void(this.hidePlayerHandler&&this.hidePlayerHandler(2)))},t.prototype.setGamePhase=function(e){this.game.phase=e},t.prototype.restorePlayCardGame=function(e){this.game.setLandlordCards(DDZGameState.Model.sharedInstance().room.bottomCards),this.game.setLandlordId(DDZGameState.Model.sharedInstance().room.confirmedLandlord),this.setPlayersCharacters(this.game.landlordId);var t=DDZGameState.Model.sharedInstance().room.lastPlayedCards,a=DDZPlayCardSetFactory.createCardSet(t);a&&!a.isEmpty()&&(this.lastPlayedCardSet=a,this.lastPlayedCardSet.setPlayerId(DDZGameState.Model.sharedInstance().room.lastPlayedCardsPlayer)),this.bottomPlayerModel=DDZGameState.Model.sharedInstance().getPlayerModelById(this.bottomPlayerModel.getId()),this.bottomPlayerModel.setSeat(1),this.playerPlayedCardsHandler(1),this.isLeftPlayerExist()&&(this.leftPlayerModel=DDZGameState.Model.sharedInstance().getPlayerModelById(this.leftPlayerModel.getId()),this.leftPlayerModel.setSeat(2)),this.playerPlayedCardsHandler(2),this.isRightPlayerExist()&&(this.rightPlayerModel=DDZGameState.Model.sharedInstance().getPlayerModelById(this.rightPlayerModel.getId()),this.rightPlayerModel.setSeat(3)),this.playerPlayedCardsHandler(3);var r=DDZGameState.Model.sharedInstance().room.activePlayer.getId(),n=this.getSeatByPlayerId(r);e(n)},t.prototype.restoreBecomLandlordGame=function(e){this.game.setLandlordCards(DDZGameState.Model.sharedInstance().room.bottomCards),this.bottomPlayerModel=DDZGameState.Model.sharedInstance().getPlayerModelById(this.bottomPlayerModel.getId()),this.bottomPlayerModel.setSeat(1),this.isLeftPlayerExist()&&(this.leftPlayerModel=DDZGameState.Model.sharedInstance().getPlayerModelById(this.leftPlayerModel.getId()),this.leftPlayerModel.setSeat(2)),this.isRightPlayerExist()&&(this.rightPlayerModel=DDZGameState.Model.sharedInstance().getPlayerModelById(this.rightPlayerModel.getId()),this.rightPlayerModel.setSeat(3));var t=DDZGameState.Model.sharedInstance().room.activePlayer.getId(),a=this.getSeatByPlayerId(t);e(a,DDZGameState.Model.sharedInstance().room.calledLandlordScore)},t.prototype.updatePlayersReadyState=function(e){var t=this.getPlayerModelByPlayerId(this.bottomPlayerModel.getId(),e);this.bottomPlayerModel.setIsReady(t.getIsReady());var a=this.bottomPlayerModel.getSeatId(),r=DDZPlayerFactory.makeLeftPlayerModel(a,e);this.leftPlayerModel.setIsReady(r.getIsReady());var n=DDZPlayerFactory.makeRightPlayerModel(a,e);this.rightPlayerModel.setIsReady(n.getIsReady())},t.prototype.getPlayerModelByPlayerId=function(e,t){for(var a=0,r=t;a<r.length;a++){var n=r[a];if(n.getId()===e)return n}},t.prototype.getWinnerCharacter=function(e){return this.game.landlordId===e?1:2},t}(QPNetworkApi);__reflect(DDZGameModel.prototype,"DDZGameModel");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DDZCardAnalyzer=function(){function e(){}return e.setCards=function(t){e.classifiedCardObject=new Object;for(var a=0,r=t;a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n.value];o?o.addCard(n):(o=new DDZClassifiedCard(n.value),o.addCard(n),e.classifiedCardObject[n.value]=o)}e.cards=[].concat(t)},e.getCardsType=function(){var t=e.cards.length;if(0===t)return 1;if(1===t)return 2;if(2===t){var a=e.cards[0],r=e.cards[1];if(a.value>15&&15<r.value)return 15;if(a.isValueEqualTo(r))return 3}if(3===t&&e.cards[0].value===e.cards[2].value)return 4;if(4===t){var a=e.cards[0],r=e.cards[1],n=e.cards[2],o=e.cards[3];if(a.isValueEqualTo(r)&&r.isValueEqualTo(n)&&n.isValueEqualTo(o))return 14;if(a.isValueEqualTo(n)||r.isValueEqualTo(o))return 5}if(t>=5){if(e.isStraight())return 7;if(e.isTrioWithPair())return 6}if(t>=6){if(e.isConsecutivePair())return 8;if(e.isAirplane())return 9;if(e.isFourTakesTwo())return 12}if(t>=8){if(e.isAirplaneTakesSingles())return 10;if(e.isAirplaneTakesPairs())return 11;if(e.isFourTakesTwoPairs())return 13}return 0},e.getCardsValue=function(){var t=e.getCardsType();if(2===t)return e.cards[0].value;if(3===t)return e.cards[0].value;if(4===t)return e.cards[0].value;if(7===t)return e.getSmallestCard().value;if(8===t)return e.getSmallestCard().value;if(9===t)return e.getSmallestCard().value;if(14===t)return e.cards[0].value;if(15===t)return e.cards[0].value;if(5===t||6===t)for(var a=0,r=Object.keys(e.classifiedCardObject);a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n];if(o.isTrio())return o.value}if(10===t||11===t){for(var i=void 0,s=0,d=Object.keys(e.classifiedCardObject);s<d.length;s++){var n=d[s],o=e.classifiedCardObject[n];o.isTrio()&&(i?i.isBiggerThan(o)&&(i=o):i=o)}if(i)return i.value}if(12===t||13===t)for(var l=0,c=Object.keys(e.classifiedCardObject);l<c.length;l++){var n=c[l],o=e.classifiedCardObject[n];if(o.isBomb())return o.value}return 0},e.isStraight=function(){for(var t=[],a=0,r=Object.keys(e.classifiedCardObject);a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n];if(!o.isSingle())return!1;t.push(o)}var i=t.length;if(5>i||i>12)return!1;var s=t[0],d=t[i-1];return d.value>14?!1:d.value-s.value===i-1?!0:!1},e.getSmallestCard=function(){var t=e.cards[0],a=e.cards[e.cards.length-1];return t.value<a.value?t:a},e.isConsecutivePair=function(){for(var t=[],a=0,r=Object.keys(e.classifiedCardObject);a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n];if(!o.isPair())return!1;t.push(o)}var i=t.length;if(3>i||i>10)return!1;var s=t[0],d=t[i-1];return 14<d.value?!1:d.value-s.value===i-1?!0:!1},e.isFourTakesTwo=function(){if(6!==e.cards.length)return!1;for(var t=0,a=Object.keys(e.classifiedCardObject);t<a.length;t++){var r=a[t],n=e.classifiedCardObject[r];if(n.isBomb())return!0}return!1},e.isFourTakesTwoPairs=function(){if(8!==e.cards.length)return!1;for(var t=!1,a=0,r=0,n=Object.keys(e.classifiedCardObject);r<n.length;r++){var o=n[r],i=e.classifiedCardObject[o];i.isBomb()&&(t=!0),i.isPair()&&(a+=1)}return t&&2===a?!0:!1},e.isTrioWithPair=function(){if(5!==e.cards.length)return!1;for(var t=!1,a=!1,r=0,n=Object.keys(e.classifiedCardObject);r<n.length;r++){var o=n[r],i=e.classifiedCardObject[o];i.isTrio()&&(t=!0),i.isPair()&&(a=!0)}return t&&a?!0:!1},e.isAirplane=function(){var t=e.cards.length;if(t%3!==0)return!1;for(var a=[],r=0,n=Object.keys(e.classifiedCardObject);r<n.length;r++){var o=n[r],i=e.classifiedCardObject[o];i.isTrio()&&a.push(i)}var s=a.length,d=t/3;if(2>s)return!1;if(d>s)return!1;var l=a[0],c=a[s-1];return 13<l.value||14<c.value?!1:c.value-l.value===s-1?!0:!1},e.isAirplaneTakesSingles=function(){var t=e.cards.length;if(8!==t&&12!==t&&16!==t&&20!==t)return!1;for(var a=[],r=[],n=0,o=Object.keys(e.classifiedCardObject);n<o.length;n++){var i=o[n],s=e.classifiedCardObject[i];s.isTrio()?a.push(s):r.push(s)}var d=a.length,l=t/4;if(2>d)return!1;if(l>d)return!1;var c=a[0],h=a[d-1];if(13<c.value||14<h.value)return!1;if(h.value-c.value!==d-1)return!1;for(var u=d,p=0,y=0,f=r;y<f.length;y++){var g=f[y];p+=g.countCards()}return p===u?!0:!1},e.isAirplaneTakesPairs=function(){var t=e.cards.length;if(10!==t&&15!==t&&20!==t)return!1;for(var a=[],r=[],n=0,o=Object.keys(e.classifiedCardObject);n<o.length;n++){var i=o[n],s=e.classifiedCardObject[i];s.isTrio()&&a.push(s),s.isPair()&&r.push(s)}var d=a.length,l=r.length,c=t/5;if(c>d)return!1;if(2>d)return!1;if(d!==l)return!1;var h=a[0],u=a[d-1];return 13<h.value||14<u.value?!1:u.value-h.value===d-1?!0:!1},e.cards=[],e}();__reflect(DDZCardAnalyzer.prototype,"DDZCardAnalyzer");var DDZClassifiedCard=function(){function e(e){this.value=18,this.cards=[],this.value=e}return e.prototype.reset=function(){this.cards=[]},e.prototype.isBiggerThan=function(e){return this.value>e.value},e.prototype.countCards=function(){return this.cards.length},e.prototype.addCard=function(e){this.cards.push(e)},e.prototype.isBlackJoker=function(){return 16===this.value},e.prototype.isRedJoker=function(){return 17===this.value},e.prototype.isSingle=function(){return 1===this.countCards()},e.prototype.isPair=function(){return 2===this.countCards()},e.prototype.isTrio=function(){return 3===this.countCards()},e.prototype.hasCards=function(){return this.countCards()>=1},e.prototype.isBomb=function(){return 4===this.countCards()},e}();__reflect(DDZClassifiedCard.prototype,"DDZClassifiedCard");var DDZDealCardModel=function(){function e(){this.cards=[],this.dealtCards=[],this.dealtCardCount=0}return e.prototype.setCards=function(e){this.cards=e,this.reset();for(var t=e.length,a=0;t>a;a+=1){var r=new DDZRearCard;r.showLandlordTag(!1),this.rearCards.push(r)}},e.prototype.listRearCards=function(){return this.rearCards},e.prototype.isAllCardsDealt=function(){return this.dealtCards.length===this.cards.length},e.prototype.dealOneCard=function(){this.dealtCards.push(this.cards[this.dealtCardCount]),this.rearCards.shift(),this.dealtCardCount+=1},e.prototype.listCards=function(){return this.cards},e.prototype.listDealtCards=function(){return this.dealtCards},e.prototype.countDealtCards=function(){return this.dealtCards.length},e.prototype.reset=function(){this.dealtCardCount=0,this.dealtCards=[],this.rearCards=[]},e}();__reflect(DDZDealCardModel.prototype,"DDZDealCardModel");var DDZHandCardModel=function(){function e(){this.cards=[]}return e.prototype.setCards=function(e){0!==e.length&&(this.classifyCards(e),this.cards=e.slice(),this.cards.sort(function(e,t){return t.index-e.index}))},e.prototype.countCards=function(){return this.cards.length},e.prototype.listCards=function(){return this.markLastCard(),this.cards},e.prototype.hasCards=function(){return this.cards.length>0},e.prototype.isSelectedCardLegal=function(){DDZCardAnalyzer.setCards(this.listSelectedCards());var e=DDZCardAnalyzer.getCardsType();return 0===e?!1:1===e?!1:!0},e.prototype.listSelectedCards=function(){for(var e=[],t=0,a=this.cards;t<a.length;t++){var r=a[t];r.isSelect&&e.push(r)}return e},e.prototype.hasSelectedCards=function(){return 0!==this.listSelectedCards().length},e.prototype.cancelSelectedCards=function(){for(var e=0,t=this.cards;e<t.length;e++){var a=t[e];a.isSelect=!1}},e.prototype.dropPlayedCards=function(e){for(var t=e.length,a=0;t>a;a+=1)for(var r=e[a],n=this.cards.length-1;n>=0;n-=1){var o=this.cards[n];o.isExactlySameTo(r)&&this.cards.splice(n,1)}this.classifyCards(this.cards)},e.prototype.hint=function(e){var t=this.findBiggerCardSetThanTarget(e);if(t)for(var a=0,r=this.cards;a<r.length;a++)for(var n=r[a],o=0,i=t.cards;o<i.length;o++){var s=i[o];if(n.isSelect=n.isExactlySameTo(s),n.isSelect)break}},e.prototype.addLandlordCards=function(e){3===e.length&&(17<this.countCards()||(this.cards=this.cards.concat(e),this.cards.sort(function(e,t){return t.index-e.index}),this.classifyCards(this.cards)))},e.prototype.addLandlordTag=function(){this.cards.forEach(function(e){e.showLandlordTag(!0)})},e.prototype.findBiggerCardSetThanTarget=function(e){if(this.isRemainCardsHuoJian())return DDZPlayCardSetFactory.createCardSet(this.cards);if(this.isRemainCardsBomb()&&e&&!e.isBomb()&&!e.isHuoJian())return DDZPlayCardSetFactory.createCardSet(this.cards);if(!e)return this.findSmallestCardSetInHand();if(!e.isHuoJian()){var t=e.listBiggerLegalCardSet(this.analyzedCardObject);return t||e.isBomb()||(t=this.findSmallestBomb(e)),t||(t=this.findHuoJian(e)),t}},e.prototype.isRemainCardsASet=function(){return 0===this.remainCardsType?!1:1===this.remainCardsType?!1:!0},e.prototype.isRemainCardsHuoJian=function(){return 15===this.remainCardsType},e.prototype.isRemainCardsBomb=function(){return 14===this.remainCardsType?!0:!1},e.prototype.getRemainCardsSet=function(){return DDZPlayCardSetFactory.createCardSet(this.cards)},e.prototype.findHuoJian=function(e){for(var t=[],a=0,r=Object.keys(this.analyzedCardObject);a<r.length;a++){var n=r[a],o=this.analyzedCardObject[n];(o.isBlackJoker()||o.isRedJoker())&&(t=t.concat(o.cards))}return 2===t.length?DDZPlayCardSetFactory.createCardSet(t):void 0},e.prototype.findSmallestBomb=function(e){for(var t=0,a=Object.keys(this.analyzedCardObject);t<a.length;t++){var r=a[t],n=this.analyzedCardObject[r];if(n.isBomb())return DDZPlayCardSetFactory.createCardSet(n.cards)}},e.prototype.findSmallestCardSetInHand=function(){if(this.isRemainCardsASet())return DDZPlayCardSetFactory.createCardSet(this.cards);for(var e=0,t=Object.keys(this.analyzedCardObject);e<t.length;e++){var a=t[e],r=this.analyzedCardObject[a];if(r.hasCards())return DDZPlayCardSetFactory.createCardSet(r.cards)}},e.prototype.classifyCards=function(e){this.analyzedCardObject=new Object;for(var t=0,a=e;t<a.length;t++){var r=a[t],n=this.analyzedCardObject[r.value];n?n.addCard(r):(n=new DDZClassifiedCard(r.value),n.addCard(r),this.analyzedCardObject[r.value]=n)}DDZCardAnalyzer.setCards(e),this.remainCardsType=DDZCardAnalyzer.getCardsType()},e.prototype.markLastCard=function(){if(this.hasCards())for(var e=this.cards.length,t=0;e>t;t+=1){var a=this.cards[t];9===t?a.isLastOne=!0:t===e-1?a.isLastOne=!0:a.isLastOne=!1}},e}();__reflect(DDZHandCardModel.prototype,"DDZHandCardModel");var DDZRearCard=function(e){function t(){return e.call(this,t.DefaultCode)||this}return __extends(t,e),t.prototype.getImageName=function(){return"poker_back@2x_png"},t.DefaultCode="3d",t}(DDZCard);__reflect(DDZRearCard.prototype,"DDZRearCard");var DDZPlayCardAirplaneSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.countCards()/3,a=this.findBiggerAirplaneCards(e,t);return 0!==a.length?DDZPlayCardSetFactory.createCardSet(a):void 0},t.prototype.getSoundEffectName=function(){return"poker_airplane_mp3"},t}(DDZPlayCardAirplaneTakes);__reflect(DDZPlayCardAirplaneSet.prototype,"DDZPlayCardAirplaneSet");var DDZPlayCardAirplaneTakesPairsSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.countCards()/5,a=this.findBiggerAirplaneCards(e,t);if(0!==a.length){for(var r=t,n=[],o=2*r,i=0,s=this.pairs;i<s.length;i++){var d=s[i];if(n.length<o&&(n=n.concat(d.cards)),n.length===o)return DDZPlayCardSetFactory.createCardSet(a.concat(n))}for(var l=a[0].value,c=a[a.length-1].value,h=0,u=this.trioes;h<u.length;h++){var p=u[h];if(n.length<o&&(p.value<l||c<p.value)&&(n=n.concat([p.cards[0],p.cards[1]])),n.length===o)return DDZPlayCardSetFactory.createCardSet(a.concat(n))}}},t.prototype.getSoundEffectName=function(){return"poker_airplane_mp3"},t}(DDZPlayCardAirplaneTakes);__reflect(DDZPlayCardAirplaneTakesPairsSet.prototype,"DDZPlayCardAirplaneTakesPairsSet");var DDZPlayCardAirplaneTakesSinglesSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.countCards()/4,a=this.findBiggerAirplaneCards(e,t);if(0!==a.length){for(var r=[],n=0,o=this.singles;n<o.length;n++){var i=o[n];if(r.length<t&&(r=r.concat(i.cards)),r.length===t)return DDZPlayCardSetFactory.createCardSet(a.concat(r))}for(var s=0,d=this.pairs;s<d.length;s++){var l=d[s];if(r.length<t&&(r=r.concat([l.cards[0]])),r.length<t&&(r=r.concat([l.cards[1]])),r.length===t)return DDZPlayCardSetFactory.createCardSet(a.concat(r))
}for(var c=a[0].value,h=a[a.length-1].value,u=0,p=this.trioes;u<p.length;u++){var y=p[u];if((y.value<c||h<y.value)&&(r.length<t&&(r=r.concat([y.cards[0]])),r.length<t&&(r=r.concat([y.cards[1]])),r.length<t&&(r=r.concat([y.cards[2]]))),r.length===t)return DDZPlayCardSetFactory.createCardSet(a.concat(r))}}},t.prototype.getSoundEffectName=function(){return"poker_airplane_mp3"},t}(DDZPlayCardAirplaneTakes);__reflect(DDZPlayCardAirplaneTakesSinglesSet.prototype,"DDZPlayCardAirplaneTakesSinglesSet");var DDZPlayCardBombSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerBombCards(e);if(0!==t.length)return DDZPlayCardSetFactory.createCardSet(t)},t.prototype.getSoundEffectName=function(){return"poker_bomb_mp3"},t}(DDZPlayCardFourTakes);__reflect(DDZPlayCardBombSet.prototype,"DDZPlayCardBombSet");var DDZPlayCardConsecutivePairsSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=[],a=0,r=Object.keys(e);a<r.length;a++){var n=r[a],o=e[n];(o.isPair()||o.isTrio()||o.isBomb())&&t.push(o)}var i=t.length,s=this.countCards()/2;if(!(s>i)){for(var d=i-1,l=0;d>=l;l+=1){var c=l+s-1;if(c>d)return;var h=t[c];if(15<=h.value)return;var u=t[l];if(this.canBeBiggerConsetutive(u,h,s)){if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND&&l<=this.lastFoundIndex)continue;if(this.lastFoundIndex=l,d>c){var p=t[c+1];(p.value-h.value!==1||15<=p.value)&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND)}else c===d&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND);for(var y=t.slice(l,c+1),f=[],g=0,m=y;g<m.length;g++){var v=m[g];f=f.concat([v.cards[0],v.cards[1]])}return DDZPlayCardSetFactory.createCardSet(f)}}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var C=this.lastFoundIndex,D=this.lastFoundIndex+s-1;if(D>d)return;if(15<=t[D].value)return;if(t[D].value-t[C].value!==s-1)return;for(var P=t.slice(C,D+1),_=[],S=0,I=P;S<I.length;S++){var M=I[S];_=_.concat([M.cards[0],M.cards[1]])}return DDZPlayCardSetFactory.createCardSet(_)}}},t.prototype.getSoundEffectName=function(){return"poker_consecutive_pairs_mp3"},t}(DDZPlayCardSet);__reflect(DDZPlayCardConsecutivePairsSet.prototype,"DDZPlayCardConsecutivePairsSet");var DDZPlayCardEmptySet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=0,a=Object.keys(e);t<a.length;t++){var r=a[t],n=e[r];if(n.hasCards())return DDZPlayCardSetFactory.createCardSet(n.cards)}},t.prototype.getSoundEffectName=function(){return QPAudioSouce.getRandomBuYao()},t}(DDZPlayCardSet);__reflect(DDZPlayCardEmptySet.prototype,"DDZPlayCardEmptySet");var DDZPlayCardErrorSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){throw new Error("错误的牌型不应该找比它大的牌")},t.prototype.getSoundEffectName=function(){return""},t}(DDZPlayCardSet);__reflect(DDZPlayCardErrorSet.prototype,"DDZPlayCardErrorSet");var DDZPlayCardFourWithTwoPairsSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerBombCards(e);if(0!==t.length){for(var a=[],r=4,n=0,o=this.pairs;n<o.length;n++){var i=o[n];if(a.length<r&&(a=a.concat(i.cards)),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var s=0,d=this.trioes;s<d.length;s++){var l=d[s];if(a.length<r&&(a=a.concat([l.cards[0],l.cards[1]])),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}}},t.prototype.getSoundEffectName=function(){return"poker_4_take_4_mp3"},t}(DDZPlayCardFourTakes);__reflect(DDZPlayCardFourWithTwoPairsSet.prototype,"DDZPlayCardFourWithTwoPairsSet");var DDZPlayCardFourTakesTwoSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerBombCards(e);if(0!==t.length){for(var a=[],r=2,n=0,o=this.singles;n<o.length;n++){var i=o[n];if(a.length<r&&!i.isBlackJoker()&&!i.isRedJoker())a.push(i.cards[0]);else if(a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var s=0,d=this.pairs;s<d.length;s++){var l=d[s];if(a.length<r&&a.push(l.cards[0]),a.length<r&&a.push(l.cards[1]),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var c=0,h=this.trioes;c<h.length;c++){var u=h[c];if(a.length<r&&a.push(u.cards[0]),a.length<r&&a.push(u.cards[1]),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var p=0,y=this.attachedBombs;p<y.length;p++){var f=y[p];if(a.length<r&&a.push(f.cards[0]),a.length<r&&a.push(f.cards[1]),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}}},t.prototype.getSoundEffectName=function(){return"poker_4_take_2_mp3"},t}(DDZPlayCardFourTakes);__reflect(DDZPlayCardFourTakesTwoSet.prototype,"DDZPlayCardFourTakesTwoSet");var DDZPlayCardHuoJianSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){},t.prototype.getSoundEffectName=function(){return"poker_huo_jian_mp3"},t}(DDZPlayCardSet);__reflect(DDZPlayCardHuoJianSet.prototype,"DDZPlayCardHuoJianSet");var DDZPlayCardPairSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=[],a=[],r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],i=e[o];i.isPair()&&this.value<i.value&&t.push(i),i.isTrio()&&this.value<i.value&&a.push(i)}var s=[];s=s.concat(t),s=s.concat(a);var d=s.length;if(1===d){var l=s[0];return DDZPlayCardSetFactory.createCardSet([l.cards[0],l.cards[1]])}for(var c=0;d>c;c+=1){var l=s[c];if(this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND)return this.lastFoundIndex=c,DDZPlayCardSetFactory.createCardSet([l.cards[0],l.cards[1]]);if(this.lastFoundIndex<c)return this.lastFoundIndex=c,c===d-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),DDZPlayCardSetFactory.createCardSet([l.cards[0],l.cards[1]])}},t.prototype.getSoundEffectName=function(){return 3===this.value?"poker_33_mp3":4===this.value?"poker_44_mp3":5===this.value?"poker_55_mp3":6===this.value?"poker_66_mp3":7===this.value?"poker_77_mp3":8===this.value?"poker_88_mp3":9===this.value?"poker_99_mp3":10===this.value?"poker_1010_mp3":11===this.value?"poker_JJ_mp3":12===this.value?"poker_QQ_mp3":13===this.value?"poker_KK_mp3":14===this.value?"poker_AA_mp3":15===this.value?"poker_22_mp3":""},t}(DDZPlayCardSet);__reflect(DDZPlayCardPairSet.prototype,"DDZPlayCardPairSet");var DDZConstant=function(){function e(){}return e.INDEX_NOT_FOUND=-1,e.DEFAULT_FARMER_CARDS_AMOUNT=17,e.DEFAULT_LANDLORD_CARDS_AMOUNT=20,e}();__reflect(DDZConstant.prototype,"DDZConstant");var DDZPlayCardSetFactory=function(){function e(){}return e.createCardSet=function(e){if(e){var t=e.slice(0);DDZCardAnalyzer.setCards(t);var a,r=DDZCardAnalyzer.getCardsType(),n=DDZCardAnalyzer.getCardsValue();switch(r){case 2:a=new DDZPlayCardSingleSet(t);break;case 3:a=new DDZPlayCardPairSet(t);break;case 4:a=new DDZPlayCardTrioTakesNoneSet(t);break;case 5:a=new DDZPlayCardTrioTakesSingleSet(t);break;case 6:a=new DDZPlayCardTrioTakesPairSet(t);break;case 7:a=new DDZPlayCardStraightSet(t);break;case 8:a=new DDZPlayCardConsecutivePairsSet(t);break;case 9:a=new DDZPlayCardAirplaneSet(t);break;case 10:a=new DDZPlayCardAirplaneTakesSinglesSet(t);break;case 11:a=new DDZPlayCardAirplaneTakesPairsSet(t);break;case 12:a=new DDZPlayCardFourTakesTwoSet(t);break;case 13:a=new DDZPlayCardFourWithTwoPairsSet(t);break;case 14:a=new DDZPlayCardBombSet(t);break;case 15:a=new DDZPlayCardHuoJianSet(t);break;case 1:a=new DDZPlayCardEmptySet(t);break;default:a=new DDZPlayCardErrorSet(t)}return a.value=n,a.cardTypeName=r,a}},e}();__reflect(DDZPlayCardSetFactory.prototype,"DDZPlayCardSetFactory");var DDZPlayCardSingleSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=[],a=[],r=[],n=0,o=Object.keys(e);n<o.length;n++){var i=o[n],s=e[i];s.isSingle()&&this.value<s.value&&t.push(s),s.isPair()&&this.value<s.value&&a.push(s),s.isTrio()&&this.value<s.value&&r.push(s)}var d=[];d=d.concat(t),d=d.concat(a),d=d.concat(r);var l=d.length;if(1===l)return DDZPlayCardSetFactory.createCardSet([d[0].cards[0]]);for(var c=0;l>c;c+=1){var h=d[c];if(this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND)return this.lastFoundIndex=c,DDZPlayCardSetFactory.createCardSet([h.cards[0]]);if(this.lastFoundIndex<c)return this.lastFoundIndex=c,c===l-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),DDZPlayCardSetFactory.createCardSet([h.cards[0]])}},t.prototype.getSoundEffectName=function(){return 3===this.value?"poker_3_mp3":4===this.value?"poker_4_mp3":5===this.value?"poker_5_mp3":6===this.value?"poker_6_mp3":7===this.value?"poker_7_mp3":8===this.value?"poker_8_mp3":9===this.value?"poker_9_mp3":10===this.value?"poker_10_mp3":11===this.value?"poker_J_mp3":12===this.value?"poker_Q_mp3":13===this.value?"poker_K_mp3":14===this.value?"poker_A_mp3":15===this.value?"poker_2_mp3":16===this.value?"poker_black_joker_mp3":17===this.value?"poker_red_joker_mp3":""},t}(DDZPlayCardSet);__reflect(DDZPlayCardSingleSet.prototype,"DDZPlayCardSingleSet");var DDZPlayCardStraightSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=this.countCards(),a=[],r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],i=e[o];a.push(i)}for(var s=a.length,d=s-1,l=0;d>=l;l+=1){var c=l+t-1;if(c>d)return;var h=a[c];if(15<=h.value)return;var u=a[l];if(this.canBeBiggerConsetutive(u,h,t)){if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND&&l<=this.lastFoundIndex)continue;if(this.lastFoundIndex=l,d>c){var p=a[c+1];(p.value-h.value!==1||15<=p.value)&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND)}else c===d&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND);for(var y=a.slice(l,c+1),f=[],g=0,m=y;g<m.length;g++){var v=m[g];f=f.concat([v.cards[0]])}return DDZPlayCardSetFactory.createCardSet(f)}}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var C=this.lastFoundIndex,D=this.lastFoundIndex+t-1;if(D>=s)return;if(15<=a[D].value)return;if(a[D].value-a[C].value!==t-1)return;for(var P=a.slice(C,D+1),f=[],_=0,S=P;_<S.length;_++){var I=S[_];f=f.concat([I.cards[0]])}return DDZPlayCardSetFactory.createCardSet(f)}},t.prototype.getSoundEffectName=function(){return"poker_straight_mp3"},t}(DDZPlayCardSet);__reflect(DDZPlayCardStraightSet.prototype,"DDZPlayCardStraightSet");var DDZCacheModel=function(){function e(){}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.removeItemForKey=function(e){egret.localStorage.removeItem(e)},e.prototype.setString=function(e,t){egret.localStorage.setItem(e,t)},e.prototype.stringForKey=function(e){return egret.localStorage.getItem(e)},e.prototype.setBoolean=function(e,t){t?egret.localStorage.setItem(e,"yes"):egret.localStorage.setItem(e,"no")},e.prototype.booleanForKey=function(e){var t=egret.localStorage.getItem(e);return"yes"===t?!0:!1},e}();__reflect(DDZCacheModel.prototype,"DDZCacheModel");var DDZPlayCardTrioTakesNoneSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerTrioCards(e);if(0!==t.length)return DDZPlayCardSetFactory.createCardSet(t)},t.prototype.getSoundEffectName=function(){return 3===this.value?"poker_333_mp3":4===this.value?"poker_444_mp3":5===this.value?"poker_555_mp3":6===this.value?"poker_666_mp3":7===this.value?"poker_777_mp3":8===this.value?"poker_888_mp3":9===this.value?"poker_999_mp3":10===this.value?"poker_101010_mp3":11===this.value?"poker_JJJ_mp3":12===this.value?"poker_QQQ_mp3":13===this.value?"poker_KKK_mp3":14===this.value?"poker_AAA_mp3":15===this.value?"poker_222_mp3":""},t}(DDZPlayCardTrioTakes);__reflect(DDZPlayCardTrioTakesNoneSet.prototype,"DDZPlayCardTrioTakesNoneSet");var DDZPlayCardTrioTakesPairSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerTrioCards(e);if(0!==t.length){if(0!==this.pairs.length)return DDZPlayCardSetFactory.createCardSet(t.concat(this.pairs[0].cards));for(var a=0,r=this.trioes;a<r.length;a++){var n=r[a];if(n.value!==t[0].value)return DDZPlayCardSetFactory.createCardSet(t.concat([n.cards[0],n.cards[1]]))}}},t.prototype.getSoundEffectName=function(){return"poker_3_take_2_mp3"},t}(DDZPlayCardTrioTakes);__reflect(DDZPlayCardTrioTakesPairSet.prototype,"DDZPlayCardTrioTakesPairSet");var DDZPlayCardTrioTakesSingleSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerTrioCards(e);if(0!==t.length){if(0!==this.singles.length)return DDZPlayCardSetFactory.createCardSet(t.concat(this.singles[0].cards));if(0!==this.pairs.length)return DDZPlayCardSetFactory.createCardSet(t.concat([this.pairs[0].cards[0]]));for(var a=0,r=this.trioes;a<r.length;a++){var n=r[a];if(n.value!==t[0].value)return DDZPlayCardSetFactory.createCardSet(t.concat([n.cards[0]]))}}},t.prototype.getSoundEffectName=function(){return"poker_3_take_1_mp3"},t}(DDZPlayCardTrioTakes);__reflect(DDZPlayCardTrioTakesSingleSet.prototype,"DDZPlayCardTrioTakesSingleSet");var DDZClockView=function(e){function t(){var t=e.call(this)||this;return t.remainTime=0,t.isTimerEnded=!1,t.skinName="DDZClockUI",t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.stopCountDown()},t.prototype.startCountDown=function(e){this.stopwatchTimer||(this.visible=!0,this.isTimerEnded=!1,this.remainTime=e,this.stopwatchLabel.text=this.remainTime.toString(),this.stopwatchTimer=new egret.Timer(1e3,0),this.stopwatchTimer.addEventListener(egret.TimerEvent.TIMER,this.timerCall,this),this.stopwatchTimer.start())},t.prototype.stopCountDown=function(){this.stopwatchTimer&&(this.isTimerEnded=!0,this.visible=!1,this.stopwatchTimer.stop(),this.stopwatchTimer.removeEventListener(egret.TimerEvent.TIMER,this.timerCall,this),this.stopwatchTimer=void 0)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.reset(),this.visible=!1},t.prototype.reset=function(){this.stopwatchLabel.text=""},t.prototype.timerCall=function(e){return this.isTimerEnded?void this.stopCountDown():(this.remainTime-=1,this.remainTime<1?(this.stopCountDown(),void(this.stopwatchFinishedHandler&&this.stopwatchFinishedHandler())):void(this.stopwatchLabel.text=this.remainTime.toString()))},t}(QPLayer);__reflect(DDZClockView.prototype,"DDZClockView");var DDZGameOverLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZGameOverUI",t.continueButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressContinueButton,t),QPApplication.sharedInstance().isWebOnReactNative()?t.downloadLaiwanButton.visible=!1:t.downloadLaiwanButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressDownloadLaiwanButton,t),t.topToolbar.pressCloseButtonHandler=t.onPressCloseButton.bind(t),t}return __extends(t,e),t.prototype.updateSettlementResult=function(e,t,a){if(e&&t&&a){var r=e>0?"+"+e:""+e,n=t>0?"+"+t:""+t,o=a>0?"+"+a:""+a;this.leftPlayerScoreLabel.text=r,this.rightPlayerScoreLabel.text=n,this.bottomPlayerScoreLabel.text=o}},t.prototype.showWinner=function(){this.resultImage.source="image_winner_png",this.continueButton.img.source="btn_winner_continue_png"},t.prototype.showLoser=function(){this.resultImage.source="image_loser_png",this.continueButton.img.source="btn_loser_continue_png"},t.prototype.onPressContinueButton=function(){this.pressedContinueGameHandler()},t.prototype.onPressDownloadLaiwanButton=function(){var e=window.open(""+QPApiConfig.DownloadHost,"_blank");e.focus()},t.prototype.onPressCloseButton=function(){this.pressedCloseButtonHandler&&this.pressedCloseButtonHandler()},t}(QPLayer);__reflect(DDZGameOverLayer.prototype,"DDZGameOverLayer");var DDZLandlordCardsView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLandlordCardsUI",t.visible=!1,t}return __extends(t,e),t.prototype.setCards=function(e){3===e.length&&(this.cardOne.setImage(e[0].getImageName()),this.cardTwo.setImage(e[1].getImageName()),this.cardThree.setImage(e[2].getImageName()),this.show())},t.prototype.show=function(){this.y=-80,this.visible=!0,egret.Tween.get(this).to({y:0},300)},t.prototype.hide=function(){this.visible=!1},t}(QPLayer);__reflect(DDZLandlordCardsView.prototype,"DDZLandlordCardsView");var DDZMatchPlayerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameMatchPlayerUI",t}return __extends(t,e),t.prototype.showWaitForStartGame=function(){this.informationImage.source="img_wait_for_starting_png",this.show()},t.prototype.showMatchPlayer=function(){this.informationImage.source="img_matching_player_png",this.show()},t.prototype.hide=function(){this.visible=!1},t.prototype.show=function(){this.visible=!0},t}(QPLayer);__reflect(DDZMatchPlayerView.prototype,"DDZMatchPlayerView");var DDZPlayGameBottomToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameBottomToolbarUI",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.chatButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressChatButton,this)},t.prototype.onPressChatButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressChatButtonHandler()},t}(QPLayer);__reflect(DDZPlayGameBottomToolbar.prototype,"DDZPlayGameBottomToolbar");var DDZTopToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameTopToolbarUI",t.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBack,t),t.taskButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressTask,t),t.packageButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressPackage,t),t.settingsButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressSettings,t),t}return __extends(t,e),t.prototype.onPressBack=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBackHandler&&this.pressBackHandler()},t.prototype.onPressTask=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressTaskHandler&&this.pressTaskHandler()},t.prototype.onPressPackage=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressPackageHandler&&this.pressPackageHandler()},t.prototype.onPressSettings=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressSettingsHandler&&this.pressSettingsHandler()},t}(QPLayer);__reflect(DDZTopToolbar.prototype,"DDZTopToolbar");var DDZColor=function(){function e(){}return e.YELLOW=16571778,e.BROWN=10041347,e}();__reflect(DDZColor.prototype,"DDZColor");var DDZCallLandlordButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZCallLandlordButtonsUI",t}return __extends(t,e),t.prototype.enableButtons=function(){this.buJiaoButton.enabled=!0,this.callOnePointButton.enabled=!0,this.callTwoPointButton.enabled=!0,this.callThreePointButton.enabled=!0},t.prototype.disableButtons=function(){this.buJiaoButton.enabled=!1,this.callOnePointButton.enabled=!1,this.callTwoPointButton.enabled=!1,this.callThreePointButton.enabled=!1},t.prototype.disableCallOnePointButton=function(){this.callOnePointButton.enabled=!1},t.prototype.disableCallTwoPointButton=function(){this.callTwoPointButton.enabled=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.buJiaoButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressBuJiaoButton,this),this.callOnePointButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressOnePointButton,this),this.callTwoPointButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressTwoPointButton,this),this.callThreePointButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressThreePointButton,this)},t.prototype.onPressBuJiaoButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.NOT_CALL_LANDLORD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressOnePointButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.CALL_ONE_POINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressTwoPointButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.CALL_TWO_POINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressThreePointButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.CALL_THREE_POINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZCallLandlordButtons.prototype,"DDZCallLandlordButtons");var DDZMustPlayCardButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZMustPlayCardButtonsUI",t}return __extends(t,e),t.prototype.disablePlayButton=function(){this.playButton.enabled=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.playButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressPlayButton,this),this.hintButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressHintButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListeners,this)},t.prototype.removeListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListeners,this)},t.prototype.enablePlayButton=function(){this.playButton.enabled=!0},t.prototype.onPressPlayButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disablePlayButton();var e=new DDZButtonEvent(DDZButtonEvent.PLAY_CARD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressHintButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.HINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZMustPlayCardButtons.prototype,"DDZMustPlayCardButtons");var DDZNoBiggerCardsButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZNoBiggerCardsButtonsUI",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.noBiggerCardsButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressNoBiggerCardsButton,this)},t.prototype.onPressNoBiggerCardsButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.NOT_PLAY_CARD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZNoBiggerCardsButtons.prototype,"DDZNoBiggerCardsButtons");var DDZPlayCardButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayCardButtonsUI",t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),this.addListeners()},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.removeListeners()},t.prototype.disablePlayButton=function(){this.playButton.enabled=!1},t.prototype.addListeners=function(){this.notPlayButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressNotPlayButton,this),this.hintButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressHintButton,this),this.playButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressPlayButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this)},t.prototype.removeListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this)},t.prototype.enablePlayButton=function(){this.playButton.enabled=!0},t.prototype.onPressNotPlayButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.NOT_PLAY_CARD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressHintButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.HINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressPlayButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.PLAY_CARD);this.disablePlayButton(),DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZPlayCardButtons.prototype,"DDZPlayCardButtons");var DDZPlayGameButtonsContainer=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameButtonsContainerUI",t}return __extends(t,e),t.prototype.hideAllButtons=function(){this.callLandlordButtons.setVisible(!1),this.playCardButtons.setVisible(!1),this.mustPlayCardButtons.setVisible(!1),this.noBiggerCardsButtons.setVisible(!1),this.startGameButton.visible=!1},t.prototype.disableCallOnePointButton=function(){this.callLandlordButtons.disableCallOnePointButton()},t.prototype.disableCallTwoPointButton=function(){this.callLandlordButtons.disableCallTwoPointButton()},t.prototype.showCallLandlordButtons=function(){this.hideAllButtons(),this.callLandlordButtons.setVisible(!0),this.callLandlordButtons.enableButtons()},t.prototype.showPlayCardButtons=function(){this.hideAllButtons(),this.playCardButtons.setVisible(!0),this.playCardButtons.disablePlayButton()},t.prototype.showNoBiggerCardsButtons=function(){this.hideAllButtons(),this.noBiggerCardsButtons.setVisible(!0)},t.prototype.showMustPlayCardButtons=function(){this.hideAllButtons(),this.mustPlayCardButtons.setVisible(!0),this.mustPlayCardButtons.disablePlayButton()},t.prototype.showStartGameButton=function(){this.hideAllButtons(),this.startGameButton.visible=!0},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.hideAllButtons(),this.startGameButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressStartGameButton,this)},t.prototype.onPressStartGameButton=function(){var e=new DDZButtonEvent(DDZButtonEvent.START_GAME);DDZEventCenter.sharedInstance().dispatchEvent(e),this.hideAllButtons()},t}(QPLayer);__reflect(DDZPlayGameButtonsContainer.prototype,"DDZPlayGameButtonsContainer");var DDZBottomPlayerHandCardsView=function(e){function t(){var t=e.call(this)||this;return t.ANIMATION_CARD_TOP_LINE_INITIAL_X=325,t.ANIMATION_CARD_TOP_LINE_INITIAL_Y=270,t.ANIMATION_CARD_BOTTOM_LINE_INITIAL_X=325,t.ANIMATION_CARD_BOTTOM_LINE_INITIAL_Y=387,t.ANIMATION_CARD_HORIZONTAL_GAP=55,t.ANIMATION_CARD_SPEED=3.106,t.skinName="DDZBottomPlayerHandCardsUI",t.dealCardModel=new DDZDealCardModel,t}return __extends(t,e),t.prototype.dealCards=function(e){this.dealCardModel.setCards(e),this.rearCardListView.setCards(this.dealCardModel.listRearCards()),this.playDealCardsAnimation()},t.prototype.setCards=function(e){this.distributeCards(e)},t.prototype.showBottomCards=function(){this.bottomCardsGroup.visible=!0},t.prototype.hideBottomCards=function(){this.bottomCardsGroup.visible=!1,this.bottomCardsGroup.scaleX=1,this.bottomCardsGroup.scaleY=1},t.prototype.playHideBottomCardsAnimation=function(e){var t=this;egret.Tween.get(this.bottomCardsGroup).to({y:-150,scaleX:.4,scaleY:.4},200).call(function(){t.hideBottomCards(),e()})},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.rearCardOriginPosition=new egret.Point(this.rearCardView.x,this.rearCardView.y)},t.prototype.distributeCards=function(e){var t=e.length,a=e.slice(0,10);if(this.topHandCardListView.setCards(a),t>10){var r=e.slice(10);this.bottomHandCardListView.setCards(r)}else this.bottomHandCardListView.setCards([])},t.prototype.playDealCardsAnimation=function(){var e=this;if(this.dealCardModel.isAllCardsDealt())return this.distributeCards(this.dealCardModel.listCards()),this.dealCardAnimationDidFinishedHandler&&this.dealCardAnimationDidFinishedHandler(),this.rearCardView.visible=!1,void this.showBottomCards();this.rearCardView.visible=!0,this.dealCardModel.dealOneCard();var t=this.dealCardModel.countDealtCards(),a=this.ANIMATION_CARD_TOP_LINE_INITIAL_X,r=this.ANIMATION_CARD_TOP_LINE_INITIAL_Y;t>=10&&(a=this.ANIMATION_CARD_BOTTOM_LINE_INITIAL_X,r=this.ANIMATION_CARD_BOTTOM_LINE_INITIAL_Y);var n=Math.abs(this.rearCardOriginPosition.x-a),o=r-this.rearCardOriginPosition.y,i=Math.floor(Math.sqrt(n*n+o*o)),s=i/this.ANIMATION_CARD_SPEED;QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.SEND_CARD,1),egret.Tween.get(this.rearCardView).to({x:a,y:r},s).call(function(){e.rearCardListView.setCards(e.dealCardModel.listRearCards()),e.distributeCards(e.dealCardModel.listDealtCards()),e.rearCardView.x=e.rearCardOriginPosition.x,e.rearCardView.y=e.rearCardOriginPosition.y,e.playDealCardsAnimation()})},t}(QPLayer);__reflect(DDZBottomPlayerHandCardsView.prototype,"DDZBottomPlayerHandCardsView");var DDZBaseProgressBar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setProgress=function(e,t){this.value=Math.floor(e/t*100),this.finishedAmountLabel.text=String(e),this.totalAmountLabel.text=String(t)},t}(eui.ProgressBar);__reflect(DDZBaseProgressBar.prototype,"DDZBaseProgressBar");var DDZHandCardListView=function(e){function t(){var t=e.call(this)||this;return t.CardSpace=58,t.CardWidth=126,t.CardHeight=182,t.CardVerticalGap=-60,t.skinName="DDZCardListUI",t}return __extends(t,e),t.prototype.setCards=function(e){var t=e.length;this.cardList.dataProvider=new eui.ArrayCollection(e),10>=t?(this.width=this.CardWidth+(t-1)*this.CardSpace,this.height=this.CardHeight):(this.width=650,this.height=2*this.CardHeight+this.CardVerticalGap)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.cardList.allowMultipleSelection=!1,this.cardList.itemRenderer=DDZHandCardView;var t=new eui.TileLayout;t.horizontalGap=this.CardSpace-this.CardWidth,t.verticalGap=this.CardVerticalGap,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.cardList.layout=t},t}(DDZCardListView);__reflect(DDZHandCardListView.prototype,"DDZHandCardListView");var DDZPlayedCardListView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CardSpace=32,t.CardVerticalGap=-40,t.CardWidth=80,t.CardHeight=112,t}return __extends(t,e),t.prototype.setCards=function(e){var t=e.length;this.cardList.dataProvider=new eui.ArrayCollection(e),10>=t?(this.width=this.CardWidth+(t-1)*this.CardSpace,this.height=this.CardHeight):(this.width=368,this.height=2*this.CardHeight+this.CardVerticalGap)
},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.cardList.itemRenderer=DDZPlayedCardView;var t=new eui.TileLayout;t.horizontalGap=this.CardSpace-this.CardWidth,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalGap=this.CardVerticalGap,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.cardList.layout=t},t}(DDZCardListView);__reflect(DDZPlayedCardListView.prototype,"DDZPlayedCardListView");var DDZRearCardListView=function(e){function t(){var t=e.call(this)||this;return t.CardSpace=20,t.CardWidth=105,t.CardHeight=140,t.skinName="DDZCardListUI",t}return __extends(t,e),t.prototype.setCards=function(e){this.cardList.dataProvider=new eui.ArrayCollection(e),this.width=this.CardWidth+(e.length-1)*this.CardSpace},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.cardList.allowMultipleSelection=!1,this.cardList.itemRenderer=DDZRearCardView;var t=new eui.TileLayout;t.horizontalGap=-85,t.verticalGap=0,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.cardList.layout=t},t}(DDZCardListView);__reflect(DDZRearCardListView.prototype,"DDZRearCardListView");var DDZEmptyContentView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZEmptyContentViewUI",t}return __extends(t,e),t}(QPLayer);__reflect(DDZEmptyContentView.prototype,"DDZEmptyContentView");var DDZTabbar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setItems=function(e){this.tabbar.dataProvider=new eui.ArrayCollection(e)},t.prototype.setSelectedIndex=function(e){this.tabbar.selectedIndex=e},t}(QPLayer);__reflect(DDZTabbar.prototype,"DDZTabbar");var DDZHandCardView=function(e){function t(){var t=e.call(this)||this;return t.isCardPositionChanged=!1,t.skinName="DDZCardUI",t.touchChildren=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.touchBeginHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.touchMoveHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_END,t.touchEndHandler,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.removeListeners,t),DDZEventCenter.sharedInstance().addEventListener(DDZHandCardEvent.TOUCH_END,t.reset,t),t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.isSelect?this.toSelectedPosition():this.toOriginPosition()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.toOriginPosition()},t.prototype.removeListeners=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListeners,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEndHandler,this),DDZEventCenter.sharedInstance().removeEventListener(DDZHandCardEvent.TOUCH_END,this.reset,this)},t.prototype.toOriginPosition=function(){this.contentGroup.y=t.ORIGIN_POS},t.prototype.toSelectedPosition=function(){this.contentGroup.y=t.SELECTED_POS},t.prototype.touchBeginHandler=function(e){this.isCardPositionChanged||this.switchCardPosition()},t.prototype.touchMoveHandler=function(){this.isCardPositionChanged||this.switchCardPosition()},t.prototype.touchEndHandler=function(e){var t=new DDZHandCardEvent(DDZHandCardEvent.TOUCH_END);DDZEventCenter.sharedInstance().dispatchEvent(t),QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CHOOSE_CARD,1)},t.prototype.switchCardPosition=function(){this.isCardPositionChanged=!0,this.data.isSelect=!this.data.isSelect,this.data.isSelect?this.toSelectedPosition():this.toOriginPosition();var e=new DDZHandCardEvent(DDZHandCardEvent.TOUCHED);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.reset=function(){this.isCardPositionChanged=!1},t.ORIGIN_POS=0,t.SELECTED_POS=-30,t}(DDZCardView);__reflect(DDZHandCardView.prototype,"DDZHandCardView");var DDZPlayedCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayedCardUI",t}return __extends(t,e),t.prototype.setImage=function(e){this.image.source="played_"+e},t}(DDZCardView);__reflect(DDZPlayedCardView.prototype,"DDZPlayedCardView");var DDZRearCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZRearCardUI",t}return __extends(t,e),t}(DDZBaseCardView);__reflect(DDZRearCardView.prototype,"DDZRearCardView");var DDZCardListLeftToRightAnimation=function(){function e(e){this.target=e.target}return e.prototype.play=function(){this.target.x=-200,egret.Tween.get(this.target).to({x:0},100)},e}();__reflect(DDZCardListLeftToRightAnimation.prototype,"DDZCardListLeftToRightAnimation",["DDZCardAnimation"]);var DDZCardListRightToLeftAnimation=function(){function e(e){this.target=e.target}return e.prototype.play=function(){this.target.x=200,egret.Tween.get(this.target).to({x:0},100)},e}();__reflect(DDZCardListRightToLeftAnimation.prototype,"DDZCardListRightToLeftAnimation",["DDZCardAnimation"]);var DDZLeaveGameAlertView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLeaveGameAlertViewUI",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.popup.pressExitHandler=this.leaveGame.bind(this),this.popup.pressCancelHandler=this.cancelLeaveGame.bind(this)},t.prototype.leaveGame=function(){this.leaveGameHandler&&this.leaveGameHandler()},t.prototype.cancelLeaveGame=function(){this.visible=!1},t}(QPLayer);__reflect(DDZLeaveGameAlertView.prototype,"DDZLeaveGameAlertView");var DDZLeaveGamePopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLeaveGamePopupUI",t.exitButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressExitButon,t),t.cancelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressCancelButton,t),t}return __extends(t,e),t.prototype.onPressExitButon=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressExitHandler&&this.pressExitHandler()},t.prototype.onPressCancelButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressCancelHandler&&this.pressCancelHandler()},t}(QPPopupLayer);__reflect(DDZLeaveGamePopup.prototype,"DDZLeaveGamePopup");var DDZActivePlayerSignView=function(e){function t(){var t=e.call(this)||this;return t.ROTATE_TIME=250,t.RIGHT_PLAYER_ANGLE=80,t.LEFT_PLAYER_ANGLE=10,t.BOTTOM_PLAYER_ANGLE=225,t.skinName="DDZActivePlayerSignUI",t}return __extends(t,e),t.prototype.hide=function(){this.leftPlayerSign.visible=!1,this.rightPlayerSign.visible=!1,this.bottomPlayerSign.visible=!1},t.prototype.rotateToLeftPlayer=function(){this.hide(),this.leftPlayerSign.rotation=this.RIGHT_PLAYER_ANGLE,this.leftPlayerSign.visible=!0,egret.Tween.get(this.leftPlayerSign).to({rotation:this.LEFT_PLAYER_ANGLE},this.ROTATE_TIME)},t.prototype.pointToLeftPlayer=function(){this.hide(),this.leftPlayerSign.rotation=this.LEFT_PLAYER_ANGLE,this.leftPlayerSign.visible=!0},t.prototype.rotateToRightPlayer=function(){this.hide(),this.rightPlayerSign.rotation=this.BOTTOM_PLAYER_ANGLE,this.rightPlayerSign.visible=!0,egret.Tween.get(this.rightPlayerSign).to({rotation:this.RIGHT_PLAYER_ANGLE-360},this.ROTATE_TIME)},t.prototype.pointToRightPlayer=function(){this.hide(),this.rightPlayerSign.rotation=this.RIGHT_PLAYER_ANGLE,this.rightPlayerSign.visible=!0},t.prototype.rotateToBottomPlayer=function(){this.hide(),this.bottomPlayerSign.rotation=this.LEFT_PLAYER_ANGLE,this.bottomPlayerSign.visible=!0,egret.Tween.get(this.bottomPlayerSign).to({rotation:this.BOTTOM_PLAYER_ANGLE-360},this.ROTATE_TIME)},t.prototype.pointToBottomPlayer=function(){this.hide(),this.bottomPlayerSign.rotation=this.BOTTOM_PLAYER_ANGLE,this.bottomPlayerSign.visible=!0},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.hide()},t}(QPLayer);__reflect(DDZActivePlayerSignView.prototype,"DDZActivePlayerSignView");var DDZLeftPlayerGameInfoView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLeftPlayerGameInfoUI",t}return __extends(t,e),t}(DDZPlayerGameInfoBaseView);__reflect(DDZLeftPlayerGameInfoView.prototype,"DDZLeftPlayerGameInfoView");var DDZTabbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTabbarItemUI",t}return __extends(t,e),t.prototype.dataChanged=function(){this.normalTitleLabel.text=this.data.title,this.selectedTitleLabel.text=this.data.title},t}(eui.ItemRenderer);__reflect(DDZTabbarItem.prototype,"DDZTabbarItem");var DDZPlayerRemainCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayerRemainCardUI",t.hLayout=new eui.HorizontalLayout,t.hLayout.horizontalAlign=egret.HorizontalAlign.CENTER,t.hLayout.verticalAlign=egret.VerticalAlign.MIDDLE,t.hLayout.gap=0,t}return __extends(t,e),t.prototype.setAmount=function(e){this.amountLabel.text=String(e),e>9&&20>e?this.hLayout.paddingRight=5:this.hLayout.paddingRight=0,this.amountLabelGroup.layout=this.hLayout},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.reset()},t.prototype.reset=function(){this.amountLabel.text=""},t}(QPLayer);__reflect(DDZPlayerRemainCardView.prototype,"DDZPlayerRemainCardView");var DDZPlayerStateView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayerStateUI",t.hideAllState(),t}return __extends(t,e),t.prototype.hideAllState=function(){this.callOnePointImage.visible=!1,this.callTwoPointImage.visible=!1,this.callThreePointImage.visible=!1,this.notCallLandlordImg.visible=!1,this.addTimesImg.visible=!1,this.notAddTimesImg.visible=!1,this.notPlayImg.visible=!1,this.waitForReady.visible=!1},t.prototype.showWaitForReady=function(e){this.waitForReady.visible=e},t.prototype.setState=function(e){switch(this.hideAllState(),e){case 1:this.callOnePointImage.visible=!0;break;case 2:this.callTwoPointImage.visible=!0;break;case 3:this.callThreePointImage.visible=!0;break;case 4:this.notCallLandlordImg.visible=!0;break;case 5:this.addTimesImg.visible=!0;break;case 7:this.notPlayImg.visible=!0;break;case 6:this.notAddTimesImg.visible=!0;break;case 8:this.waitForReady.visible=!0}},t}(QPLayer);__reflect(DDZPlayerStateView.prototype,"DDZPlayerStateView");var DDZPlayerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayerUI",t}return __extends(t,e),t.prototype.showLandlordSign=function(e){this.landlordHatImage.visible=e},t.prototype.setAvatar=function(e){var t=new egret.Texture;t.bitmapData=e,this.avatarImg.source=t,this.makeAvatarBecomRound()},t.prototype.setName=function(e){this.nameLabel.text=e},t.prototype.setScore=function(e){var t=e||0;this.scoreLabel.text="积分: "+t},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.landlordHatImage.visible=!1},t.prototype.makeAvatarBecomRound=function(){var e=new egret.Shape;e.graphics.beginFill(255);var t=this.avatarImg.width/2,a=this.avatarImg.width/2;e.graphics.drawCircle(t,t,a),e.graphics.endFill(),this.avatarGroup.addChild(e),this.avatarImg.mask=e},t}(QPLayer);__reflect(DDZPlayerView.prototype,"DDZPlayerView");var DDZRightPlayerGameInfoView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZRightPlayerGameInfoUI",t}return __extends(t,e),t}(DDZPlayerGameInfoBaseView);__reflect(DDZRightPlayerGameInfoView.prototype,"DDZRightPlayerGameInfoView");var DDZWarningLightView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZWarningLightUI",t}return __extends(t,e),t.prototype.show=function(){this.visible=!0,this.warningLightShine.gotoAndPlay("shine",-1)},t.prototype.hide=function(){this.visible=!1,this.warningLightShine.gotoAndStop("shine")},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=RES.getRes("warning_light_json"),a=RES.getRes("warning_light_png"),r=new egret.MovieClipDataFactory(t,a);this.warningLightShine=new egret.MovieClip(r.generateMovieClipData("shine")),this.contentGroup.addChild(this.warningLightShine),this.hide()},t}(QPLayer);__reflect(DDZWarningLightView.prototype,"DDZWarningLightView");var DDZPlayGameTopToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameTopToolbarUI",t}return __extends(t,e),t.prototype.updateContent=function(){800<Device.sharedInstance().getHeight()?this.closeButton.y=60:this.closeButton.y=20},t.prototype.showCloseButton=function(){this.closeButton.visible=!0,this.updateContent(),this.hideDownloadButton()},t.prototype.hideCloseButton=function(){this.closeButton.visible=!1},t.prototype.showDownloadButton=function(){this.downloadLaiwanButton.visible=!0,this.hideCloseButton()},t.prototype.hideDownloadButton=function(){this.downloadLaiwanButton.visible=!1},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCloseButton,this),this.downloadLaiwanButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressDownloadButton,this),QPApplication.sharedInstance().isWebOnReactNative()||this.showDownloadButton()},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressCloseButtonHandler()},t.prototype.onPressDownloadButton=function(){var e=window.open(""+QPApiConfig.DownloadHost,"_blank");e.focus()},t}(QPLayer);__reflect(DDZPlayGameTopToolbar.prototype,"DDZPlayGameTopToolbar");var TestGameModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.startTest=function(){this.testGameOver(),this.testHintTrioTakesSingle(),this.testHintTrioTakesSingleNoBiggerTrioInHand(),this.testHintStraightTarget5678910IHave78910JQKA()},t.prototype.testGameOver=function(){var e=new DDZGameServiceMessageGameOverData(mockGameOverPayload);this.assertEquals("Game Action expect to end_game","end_game",e.action),this.assertEquals("room id expect to 8b2a1a3d-2fec-4cc0-b392-4512d7d3f215","8b2a1a3d-2fec-4cc0-b392-4512d7d3f215",e.roomId),this.assertEquals("game is spring expect false",!1,e.isSpring);var t=e.gameOverPlayerInformations[0];this.assertEquals("player's id expect to aaaaaaaa-7a8e-4f14-bdeb-df27796c39a2","aaaaaaaa-7a8e-4f14-bdeb-df27796c39a2",t.playerId);var a=e.gameOverPlayerInformations[1];this.assertEquals("player's id expect to bbbbbbbb-77d8-49a4-9616-4fa07f987039","bbbbbbbb-77d8-49a4-9616-4fa07f987039",a.playerId);var r=e.gameOverPlayerInformations[2];this.assertEquals("player's id expect to  cccccccc-8a2e-46c6-9723-57caa2a61c4c","cccccccc-8a2e-46c6-9723-57caa2a61c4c",r.playerId)},t.prototype.testHintTrioTakesSingle=function(){var e=new DDZHandCardModel,t=["8s","8h","8c","5s"].map(function(e){return new DDZCard(e)}),a=["ts","th","tc","9s","7h","2s","2s","2s"].map(function(e){return new DDZCard(e)});e.setCards(a);var r=DDZPlayCardSetFactory.createCardSet(t);e.hint(r);var n=e.listSelectedCards(),o=DDZPlayCardSetFactory.createCardSet(n);this.assertEquals("test hint trio takes single target cardtype expected to 5",5,o.cardTypeName)},t.prototype.testHintTrioTakesSingleNoBiggerTrioInHand=function(){var e=new DDZHandCardModel,t=["as","ah","ac","5s"].map(function(e){return new DDZCard(e)}),a=["ts","th","tc","9s","7h","qs","qs","qs"].map(function(e){return new DDZCard(e)});e.setCards(a);var r=DDZPlayCardSetFactory.createCardSet(t);e.hint(r);var n=e.listSelectedCards(),o="test hint trio takes single no bigger trio in hand expected found cards length 0";this.assert(o,0===n.length)},t.prototype.testHintStraightTarget5678910IHave78910JQKA=function(){var e=new DDZHandCardModel,t=["5h","7d","8d","9d","td","th","jd","qh","qs","kh","ac","2c","2h","bj"].map(function(e){return new DDZCard(e)});e.setCards(t);var a=["5s","6h","7h","8s","9s","ts"].map(function(e){return new DDZCard(e)}),r=DDZPlayCardSetFactory.createCardSet(a);e.hint(r);var n=e.listSelectedCards(),o="1st hint testHintStraightTarget5678910IHave78910JQKA first and last card expect qh&7d";this.assertEquals(o,"qh&7d",n[0].code+"&"+n[n.length-1].code),e.hint(r),n=e.listSelectedCards(),o="2nd hint testHintStraightTarget5678910IHave78910JQKA first and last card expect kh&8d",this.assertEquals(o,"kh&8d",n[0].code+"&"+n[n.length-1].code),e.hint(r),n=e.listSelectedCards(),o="3rd hint testHintStraightTarget5678910IHave78910JQKA first and last card expect ac&9d",this.assertEquals(o,"ac&9d",n[0].code+"&"+n[n.length-1].code),e.hint(r),n=e.listSelectedCards(),o="4th hint testHintStraightTarget5678910IHave78910JQKA first and last card expect qh&7d",this.assertEquals(o,"qh&7d",n[0].code+"&"+n[n.length-1].code),e.hint(r),n=e.listSelectedCards(),o="5th hint testHintStraightTarget5678910IHave78910JQKA first and last card expect kh&8d",this.assertEquals(o,"kh&8d",n[0].code+"&"+n[n.length-1].code),e.hint(r),n=e.listSelectedCards(),o="6th hint testHintStraightTarget5678910IHave78910JQKA first and last card expect ac&9d",this.assertEquals(o,"ac&9d",n[0].code+"&"+n[n.length-1].code)},t}(QPTestCase);__reflect(TestGameModel.prototype,"TestGameModel");var mockGameOverPayload={action:"end_game",sent_at:"2018-01-31T09:50:42.849090",room_id:"8b2a1a3d-2fec-4cc0-b392-4512d7d3f215",is_slam:!1,players:[{player_id:"aaaaaaaa-7a8e-4f14-bdeb-df27796c39a2",remain_cards:["3h","5d","6c","6h","7c","7h","9c","ac","ah","tc","td","th"],settlement:{balance:"19100",dealt_amount:"300",frozen_amount:"0",total_amount:"19100"}},{player_id:"bbbbbbbb-77d8-49a4-9616-4fa07f987039",remain_cards:[],settlement:{balance:"19100",dealt_amount:"300",frozen_amount:"0",total_amount:"19100"}},{player_id:"cccccccc-8a2e-46c6-9723-57caa2a61c4c",remain_cards:["2d","bw"],settlement:{balance:"19100",dealt_amount:"-600",frozen_amount:"0",total_amount:"19100"}}],ended_at:"2017-12-19T06:50:48.053709"},DDZUserInfoScene=function(e){function t(t,a){var r=e.call(this)||this;return r.skinName="DDZUserInfoSceneUI",r.userAttribute=a,r.backgroundImage.source=t,r.popup.pressCloseButtonHandler=r.goBack.bind(r),r.popup.pressSwitchAccountButtonHandler=r.switchAccount.bind(r),r.popup.pressBindPhoneButtonHandler=r.bindPhone.bind(r),r}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.popup.setUserInfo(this.userAttribute)},t.prototype.goBack=function(){qp.SceneManager.sharedInstance().popScene()},t.prototype.switchAccount=function(){},t.prototype.bindPhone=function(){qp.SceneManager.sharedInstance().pushScene(new DDZBindAccountScene)},t}(QPScene);__reflect(DDZUserInfoScene.prototype,"DDZUserInfoScene");var DDZBindAccountScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZBindAccountSceneUI",t.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBackButton,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.bindPhonePopup.pressBindHandler=this.bindAccount.bind(this),this.bindPhonePopup.pressGetVerificationCodeButtonHandler=this.getVerificationCode.bind(this)},t.prototype.getVerificationCode=function(e){var t=this;UserModel.sharedInstance().inputtedAttributeModel.setPhoneNumber(e);var a=UserModel.sharedInstance().actionDataFactory.makeSendVerificationCodeData();a.isLegal&&this.bindPhonePopup.disableSendVerificationCodeButton(),UserModel.sharedInstance().actionModel.sendVerificationCode(a,function(e){UserModel.sharedInstance().inputtedAttributeModel.setCountryCode("86"),UserModel.sharedInstance().attributeModel.setHashDigest(e.hash_digest),UserModel.sharedInstance().attributeModel.setExpireISOTime(e.expire_iso_time)},function(e){QPAlert.sharedInstance().showOKButtonAt(t,e.message)})},t.prototype.bindAccount=function(e,t,a){var r=this;UserModel.sharedInstance().inputtedAttributeModel.setPhoneNumber(e),UserModel.sharedInstance().inputtedAttributeModel.setPassword(t),UserModel.sharedInstance().inputtedAttributeModel.setVerificationCode(a);var n=new QPLoadingScene;n.show("正在发送请求");var o=UserModel.sharedInstance().actionDataFactory.makeBindPhoneData();UserModel.sharedInstance().actionModel.bindPhone(o,function(e){n.hide(),UserModel.sharedInstance().attributeModel.setHasBindPhoneNumber(!0),QPAlert.sharedInstance().showOKButtonAt(r,"手机号绑定成功"),QPAlert.sharedInstance().pressedOKHandler=function(){r.onPressBackButton()};var t=new DDZDataEvent(DDZDataEvent.UPDATE);DDZEventCenter.sharedInstance().dispatchEvent(t)},function(e){n.hide(),QPAlert.sharedInstance().showOKButtonAt(r,e.message)})},t.prototype.onPressBackButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),qp.SceneManager.sharedInstance().popScene()},t}(QPScene);__reflect(DDZBindAccountScene.prototype,"DDZBindAccountScene");var DDZBindAccountTextInput=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.TextInput);__reflect(DDZBindAccountTextInput.prototype,"DDZBindAccountTextInput");var DDZBindPhonePopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZBindPhonePopupUI",t.getVerificationCodeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressGetVerificationCodeButton,t),t.bindButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBindButton,t),t}return __extends(t,e),t.prototype.onExit=function(){e.prototype.onExit.call(this),this.getVerificationCodeButton.stopCountDown()},t.prototype.disableSendVerificationCodeButton=function(){this.getVerificationCodeButton.disable()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.phoneInput.prompt="请输入电话号码",this.passwordInput.prompt="请输入长度为6-50位的密码",this.passwordInput.displayAsPassword=!0,this.verificationCodeInput.prompt="请输入验证码",this.descriptionLabel.text="为账号"+UserModel.sharedInstance().attributeModel.getNickname()+"绑定手机号"},t.prototype.onPressGetVerificationCodeButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressGetVerificationCodeButtonHandler(this.phoneInput.text)},t.prototype.onPressBindButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBindHandler(this.phoneInput.text,this.passwordInput.text,this.verificationCodeInput.text)},t}(QPPopupLayer);__reflect(DDZBindPhonePopup.prototype,"DDZBindPhonePopup");var DDZGetVerificationCodeButton=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.disable=function(){this.enabled=!1,this.labelDisplay.text="60s 重新获取",this.startCountDown()},t.prototype.stopCountDown=function(){this.stopwatch&&(this.labelDisplay.text="",this.stopwatch.stop(),this.stopwatch=void 0,this.enabled=!0)},t.prototype.startCountDown=function(){this.stopwatch||(this.stopwatch=new egret.Timer(1e3,0),this.stopwatch.addEventListener(egret.TimerEvent.TIMER,this.stopwatchFunction,this),this.remainStopwatchValue=t.STOP_WATCH_VALUE,this.stopwatch.start())},t.prototype.stopwatchFunction=function(){return this.remainStopwatchValue-=1,this.remainStopwatchValue<1?void this.stopCountDown():void(this.labelDisplay.text=this.remainStopwatchValue+"s 重新获取")},t.STOP_WATCH_VALUE=60,t}(eui.Button);__reflect(DDZGetVerificationCodeButton.prototype,"DDZGetVerificationCodeButton");var DDZUserInfoAvatar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoAvatarUI",t}return __extends(t,e),t.prototype.setAvatar=function(e){this.avatarImage.source=e},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.avatarButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressedAvatarButton,this)},t.prototype.onPressedAvatarButton=function(){this.onPressedHandler&&this.onPressedHandler()},t}(QPLayer);__reflect(DDZUserInfoAvatar.prototype,"DDZUserInfoAvatar");var DDZUserInfoEditPopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoEditPopupUI",t}return __extends(t,e),t.prototype.setCurrentUserInfo=function(e){this.nameInput.text=e.getNickname()},t.prototype.getNameValue=function(){return this.nameInput.text},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.cancelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCancelButton,this),this.saveButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressSaveButton,this);var t=new eui.RadioButtonGroup;t.addEventListener(eui.UIEvent.CHANGE,this.radioChangedHandler,this),this.maleRadioButton.group=t,this.femaleRadioButton.group=t},t.prototype.radioChangedHandler=function(e){var t=e.target;egret.log(t.selectedValue)},t.prototype.onPressCancelButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressedCancelHandler()},t.prototype.onPressSaveButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressedSaveHandler()},t}(QPPopupLayer);__reflect(DDZUserInfoEditPopup.prototype,"DDZUserInfoEditPopup");var DDZUserInfoEditScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoEditSceneUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.popup.pressedCancelHandler=this.cancelEditUserInfo.bind(this),this.popup.pressedSaveHandler=this.saveEditUserInfo.bind(this),this.popup.setCurrentUserInfo(UserModel.sharedInstance().attributeModel)},t.prototype.cancelEditUserInfo=function(){qp.SceneManager.sharedInstance().removeChildLayer(this)},t.prototype.saveEditUserInfo=function(){var e=this,t={nickname:this.popup.getNameValue()},a=new QPLoadingScene;a.show("正在修改信息"),UserModel.sharedInstance().modifyUserInformation(t,function(t){if(a.hide(),t)return void QPAlert.sharedInstance().showOKButtonAt(e,t.message);var r=new DDZDataEvent(DDZDataEvent.UPDATE);r.userAttribute=UserModel.sharedInstance().attributeModel,DDZEventCenter.sharedInstance().dispatchEvent(r),QPAlert.sharedInstance().showOKButtonAt(e,"您的信息已经成功更新。"),QPAlert.sharedInstance().pressedOKHandler=function(){qp.SceneManager.sharedInstance().removeChildLayer(e)}})},t}(QPLayer);__reflect(DDZUserInfoEditScene.prototype,"DDZUserInfoEditScene");var DDZUserInfoGameDataView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoGameDataViewUI",t}return __extends(t,e),t.prototype.setTitleText=function(e){this.titleLabel.text=e+"："},t.prototype.setValueText=function(e){this.valueLabel.text=e},t}(QPLayer);__reflect(DDZUserInfoGameDataView.prototype,"DDZUserInfoGameDataView");var DDZUserInfoNameInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoNameInputUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.addEventListener(egret.Event.CHANGE,this.onValueChanged,this),this.cleanButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCleanButton,this),this.cleanButton.visible=this.text&&""!==this.text},t.prototype.onValueChanged=function(e){this.cleanButton.visible=e.target.text&&""!==e.target.text},t.prototype.onPressCleanButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.text=""},t}(eui.TextInput);__reflect(DDZUserInfoNameInput.prototype,"DDZUserInfoNameInput");var DDZUserInfoPopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoPopupUI",t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),DDZEventCenter.sharedInstance().addEventListener(DDZDataEvent.UPDATE,this.receiveUserDataChangedEvent,this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),DDZEventCenter.sharedInstance().removeEventListener(DDZDataEvent.UPDATE,this.receiveUserDataChangedEvent,this)},t.prototype.setUserInfo=function(e){this.nameLabel.text=e.getNickname(),this.idLabel.text="ID: "+e.getServiceId(),this.totalGame.setValueText(String(e.getTotalGameAmount())),this.winningRate.setValueText(String(e.getWinningRate())),this.escapeRate.setValueText(String(e.getEscapeRate())),this.winningAmount.setValueText(String(e.getWinningGameAmount())),this.continueWinningAmount.setValueText(String(e.getContinuousWinningAmount()))},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.closeButton.pressHandler=this.onPressCloseButton.bind(this),this.totalGame.setTitleText("总局数"),this.winningRate.setTitleText("胜率"),this.escapeRate.setTitleText("逃跑率"),this.winningAmount.setTitleText("胜利场"),this.continueWinningAmount.setTitleText("连胜")},t.prototype.receiveUserDataChangedEvent=function(e){e.userAttribute&&this.setUserInfo(e.userAttribute)},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressCloseButtonHandler&&this.pressCloseButtonHandler()},t.prototype.onPressEditUsernameButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZUserInfoEditScene;qp.SceneManager.sharedInstance().addChildLayer(e)},t.prototype.onPressSwitchAccountButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressSwitchAccountButtonHandler&&this.pressSwitchAccountButtonHandler()},t.prototype.onPressBindPhoneButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBindPhoneButtonHandler&&this.pressBindPhoneButtonHandler()},t.prototype.onPressSignOutButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressSignOutButtonHandler&&this.pressSignOutButtonHandler()},t}(QPPopupLayer);__reflect(DDZUserInfoPopup.prototype,"DDZUserInfoPopup");var Color=function(){function e(){}return e.TextGray=9868950,e.Red=15018281,e.Black=1513239,e}();__reflect(Color.prototype,"Color");var DDZPopupCloseButton=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCloseButton,this)},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressHandler&&this.pressHandler()},t}(eui.Component);__reflect(DDZPopupCloseButton.prototype,"DDZPopupCloseButton");var DEVICE_ID_KEY="user.device.id.local.save.key",DEVICE_IF_RUN_APP_KEY="user.device.if.run.app.save.key",Device=function(){function e(){var e=DDZCacheModel.sharedInstance().stringForKey(DEVICE_ID_KEY);e?this.id=e:(this.id=UUID.generate(),DDZCacheModel.sharedInstance().setString(DEVICE_ID_KEY,this.id));var t=DDZCacheModel.sharedInstance().booleanForKey(DEVICE_IF_RUN_APP_KEY);this.isLaunchedApp=t,t||DDZCacheModel.sharedInstance().setBoolean(DEVICE_IF_RUN_APP_KEY,!0)}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getWidth=function(){return this.width},e.prototype.setWidth=function(e){this.width=e},e.prototype.getHeight=function(){return this.height},e.prototype.setHeight=function(e){this.height=e},e.prototype.autoAdjustResolutioin=function(e){e.width=2*this.width,e.height=2*this.height},e.prototype.screenShoot=function(t){var a=new egret.RenderTexture,r=new egret.Rectangle(0,0,e.sharedInstance().width,e.sharedInstance().height);return a.drawToTexture(t,r),a},e.prototype.isNative=function(){return egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE},e.prototype.isiOS=function(){return"iOS"===egret.Capabilities.os},e.prototype.isWeb=function(){return egret.Capabilities.runtimeType===egret.RuntimeType.WEB},e.prototype.isPCBrowser=function(){var e=!0;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!1)
}(navigator.userAgent||navigator.vendor),e},e.instance=void 0,e}();__reflect(Device.prototype,"Device");var PasteBoard=function(){function e(){}return e.write=function(e){egret.ExternalInterface.call("saveToPasteBoard",e)},e.getContent=function(e){egret.ExternalInterface.call("getPasteBoardContent",""),egret.ExternalInterface.addCallback("getPasteBoardContent",function(t){e(t)})},e}();__reflect(PasteBoard.prototype,"PasteBoard");var QPAlert=function(e){function t(){var t=e.call(this)||this;return t.skinName="QPAlertUI",t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.onEnter=function(){e.prototype.onEnter.call(this),QPApplication.sharedInstance().isWebOnReactNative()&&Device.sharedInstance().autoAdjustResolutioin(this)},t.prototype.hide=function(){this.hideAllButtonGroups(),this.pressedCancelHandler=void 0,this.pressedOKHandler=void 0,this.titleLabel.text="",qp.SceneManager.sharedInstance().removeChildLayer(this)},t.prototype.showAt=function(e,t,a){this.showOKButtonAt(e,t,a)},t.prototype.showOKButtonAt=function(e,t,a){this.okGroup.visible=!0,this.messageLabel.text=t,this.titleLabel.text=a,qp.SceneManager.sharedInstance().addChildLayer(this)},t.prototype.showCancelAndOkButtonAt=function(e,t,a){this.cancelAndOkGroup.visible=!0,this.messageLabel.text=t,this.titleLabel.text=a,qp.SceneManager.sharedInstance().addChildLayer(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.okButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressOkButton,this),this.cancelAndOkGroupCancelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCancelButton,this),this.cancelAndOkGroupOkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressOkButton,this)},t.prototype.onPressCancelButton=function(){this.pressedCancelHandler&&this.pressedCancelHandler(),this.hide()},t.prototype.onPressOkButton=function(){this.pressedOKHandler&&this.pressedOKHandler(),this.hide()},t.prototype.hideAllButtonGroups=function(){this.okGroup.visible=!1,this.cancelAndOkGroup.visible=!1},t.instance=void 0,t}(QPLayer);__reflect(QPAlert.prototype,"QPAlert");var QPApplication=function(){function e(){}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.switchToOtherApp=function(e,t,a){egret.ExternalInterface.call("switchToOtherApp",e),egret.ExternalInterface.addCallback("switchSuccess",function(){t()}),egret.ExternalInterface.addCallback("switchError",function(e){a(new Error(e))})},e.prototype.setPlatform=function(e){this.platform=e},e.prototype.getPlatform=function(){return this.platform},e.prototype.isWebOnReactNative=function(){return"react_native"===this.platform},e}();__reflect(QPApplication.prototype,"QPApplication");var DEFAULT_VOLUME="0.5",QPAudioManager=function(){function e(){this.MUSIC_START_TIME=0,this.backgroundMusics={},this.isBackgroundMusicPlaying=!1,this.backgroundSoundChannels={},this.soundEffects={},this.soundEffectChannels={},this.backgroundMusicVolume=-1,this.soundEffectVolume=-1,this.enableBackgroundMusic=!0,this.enableSoundEffect=!0}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setBackgroundMusicVolume=function(e){this.backgroundMusicVolume=e/100;for(var t in this.backgroundSoundChannels)t&&(this.backgroundSoundChannels[t].volume=this.backgroundMusicVolume)},e.prototype.setSoundEffectVolume=function(e){this.soundEffectVolume=e/100;for(var t in this.soundEffectChannels)t&&(this.soundEffectChannels[t].volume=this.soundEffectVolume)},e.prototype.setBackgroundMusicEnable=function(e){this.enableBackgroundMusic=e},e.prototype.setSoundEffectEnable=function(e){this.enableSoundEffect=e},e.prototype.playBackgroundMusic=function(e,t){if(void 0===t&&(t=0),this.enableBackgroundMusic&&e!==this.currentSoundFileSource){this.isBackgroundMusicPlaying&&this.stopPlayBackgroundMusic();var a=RES.getRes(e);if(!a)return void egret.log("糟糕！！！！！ 资源文件"+e+"，读取失败，音乐不能播放");this.currentSoundFileSource=e,this.backgroundMusics[e]=a;var r=a.play(this.MUSIC_START_TIME,t);r.volume=this.backgroundMusicVolume<0?DEFAULT_VOLUME:this.backgroundMusicVolume,this.backgroundSoundChannels[a.hashCode.toString()]=r,this.isBackgroundMusicPlaying=!0}},e.prototype.getPlayingSoundFileSource=function(){return this.currentSoundFileSource},e.prototype.stopPlayBackgroundMusic=function(){for(var e in this.backgroundSoundChannels)e&&(this.backgroundSoundChannels[e].stop(),delete this.backgroundSoundChannels[e]);for(var t in this.backgroundMusics)t&&delete this.backgroundMusics[t];this.currentSoundFileSource=void 0,this.isBackgroundMusicPlaying=!1},e.prototype.playEffectSound=function(e,t){if(void 0===t&&(t=1),this.enableSoundEffect){var a=RES.getRes(e);if(!a)return void egret.log("糟糕，音效文件"+e+"，读取失败，未能播放");this.soundEffects[e]=a;var r=a.play(this.MUSIC_START_TIME,t);r.volume=this.soundEffectVolume<0?DEFAULT_VOLUME:this.soundEffectVolume,this.soundEffectChannels[a.hashCode.toString()]=r}},e.prototype.stopPlayEffectSound=function(e){var t=this.soundEffects[e];if(t){var a=this.soundEffectChannels[t.hashCode.toString()];a.stop(),delete this.soundEffects[e],delete this.soundEffectChannels[t.hashCode.toString()]}},e}();__reflect(QPAudioManager.prototype,"QPAudioManager");var QPAudioSouce=function(){function e(){}return e.getRandomBuYao=function(){return Math.random()>.5?"voice_bu_yao_mp3":"voice_guo_mp3"},e.CLICK_BUTTON="btn_click_mp3",e.BU_JIAO="grab_bu_jiao_mp3",e.JIAO_DI_ZHU="grab_jiao_di_zhu_mp3",e.SEND_CARD="ddz_send_card_mp3",e.CHOOSE_CARD="ddz_choose_card_mp3",e.PLAY_GAME_BACKGROUND="ddz_play_game_music_mp3",e}();__reflect(QPAudioSouce.prototype,"QPAudioSouce");var QPCOOKIE_USER_ORIGIN_DATA_KEY="user_origin_data",QPCookie=function(){function e(){}return e.set=function(e,t,a){var r="";if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),r="; expires="+n.toUTCString()}window.document.cookie=e+"="+(t||"")+r+"; path=/"},e.getByName=function(e){for(var t=e+"=",a=window.document.cookie.split(";"),r=0,n=a.length;n>r;r+=1){for(var o=a[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""},e.eraseCookie=function(e){window.document.cookie=e+"=; Max-Age=-99999999;"},e}();__reflect(QPCookie.prototype,"QPCookie");var QPCrossPlatformCommunication=function(){function e(){}return e.closeH5Game=function(){if(QPApplication.sharedInstance().isWebOnReactNative()){var e={command:"close_webview"};window.postMessage(JSON.stringify(e),"*")}},e.transformPin=function(e){if(QPApplication.sharedInstance().isWebOnReactNative()){var t={command:"transform_pin",payload:e};window.postMessage(JSON.stringify(t),"*")}},e.showInviteFriends=function(e){if(QPApplication.sharedInstance().isWebOnReactNative()){var t={command:"show_invite_friends",payload:e};window.postMessage(JSON.stringify(t),"*")}},e.postGameIsStarted=function(e){if(QPApplication.sharedInstance().isWebOnReactNative()){var t={command:"query_game_is_started",payload:{isStarted:e}};window.postMessage(JSON.stringify(t),"*")}},e}();__reflect(QPCrossPlatformCommunication.prototype,"QPCrossPlatformCommunication");var QPLoadingScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="QPLoadingUI",QPApplication.sharedInstance().isWebOnReactNative()&&Device.sharedInstance().autoAdjustResolutioin(t),t}return __extends(t,e),t.prototype.show=function(e){this.messageLabel.text=e||"",this.parent||(qp.SceneManager.sharedInstance().addChildLayer(this),this.startAnimation())},t.prototype.hide=function(){this.parent&&(this.loadingAnimationGroup.stop(),qp.SceneManager.sharedInstance().removeChildLayer(this))},t.prototype.createChildren=function(){e.prototype.createChildren.call(this);for(var t in this.loadingAnimationGroup.items)if(t){var a=this.loadingAnimationGroup.items[t];a&&(a.props={loop:!0})}},t.prototype.startAnimation=function(){this.parent&&this.loadingAnimationGroup.play()},t}(QPLayer);__reflect(QPLoadingScene.prototype,"QPLoadingScene");var QPProgressBar=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameLaunchProgressUI",t}return __extends(t,e),t.prototype.setProgressValue=function(e){this.value=Math.floor(100*e),this.rocketImage.x=this.width*e,this.labelFunction=function(e,t){return Math.ceil(e/t*100)+"%"}},t}(eui.ProgressBar);__reflect(QPProgressBar.prototype,"QPProgressBar");var DDZTransparentCover=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTransparentCoverUI",t}return __extends(t,e),t}(QPLayer);__reflect(DDZTransparentCover.prototype,"DDZTransparentCover");var QPToast=function(e){function t(){var t=e.call(this)||this;return t.skinName="QPToastUI",QPApplication.sharedInstance().isWebOnReactNative()&&Device.sharedInstance().autoAdjustResolutioin(t),t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.showAt=function(e,t){this.messageLabel.text=t,this.messageBackground.width=this.messageLabel.width+60,this.messageBackground.height=this.messageLabel.height+50,this.parent||e.addChild(this)},t.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},t.instance=void 0,t}(eui.Component);__reflect(QPToast.prototype,"QPToast");var UnderLineTextInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="UnderLineTextInputUI",t}return __extends(t,e),t}(eui.TextInput);__reflect(UnderLineTextInput.prototype,"UnderLineTextInput");var DDZButtonEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.ENABLE_PLAY_CARD_BUTTON="event.enable.play.card.button",t.DISABLE_PLAY_CARD_BUTTON="event.disable.play.card.button",t.NOT_CALL_LANDLORD="event.press.not.call.landlord.button",t.CALL_ONE_POINT="event.press.call.one.point.button",t.CALL_TWO_POINT="event.press.call.two.point.button",t.CALL_THREE_POINT="event.press.call.three.point.button",t.NOT_PLAY_CARD="event.not.play.card",t.PLAY_CARD="event.must.play.card",t.HINT="event.hint",t.SHOW_CARDS_START_PLAY="event.show.cards.start.play",t.GAME_OVER_SHARE="event.game.over.share.button",t.CONTINUE_PLAY="event.continue.play",t.START_GAME="event.press.start.game.button",t}(egret.Event);__reflect(DDZButtonEvent.prototype,"DDZButtonEvent");var DDZDataEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.UPDATE="ddz.data.event.update",t}(egret.Event);__reflect(DDZDataEvent.prototype,"DDZDataEvent");var DDZDebugEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.DEBUG_ROOM_CHANNEL="event.debug.room.channel",t}(egret.Event);__reflect(DDZDebugEvent.prototype,"DDZDebugEvent");var DDZEventCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.instance=void 0,t}(egret.DisplayObjectContainer);__reflect(DDZEventCenter.prototype,"DDZEventCenter");var qp;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.sceneStack=new eui.ViewStack,t.scenes=[],t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.addRootStage=function(e){this.rootStage=e,this.rootStage.addChild(this.sceneStack)},t.prototype.addChildLayer=function(e){if(!e)throw new Error("无法添加不存在的layer");this.rootStage.addChild(e),e.onEnter()},t.prototype.removeChildLayer=function(e){if(!e)throw new Error("无法移出不存在的scene");e.parent&&(e.onExit(),this.rootStage.removeChild(e),e=void 0)},t.prototype.pushScene=function(e){if(!e)throw new Error("你不能push一个不存在的scene");this.sceneStack.addChild(e),e.onEnter(),this.scenes.push(e),this.sceneStack.selectedIndex=this.sceneStack.length-1},t.prototype.popScene=function(){if(1<=this.scenes.length){var e=this.scenes.pop();e.onExit();var t=this.sceneStack.removeChild(e);this.sceneStack.selectedIndex=this.sceneStack.length-1,this.sceneStack.selectedIndex<0&&(this.sceneStack.selectedIndex=0),t=void 0}},t.prototype.replaceScene=function(e){if(!e)throw new Error("你不能replace一个不存在的scene");this.popScene(),this.pushScene(e)},t.instance=void 0,t}(egret.DisplayObjectContainer);e.SceneManager=t,__reflect(t.prototype,"qp.SceneManager")}(qp||(qp={})),String.prototype.countByte=function(){for(var e=0,t=0;t<this.length;t+=1){var a=this.charCodeAt(t);e+=128>a?1:2048>a?2:65536>a?3:1<<21>a?4:1<<26>a?5:1<<31>a?6:Number.NaN}return e},String.prototype.canBeUsername=function(){var e=/^[a-zA-Z0-9]+$/;return e.test(this)?!0:!1},String.prototype.isValidDate=function(){var e=/((^((1[8-9]\d{2})|([2-9]\d{3}))([-])(10|12|0?[13578])([-])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-])(11|0?[469])([-])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-])(0?2)([-])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-])(0?2)([-])(29)$)|(^([3579][26]00)([-])(0?2)([-])(29)$)|(^([1][89][0][48])([-])(0?2)([-])(29)$)|(^([2-9][0-9][0][48])([-])(0?2)([-])(29)$)|(^([1][89][2468][048])([-])(0?2)([-])(29)$)|(^([2-9][0-9][2468][048])([-])(0?2)([-])(29)$)|(^([1][89][13579][26])([-])(0?2)([-])(29)$)|(^([2-9][0-9][13579][26])([-])(0?2)([-])(29)$))/;return e.test(this)},String.prototype.canBePassword=function(){return this.length>=8},String.prototype.isValidPhoneNumber=function(){var e=/^[0-9]+$/;return e.test(this)&&this.length>=8?!0:!1},String.prototype.isValidVerificationCode=function(){var e=/^[0-9]+$/;return e.test(this)?!0:!1};var QPResource;!function(e){var t=function(){function e(){}return e.LAUNCH_GAME="ddz_launch_game",e.HOME="ddz_home",e.COMMON_MUSIC="ddz_common_music",e.COMMON_IMAGE="ddz_common_image",e.OTHER_MUSIC="ddz_other_music",e.PLAY_GAME="ddz_play_game_image",e.SETTINGS="ddz_settings_image",e.USER_INFO="ddz_user_info_image",e}();e.GroupName=t,__reflect(t.prototype,"QPResource.GroupName");var a=function(){function e(){this.isLoaded=!1}return e.prototype.load=function(e){if(!e)throw new Error("不能加载不存在的Group");return this.isLoaded?void this.loadCompleteHandler(new RES.ResourceEvent(RES.ResourceEvent.GROUP_COMPLETE)):(this.addLoadGroupEvent(),void RES.loadGroup(e))},e.prototype.addLoadGroupEvent=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.removeLoadGroupEvent=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.onGroupLoadComplete=function(e){this.isLoaded=!0,this.removeLoadGroupEvent(),this.loadCompleteHandler&&this.loadCompleteHandler(e)},e.prototype.onGroupLoadError=function(e){this.isLoaded=!1,this.removeLoadGroupEvent(),this.loadCompleteHandler&&this.loadCompleteHandler(e)},e.prototype.onGroupProgress=function(e){this.loadProgressHandler&&this.loadProgressHandler(e)},e.prototype.onItemLoadError=function(e){throw new Error(e.resItem.url+"加载失败")},e}();e.GroupModel=a,__reflect(a.prototype,"QPResource.GroupModel");var r=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.LAUNCH_GAME)},a}(a);e.LaunchGameGroup=r,__reflect(r.prototype,"QPResource.LaunchGameGroup");var n=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.HOME)},a}(a);e.HomeGroup=n,__reflect(n.prototype,"QPResource.HomeGroup");var o=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.COMMON_MUSIC)},a}(a);e.CommonMusicGroup=o,__reflect(o.prototype,"QPResource.CommonMusicGroup");var i=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.OTHER_MUSIC)},a}(a);e.OtherMusicGroup=i,__reflect(i.prototype,"QPResource.OtherMusicGroup");var s=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.COMMON_IMAGE)},a}(a);e.CommonImagesGroup=s,__reflect(s.prototype,"QPResource.CommonImagesGroup");var d=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.PLAY_GAME)},a}(a);e.PlayGameGroup=d,__reflect(d.prototype,"QPResource.PlayGameGroup");var l=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.SETTINGS)},a}(a);e.SettingsGroup=l,__reflect(l.prototype,"QPResource.SettingsGroup");var c=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.USER_INFO)},a}(a);e.UserInfoGroup=c,__reflect(c.prototype,"QPResource.UserInfoGroup")}(QPResource||(QPResource={}));var QPResource;!function(e){var t=function(){function t(){}return t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.isLoadedSuccessful?[2]:this.isLoading?[2]:(this.isLoading=!0,[4,this.loadSettingsImages()]);case 1:return t.sent(),[4,this.loadUserInfoImages()];case 2:return t.sent(),[4,this.loadOtherMusics()];case 3:return t.sent(),e=new DDZMusicEvent(DDZMusicEvent.PLAY_MUSIC_EVENT),DDZEventCenter.sharedInstance().dispatchEvent(e),this.isLoading=!1,this.isLoadedSuccessful=!0,[2]}})})},t.prototype.getLoadGroupFailedError=function(){return new Error("游戏资源加载失败")},t.prototype.loadOtherMusics=function(){var t=this;return new Promise(function(a,r){e.OtherMusicGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.OtherMusicGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.OtherMusicGroup.sharedInstance().load()})},t.prototype.loadPlayGameImages=function(){var t=this;return new Promise(function(a,r){e.PlayGameGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.PlayGameGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.PlayGameGroup.sharedInstance().load()})},t.prototype.loadSettingsImages=function(){var t=this;return new Promise(function(a,r){e.SettingsGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.SettingsGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.SettingsGroup.sharedInstance().load()})},t.prototype.loadUserInfoImages=function(){var t=this;return new Promise(function(a,r){e.UserInfoGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.UserInfoGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.UserInfoGroup.sharedInstance().load()})},t}();e.AsyncLoader=t,__reflect(t.prototype,"QPResource.AsyncLoader")}(QPResource||(QPResource={}));