var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))(function(n,o){function i(e){try{d(r.next(e))}catch(t){o(t)}}function s(e){try{d(r["throw"](e))}catch(t){o(t)}}function d(e){e.done?n(e.value):new a(function(t){t(e.value)}).then(i,s)}d((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function a(e){return function(t){return r([e,t])}}function r(a){if(n)throw new TypeError("Generator is already executing.");for(;d;)try{if(n=1,o&&(i=o[2&a[0]?"return":a[0]?"throw":"next"])&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[0,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return d.label++,{value:a[1],done:!1};case 5:d.label++,o=a[1],a=[0];continue;case 7:a=d.ops.pop(),d.trys.pop();continue;default:if(i=d.trys,!(i=i.length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){d=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){d.label=a[1];break}if(6===a[0]&&d.label<i[1]){d.label=i[1],i=a;break}if(i&&d.label<i[2]){d.label=i[2],d.ops.push(a);break}i[2]&&d.ops.pop(),d.trys.pop();continue}a=t.call(e,d)}catch(r){a=[6,r],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var n,o,i,s,d={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},DDZBaseComponent=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.Component);__reflect(DDZBaseComponent.prototype,"DDZBaseComponent");var DDZGameServiceMessageBaseData=function(){function e(e){this.action=e.action,e.room&&(this.roomId=e.room.id)}return e}();__reflect(DDZGameServiceMessageBaseData.prototype,"DDZGameServiceMessageBaseData");var DDZPlayCardSet=function(){function e(e){this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND,this.singles=[],this.pairs=[],this.trioes=[],this.bombs=[],this.attachedBombs=[],this.cards=e}return e.prototype.reset=function(){this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND},e.prototype.isEmpty=function(){return 1===this.cardTypeName},e.prototype.isBomb=function(){return 14===this.cardTypeName},e.prototype.isHuoJian=function(){return 15===this.cardTypeName},e.prototype.isFourTakes=function(){return 12===this.cardTypeName||13===this.cardTypeName?!0:!1},e.prototype.canBeBiggerConsetutive=function(e,t,a){return t.value-e.value===a-1&&this.value<e.value},e.prototype.isLegal=function(){return 0!==this.cardTypeName&&1!==this.cardTypeName},e.prototype.isTypeEqualTo=function(e){return e?this.cardTypeName===e.cardTypeName&&this.countCards()===e.countCards():!1},e.prototype.setPlayerId=function(e){this.playerId=e},e.prototype.countCards=function(){return this.cards.length},e.prototype.isBiggerThan=function(e){if(!e)throw new Error("用于比较的cardSet不能为空");return this.isHuoJian()?!0:e.isHuoJian()?!1:this.isTypeEqualTo(e)?this.value>e.value:this.isBomb()?!0:e.isBomb()?!1:!1},e.prototype.isEqualTo=function(e){if(!e)throw new Error("用于比较的cardSet不能为空");return this.isTypeEqualTo(e)&&this.value===e.value?!0:!1},e.prototype.listBiggerLegalCardSet=function(e){throw new Error("需要子类重写实现此方法")},e.prototype.getSoundEffectName=function(){throw new Error("需要子类重写此方法获取音效名字")},e.prototype.classifyCards=function(e){this.cleanCards();for(var t=0,a=Object.keys(e);t<a.length;t++){var r=a[t],n=e[r];n.isSingle()?this.singles.push(n):n.isPair()?this.pairs.push(n):n.isTrio()?this.trioes.push(n):n.isBomb()&&this.bombs.push(n)}},e.prototype.cleanCards=function(){this.singles=[],this.pairs=[],this.trioes=[],this.bombs=[],this.attachedBombs=[]},e}();__reflect(DDZPlayCardSet.prototype,"DDZPlayCardSet");var DDZBaseCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="",t}return __extends(t,e),t.prototype.setImage=function(e){this.image.source=e},t.prototype.dataChanged=function(){this.setImage(this.data.getImageName())},t}(eui.ItemRenderer);__reflect(DDZBaseCardView.prototype,"DDZBaseCardView");var QPLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){for(var e=this.numChildren,a=0;e>a;a+=1){var r=this.getChildAt(a);r instanceof t&&r.onEnter()}},t.prototype.onExit=function(){for(var e=this.numChildren,a=0;e>a;a+=1){var r=this.getChildAt(a);r instanceof t&&r.onExit()}},t}(DDZBaseComponent);__reflect(QPLayer.prototype,"QPLayer");var DDZBaseButtons=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setVisible=function(e){this.visible=e},t}(QPLayer);__reflect(DDZBaseButtons.prototype,"DDZBaseButtons");var QPNetworkApi=function(){function e(){}return e.prototype.fetchJson=function(e,t,a){var r=this,n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.open(e.url,egret.HttpMethod.GET),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Access-Control-Allow-Origin","*");for(var o=0,i=Object.keys(e.header);o<i.length;o++){var s=i[o];n.setRequestHeader(s,e.header[s])}n.send(),n.addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget.response;if(!n)return void a(new QPNetworkError({message:"HTTP GET response is null"}));var o=JSON.parse(n);o.ok?t(o.result):a(r.getResponseError(o))},this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){a(new QPNetworkError({message:"无法连接到服务器"}))},this)},e.prototype.postReturnJson=function(e,t,a){var r=this,n=e.url+this.buildParams(e.parameters),o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(n,egret.HttpMethod.POST);for(var i=0,s=Object.keys(e.header);i<s.length;i++){var d=s[i];o.setRequestHeader(d,e.header[d])}if(o.addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget.response;if(!n)return void a(new QPNetworkError({message:"HTTP POST response is null"}));var o=JSON.parse(n);o.ok?t(o.result):a(r.getResponseError(o))},this),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){a(new QPNetworkError({message:"无法连接到服务器"}))},this),e.body){var l=this.buildBody(e.body);o.send(l)}else o.send()},e.prototype.headerWithoutAuthorization=function(){return{Accept:"application/json","Access-Control-Allow-Origin":"*","Content-Type":"application/json"}},e.prototype.headerWithAuthorization=function(){var e=this.headerWithoutAuthorization();return e.Authorization="Bearer "+UserModel.sharedInstance().attributeModel.getAccessToken(),e},e.prototype.getResponseError=function(e){if(e.errors){if(e.errors.length<=0)return new QPNetworkError({message:"服务器请求错误返回格式不对。"});var t=e.errors[0],a=t.message;return t.field&&(a=a+" ("+t.field+")"),new QPNetworkError({message:a,error_type:e.errors[0].error_type})}return new QPNetworkError({message:e.message,error_type:e.error_type})},e.prototype.buildParams=function(e){if(!e)return"";var t="?";for(var a in e)a&&(t=t+a+"="+e[a]+"&");return t=t.slice(0,-1)},e.prototype.buildBody=function(e){return JSON.stringify(e)},e}();__reflect(QPNetworkApi.prototype,"QPNetworkApi");var BaseUserAttributeModel=function(){function e(){}return e.prototype.setId=function(e){this.id=e},e.prototype.getDisplayId=function(){return this.serviceId},e.prototype.setBalanceAmount=function(e){this.balanceAmount=e},e.prototype.getBalanceAmount=function(){return this.balanceAmount},e.prototype.deleteAccount=function(){this.id=void 0},e.prototype.setHasSignUp=function(e){this.hasSignUp=e},e.prototype.getHasSignUp=function(){return this.hasSignUp},e.prototype.setHasBindPhoneNumber=function(e){this.hasBindPhoneNumber=e},e.prototype.getHasBindPhoneNumber=function(){return this.hasBindPhoneNumber},e.prototype.setAccessToken=function(e){this.accessToken=e},e.prototype.getAccessToken=function(){return this.accessToken},e.prototype.setChannel=function(e){this.channel=e},e.prototype.getChannel=function(){return this.channel},e.prototype.setTimestamp=function(e){this.timestamp=e},e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.setInfo=function(e){this.info=e},e.prototype.getInfo=function(){return this.info},e.prototype.setToken=function(e){this.token=e},e.prototype.getToken=function(){return this.token},e.prototype.setHashDigest=function(e){this.hashDigest=e},e.prototype.getHashDigest=function(){return this.hashDigest},e.prototype.setExpireISOTime=function(e){this.expireISOTime=e},e.prototype.getExpireISOTime=function(){return this.expireISOTime},e.prototype.cleanCommunicationAttribute=function(){this.accessToken=void 0,this.channel=void 0,this.timestamp=void 0,this.info=void 0,this.token=void 0,this.hashDigest=void 0,this.expireISOTime=void 0},e}();__reflect(BaseUserAttributeModel.prototype,"BaseUserAttributeModel",["IUserAttribute","IUserCacheAttribute","ICommunicationAttribute"]);var BLACK_JOKER_CODE="bw",RED_JOKER_CODE="rw",DDZCard=function(){function e(e){this.shouldShowLandlordTag=!1,this.isLastOne=!1,this.code=e,this.setImageNameByCode(e),this.decode(e),this.calculateIndex(),this.isSelect=!1}return e.prototype.showLandlordTag=function(e){this.shouldShowLandlordTag=e},e.prototype.getImageName=function(){return this.imageName},e.prototype.isValueEqualTo=function(e){return this.value===e.value},e.prototype.isExactlySameTo=function(e){return this.index===e.index},e.prototype.setImageNameByCode=function(e){this.imageName="poker_"+e+"@2x_png"},e.prototype.calculateIndex=function(){var e=4*(this.value-3);1===this.suit?e+=3:2===this.suit?e+=2:3===this.suit?e+=1:4===this.suit&&(e+=0),this.code===BLACK_JOKER_CODE?e=52:this.code===RED_JOKER_CODE&&(e=53),this.index=e},e.prototype.decode=function(e){if(e===BLACK_JOKER_CODE)return void(this.value=16);if(e===RED_JOKER_CODE)return void(this.value=17);var t=e.charAt(0),a=e.slice(-1);this.decodeSuit(a),this.decodeValue(t)},e.prototype.decodeValue=function(e){switch(e){case"3":this.value=3;break;case"4":this.value=4;break;case"5":this.value=5;break;case"6":this.value=6;break;case"7":this.value=7;break;case"8":this.value=8;break;case"9":this.value=9;break;case"t":this.value=10;break;case"j":this.value=11;break;case"q":this.value=12;break;case"k":this.value=13;break;case"a":this.value=14;break;case"2":this.value=15;break;default:this.value=18}},e.prototype.decodeSuit=function(e){switch(e){case"s":this.suit=1;break;case"h":this.suit=2;break;case"c":this.suit=3;break;case"d":this.suit=4;break;default:this.suit=0}},e}();__reflect(DDZCard.prototype,"DDZCard");var DDZPlayCardFourTakes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findBiggerBombCards=function(e){this.classifyCards(e);var t=this.bombs.length;if(0===t)return[];if(1===t){var a=this.bombs[0];return a.value<this.value?[]:a.cards}for(var r,n=0;t>n;n+=1){var a=this.bombs[n];this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND&&this.value<a.value?(this.lastFoundIndex=n,r=a):!r&&this.lastFoundIndex<n&&this.value<a.value?(this.lastFoundIndex=n,this.lastFoundIndex===t-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),r=a):this.attachedBombs.push(a)}return r?r.cards:[]},t}(DDZPlayCardSet);__reflect(DDZPlayCardFourTakes.prototype,"DDZPlayCardFourTakes");var DDZBaseWarehouse=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),DDZEventCenter.sharedInstance().addEventListener(DDZDataEvent.UPDATE,this.setBalance,this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),DDZEventCenter.sharedInstance().removeEventListener(DDZDataEvent.UPDATE,this.setBalance,this)},t.prototype.setAmount=function(e){this.amountLabel.text=String(e)},t.prototype.hideAddImage=function(){this.addImage.visible=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressAddButton,this)},t.prototype.setBalance=function(){this.setAmount(UserModel.sharedInstance().attributeModel.getBalanceAmount())},t.prototype.onPressAddButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressAddButtonHandler&&this.pressAddButtonHandler()},t}(QPLayer);__reflect(DDZBaseWarehouse.prototype,"DDZBaseWarehouse");var DDZPlayCardTrioTakes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findBiggerTrioCards=function(e){this.classifyCards(e);var t=this.trioes.concat(this.bombs).sort(function(e,t){return e.value-t.value}),a=t.length;if(1===a){var r=t[0];return r.value<this.value?[]:[r.cards[0],r.cards[1],r.cards[2]]}for(var n=0;a>n;n+=1){var r=t[n];if(this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND&&this.value<r.value)return this.lastFoundIndex=n,[r.cards[0],r.cards[1],r.cards[2]];if(this.lastFoundIndex<n&&this.value<r.value)return this.lastFoundIndex=n,n===a-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),[r.cards[0],r.cards[1],r.cards[2]]}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var r=t[this.lastFoundIndex];return[r.cards[0],r.cards[1],r.cards[2]]}return[]},t}(DDZPlayCardSet);__reflect(DDZPlayCardTrioTakes.prototype,"DDZPlayCardTrioTakes");var DDZBaseProgressBar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setProgress=function(e,t){this.value=Math.floor(e/t*100),this.finishedAmountLabel.text=String(e),this.totalAmountLabel.text=String(t)},t}(eui.ProgressBar);__reflect(DDZBaseProgressBar.prototype,"DDZBaseProgressBar");var DDZCardListView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZCardListUI",t}return __extends(t,e),t.prototype.setAnimation=function(e){this.animation=e},t.prototype.playAnimation=function(){this.animation.play()},t.prototype.setCards=function(e){this.cardList.dataProvider=new eui.ArrayCollection(e),this.width=e.length<=14?65+25*(e.length-1):400},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setupCardList()},t.prototype.setupCardList=function(){this.cardList.itemRenderer=DDZCardView,this.cardList.allowMultipleSelection=!0,this.height=177},t}(QPLayer);__reflect(DDZCardListView.prototype,"DDZCardListView");var DDZPlayCardAirplaneTakes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findBiggerAirplaneCards=function(e,t){this.classifyCards(e);var a=this.trioes.concat(this.bombs).sort(function(e,t){return e.value-t.value}),r=a.length;if(t>r)return[];for(var n=0;r>n;n+=1){var o=n+t-1;if(o>r-1)return[];var i=a[o];if(15<=i.value)return[];var s=a[n];if(this.canBeBiggerConsetutive(s,i,t)){if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND&&n<=this.lastFoundIndex)continue;if(this.lastFoundIndex=n,r-1>o){var d=a[o+1];(d.value-i.value!==1||15<=d.value)&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND)}else o===r-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND);for(var l=a.slice(n,o+1),c=[],u=0,h=l;u<h.length;u++){var p=h[u];c=c.concat([p.cards[0],p.cards[1],p.cards[2]])}return c}}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var y=this.lastFoundIndex,s=a[y],f=this.lastFoundIndex+t-1,i=a[f];if(f>=r)return[];if(15<=i.value)return[];if(i.value-s.value!==t-1)return[];for(var D=a.slice(y,f+1),c=[],m=0,g=D;m<g.length;m++){var v=g[m];c=c.concat([v.cards[0],v.cards[1],v.cards[2]])}return c}return[]},t}(DDZPlayCardSet);__reflect(DDZPlayCardAirplaneTakes.prototype,"DDZPlayCardAirplaneTakes");var DDZCardView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.landlordSignImage.visible=!1},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.isLastOne&&(this.landlordSignImage.visible=this.data.shouldShowLandlordTag)},t}(DDZBaseCardView);__reflect(DDZCardView.prototype,"DDZCardView");var DDZPlayerGameInfoBaseView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.hideAllState=function(){this.playerStateView.hideAllState()},t.prototype.setRemainCardsCount=function(e){this.remainCardView.visible=!0,this.remainCardView.setAmount(e)},t.prototype.showWarningLightView=function(){this.warningLightView.show()},t.prototype.hideWarningLightView=function(){this.warningLightView.hide()},t.prototype.reset=function(){this.hideWarningLightView(),this.playerStateView.hideAllState()},t.prototype.hideRemainCardsView=function(){this.remainCardView.visible=!1},t.prototype.setCallLandlordPoint=function(e){1===e?this.playerStateView.setState(1):2===e?this.playerStateView.setState(2):3===e&&this.playerStateView.setState(3)},t.prototype.showNotPlayCard=function(){this.playerStateView.setState(7)},t.prototype.showNotCallLandlord=function(){this.playerStateView.setState(4)},t.prototype.showWaitForReady=function(e){e?this.playerStateView.showWaitForReady():this.playerStateView.hideWaitForReady()},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.remainCardView.visible=!1},t}(QPLayer);__reflect(DDZPlayerGameInfoBaseView.prototype,"DDZPlayerGameInfoBaseView");var DDZAppleIAPModel=function(){function e(){}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.purchaseDiamondByProductId=function(e,t,a){egret.ExternalInterface.addCallback("transaction",function(e){var r=JSON.parse(e);if("failed"===r.type){var n=new Error(r.message);return void a(n)}var o;"purchasing"===r.type?o=new DDZIAPResponse({message:r.message,type:DDZIAPResponseType.Purchasing}):"complete"===r.type&&(o=new DDZIAPResponse({message:r.message,type:DDZIAPResponseType.PurchasedSuccessfully,receipt:r.receipt})),t(o)}),egret.ExternalInterface.call("transaction",e)},e.PRODUCT_10_DIAMONDS_ID="org.egret.doudizhu_ios.10diamonds",e.PRODUCT_20_DIAMONDS_ID="org.egret.doudizhu_ios.20diamonds",e.PRODUCT_30_DIAMONDS_ID="org.egret.doudizhu_ios.30diamonds",e.PRODUCT_40_DIAMONDS_ID="org.egret.doudizhu_ios.40diamonds",e.PRODUCT_50_DIAMONDS_ID="org.egret.doudizhu_ios.50diamonds",e}();__reflect(DDZAppleIAPModel.prototype,"DDZAppleIAPModel");var DDZStoreGoodView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZStoreGoodUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.purchaseButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPurchaseButtonPressed,this)},t.prototype.dataChanged=function(){this.goodsImage.source=this.data.image,this.quantityLabel.text=String(this.data.quantity)},t.prototype.onPurchaseButtonPressed=function(){egret.log("子类实现")},t}(eui.ItemRenderer);__reflect(DDZStoreGoodView.prototype,"DDZStoreGoodView");var QPTestCase=function(){function e(e){this.name=e}return e.prototype.startTest=function(){throw new Error("需要子类实现")},e.prototype.assertEquals=function(e,t,a){return t===a?void this.testSuccessLog(e):void egret.log("❌ "+e+": expectValue "+t+" not equals to subject "+a)},e.prototype.assert=function(e,t){return t?void this.testSuccessLog(e):void egret.log("❌ "+e)},e.prototype.testSuccessLog=function(e){egret.log("✅  SUCCESS : "+e)},e}();__reflect(QPTestCase.prototype,"QPTestCase");var DDZGameServiceMessageStartGameData=function(e){function t(t){var a=e.call(this,t)||this;return a.playerIds=[],a.playerIds=t.player_ids,a.startedAt=t.started_at,a.gameMatchId=t.game_match_id,a.initLandlord=t.init_landlord,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageStartGameData.prototype,"DDZGameServiceMessageStartGameData");var HttpActionData=function(){function e(e){this.body={application:"doudizhu"},this.validate(e)}return e.prototype.validate=function(e){throw new Error("需要子类实现")},e}();__reflect(HttpActionData.prototype,"HttpActionData",["IHttpActionData"]);var QPPopupLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(QPLayer);__reflect(QPPopupLayer.prototype,"QPPopupLayer");var QPScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){for(var e=this.numChildren,t=0;e>t;t+=1){var a=this.getChildAt(t);a instanceof QPLayer&&a.onEnter()}this.addRealtimeConnetListeners()},t.prototype.onExit=function(){for(var e=this.numChildren,t=0;e>t;t+=1){var a=this.getChildAt(t);a instanceof QPLayer&&a.onExit()}this.hideLostRealtimeServiceConnetInfo(),this.removeRealtimeConnetListeners()},t.prototype.addRealtimeConnetListeners=function(){DDZEventCenter.sharedInstance().addEventListener(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT,this.hideLostRealtimeServiceConnetInfo,this),DDZEventCenter.sharedInstance().addEventListener(DDZNetworkEvent.DISCONNECT_SERVER_EVENT,this.showLostRealtimeServiceConnectInfo,this)},t.prototype.removeRealtimeConnetListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT,this.hideLostRealtimeServiceConnetInfo,this),DDZEventCenter.sharedInstance().removeEventListener(DDZNetworkEvent.DISCONNECT_SERVER_EVENT,this.showLostRealtimeServiceConnectInfo,this)},t.prototype.hideLostRealtimeServiceConnetInfo=function(){this.loadingScene&&(this.loadingScene.hide(),this.loadingScene=void 0)},t.prototype.showLostRealtimeServiceConnectInfo=function(){this.loadingScene||(this.loadingScene=new QPLoadingScene),this.loadingScene.show("网络连接不稳定，正在努力重连中...")},t}(DDZBaseComponent);__reflect(QPScene.prototype,"QPScene");var DDZDebugEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.DEBUG_ROOM_CHANNEL="event.debug.room.channel",t}(egret.Event);__reflect(DDZDebugEvent.prototype,"DDZDebugEvent");var DDZEventCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.instance=void 0,t}(egret.DisplayObjectContainer);__reflect(DDZEventCenter.prototype,"DDZEventCenter");var DDZHandCardEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.TOUCHED="event.hand.card.touched",t.TOUCH_END="event.hand.card.touch.end",t}(egret.Event);__reflect(DDZHandCardEvent.prototype,"DDZHandCardEvent");var DDZMusicEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.PLAY_MUSIC_EVENT="event.play.game.music",t.STOP_MUSIC_EVENT="event.stop.game.music",t}(egret.Event);__reflect(DDZMusicEvent.prototype,"DDZMusicEvent");var DDZNetworkEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.DISCONNECT_SERVER_EVENT="event.disconnect.with.server",t.CONNECT_TO_SERVER_EVENT="event.connect.to.server",t}(egret.Event);__reflect(DDZNetworkEvent.prototype,"DDZNetworkEvent");var DDZWebsocketEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.MISS_MESSAGE_EVENT="event.miss.websocket.message",t}(egret.Event);__reflect(DDZWebsocketEvent.prototype,"DDZWebsocketEvent");var DDZMailScene=function(e){function t(t){var a=e.call(this)||this;return a.skinName="DDZMailSceneUI",a.backgroundImage.source=t,a}return __extends(t,e),t}(QPScene);__reflect(DDZMailScene.prototype,"DDZMailScene");var DDZMail=function(){function e(e){this.title=e.title,this.contentTextFlow=e.content}return e}();__reflect(DDZMail.prototype,"DDZMail");var testSystemMessages=[],DDZMailModel=function(){function e(){}return e.prototype.fetchSystemMails=function(e){e([])},e.prototype.getMailAtIndex=function(e){return e>=this.mails.length?void 0:this.mails[e]},e}();__reflect(DDZMailModel.prototype,"DDZMailModel");var DDZMailDetailView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZMailDetailUI",t.closeButton.pressHandler=t.goBack.bind(t),t}return __extends(t,e),t.prototype.setMailTitle=function(e){this.mailTitleLabel.text=e},t.prototype.setContentTextFlow=function(e){this.contentLabel.textFlow=e},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.contentScroller.viewport=this.contentGroup,this.okButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goBack,this)},t.prototype.goBack=function(){qp.SceneManager.sharedInstance().removeChildLayer(this)},t}(QPLayer);__reflect(DDZMailDetailView.prototype,"DDZMailDetailView");var DDZMailListCell=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZMailListCellUI",t}return __extends(t,e),t.prototype.dataChanged=function(){this.titleLabel.text=this.data.title,this.dateLabel.text=String(this.data.date)},t}(eui.ItemRenderer);__reflect(DDZMailListCell.prototype,"DDZMailListCell");var DDZMailPopupView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZMailPopupUI",t.mailModel=new DDZMailModel,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.emptyContentView.visible=!1,this.createMailList()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closeButton.pressHandler=this.onPressCloseButton.bind(this)},t.prototype.createMailList=function(){var e=this;this.mailListScroller.viewport=this.mailList,this.mailModel.fetchSystemMails(function(t,a){a||(e.emptyContentView.visible=0===t.length,e.mailList.dataProvider=new eui.ArrayCollection(t),e.mailList.itemRenderer=DDZMailListCell,e.mailList.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onPressMail,e))})},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),qp.SceneManager.sharedInstance().popScene()},t.prototype.onPressMail=function(e){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var t=new DDZMailDetailView,a=this.mailModel.getMailAtIndex(e.itemIndex);a?(t.setMailTitle(a.title),t.setContentTextFlow(a.contentTextFlow),qp.SceneManager.sharedInstance().addChildLayer(t)):egret.log("糟糕！！！ DDZMailScene 获取内容列表数据出错")},t}(QPPopupLayer);__reflect(DDZMailPopupView.prototype,"DDZMailPopupView");var DDZGameService=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Centrifuge);__reflect(DDZGameService.prototype,"DDZGameService");var DDZGameServiceModel=function(){function e(){this.gameService=void 0,this.needExecuteCallback=!1}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.isSupportWSS=function(e,t){var a=new egret.WebSocket;a.type=egret.WebSocket.TYPE_BINARY,a.addEventListener(egret.Event.CONNECT,function(e){t(!0),a.close()},this),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){t(!1)},this),a.connectByUrl(e)},e.prototype.start=function(e,t){var a=this;if(this.needExecuteCallback=!0,this.gameService)return void(this.needExecuteCallback&&(this.gameService.connect(),t(),this.needExecuteCallback=!1));var r={isNative:Device.sharedInstance().isNative(),url:e.host,version:e.version,accessToken:e.access_token,user:e.user_id,info:e.info,timestamp:e.timestamp,token:e.token};this.gameService=new DDZGameService(r),this.gameService.connect(),this.gameService.on("connect",function(e){t&&a.needExecuteCallback&&(t(),a.needExecuteCallback=!1);var r=new DDZNetworkEvent(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(r),egret.log("game service connect ....")}),this.gameService.on("disconnect",function(e){var t=new DDZNetworkEvent(DDZNetworkEvent.DISCONNECT_SERVER_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(t),egret.log("game service disconnect ......"),egret.log(e)}),this.gameService.on("error",function(e){egret.log("game service error ......"),egret.log(e)})},e.prototype.stop=function(){this.gameService.disconnect(),this.gameService=void 0},e.prototype.subscribe=function(e,t){return this.gameService.subscribe(e,t)},e}();__reflect(DDZGameServiceModel.prototype,"DDZGameServiceModel",["IUserWebsocketAction"]);var DDZUserChannelModel=function(){function e(){this.needExecuteCallback=!1}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setMessageCounter=function(e){this.messageCounter=e},e.prototype.resetMessageCounter=function(){this.messageCounter.reset()},e.prototype.subscribe=function(e,t){var a=this;if(this.needExecuteCallback=!0,this.userChannel)return egret.log("callback without subscribe..........."),void t();var r={message:function(e){egret.log("----------------------------------------"),egret.log(JSON.stringify(e.data.payload)),egret.log("\n"),a.needResetMessageCounter(e)&&a.resetMessageCounter(),"room"===e.data.stream?a.handleRoomMessage(e):"doudizhu"===e.data.stream&&a.handleGameMessage(e),a.checkMessageMissed(e)},join:function(e){egret.log("user channel someone joined channel")},leave:function(e){egret.log("user channel someone left channel")},subscribe:function(e){a.needExecuteCallback&&(t(),a.needExecuteCallback=!1)},error:function(e){a.needExecuteCallback&&(t(new Error("订阅用户频道出错")),a.needExecuteCallback=!1),a.unsubscribe(),egret.log("subscribe userChannel failed ......."),egret.log(e)},unsubscribe:function(e){egret.log("unsubscribe userChannel success .......")}};this.userChannel=DDZGameServiceModel.sharedInstance().subscribe(e,r)},e.prototype.unsubscribe=function(){this.userChannel&&(this.userChannel.unsubscribe(),this.userChannel=void 0)},e.prototype.handleRoomMessage=function(e){var t=new DDZGameServiceMessage(e);this.roomMessageReceivedHandler&&this.roomMessageReceivedHandler(t.data)},e.prototype.handleGameMessage=function(e){var t=new DDZGameServiceMessage(e);this.userMessageReceivedHandler&&this.userMessageReceivedHandler(t.data)},e.prototype.needResetMessageCounter=function(e){var t=e.data.payload.action;return t===DDZGameServiceAction.RestartGame?!0:t===DDZGameServiceAction.GameOver?!0:t===DDZGameServiceAction.ForceGameOver?!0:!1},e.prototype.checkMessageMissed=function(e){if(e.data.payload.action!==DDZGameServiceAction.GameOver&&(this.messageCounter.addMessage(e.data.payload.sequence),this.messageCounter.isMessageMissed())){var t=new DDZWebsocketEvent(DDZWebsocketEvent.MISS_MESSAGE_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(t)}},e}();__reflect(DDZUserChannelModel.prototype,"DDZUserChannelModel");var TestDDZUserChannelModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.startTest=function(){this.testMissMessage(),this.testNoMessageMissed(),this.testMissedMessageAndCountAgain()},t.prototype.testMissMessage=function(){var e=new DDZGameServiceMessageCounter;this.assertEquals("期待初始丢失消息状态为 false",!1,e.isMessageMissed()),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(6),this.assertEquals("监测到丢失消息",!0,e.isMessageMissed())},t.prototype.testNoMessageMissed=function(){var e=new DDZGameServiceMessageCounter;this.assertEquals("期待初始丢失消息状态为 false",!1,e.isMessageMissed()),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(5),e.addMessage(6),e.addMessage(7),e.addMessage(8),e.addMessage(9),e.addMessage(10),e.addMessage(11),e.addMessage(12),e.addMessage(13),e.addMessage(14),e.addMessage(15),this.assertEquals("测试连续收到15条消息",!1,e.isMessageMissed())},t.prototype.testMissedMessageAndCountAgain=function(){var e=new DDZGameServiceMessageCounter;this.assertEquals("测试缺失消息然后重新检测 --- 期待初始丢失消息状态为 false",!1,e.isMessageMissed()),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(6),this.assertEquals("测试缺失消息然后重新检测 --- 监测到消息丢失",!0,e.isMessageMissed()),e.reset(),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(5),this.assertEquals("测试缺失消息然后重新检测 --- 消息丢失后重新检测没有丢失情况",!1,e.isMessageMissed()),e.reset(),e.addMessage(1),e.addMessage(2),e.addMessage(3),e.addMessage(4),e.addMessage(6),this.assertEquals("测试缺失消息然后重新检测 --- 消息丢失后重新检测又有消息丢失情况",!0,e.isMessageMissed())
},t}(QPTestCase);__reflect(TestDDZUserChannelModel.prototype,"TestDDZUserChannelModel");var DDZGameServiceAction=function(){function e(){}return e.JoinRoom="join_room",e.LeaveRoom="leave_room",e.StartGame="start_game",e.DealCards="deal_cards",e.Match="match",e.CallLandlord="become_landlord",e.ConfirmLandlord="finish_landlord",e.RestartGame="restart_game",e.Deal="deal",e.PlayCard="play_card",e.GameOver="end_game",e.ForceGameOver="force_end_game_by_leaving",e.Ready="ready",e}();__reflect(DDZGameServiceAction.prototype,"DDZGameServiceAction");var DDZGameServiceMessage=function(){function e(e){this.uid=e.uid,this.channel=e.channel,this.data=DDZGameServiceMessageDataFactory.createMessageData(e.data.payload)}return e}();__reflect(DDZGameServiceMessage.prototype,"DDZGameServiceMessage");var TestMain=function(e){function t(){var t=e.call(this)||this,a=new TestGameModel("test_game_model");a.startTest();var r=new TestDDZTaskActionModel("test_task_action_model");r.startTest();var n=new TestUserActionModel("test.user.http.action.model");n.startTest();var o=new TestDDZUserChannelModel("test.user.channel.model");return o.startTest(),t}return __extends(t,e),t}(eui.UILayer);__reflect(TestMain.prototype,"TestMain");var DDZGameServiceMessageCallLandlordData=function(e){function t(t){var a=e.call(this,t)||this;return a.nextPlayer=t.next_player_id,a.playerId=t.player_id,a.score=t.score,a.currentLandlordScore=t.current_landlord_score,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageCallLandlordData.prototype,"DDZGameServiceMessageCallLandlordData");var DDZGameServiceMessageConfirmLandlordData=function(e){function t(t){var a=e.call(this,t)||this;a.landlord=t.landlord,a.bottomCards=[];for(var r=0,n=t.bottom_cards;r<n.length;r++){var o=n[r],i=new DDZCard(o);a.bottomCards.push(i)}return a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageConfirmLandlordData.prototype,"DDZGameServiceMessageConfirmLandlordData");var DDZGameServiceMessageCounter=function(){function e(){this.DefaultMessageSequence=-11111,this.reset()}return e.prototype.addMessage=function(e){void 0!==e&&(this.previousMessageSequence===this.DefaultMessageSequence?this.missMessage=!1:e-this.previousMessageSequence!==1&&(this.missMessage=!0),this.previousMessageSequence=e)},e.prototype.isMessageMissed=function(){return this.missMessage},e.prototype.reset=function(){this.previousMessageSequence=this.DefaultMessageSequence,this.missMessage=!1},e}();__reflect(DDZGameServiceMessageCounter.prototype,"DDZGameServiceMessageCounter",["IDDZMessageCounter"]);var DDZGameServiceMessageDataFactory=function(){function e(){}return e.createMessageData=function(e){switch(e.action){case DDZGameServiceAction.JoinRoom:return new DDZGameServiceMessageRoomPlayerChangedData(e);case DDZGameServiceAction.LeaveRoom:return new DDZGameServiceMessageRoomPlayerChangedData(e);case DDZGameServiceAction.DealCards:return new DDZGameServiceMessageDealCardsData(e);case DDZGameServiceAction.CallLandlord:return new DDZGameServiceMessageCallLandlordData(e);case DDZGameServiceAction.ConfirmLandlord:return new DDZGameServiceMessageConfirmLandlordData(e);case DDZGameServiceAction.StartGame:return new DDZGameServiceMessageStartGameData(e);case DDZGameServiceAction.RestartGame:return new DDZGameServiceMessageRestartGameData(e);case DDZGameServiceAction.PlayCard:return new DDZGameServiceMessagePlayCardData(e);case DDZGameServiceAction.GameOver:return new DDZGameServiceMessageGameOverData(e);case DDZGameServiceAction.ForceGameOver:return new DDZGameServiceMessageForceGameOverData(e);case DDZGameServiceAction.Ready:return new DDZGameServiceMessageRoomPlayerChangedData(e)}throw new Error("create game service message data fatal error ...")},e}();__reflect(DDZGameServiceMessageDataFactory.prototype,"DDZGameServiceMessageDataFactory");var DDZGameServiceMessageDealCardsData=function(e){function t(t){var a=e.call(this,t)||this;a.cards=[];for(var r=0,n=t.cards;r<n.length;r++){var o=n[r],i=new DDZCard(o);a.cards.push(i)}return a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageDealCardsData.prototype,"DDZGameServiceMessageDealCardsData");var DDZGameServiceMessageForceGameOverData=function(e){function t(t){var a=e.call(this,t)||this;return a.leftPlayerName=t.left_player.nickname,a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageForceGameOverData.prototype,"DDZGameServiceMessageForceGameOverData");var DDZGameServiceMessageGameOverData=function(e){function t(t){var a=e.call(this,t)||this;return a.gameOverPlayerInformations=a.createPlayerInformations(t.players),a.isSpring=t.is_slam,a.endDateString=t.ended_at,a}return __extends(t,e),t.prototype.createPlayerInformations=function(e){for(var t=[],a=0,r=e;a<r.length;a++){var n=r[a],o=new DDZGameOverPlayerInformation(n);t.push(o)}return t},t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageGameOverData.prototype,"DDZGameServiceMessageGameOverData");var DDZGameOverPlayerInformation=function(){function e(e){if(this.playerId=e.id,this.remainCards=[],e.remain_cards)for(var t=0,a=e.remain_cards;t<a.length;t++){var r=a[t],n=new DDZCard(r);this.remainCards.push(n)}}return e.prototype.isWinner=function(){return 0===this.remainCards.length},e}();__reflect(DDZGameOverPlayerInformation.prototype,"DDZGameOverPlayerInformation");var DDZGameServiceMessagePlayCardData=function(e){function t(t){var a=e.call(this,t)||this;if(a.playerId=t.player_id,a.remainCardsAmount=t.remain_cards_amount,a.nextPlayerId=t.next_player_id,0===t.played_cards.length)a.playedCards=[];else{var r=t.played_cards.map(function(e){return new DDZCard(e)});a.playedCards=r.sort(function(e,t){return t.index-e.index})}return a}return __extends(t,e),t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessagePlayCardData.prototype,"DDZGameServiceMessagePlayCardData");var DDZGameServiceMessageRestartGameData=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(DDZGameServiceMessageStartGameData);__reflect(DDZGameServiceMessageRestartGameData.prototype,"DDZGameServiceMessageRestartGameData");var DDZGameServiceMessageRoomPlayerChangedData=function(e){function t(t){var a=e.call(this,t)||this;return a.playerId=t.player_id,a.playerInformations=[],a.createPlayerInformaitons(t.room.players),a}return __extends(t,e),t.prototype.createPlayerInformaitons=function(e){for(var t=0,a=e;t<a.length;t++){var r=a[t],n={id:r.id,service_id:r.service_id,is_active:!1,timer_value:0,cards_count:0,cards:[],call_landlord_score:0,has_called_landlord:!1,last_played_cards:[],seat:r.seat,nickname:r.nickname,profile_image:r.profile_image,gender:r.gender,balance:r.balance,is_ready:r.ready},o=new DDZPlayerJoinGameInformation(n);this.playerInformations.push(o)}},t}(DDZGameServiceMessageBaseData);__reflect(DDZGameServiceMessageRoomPlayerChangedData.prototype,"DDZGameServiceMessageRoomPlayerChangedData");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,a,r){function n(e){t.call(r,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),a.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var DDZGameState;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.fetch=function(e,t){var r=this,n={url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/player_state",header:this.headerWithAuthorization()};this.fetchJson(n,function(t){egret.log("fetch game state success ... \n"),egret.log(t),egret.log("========================"),r.setGameState(t.state),t.room&&(r.room=new a(t.room)),e(t)},function(e){t(e)})},t.prototype.setGameState=function(e){this.gameState=e},t.prototype.isWaiting=function(){return this.gameState===r.WAITING},t.prototype.isInGame=function(){return this.gameState===r.BECOMING_LANDLORD||this.gameState===r.PLAYING_CARD},t.prototype.isIdling=function(){return this.gameState===r.IDLING},t.prototype.isPlayingGame=function(){return this.gameState===r.PLAYING_CARD},t.prototype.isBecomingLandlord=function(){return this.gameState===r.BECOMING_LANDLORD},t.prototype.countCardsForPlayer=function(e){var t=this.getPlayerInformationById(e);return t?t.cardsCount:0},t.prototype.listCardsForPlayer=function(e){var t=this.getPlayerInformationById(e);return t?t.cards:[]},t.prototype.listPlayedCardsForPlayer=function(e){var t=this.getPlayerInformationById(e);e===this.room.confirmedLandlord;return t?t.lastPlayedCards:[]},t.prototype.getPlayerInformationById=function(e){for(var t=0,a=this.room.playerInformations;t<a.length;t++){var r=a[t];if(r.id===e)return r}},t.prototype.getActivePlayerTimerValue=function(){return this.room.activePlayerInformation.timerValue},t.instance=void 0,t}(QPNetworkApi);e.Model=t,__reflect(t.prototype,"DDZGameState.Model");var a=function(){function e(e){if(this.lastPlayedCards=[],this.calledLandlordScore=0,this.id=e.id,this.gameMatchId=e.game_match_id,this.startedAt=e.started_at,this.baseScore=e.base_score,this.bottomCards=[],e.bottom_cards)for(var t=0,a=e.bottom_cards;t<a.length;t++){var r=a[t],n=new DDZCard(r);this.bottomCards.push(n)}this.confirmedLandlord=e.landlord,this.initLandlord=e.init_landlord,this.playerIds=e.player_ids,this.playerInformations=[],this.createPlayerInformations(e.players)}return e.prototype.createPlayerInformations=function(e){for(var t=0,a=e;t<a.length;t++){var r=a[t],n={id:r.id,service_id:r.service_id,is_active:r.is_active,timer_value:0,cards_count:r.remain_cards_amount,cards:r.cards,call_landlord_score:r.become_landlord_record?r.become_landlord_record.score:0,has_called_landlord:null!==r.become_landlord_record,last_played_cards:r.last_play_card_record?r.last_play_card_record.played_cards:[],seat:r.seat,nickname:r.nickname,profile_image:r.profile_image,gender:r.gender,balance:r.balance,is_ready:r.ready};r.last_play_card_record&&this.setLastPlayedCardsCards(r),this.setLastCalledLandlordScore(r);var o=new DDZPlayerJoinGameInformation(n);o.isActive&&(this.activePlayerInformation=o),this.playerInformations.push(o)}},e.prototype.setLastCalledLandlordScore=function(e){var t=e.become_landlord_record;t&&this.calledLandlordScore<t.score&&(this.calledLandlordScore=t.score)},e.prototype.setLastPlayedCardsCards=function(e){var t=e.last_play_card_record;if(this.lastPlayedCardsDate){var a=new Date(t.created_at);if(this.lastPlayedCardsDate<a){var r=t.played_cards.map(function(e){return new DDZCard(e)});0!==r.length&&(this.lastPlayedCardsDate=a,this.lastPlayedCards=r,this.lastPlayedCardsPlayer=e.id)}}else{var r=t.played_cards.map(function(e){return new DDZCard(e)});0!==r.length&&(this.lastPlayedCardsDate=new Date(t.created_at),this.lastPlayedCards=r,this.lastPlayedCardsPlayer=e.id)}},e}();e.Room=a,__reflect(a.prototype,"DDZGameState.Room");var r=function(){function e(){}return e.BECOMING_LANDLORD="becoming_landlord",e.PLAYING_CARD="playing_card",e.WAITING="waiting",e.IDLING="idling",e.GAME_BEEN_RESTORED="game_has_been_restored",e}();e.Type=r,__reflect(r.prototype,"DDZGameState.Type")}(DDZGameState||(DDZGameState={}));var DDZPlayerJoinGameInformation=function(){function e(e){if(this.cardsCount=0,this.calledLandlordScore=0,this.id=e.id,this.serviceId=e.service_id||"",this.isActive=e.is_active,this.timerValue=e.timer_value,this.cardsCount=e.cards_count,this.hasCalledLandlord=e.has_called_landlord,this.cards=[],this.seatId=String(e.seat),this.nickame=e.nickname,this.profileImage=e.profile_image,this.balance=e.balance,this.gender=GenderFactory.createGender(e.gender),this.isReady=e.is_ready,e.cards)for(var t=0,a=e.cards;t<a.length;t++){var r=a[t],n=new DDZCard(r);this.cards.push(n)}if(this.calledLandlordScore=e.call_landlord_score,this.lastPlayedCards=[],e.last_played_cards)for(var o=0,i=e.last_played_cards;o<i.length;o++){var r=i[o],n=new DDZCard(r);this.lastPlayedCards.push(n)}}return e}();__reflect(DDZPlayerJoinGameInformation.prototype,"DDZPlayerJoinGameInformation");var HttpActionModel=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.executeGet=function(e,t,a){},t.prototype.executePost=function(e,t,a){var r={url:e.url,header:e.needAuthorization?this.headerWithAuthorization():this.headerWithoutAuthorization(),body:e.body};this.postReturnJson(r,function(e){t(e)},function(e){a(e)})},t}(QPNetworkApi);__reflect(HttpActionModel.prototype,"HttpActionModel",["IHttpAction"]);var QPApiConfig=function(){function e(){}return e.Host="https://api.laiwan.io",e.DownloadHost="https://www.laiwan.io/download",e.V1="v1",e.WEBSOCKET_V1="v1",e.WSS_HOST="wss://api.laiwan.io",e.WS_HOST="ws://api.laiwan.io",e}();__reflect(QPApiConfig.prototype,"QPApiConfig");var QPNetworkErrorType;!function(e){e[e.None=0]="None",e[e.UserNotFound=1]="UserNotFound",e[e.NotThisPlayerTurn=2]="NotThisPlayerTurn",e[e.WrongCardType=3]="WrongCardType",e[e.ClientCheckedWrongCardType=4]="ClientCheckedWrongCardType"}(QPNetworkErrorType||(QPNetworkErrorType={}));var QPNetworkError=function(){function e(e){this.message=e.message,"user_not_found"===e.error_type?this.type=QPNetworkErrorType.UserNotFound:"not_this_player_turn"===e.error_type?this.type=QPNetworkErrorType.NotThisPlayerTurn:"wrong_card_type"===e.error_type?this.type=QPNetworkErrorType.WrongCardType:"client_checked_wrong_card_type"===e.error_type?this.type=QPNetworkErrorType.ClientCheckedWrongCardType:this.type=QPNetworkErrorType.None}return e}();__reflect(QPNetworkError.prototype,"QPNetworkError");var UserModel=function(e){function t(){var t=e.call(this)||this;return t.isTourist=!0,t.actionModel=new UserActionModel,t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.setActionDataFactory=function(e){this.actionDataFactory=e},t.prototype.setAttributeModel=function(e){this.attributeModel=e},t.prototype.setInputtedAttributeModel=function(e){this.inputtedAttributeModel=e},t.prototype.setPersonalRoomModel=function(e){this.personalRoomModel=e},t.prototype.signOut=function(e,t){DDZUserChannelModel.sharedInstance().unsubscribe(),DDZGameServiceModel.sharedInstance().stop(),this.attributeModel.cleanCommunicationAttribute(),t()},t.prototype.verifyIAPReceipt=function(e,t){var a={url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/iap/transaction",header:this.headerWithAuthorization(),body:{user_id:this.attributeModel.id,receipt_data:e}};this.postReturnJson(a,function(e){t()},function(e){t(e)})},t.prototype.joinGame=function(e,t){var a=this,r={url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/doudizhu/basic/join",header:this.headerWithAuthorization()};this.postReturnJson(r,function(e){egret.log("加入房间http请求成功")},function(e){t(e)}),DDZUserChannelModel.sharedInstance().roomMessageReceivedHandler=function(t){var r={roomId:t.roomId,baseScore:0,playerInformations:t.playerInformations},n=a.findMyInformation(t.playerInformations);a.setBalance(Number(n.balance)),e(r)}},t.prototype.modifyUserInformation=function(e,t){var a=this;if(e.nickname.countByte()<6)return void t(new QPNetworkError({message:"您的用户名不能少于2个中文或者6个英文字母"}));if(21<e.nickname.countByte())return void t(new QPNetworkError({message:"您的用户名不能多余7个中文或者21个英文字母"}));var r={header:this.headerWithAuthorization(),body:{nickname:e.nickname,gender:e.gender},url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/profile/"};this.postReturnJson(r,function(e){a.attributeModel.name=e.nickname,a.attributeModel.gender=GenderFactory.createGender(e.gender),t()},function(e){t(e)})},t.prototype.connectRealtimeGameService=function(e){var t=this,a={user_id:this.attributeModel.id,timestamp:this.attributeModel.getTimestamp(),host:QPApiConfig.WSS_HOST,version:QPApiConfig.WEBSOCKET_V1,access_token:this.attributeModel.getAccessToken(),info:this.attributeModel.getInfo(),token:this.attributeModel.getToken()};DDZGameServiceModel.sharedInstance().start(a,function(){DDZUserChannelModel.sharedInstance().subscribe(t.attributeModel.getChannel(),function(t){return t?void e(t):(DDZUserChannelModel.sharedInstance().setMessageCounter(new DDZGameServiceMessageCounter),void e())})})},t.prototype.addBalance=function(e){this.wallet.add(e),this.attributeModel.setBalanceAmount(this.wallet.getAvailableAmount())},t.prototype.saveUserInformation=function(e){this.attributeModel.setAccessToken(e.auth.access_token),this.attributeModel.setId(e.user.id),this.attributeModel.serviceId=e.user.service_id,this.attributeModel.gender=GenderFactory.createGender(e.user.gender),this.attributeModel.name=e.user.nickname,e.user.wallet&&(this.wallet=new UserWallet(e.user.wallet[0]),this.attributeModel.setBalanceAmount(this.wallet.getAvailableAmount())),this.attributeModel.setChannel(e.websocket_token.user_channel),this.attributeModel.setInfo(e.websocket_token.info),this.attributeModel.setTimestamp(e.websocket_token.timestamp),this.attributeModel.setToken(e.websocket_token.token)},t.prototype.findMyInformation=function(e){for(var t=0,a=e;t<a.length;t++){var r=a[t];if(r.id===this.attributeModel.id)return r}},t.prototype.setBalance=function(e){this.wallet.setAvailableAmount(e),this.attributeModel.setBalanceAmount(this.wallet.getAvailableAmount())},t.instance=void 0,t}(QPNetworkApi);__reflect(UserModel.prototype,"UserModel");var UserWallet=function(){function e(e){this.name=e.currency,this.availableAmount=Number(e.balance),this.frozenAmount=Number(e.frozen_amount),this.totalAmount=Number(e.total_amount)}return e.prototype.add=function(e){this.availableAmount+=e,this.update()},e.prototype.setAvailableAmount=function(e){this.availableAmount=e,this.update()},e.prototype.getAvailableAmount=function(){return this.availableAmount},e.prototype.update=function(){this.totalAmount=this.availableAmount+this.frozenAmount;var e=new DDZDataEvent(DDZDataEvent.UPDATE);DDZEventCenter.sharedInstance().dispatchEvent(e)},e}();__reflect(UserWallet.prototype,"UserWallet",["IWallet"]);var TestUserActionModel=function(e){function t(t){var a=e.call(this,t)||this;return a.actionModel=new UserActionModel,a}return __extends(t,e),t.prototype.startTest=function(){this.testGetVerificationCode(),this.testPhoneSignIn(),this.testCreatePersonalRoom(),this.testJoinPersonalRoomByPin(),this.testContinueGame()},t.prototype.testGetVerificationCode=function(){var e=this,t=new SendVerificationCodeData({country_code:"86",phone_number:"13982100549"});this.actionModel.sendVerificationCode(t,function(t){e.assert("测试请求发送验证码",!0),e.hashDigest=t.hash_digest,e.expireISOTime=t.expire_iso_time,e.testPhoneSignUp()},function(t){e.assert("测试请求发送验证码",!1)})},t.prototype.testPhoneSignUp=function(){var e=this,t=new PhoneSignUpData({country_code:"86",phone_number:"13982100549",password:"qwerty",verification_code:"123456",hash_digest:this.hashDigest,expire_iso_time:this.expireISOTime,username:"ieffffff",nickname:"David Lee",birthday:"2000-01-01"});this.actionModel.signUp(t,function(t){e.assert("测试用户手机注册",!0)},function(t){e.assert("测试用户手机注册 "+t.message,!1)})},t.prototype.testPhoneSignIn=function(){var e=this,t=new PhoneAndPasswordSignInData({country_code:"86",phone_number:"13982100549",password:"123456"});this.actionModel.signIn(t,function(t){e.assert("手机密码登录",!0)},function(t){e.assert("手机密码登录 : "+t.message,!1)})},t.prototype.testCreatePersonalRoom=function(){var e=this,t=new CreatePersonalRoomData({});this.actionModel.createPersonalRoom(t,function(t){UserModel.sharedInstance().personalRoomModel.setPin(t.pin),UserModel.sharedInstance().personalRoomModel.setId(t.id),UserModel.sharedInstance().personalRoomModel.setPlayers(t.players),e.assertEquals("房间的pin应该是 "+t.pin,t.pin,UserModel.sharedInstance().personalRoomModel.getPin()),e.assertEquals("房间的id应该是 "+t.id,t.id,UserModel.sharedInstance().personalRoomModel.getId()),e.assertEquals("房间的玩家数应该是 "+t.players.length,t.players.length,UserModel.sharedInstance().personalRoomModel.getPlayers().length)},function(t){e.assert("创建私人房间出错，错误是："+t.message,!1)})},t.prototype.testJoinPersonalRoomByPin=function(){var e=this,t=new JoinPersonalRoomData({pin:UserModel.sharedInstance().personalRoomModel.getPin()});this.actionModel.joinPersonalRoomByPin(t,function(t){UserModel.sharedInstance().personalRoomModel.setPlayers(t.players),e.assertEquals("房间的玩家数应该是 "+t.players.length,t.players.length,UserModel.sharedInstance().personalRoomModel.getPlayers().length),e.assertEquals("房间邀请码应该是 "+t.pin,t.pin,UserModel.sharedInstance().personalRoomModel.getPin())},function(t){e.assert("加入个人房间出错，错误是："+t.message,!1)})},t.prototype.testContinueGame=function(){var e=this,t=new ContinueGameData({});this.actionModel.continueGame(t,function(t){e.assertEquals("返回的数据ok应该为true",!0,t.ok)},function(t){e.assert("继续游戏发生错误 : "+t.message,!1)})},t}(QPTestCase);__reflect(TestUserActionModel.prototype,"TestUserActionModel");var PhoneUserActionDataFactory=function(){function e(){}return e.prototype.makeSendVerificationCodeData=function(){return new SendVerificationCodeData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber()})},e.prototype.makeSignUpData=function(){return new PhoneSignUpData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber(),password:UserModel.sharedInstance().inputtedAttributeModel.getPassword(),username:UserModel.sharedInstance().inputtedAttributeModel.getUsername(),nickname:UserModel.sharedInstance().inputtedAttributeModel.getNickname(),birthday:UserModel.sharedInstance().inputtedAttributeModel.getBirthday(),verification_code:UserModel.sharedInstance().inputtedAttributeModel.getVerificationCode(),hash_digest:UserModel.sharedInstance().attributeModel.getHashDigest(),expire_iso_time:UserModel.sharedInstance().attributeModel.getExpireISOTime()})},e.prototype.makeSignInData=function(){return new PhoneAndPasswordSignInData({country_code:UserModel.sharedInstance().inputtedAttributeModel.getCountryCode(),phone_number:UserModel.sharedInstance().inputtedAttributeModel.getPhoneNumber(),password:UserModel.sharedInstance().inputtedAttributeModel.getPassword()})},e.prototype.makeSignOutData=function(){},e.prototype.makeBindPhoneData=function(){throw new Error("电话登录用户不用绑定手机号")},e.prototype.makeCreatePersonalRoomData=function(){return new CreatePersonalRoomData({})},e.prototype.makeJoinPersonalRoomData=function(){return new JoinPersonalRoomData({pin:UserModel.sharedInstance().personalRoomModel.getPin()})},e.prototype.makeContinueGameData=function(){return new ContinueGameData({})},e}();__reflect(PhoneUserActionDataFactory.prototype,"PhoneUserActionDataFactory",["IUserActionDataFactory"]);var UserActionModel=function(e){function t(){var a=e.call(this)||this;return a.httpAction=new HttpActionModel,a.isAgreementReaded=DDZCacheModel.sharedInstance().booleanForKey(t.SAVE_READ_AGREEMENT_KEY),a.isAgreementApproved=DDZCacheModel.sharedInstance().booleanForKey(t.SAVE_APPROVED_AGREEMENT_KEY),a}return __extends(t,e),t.prototype.readAgreement=function(){this.isAgreementReaded=!0,DDZCacheModel.sharedInstance().setBoolean(t.SAVE_READ_AGREEMENT_KEY,this.isAgreementReaded)},t.prototype.approveAgreement=function(e){this.isAgreementApproved=e,DDZCacheModel.sharedInstance().setBoolean(t.SAVE_APPROVED_AGREEMENT_KEY,this.isAgreementApproved)},t.prototype.sendVerificationCode=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},t.prototype.signUp=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},t.prototype.signIn=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},t.prototype.signOut=function(e,t,a){},t.prototype.bindPhone=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},t.prototype.createPersonalRoom=function(e,t,a){this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)})},t.prototype.joinPersonalRoomByPin=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},t.prototype.continueGame=function(e,t,a){return e.isLegal?void this.httpAction.executePost(e,function(e){t(e)},function(e){a(e)}):void a(new QPNetworkError({message:e.validateMessage}))},t.SAVE_READ_AGREEMENT_KEY="save.user.is.read.agreement.key",t.SAVE_APPROVED_AGREEMENT_KEY="save.user.is.approved.agreement.key",t}(QPNetworkApi);__reflect(UserActionModel.prototype,"UserActionModel",["IUserAction"]);var BindPhoneData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.password=t.password,a.body.verification_code=t.verification_code,a.body.hash_digest=t.hash_digest,a.body.expire_iso_time=t.expire_iso_time,a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/bind_phone/",a}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.phone_number?e.phone_number.length<11?void(this.validateMessage="请输入正确的电话号码"):e.password?e.password.length<6?void(this.validateMessage="密码长度不能小于6"):50<e.password.length?void(this.validateMessage="密码长度不能大于50"):e.verification_code?6!==e.verification_code.length?void(this.validateMessage="请输入6位数验证码"):void(this.isLegal=!0):void(this.validateMessage="请输入验证码"):void(this.validateMessage="请输入密码"):void(this.validateMessage="请输入电话号码")},t}(HttpActionData);__reflect(BindPhoneData.prototype,"BindPhoneData");var SendVerificationCodeData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/sms/code/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.phone_number?e.phone_number.length<11?(this.validateMessage="请输入正确的电话号码",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入电话号码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(SendVerificationCodeData.prototype,"SendVerificationCodeData");var CreatePersonalRoomData=function(e){function t(t){var a=e.call(this,t)||this;return a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/room",a}return __extends(t,e),t.prototype.validate=function(e){this.isLegal=!0},t}(HttpActionData);__reflect(CreatePersonalRoomData.prototype,"CreatePersonalRoomData");var JoinPersonalRoomData=function(e){function t(t){var a=e.call(this,t)||this;return a.body={pin:t.pin},a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/join",a}return __extends(t,e),t.prototype.validate=function(e){return e.pin?void(this.isLegal=!0):(this.validateMessage="请提供想要加入房间的邀请码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(JoinPersonalRoomData.prototype,"JoinPersonalRoomData");var ContinueGameData=function(e){function t(t){var a=e.call(this,t)||this;return a.needAuthorization=!0,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/ready",a}return __extends(t,e),t.prototype.validate=function(e){this.isLegal=!0},t}(HttpActionData);__reflect(ContinueGameData.prototype,"ContinueGameData");var PhoneAndPasswordSignInData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.password=t.password,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/login/phone/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.phone_number?e.phone_number.length<11?(this.validateMessage="请输入正确的电话号码",void(this.isLegal=!1)):e.password?e.password.length<6?(this.validateMessage="密码长度不能小于6",void(this.isLegal=!1)):50<e.password.length?(this.validateMessage="密码长度不能大于50",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入密码",void(this.isLegal=!1)):(this.validateMessage="请输入电话号码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(PhoneAndPasswordSignInData.prototype,"PhoneAndPasswordSignInData");var PhoneAndVerifyCodeLoginData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.verifycation_code=t.verifycation_code,a.body.hash_digest=t.hash_digest,a.body.expire_iso_time=t.expire_iso_time,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/login/phone/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){this.validateMessage="暂不提供手机验证登录方式",this.isLegal=!1},t}(HttpActionData);__reflect(PhoneAndVerifyCodeLoginData.prototype,"PhoneAndVerifyCodeLoginData");var TouristSignInData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.user_id=t.user_id,a.body.password=t.password,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/login/anonymous/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.user_id?e.password?e.password.length<6?(this.validateMessage="密码长度不能小于6",void(this.isLegal=!1)):50<e.password.length?(this.validateMessage="密码长度不能大于50",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入密码",void(this.isLegal=!1)):(this.validateMessage="没有用户名",void(this.isLegal=!1))},t}(HttpActionData);__reflect(TouristSignInData.prototype,"TouristSignInData");var PhoneSignUpData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.country_code=t.country_code,a.body.phone_number=t.phone_number,a.body.username=t.username,a.body.nickname=t.nickname,a.body.birthday=t.birthday,a.body.password=t.password,a.body.verification_code=t.verification_code,a.body.hash_digest=t.hash_digest,a.body.expire_iso_time=t.expire_iso_time,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/register/phone/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return this.isLegal=!1,e.phone_number?e.phone_number.length<11?void(this.validateMessage="请输入正确的电话号码"):e.password?e.password.length<6?void(this.validateMessage="密码长度不能小于6"):50<e.password.length?void(this.validateMessage="密码长度不能大于50"):e.verification_code?6!==e.verification_code.length?void(this.validateMessage="请输入6位数验证码"):void(this.isLegal=!0):void(this.validateMessage="请输入验证码"):void(this.validateMessage="请输入密码"):void(this.validateMessage="请输入电话号码")},t}(HttpActionData);__reflect(PhoneSignUpData.prototype,"PhoneSignUpData");var TouristRegisterData=function(e){function t(t){var a=e.call(this,t)||this;return a.body.password=t.password,a.url=QPApiConfig.Host+"/"+QPApiConfig.V1+"/user/register/anonymous/",a.needAuthorization=!1,a}return __extends(t,e),t.prototype.validate=function(e){return e.password?e.password.length<6?(this.validateMessage="密码长度不能小于6",void(this.isLegal=!1)):50<e.password.length?(this.validateMessage="密码长度不能大于50",void(this.isLegal=!1)):void(this.isLegal=!0):(this.validateMessage="请输入密码",void(this.isLegal=!1))},t}(HttpActionData);__reflect(TouristRegisterData.prototype,"TouristRegisterData");var InputtedAttributeModel=function(){function e(){this.countryCode="86"}return e.prototype.setCountryCode=function(e){this.countryCode=e},e.prototype.getCountryCode=function(){return this.countryCode},e.prototype.setPhoneNumber=function(e){this.phoneNumber=e},e.prototype.getPhoneNumber=function(){return this.phoneNumber},e.prototype.setPassword=function(e){this.password=e},e.prototype.getPassword=function(){return this.password},e.prototype.setVerificationCode=function(e){this.verificationCode=e},e.prototype.getVerificationCode=function(){return this.verificationCode},e.prototype.setFirstName=function(e){this.firstName=e},e.prototype.getFirstName=function(){return this.firstName
},e.prototype.setLastName=function(e){this.lastName=e},e.prototype.getLastName=function(){return this.lastName},e.prototype.hasAccountAndPassword=function(){return this.phoneNumber&&this.password?!0:!1},e.prototype.hasNickname=function(){return this.firstName||this.lastName?!0:!1},e.prototype.getNickname=function(){var e="";return this.firstName&&(e+=this.firstName),this.lastName&&(e+=this.lastName),e},e.prototype.setUsername=function(e){this.username=e},e.prototype.getUsername=function(){return this.username},e.prototype.setBirthday=function(e){this.birthday=e},e.prototype.getBirthday=function(){return this.birthday},e}();__reflect(InputtedAttributeModel.prototype,"InputtedAttributeModel",["IInputtedAttribute"]);var PersonalRoomModel=function(){function e(){}return e.prototype.setPin=function(e){this.pin=e},e.prototype.getPin=function(){return this.pin},e.prototype.setId=function(e){this.id=e},e.prototype.getId=function(){return this.id},e.prototype.setPlayers=function(e){this.players=[];for(var t=0,a=e;t<a.length;t++){var r=a[t],n=new DDZPlayerJoinGameInformation({id:r.id,service_id:r.username,nickname:r.nickname,gender:r.gender,seat:r.seat,is_ready:r.ready});this.players.push(n)}},e.prototype.getPlayers=function(){return this.players},e}();__reflect(PersonalRoomModel.prototype,"PersonalRoomModel",["IPersonalRoom"]);var PhoneUserAttributeModel=function(e){function t(){var a=e.call(this)||this;return a.hasSignUp=DDZCacheModel.sharedInstance().booleanForKey(t.SIGN_UP_STATE_KEY),a}return __extends(t,e),t.prototype.setHasSignUp=function(e){this.hasSignUp=e,DDZCacheModel.sharedInstance().setBoolean(t.SIGN_UP_STATE_KEY,e)},t.SIGN_UP_STATE_KEY="phone.user.register.state.key",t}(BaseUserAttributeModel);__reflect(PhoneUserAttributeModel.prototype,"PhoneUserAttributeModel");var TouristUserAttributeModel=function(e){function t(){var a=e.call(this)||this;return a.password=DDZCacheModel.sharedInstance().stringForKey(t.PASSWORD_KEY),a.password||(a.password=UUID.generate(),DDZCacheModel.sharedInstance().setString(t.PASSWORD_KEY,a.password)),a.id=DDZCacheModel.sharedInstance().stringForKey(t.USER_ID_KEY),a.hasSignUp=DDZCacheModel.sharedInstance().booleanForKey(t.SIGN_UP_STATE_KEY),a.hasBindPhoneNumber=DDZCacheModel.sharedInstance().booleanForKey(t.HAS_BIND_PHONE_NUMBER_KEY),a}return __extends(t,e),t.prototype.setId=function(e){if(!e)throw new Error("尝试为用户设置空id");this.id=e,DDZCacheModel.sharedInstance().setString(t.USER_ID_KEY,this.id)},t.prototype.deleteAccount=function(){this.id=void 0,this.setHasSignUp(!1),this.setHasBindPhoneNumber(!1),DDZCacheModel.sharedInstance().removeItemForKey(t.USER_ID_KEY)},t.prototype.setHasSignUp=function(e){this.hasSignUp=e,DDZCacheModel.sharedInstance().setBoolean(t.SIGN_UP_STATE_KEY,e)},t.prototype.setHasBindPhoneNumber=function(e){this.hasBindPhoneNumber=e,DDZCacheModel.sharedInstance().setBoolean(t.HAS_BIND_PHONE_NUMBER_KEY,e)},t.PASSWORD_KEY="tourist.user.password.save.key",t.USER_ID_KEY="tourist.user.id.save.key",t.SIGN_UP_STATE_KEY="tourist.user.register.state.key",t.HAS_BIND_PHONE_NUMBER_KEY="tourist.user.has.bind.phone.number.key",t}(BaseUserAttributeModel);__reflect(TouristUserAttributeModel.prototype,"TouristUserAttributeModel");var GenderFactory=function(){function e(){}return e.createGender=function(e){return"male"===e?new GenderMale:"female"===e?new GenderFeMale:new GenderNull},e}();__reflect(GenderFactory.prototype,"GenderFactory");var GenderFeMale=function(){function e(){this.name="female",this.iconSource="img_userinfo_female@2x_png"}return e.prototype.isMale=function(){return!1},e}();__reflect(GenderFeMale.prototype,"GenderFeMale",["IGender"]);var GenderMale=function(){function e(){this.name="male",this.iconSource="img_userinfo_male@2x_png"}return e.prototype.isMale=function(){return!0},e}();__reflect(GenderMale.prototype,"GenderMale",["IGender"]);var GenderNull=function(){function e(){this.name="null",this.iconSource=""}return e.prototype.isMale=function(){return!1},e}();__reflect(GenderNull.prototype,"GenderNull",["IGender"]);var DDZPackageScene=function(e){function t(t){var a=e.call(this)||this;return a.skinName="DDZPackageSceneUI",a.backgroundImage.source=t,a.popup.pressBackButtonHandler=a.goBack.bind(a),a}return __extends(t,e),t.prototype.goBack=function(){qp.SceneManager.sharedInstance().popScene()},t}(QPScene);__reflect(DDZPackageScene.prototype,"DDZPackageScene");var testProps=[{amount:2,name:"圣诞大礼包"},{amount:5,name:"双11大礼包"},{amount:8,name:"双12大礼包"},{amount:1,name:"元旦大礼包"},{amount:2,name:"春节大礼包"},{amount:9,name:"春季大礼包"}],DDZPackageModel=function(){function e(){}return e.prototype.fetchProps=function(e,t){e(testProps)},e}();__reflect(DDZPackageModel.prototype,"DDZPackageModel");var DDZPackageListCell=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPackageListCellUI",t.useButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressUseButton,t),t}return __extends(t,e),t.prototype.onPressUseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1)},t}(eui.ItemRenderer);__reflect(DDZPackageListCell.prototype,"DDZPackageListCell");var DDZPackagePopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPackagePopupUI",t.leftToggle.addEventListener(eui.UIEvent.CHANGE,t.toggleChangedHandler,t),t.middleToggle.addEventListener(eui.UIEvent.CHANGE,t.toggleChangedHandler,t),t.rightToggle.addEventListener(eui.UIEvent.CHANGE,t.toggleChangedHandler,t),t.packageModel=new DDZPackageModel,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.emptyContentView.visible=!1,this.contentScroller.viewport=this.contentList,this.createContentList(),this.closeButton.pressHandler=this.onPressCloseButton.bind(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.leftToggle.selected=!0},t.prototype.createContentList=function(){var e=this;this.packageModel.fetchProps(function(t){e.emptyContentView.visible=0===t.length,e.contentList.dataProvider=new eui.ArrayCollection(t),e.contentList.itemRenderer=DDZPackageListCell,e.contentList.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onPressPackageItem,e)},function(){egret.log("fetch props error.")})},t.prototype.onPressPackageItem=function(e){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),QPAlert.sharedInstance().showAt(this.parent,"暂未开放此功能，敬请期待")},t.prototype.toggleChangedHandler=function(e){var t=this;QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.leftToggle===e.target&&(this.packageModel.fetchProps(function(e){t.emptyContentView.visible=0===e.length,t.contentList.dataProvider=new eui.ArrayCollection(e)},function(){egret.log("fetch  props error")}),this.leftToggle.selected=!0,this.middleToggle.selected=!1,this.rightToggle.selected=!1),this.middleToggle===e.target&&(this.emptyContentView.visible=!0,this.contentList.dataProvider=new eui.ArrayCollection([]),this.leftToggle.selected=!1,this.middleToggle.selected=!0,this.rightToggle.selected=!1),this.rightToggle===e.target&&(this.emptyContentView.visible=!0,this.contentList.dataProvider=new eui.ArrayCollection([]),this.leftToggle.selected=!1,this.middleToggle.selected=!1,this.rightToggle.selected=!0)},t.prototype.onPressCloseButton=function(){this.pressBackButtonHandler()},t}(QPPopupLayer);__reflect(DDZPackagePopup.prototype,"DDZPackagePopup");var DDZPlayGameDebugWindow=function(e){function t(){var t=e.call(this)||this;return t.messageCount=0,t}return __extends(t,e),t.prototype.setRoomId=function(e){this.roomIdLabel.text="房间："+e},t.prototype.setServerAddress=function(e){this.serverLabel.text="服务器: "+e},t.prototype.setGameMatchId=function(e){e&&(this.gameMatchIdLabel.text="游戏："+e)},t.prototype.addMessage=function(e){if(e){var t=JSON.stringify(e),a=new eui.Label(t);a.textColor=16777215,a.size=25,a.y=50*this.messageCount,this.contentGroup.addChild(a),this.messageCount+=1}},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.contentScroller.viewport=this.contentGroup;var t=RES.getRes("app_version_json");this.setAppVersion(t.version)},t.prototype.setAppVersion=function(e){this.appVersionLabel.text="版本："+e},t}(QPLayer);__reflect(DDZPlayGameDebugWindow.prototype,"DDZPlayGameDebugWindow");var DDZPlayGameScene=function(e){function t(t){var a=e.call(this)||this;return a.skinName="DDZPlayGameSceneUI",a.gameModel=t,a.invitePlayerPopup=new InvitePlayerPopupLayer,a.setup(),a}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),QPResource.AsyncLoader.sharedInstance().start(),this.addListeners()},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.gameModel.removeGameService(),this.gameModel=void 0,this.removeListeners(),this.matchPlayerView.hide()},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.playMusic(),this.setPlayersCharacterImage(),this.bottomPlayerStateView.hideWaitForReady(),this.setLeftPlayerViewVisible(!1),this.leftPlayerView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showLeftPlayerDetailInfo,this),this.setRightPlayerViewVisible(!1),this.rightPlayerView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRightPlayerDetailInfo,this),this.bottomPlayerView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showBottomPlayerDetailInfo,this),this.showPlayers()},t.prototype.childrenCreated=function(){if(e.prototype.childrenCreated.call(this),DDZGameState.Model.sharedInstance().isInGame()){var t={playCardGameRestored:this.playCardGameRestored.bind(this),becomeLandlordGameRestored:this.becomeLandlordGameRestored.bind(this)};this.gameModel.restoreGame(t)}DDZGameState.Model.sharedInstance().isWaiting()&&!this.gameModel.bottomPlayerModel.attribute.isReady&&this.showGameOverLayer(),this.updateDebugWindowContent(),this.showInvitePlayerPopup(),this.topToolbar.pressCloseButtonHandler=this.leaveGamePressed.bind(this)},t.prototype.updateDebugWindowContent=function(){this.debugWindow.setRoomId(this.gameModel.game.roomId),this.debugWindow.setServerAddress(QPApiConfig.Host),this.debugWindow.setGameMatchId(this.gameModel.game.getMatchId())},t.prototype.showInvitePlayerPopup=function(){if(!this.gameModel.isPlayersFull()&&!this.isPlayerLeaveAlertShow){var e=UserModel.sharedInstance().personalRoomModel.getPin();egret.log("房间的pin是",e);var t="您可以粘贴这条消息给好友,邀请好友加入您创建的私人房间一起来玩!!! 房间号: ["+e+"],快去告诉Ta!";this.invitePlayerPopup.verticalCenter=0,this.invitePlayerPopup.horizontalCenter=0,this.invitePlayerPopup.setInvitationMessage(t),this.invitePlayerPopup.show()}},t.prototype.addListeners=function(){DDZEventCenter.sharedInstance().addEventListener(DDZHandCardEvent.TOUCHED,this.handCardTouched,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.PLAY_CARD,this.playCard,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.HINT,this.hint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.NOT_PLAY_CARD,this.notPlayCardButtonPressed,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.NOT_CALL_LANDLORD,this.notCallLandlord,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.CALL_ONE_POINT,this.callOnePoint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.CALL_TWO_POINT,this.callTwoPoint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.CALL_THREE_POINT,this.callThreePoint,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.START_GAME,this.startMatchPlayer,this),DDZEventCenter.sharedInstance().addEventListener(DDZDebugEvent.DEBUG_ROOM_CHANNEL,this.receiveDebugMessage,this),DDZEventCenter.sharedInstance().addEventListener(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT,this.fetchUserGameState,this),DDZEventCenter.sharedInstance().addEventListener(DDZMusicEvent.PLAY_MUSIC_EVENT,this.playMusic,this),DDZEventCenter.sharedInstance().addEventListener(DDZMusicEvent.STOP_MUSIC_EVENT,this.stopMusic,this),DDZEventCenter.sharedInstance().addEventListener(DDZWebsocketEvent.MISS_MESSAGE_EVENT,this.fetchUserGameState,this)},t.prototype.removeListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZHandCardEvent.TOUCHED,this.handCardTouched,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.PLAY_CARD,this.playCard,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.HINT,this.hint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.NOT_PLAY_CARD,this.notPlayCardButtonPressed,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.NOT_CALL_LANDLORD,this.notCallLandlord,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.CALL_ONE_POINT,this.callOnePoint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.CALL_TWO_POINT,this.callTwoPoint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.CALL_THREE_POINT,this.callThreePoint,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.START_GAME,this.startMatchPlayer,this),DDZEventCenter.sharedInstance().removeEventListener(DDZDebugEvent.DEBUG_ROOM_CHANNEL,this.receiveDebugMessage,this),DDZEventCenter.sharedInstance().removeEventListener(DDZNetworkEvent.CONNECT_TO_SERVER_EVENT,this.fetchUserGameState,this),DDZEventCenter.sharedInstance().removeEventListener(DDZMusicEvent.PLAY_MUSIC_EVENT,this.playMusic,this),DDZEventCenter.sharedInstance().removeEventListener(DDZMusicEvent.STOP_MUSIC_EVENT,this.stopMusic,this),DDZEventCenter.sharedInstance().removeEventListener(DDZWebsocketEvent.MISS_MESSAGE_EVENT,this.fetchUserGameState,this)},t.prototype.receiveDebugMessage=function(e){this.debugWindow.addMessage(e.messageObject)},t.prototype.showSettingsScene=function(){var e=Device.sharedInstance().screenShoot(this);qp.SceneManager.sharedInstance().pushScene(new DDZSettingsScene(e))},t.prototype.setLeftPlayerViewVisible=function(e){e?this.leftPlayerView.showLandlordSign(this.gameModel.leftPlayerModel.attribute.isLandlord()):this.leftPlayerPlayedCardListView.visible=!1,this.leftPlayerView.visible=e,this.leftPlayerGameInfoView.visible=e},t.prototype.setRightPlayerViewVisible=function(e){e?this.rightPlayerView.showLandlordSign(this.gameModel.rightPlayerModel.attribute.isLandlord()):this.rightPlayerPlayedCardListView.visible=!1,this.rightPlayerView.visible=e,this.rightPlayerGameInfoView.visible=e},t.prototype.setup=function(){this.leftPlayerPlayedCardListView.setAnimation(new DDZCardListLeftToRightAnimation({target:this.leftPlayerPlayedCardListView.cardList})),this.rightPlayerPlayedCardListView.setAnimation(new DDZCardListRightToLeftAnimation({target:this.rightPlayerPlayedCardListView.cardList})),this.bottomPlayerHandCardsView.dealCardAnimationDidFinishedHandler=this.startCallingLandlord.bind(this),this.gameModel.showPlayerHandler=this.showPlayers.bind(this),this.gameModel.hidePlayerHandler=this.hidePlayer.bind(this),this.gameModel.playerPlayedCardsHandler=this.playerPlayedCards.bind(this),this.gameModel.nextPlayCardPlayerHandler=this.nextPlayCardPlayer.bind(this),this.gameModel.nextCallLandlordPlayerHandler=this.nextCallLandlordPlayer.bind(this),this.gameModel.playerCalledLandlordHandler=this.showPlayerCallLandlordResult.bind(this),this.gameModel.dealCardsHandler=this.dealCards.bind(this),this.gameModel.dealCardsAgainHandler=this.reDealCards.bind(this),this.gameModel.gameLandlordConfirmedHandler=this.gameLandlordHasBeenConfirmed.bind(this),this.gameModel.playerReadyStateChangedHandler=this.updatePlayerReadyState.bind(this),this.gameModel.gameOverHandler=this.gameOver.bind(this),this.gameModel.forceGameOverHandler=this.forceGameOver.bind(this)},t.prototype.leaveGamePressed=function(){var e=this;return this.gameModel.isStarted?(QPAlert.sharedInstance().showCancelAndOkButtonAt(this,"退出后，其他玩家将无法继续本局游戏。","确定退出游戏吗？"),void(QPAlert.sharedInstance().pressedOKHandler=function(){e.leaveGame()})):void this.leaveGame()},t.prototype.leaveGame=function(){var e=this,t=new QPLoadingScene;t.show("离开房间中"),this.gameModel.bottomPlayerModel.leaveRoom(function(a){return t.hide(),a?void QPAlert.sharedInstance().showOKButtonAt(e,a.message):(e.invitePlayerPopup.hide(),void QPCrossPlatformCommunication.closeH5Game())})},t.prototype.handCardTouched=function(){if(this.gameModel.bottomPlayerModel.handCardModel.isSelectedCardLegal())this.dispatchEnablePlayCardButtonEvent();else{var e=new DDZButtonEvent(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON);DDZEventCenter.sharedInstance().dispatchEvent(e)}},t.prototype.dispatchEnablePlayCardButtonEvent=function(){var e=new DDZButtonEvent(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.startCallingLandlord=function(){this.gameModel.isBottomPlayerCallingLandlord()?(this.playGameButtonsContainer.showCallLandlordButtons(),this.activePlayerSignView.pointToBottomPlayer()):this.gameModel.isLeftPlayerCallingLandlord()?(this.leftPlayerGameInfoView.hideAllState(),this.activePlayerSignView.pointToLeftPlayer()):this.gameModel.isRightPlayerCallingLandlord()&&(this.rightPlayerGameInfoView.hideAllState(),this.activePlayerSignView.pointToRightPlayer())},t.prototype.playerPlayedCards=function(e){1===e?this.bottomPlayerPlayedCards():2===e?this.leftPlayerPlayedCards():3===e&&this.rightPlayerPlayedCards()},t.prototype.bottomPlayerPlayedCards=function(){var e=this.gameModel.bottomPlayerModel.listLastPlayedCards();this.bottomPlayerPlayedCardListView.setCards(e),this.bottomPlayerPlayedCardListView.visible=!0,this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),0===e.length?this.bottomPlayerStateView.setState(7):this.bottomPlayerStateView.hideAllState(),this.playGameButtonsContainer.hideAllButtons(),this.dispatchEnablePlayCardButtonEvent()},t.prototype.leftPlayerPlayedCards=function(){if(this.gameModel.isLeftPlayerExist()){this.leftPlayerGameInfoView.reset(),this.showLeftPlayerPlayedCards();var e=this.gameModel.countLeftPlayerCardsAmount();this.leftPlayerGameInfoView.setRemainCardsCount(e),3>e&&this.leftPlayerGameInfoView.showWarningLightView(),0===e&&this.leftPlayerGameInfoView.hideRemainCardsView()}},t.prototype.showLeftPlayerPlayedCards=function(){if(this.gameModel.isLeftPlayerExist()){var e=this.gameModel.leftPlayerModel.listLastPlayedCards();if(0===e.length)return void this.leftPlayerGameInfoView.showNotPlayCard();this.leftPlayerPlayedCardListView.visible=!0,this.leftPlayerPlayedCardListView.setCards(e),this.leftPlayerPlayedCardListView.playAnimation()}},t.prototype.rightPlayerPlayedCards=function(){if(this.gameModel.isRightPlayerExist()){this.rightPlayerGameInfoView.reset(),this.showRightPlayerPlayedCards();var e=this.gameModel.countRightPlayerCardsAmount();this.rightPlayerGameInfoView.setRemainCardsCount(e),3>e&&this.rightPlayerGameInfoView.showWarningLightView(),0===e&&this.rightPlayerGameInfoView.hideRemainCardsView()}},t.prototype.showRightPlayerPlayedCards=function(){if(this.gameModel.isRightPlayerExist()){var e=this.gameModel.rightPlayerModel.listLastPlayedCards();if(0===e.length)return void this.rightPlayerGameInfoView.showNotPlayCard();this.rightPlayerPlayedCardListView.visible=!0,this.rightPlayerPlayedCardListView.setCards(e),this.rightPlayerPlayedCardListView.playAnimation()}},t.prototype.gameLandlordHasBeenConfirmed=function(){var e=this;this.bottomPlayerHandCardsView.playHideBottomCardsAnimation(function(){e.leftPlayerGameInfoView.reset(),e.rightPlayerGameInfoView.reset(),e.updatePlayersStateAndCards(),e.startPlayingCard()})},t.prototype.updatePlayerReadyState=function(){if(this.gameModel.isLeftPlayerExist()){var e=!this.gameModel.leftPlayerModel.attribute.isReady;this.leftPlayerGameInfoView.showWaitForReady(e)}if(this.gameModel.isRightPlayerExist()){var t=!this.gameModel.rightPlayerModel.attribute.isReady;this.rightPlayerGameInfoView.showWaitForReady(t)}},t.prototype.reDealCards=function(){this.leftPlayerGameInfoView.reset(),this.rightPlayerGameInfoView.reset(),this.bottomPlayerStateView.hideAllState(),this.bottomPlayerHandCardsView.hideBottomCards()},t.prototype.updatePlayersStateAndCards=function(){this.bottomPlayerStateView.hideAllState(),this.landlordCardsView.setCards(this.gameModel.game.landlordCards),this.setPlayersCharacterImage(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.bottomPlayerHandCardsView.hideBottomCards(),this.leftPlayerGameInfoView.setRemainCardsCount(this.gameModel.countLeftPlayerCardsAmount()),this.rightPlayerGameInfoView.setRemainCardsCount(this.gameModel.countRightPlayerCardsAmount())},t.prototype.setPlayersCharacterImage=function(){this.gameModel.isLeftPlayerExist()&&this.leftPlayerView.showLandlordSign(this.gameModel.leftPlayerModel.attribute.isLandlord()),this.gameModel.isRightPlayerExist()&&this.rightPlayerView.showLandlordSign(this.gameModel.rightPlayerModel.attribute.isLandlord()),this.bottomPlayerView.showLandlordSign(this.gameModel.bottomPlayerModel.attribute.isLandlord())},t.prototype.playCardGameRestored=function(e){this.matchPlayerView.hide(),this.updatePlayersStateAndCards(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.nextPlayCardPlayer(e),this.updateDebugWindowContent()},t.prototype.becomeLandlordGameRestored=function(e,t){this.matchPlayerView.hide(),this.updatePlayersStateAndCards(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.bottomPlayerHandCardsView.showBottomCards(),this.nextCallLandlordPlayer(e,t),this.gameModel.bottomPlayerModel.attribute.hasCalledLandlord&&this.showBottomPlayerCallLandlord(this.gameModel.bottomPlayerModel.attribute.calledLandlordScore),this.gameModel.leftPlayerModel.attribute.hasCalledLandlord&&this.showLeftPlayerCallLandlord(this.gameModel.leftPlayerModel.attribute.calledLandlordScore),this.gameModel.rightPlayerModel.attribute.hasCalledLandlord&&this.showRightPlayerCallLandlord(this.gameModel.rightPlayerModel.attribute.calledLandlordScore),this.updateDebugWindowContent()},t.prototype.showBottomPlayerCallLandlordButtons=function(e){this.playGameButtonsContainer.showCallLandlordButtons(),1===e?this.playGameButtonsContainer.disableCallOnePointButton():2===e&&(this.playGameButtonsContainer.disableCallOnePointButton(),this.playGameButtonsContainer.disableCallTwoPointButton())},t.prototype.nextCallLandlordPlayer=function(e,t){switch(e){case 1:this.bottomPlayerStateView.hideAllState(),this.showBottomPlayerCallLandlordButtons(t),this.activePlayerSignView.pointToBottomPlayer();break;case 2:this.leftPlayerGameInfoView.hideAllState(),this.activePlayerSignView.pointToLeftPlayer();break;case 3:this.rightPlayerGameInfoView.hideAllState(),this.activePlayerSignView.pointToRightPlayer()}},t.prototype.showPlayerCallLandlordResult=function(e,t){1===e?(this.showBottomPlayerCallLandlord(t),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.bottomPlayerModel.getCallLandlordSoundByPoint(t),1)):2===e?(this.showLeftPlayerCallLandlord(t),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.leftPlayerModel.getCallLandlordSoundByPoint(t),1)):3===e&&(this.showRightPlayerCallLandlord(t),QPAudioManager.sharedInstance().playEffectSound(this.gameModel.rightPlayerModel.getCallLandlordSoundByPoint(t),1))},t.prototype.showBottomPlayerCallLandlord=function(e){1===e?this.bottomPlayerStateView.setState(1):2===e?this.bottomPlayerStateView.setState(2):3===e?this.bottomPlayerStateView.setState(3):0===e&&this.bottomPlayerStateView.setState(4),this.playGameButtonsContainer.hideAllButtons()},t.prototype.showLeftPlayerCallLandlord=function(e){this.leftPlayerGameInfoView.reset(),0===e?this.leftPlayerGameInfoView.showNotCallLandlord():this.leftPlayerGameInfoView.setCallLandlordPoint(e)},t.prototype.showRightPlayerCallLandlord=function(e){this.rightPlayerGameInfoView.reset(),0===e?this.rightPlayerGameInfoView.showNotCallLandlord():this.rightPlayerGameInfoView.setCallLandlordPoint(e)},t.prototype.nextPlayCardPlayer=function(e){switch(this.bottomPlayerHandCardsView.hideBottomCards(),e){case 1:if(this.bottomPlayerPlayedCardListView.visible=!1,this.bottomPlayerStateView.setState(0),this.activePlayerSignView.pointToBottomPlayer(),this.gameModel.amIWinInARound()){if(this.gameModel.resetLastPlayedCards(),this.gameModel.canIAutoPlayRemainCardsSet())return void this.autoPlayCard();this.playGameButtonsContainer.showMustPlayCardButtons()}else if(this.gameModel.doIHaveBiggerCards()){if(this.gameModel.canIAutoPlayRemainCardsSet())return void this.autoPlayCard();this.playGameButtonsContainer.showPlayCardButtons()}else this.playGameButtonsContainer.showNoBiggerCardsButtons();this.gameModel.bottomPlayerModel.handCardModel.isSelectedCardLegal()&&this.dispatchEnablePlayCardButtonEvent();break;case 2:this.leftPlayerPlayedCardListView.visible=!1,this.leftPlayerGameInfoView.hideAllState(),this.activePlayerSignView.pointToLeftPlayer();break;case 3:this.rightPlayerPlayedCardListView.visible=!1,this.rightPlayerGameInfoView.hideAllState(),this.activePlayerSignView.pointToRightPlayer();break;case 0:this.leftPlayerGameInfoView.hideAllState(),this.rightPlayerGameInfoView.hideAllState();break;default:throw new Error("玩家类型出错了")}},t.prototype.startMatchPlayer=function(){var e=this,a=new QPLoadingScene;a.show("正在匹配玩家"),UserModel.sharedInstance().joinGame(function(e){var r={roomId:e.roomId,baseScore:e.baseScore,playerInformations:e.playerInformations};a.hide();var n=new DDZGameModel(r.roomId);n.addPlayers(r.playerInformations),n.setBaseScore(r.baseScore),qp.SceneManager.sharedInstance().replaceScene(new t(n))},function(t){a.hide(),QPAlert.sharedInstance().showAt(e,t.message),e.playGameButtonsContainer.showStartGameButton()})},t.prototype.startPlayingCard=function(){this.leftPlayerGameInfoView.hideAllState(),this.rightPlayerGameInfoView.hideAllState(),this.gameModel.isBottomPlayerLandlord()?(this.playGameButtonsContainer.showMustPlayCardButtons(),this.activePlayerSignView.pointToBottomPlayer()):this.gameModel.isLeftPlayerLandlord()?this.activePlayerSignView.pointToLeftPlayer():this.gameModel.isRightPlayerLandlord()&&this.activePlayerSignView.pointToRightPlayer()},t.prototype.showPlayers=function(){if(this.gameModel.isPlayersFull()&&(this.invitePlayerPopup.hide(),this.removeGameOverLayer(),QPAlert.sharedInstance().hide()),this.gameModel.isLeftPlayerExist()){this.leftPlayerView.setName(this.gameModel.leftPlayerModel.attribute.name),this.leftPlayerView.setScore(String(this.gameModel.leftPlayerModel.attribute.score));var e=!this.gameModel.leftPlayerModel.attribute.isReady;this.leftPlayerGameInfoView.showWaitForReady(e),this.setLeftPlayerViewVisible(!0)}if(this.gameModel.isRightPlayerExist()){this.rightPlayerView.setName(this.gameModel.rightPlayerModel.attribute.name),this.rightPlayerView.setScore(String(this.gameModel.rightPlayerModel.attribute.score));var t=!this.gameModel.rightPlayerModel.attribute.isReady;this.rightPlayerGameInfoView.showWaitForReady(t),this.setRightPlayerViewVisible(!0)}this.bottomPlayerView.setName(this.gameModel.bottomPlayerModel.attribute.name),this.bottomPlayerView.setScore(String(this.gameModel.bottomPlayerModel.attribute.score)),this.gameModel.isPlayersFull()&&this.matchPlayerView.showWaitForStartGame()},t.prototype.hidePlayer=function(e){2===e?this.setLeftPlayerViewVisible(!1):3===e&&this.setRightPlayerViewVisible(!1),this.showInvitePlayerPopup()},t.prototype.dealCards=function(){this.bottomPlayerHandCardsView.dealCards(this.gameModel.bottomPlayerModel.listHandCards()),this.matchPlayerView.hide(),this.leftPlayerGameInfoView.setRemainCardsCount(this.gameModel.DefaultCardsCount),this.rightPlayerGameInfoView.setRemainCardsCount(this.gameModel.DefaultCardsCount),this.updateDebugWindowContent()},t.prototype.gameOver=function(){this.leftPlayerGameInfoView.reset(),this.rightPlayerGameInfoView.reset(),this.gameModel.isLeftPlayerPlayedAllCards()||(this.leftPlayerPlayedCardListView.setCards(this.gameModel.leftPlayerModel.listHandCards()),this.leftPlayerPlayedCardListView.visible=!0),this.gameModel.isRightPlayerPlayedAllCards()||(this.rightPlayerPlayedCardListView.setCards(this.gameModel.rightPlayerModel.listHandCards()),this.rightPlayerPlayedCardListView.visible=!0);var e=new egret.Timer(2e3,1);e.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.showGameOverLayer,this),e.start()},t.prototype.forceGameOver=function(e){var t=this;this.reset(),this.invitePlayerPopup.hide(),this.isPlayerLeaveAlertShow=!0,QPAlert.sharedInstance().showOKButtonAt(this,e+" 已经离开游戏，游戏结束"),QPAlert.sharedInstance().pressedOKHandler=function(){t.isPlayerLeaveAlertShow=!1,t.showInvitePlayerPopup()}},t.prototype.showGameOverLayer=function(){var e=this;this.gameOverLayer||(this.gameOverLayer=new DDZGameOverLayer),this.gameOverLayer.pressedContinueGameHandler=function(){e.continueGame()},this.addChild(this.gameOverLayer)},t.prototype.removeGameOverLayer=function(){this.gameOverLayer&&(this.removeChild(this.gameOverLayer),this.gameOverLayer=void 0)},t.prototype.continueGame=function(){var e=this,t=UserModel.sharedInstance().actionDataFactory.makeContinueGameData(),a=new QPLoadingScene;a.show("游戏准备中..."),UserModel.sharedInstance().actionModel.continueGame(t,function(){e.reset(),a.hide(),e.removeGameOverLayer()},function(t){a.hide(),QPAlert.sharedInstance().showAt(e,t.message)})},t.prototype.reset=function(){if(this.gameModel.reset(),this.landlordCardsView.hide(),this.gameModel.isLeftPlayerExist()){this.leftPlayerGameInfoView.hideRemainCardsView(),this.leftPlayerView.showLandlordSign(!1),this.leftPlayerPlayedCardListView.visible=!1,this.leftPlayerGameInfoView.hideAllState();var e=!this.gameModel.leftPlayerModel.attribute.isReady;this.leftPlayerGameInfoView.showWaitForReady(e)}if(this.gameModel.isRightPlayerExist()){this.rightPlayerGameInfoView.hideRemainCardsView(),this.rightPlayerView.showLandlordSign(!1),this.rightPlayerPlayedCardListView.visible=!1,this.rightPlayerGameInfoView.hideAllState();var t=!this.gameModel.rightPlayerModel.attribute.isReady;this.rightPlayerGameInfoView.showWaitForReady(t)}this.bottomPlayerPlayedCardListView.visible=!1,this.playGameButtonsContainer.hideAllButtons(),this.bottomPlayerStateView.hideAllState(),this.bottomPlayerView.showLandlordSign(!1),this.bottomPlayerHandCardsView.setCards([]),this.activePlayerSignView.hide()},t.prototype.playCard=function(){var e=this,t=this.gameModel.bottomPlayerModel.listSelectedCards();this.gameModel.playCards(t,function(t){return t?void e.handlePlayCardError(t):void e.bottomPlayerPlayedCards()})},t.prototype.handlePlayCardError=function(e){this.gameModel.bottomPlayerModel.cancelSelectedCards(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()),this.dispatchEnablePlayCardButtonEvent(),e.type===QPNetworkErrorType.ClientCheckedWrongCardType?this.showWrongCardTypeMessage():this.fetchUserGameState()},t.prototype.showWrongCardTypeMessage=function(){var e=this;this.wrongTypeCardImage.visible=!0;var t=new egret.Timer(2e3,1);t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.wrongTypeCardImage.visible=!1,t=void 0},this),t.start()},t.prototype.fetchUserGameState=function(){var e=this;QPToast.sharedInstance().showAt(this,"连接网络中..."),DDZGameState.Model.sharedInstance().fetch(function(t){QPToast.sharedInstance().hide(),t.room.pin&&UserModel.sharedInstance().personalRoomModel.setPin(t.room.pin),DDZGameState.Model.sharedInstance().room&&e.gameModel.addPlayers(DDZGameState.Model.sharedInstance().room.playerInformations);var a={playCardGameRestored:e.playCardGameRestored.bind(e),becomeLandlordGameRestored:e.becomeLandlordGameRestored.bind(e)};e.gameModel.restoreGame(a),DDZUserChannelModel.sharedInstance().resetMessageCounter()},function(t){return QPToast.sharedInstance().hide(),t?void QPAlert.sharedInstance().showAt(e,t.message):void 0})},t.prototype.hint=function(){this.gameModel.hint(),this.gameModel.bottomPlayerModel.handCardModel.hasSelectedCards()&&(this.dispatchEnablePlayCardButtonEvent(),this.bottomPlayerHandCardsView.setCards(this.gameModel.bottomPlayerModel.listHandCards()))
},t.prototype.notPlayCardButtonPressed=function(){this.notPlayCard()},t.prototype.autoPlayCard=function(){var e=this;this.dispatchEnablePlayCardButtonEvent(),this.gameModel.bottomPlayerModel.cancelSelectedCards();var t=this.gameModel.listAutoPlayCards();this.gameModel.playCards(t,function(t){return t?void e.handlePlayCardError(t):void e.bottomPlayerPlayedCards()})},t.prototype.notPlayCard=function(){var e=this;this.gameModel.bottomPlayerModel.cancelSelectedCards(),this.gameModel.notPlayCard(function(t){return t?(egret.log("\n\n"),void egret.log(t)):void e.bottomPlayerPlayedCards()})},t.prototype.notCallLandlord=function(){this.gameModel.bottomPlayerModel.notCallLandlord(),this.bottomPlayerStateView.setState(4),this.playGameButtonsContainer.hideAllButtons()},t.prototype.callOnePoint=function(){this.gameModel.bottomPlayerModel.callLandlord(1),this.playGameButtonsContainer.hideAllButtons()},t.prototype.callTwoPoint=function(){this.gameModel.bottomPlayerModel.callLandlord(2),this.playGameButtonsContainer.hideAllButtons()},t.prototype.callThreePoint=function(){this.gameModel.bottomPlayerModel.callLandlord(3),this.playGameButtonsContainer.hideAllButtons()},t.prototype.playMusic=function(){QPAudioManager.sharedInstance().playBackgroundMusic("ddz_play_game_music_mp3",-1)},t.prototype.stopMusic=function(){QPAudioManager.sharedInstance().stopPlayBackgroundMusic()},t.prototype.showLeftPlayerDetailInfo=function(){},t.prototype.showRightPlayerDetailInfo=function(){},t.prototype.showBottomPlayerDetailInfo=function(){},t}(QPScene);__reflect(DDZPlayGameScene.prototype,"DDZPlayGameScene");var TestGameModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.startTest=function(){this.testGameOver(),this.testHintTrioTakesSingle(),this.testHintTrioTakesSingleNoBiggerTrioInHand()},t.prototype.testGameOver=function(){var e=new DDZGameServiceMessageGameOverData(mockGameOverPayload);this.assertEquals("Game Action expect to end_game","end_game",e.action),this.assertEquals("room id expect to 8b2a1a3d-2fec-4cc0-b392-4512d7d3f215","8b2a1a3d-2fec-4cc0-b392-4512d7d3f215",e.roomId),this.assertEquals("game is spring expect false",!1,e.isSpring);var t=e.gameOverPlayerInformations[0];this.assertEquals("player's id expect to aaaaaaaa-7a8e-4f14-bdeb-df27796c39a2","aaaaaaaa-7a8e-4f14-bdeb-df27796c39a2",t.playerId);var a=e.gameOverPlayerInformations[1];this.assertEquals("player's id expect to bbbbbbbb-77d8-49a4-9616-4fa07f987039","bbbbbbbb-77d8-49a4-9616-4fa07f987039",a.playerId);var r=e.gameOverPlayerInformations[2];this.assertEquals("player's id expect to  cccccccc-8a2e-46c6-9723-57caa2a61c4c","cccccccc-8a2e-46c6-9723-57caa2a61c4c",r.playerId)},t.prototype.testHintTrioTakesSingle=function(){var e=new DDZHandCardModel,t=["8s","8h","8c","5s"].map(function(e){return new DDZCard(e)}),a=["ts","th","tc","9s","7h","2s","2s","2s"].map(function(e){return new DDZCard(e)});e.setCards(a);var r=DDZPlayCardSetFactory.createCardSet(t);e.hint(r);var n=e.listSelectedCards(),o=DDZPlayCardSetFactory.createCardSet(n);this.assertEquals("test hint trio takes single target cardtype expected to 5",5,o.cardTypeName)},t.prototype.testHintTrioTakesSingleNoBiggerTrioInHand=function(){var e=new DDZHandCardModel,t=["as","ah","ac","5s"].map(function(e){return new DDZCard(e)}),a=["ts","th","tc","9s","7h","qs","qs","qs"].map(function(e){return new DDZCard(e)});e.setCards(a);var r=DDZPlayCardSetFactory.createCardSet(t);e.hint(r);var n=e.listSelectedCards(),o="test hint trio takes single no bigger trio in hand expected found cards length 0";this.assert(o,0===n.length)},t}(QPTestCase);__reflect(TestGameModel.prototype,"TestGameModel");var mockGameOverPayload={action:"end_game",sent_at:"2018-01-31T09:50:42.849090",room_id:"8b2a1a3d-2fec-4cc0-b392-4512d7d3f215",is_slam:!1,players_information:[{player_id:"aaaaaaaa-7a8e-4f14-bdeb-df27796c39a2",remain_cards:["3h","5d","6c","6h","7c","7h","9c","ac","ah","tc","td","th"],settlement:{balance:"19100",dealt_amount:"300",frozen_amount:"0",total_amount:"19100"}},{player_id:"bbbbbbbb-77d8-49a4-9616-4fa07f987039",remain_cards:[],settlement:{balance:"19100",dealt_amount:"300",frozen_amount:"0",total_amount:"19100"}},{player_id:"cccccccc-8a2e-46c6-9723-57caa2a61c4c",remain_cards:["2d","bw"],settlement:{balance:"19100",dealt_amount:"-600",frozen_amount:"0",total_amount:"19100"}}],ended_at:"2017-12-19T06:50:48.053709"},DDZGame=function(){function e(e){this.phase=0,this.baseScore=0,this.bombAmount=0,this.isSpring=!1,this.landlordCards=[],this.roomId=e}return e.prototype.reset=function(){this.phase=0,this.baseScore=0,this.bombAmount=0,this.isSpring=!1,this.landlordId=void 0,this.callingLandlordPlayerSeat=0,this.multiple=0,this.landlordCards=[],this.setMatchId(void 0)},e.prototype.setMatchId=function(e){this.matchId=e},e.prototype.getMatchId=function(){return this.matchId},e.prototype.setPhase=function(e){this.phase=e},e.prototype.getMultiple=function(){return this.multiple=1,this.bombAmount&&(this.multiple*=this.bombAmount),this.isSpring&&(this.multiple*=2),this.multiple},e.prototype.addBombAmount=function(){this.bombAmount+=1},e.prototype.setIsSpring=function(e){this.isSpring=e},e.prototype.setLandlordId=function(e){this.landlordId=e},e.prototype.setLandlordCards=function(e){this.landlordCards=e},e.prototype.setCallingLandlordPlayerSeat=function(e){this.callingLandlordPlayerSeat=e},e}();__reflect(DDZGame.prototype,"DDZGame");var DDZGameModel=function(e){function t(t){var a=e.call(this)||this;return a.DefaultCardsCount=17,a.bottomPlayerModel=void 0,a.leftPlayerModel=void 0,a.rightPlayerModel=void 0,a.isGameOver=!1,a.game=new DDZGame(t),a.createBottomPlayer(),a.registerGameService(),a}return __extends(t,e),t.prototype.reset=function(){this.resetLastPlayedCards(),this.isStarted=!1,this.isGameOver=!1,this.game.reset(),this.leftPlayerModel&&this.leftPlayerModel.reset(),this.rightPlayerModel&&this.rightPlayerModel.reset(),this.bottomPlayerModel.reset()},t.prototype.registerGameService=function(){var e=this;DDZUserChannelModel.sharedInstance().roomMessageReceivedHandler=function(t){return t.action===DDZGameServiceAction.ForceGameOver?void e.handleForceGameOver(t):(e.addPlayers(t.playerInformations),void(t.action===DDZGameServiceAction.Ready&&e.playerReadyStateChangedHandler()))},DDZUserChannelModel.sharedInstance().userMessageReceivedHandler=function(t){t.action===DDZGameServiceAction.CallLandlord?e.handleCallLandlord(t):t.action===DDZGameServiceAction.PlayCard?e.handlePlayCard(t):t.action===DDZGameServiceAction.DealCards?e.handleServerDealCards(t):t.action===DDZGameServiceAction.StartGame?e.handleStartGame(t):t.action===DDZGameServiceAction.RestartGame?e.handleRestartGame(t):t.action===DDZGameServiceAction.ConfirmLandlord?e.handleConfirmLandlord(t):t.action===DDZGameServiceAction.GameOver&&e.handleGameOver(t)}},t.prototype.removeGameService=function(){DDZUserChannelModel.sharedInstance().roomMessageReceivedHandler=void 0,DDZUserChannelModel.sharedInstance().userMessageReceivedHandler=void 0},t.prototype.restoreGame=function(e){DDZGameState.Model.sharedInstance().isPlayingGame()?(this.isStarted=!0,this.setGamePhase(2),this.restorePlayCardGame(function(t){e.playCardGameRestored&&e.playCardGameRestored(t)})):DDZGameState.Model.sharedInstance().isBecomingLandlord()&&(this.isStarted=!0,this.setGamePhase(1),this.restoreBecomLandlordGame(function(t,a){e.becomeLandlordGameRestored&&e.becomeLandlordGameRestored(t,a)})),DDZGameState.Model.sharedInstance().room&&this.game.setMatchId(DDZGameState.Model.sharedInstance().room.gameMatchId),DDZGameState.Model.sharedInstance().setGameState(DDZGameState.Type.GAME_BEEN_RESTORED)},t.prototype.containsPlayerId=function(e){return this.bottomPlayerModel?this.bottomPlayerModel.attribute.id===e:this.leftPlayerModel?this.leftPlayerModel.attribute.id===e:this.rightPlayerModel?this.rightPlayerModel.attribute.id===e:!1},t.prototype.addPlayers=function(e){var t=this.getBottomPlayerInformation(e);this.bottomPlayerModel.attribute.isReady=t.isReady,"1"===t.seatId?(this.createLeftPlayer(this.getPlayerInfoBySeatId("3",e)),this.createRightPlayer(this.getPlayerInfoBySeatId("2",e))):"2"===t.seatId?(this.createLeftPlayer(this.getPlayerInfoBySeatId("1",e)),this.createRightPlayer(this.getPlayerInfoBySeatId("3",e))):"3"===t.seatId&&(this.createLeftPlayer(this.getPlayerInfoBySeatId("2",e)),this.createRightPlayer(this.getPlayerInfoBySeatId("1",e)))},t.prototype.isPlayersFull=function(){return this.leftPlayerModel&&this.rightPlayerModel?!0:!1},t.prototype.resetLastPlayedCards=function(){this.lastPlayedCardSet=void 0},t.prototype.doIHaveBiggerCards=function(){return this.bottomPlayerModel.isHaveBiggerCards(this.lastPlayedCardSet)},t.prototype.hint=function(){this.bottomPlayerModel.handCardModel.hint(this.lastPlayedCardSet)},t.prototype.isLeftPlayerExist=function(){return this.leftPlayerModel?!0:!1},t.prototype.isRightPlayerExist=function(){return this.rightPlayerModel?!0:!1},t.prototype.isBottomPlayerLandlord=function(){return this.bottomPlayerModel.attribute.isLandlord()},t.prototype.isLeftPlayerLandlord=function(){return this.leftPlayerModel.attribute.isLandlord()},t.prototype.isRightPlayerLandlord=function(){return this.rightPlayerModel.attribute.isLandlord()},t.prototype.isLeftPlayerPlayedAllCards=function(){return 0===this.leftPlayerModel.countRemainCards()},t.prototype.isRightPlayerPlayedAllCards=function(){return 0===this.rightPlayerModel.countRemainCards()},t.prototype.canIAutoPlayRemainCardsSet=function(){if(this.bottomPlayerModel.handCardModel.isRemainCardsASet()){var e=this.bottomPlayerModel.handCardModel.getRemainCardsSet();if(!this.lastPlayedCardSet)return e.isFourTakes()?!1:e.isHuoJian()?!1:!0;if(e.isBiggerThan(this.lastPlayedCardSet))return!0}return!1},t.prototype.amIWinInARound=function(){return this.lastPlayedCardSet?this.bottomPlayerModel.isIdEqualTo(this.lastPlayedCardSet.playerId)?!0:!1:!0},t.prototype.setBaseScore=function(e){this.game.baseScore=e},t.prototype.listAutoPlayCards=function(){return this.bottomPlayerModel.listAutoPlayCards(this.lastPlayedCardSet)},t.prototype.playCards=function(e,t){if(!this.isGameOver){var a=DDZPlayCardSetFactory.createCardSet(e);if(a.setPlayerId(this.bottomPlayerModel.attribute.id),!a.isLegal())return void t(new QPNetworkError({message:"您的出牌不符合规则",error_type:"client_checked_wrong_card_type"}));if(this.lastPlayedCardSet&&!a.isBomb()&&!a.isHuoJian()&&!a.isTypeEqualTo(this.lastPlayedCardSet))return void t(new QPNetworkError({message:"您的出牌不符合规则",error_type:"client_checked_wrong_card_type"}));if(this.lastPlayedCardSet&&!a.isBiggerThan(this.lastPlayedCardSet))return void t(new QPNetworkError({message:"您的出牌不符合规则",error_type:"client_checked_wrong_card_type"}));(a.isBomb()||a.isHuoJian())&&this.game.addBombAmount(),a.isEmpty()||(this.lastPlayedCardSet=a),this.bottomPlayerModel.dropPlayedCards(e),this.bottomPlayerModel.setLatestPlayedCards(e),t();var r=a.cards.map(function(e){return e.code}),n={body:{played_cards:r},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/play_card"};this.postReturnJson(n,function(){},function(e){t(e)})}},t.prototype.notPlayCard=function(e){var t={body:{played_cards:[]},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/play_card"};this.bottomPlayerModel.dropPlayedCards([]),this.bottomPlayerModel.setLatestPlayedCards([]),e(),this.postReturnJson(t,function(){},function(t){e(t)})},t.prototype.setDefaultLandlordId=function(e){var t=this.getSeatByPlayerId(e);this.game.setCallingLandlordPlayerSeat(t)},t.prototype.getSeatByPlayerId=function(e){var t=0;return this.bottomPlayerModel.isIdEqualTo(e)?t=1:this.leftPlayerModel&&this.leftPlayerModel.isIdEqualTo(e)?t=2:this.rightPlayerModel&&this.rightPlayerModel.isIdEqualTo(e)&&(t=3),t},t.prototype.isBottomPlayerCallingLandlord=function(){return 1===this.game.callingLandlordPlayerSeat},t.prototype.isLeftPlayerCallingLandlord=function(){return 2===this.game.callingLandlordPlayerSeat},t.prototype.isRightPlayerCallingLandlord=function(){return 3===this.game.callingLandlordPlayerSeat},t.prototype.countLeftPlayerCardsAmount=function(){return this.isLeftPlayerExist()?this.leftPlayerModel.countRemainCards():0},t.prototype.countRightPlayerCardsAmount=function(){return this.isRightPlayerExist()?this.rightPlayerModel.countRemainCards():0},t.prototype.handleCallLandlord=function(e){this.setGamePhase(1);var t=this.getSeatByPlayerId(e.nextPlayer);this.nextCallLandlordPlayerHandler(t,e.currentLandlordScore);var a=this.getSeatByPlayerId(e.playerId),r=e.score;this.playerCalledLandlordHandler(a,r)},t.prototype.handlePlayCard=function(e){this.setGamePhase(2);var t=this.getSeatByPlayerId(e.playerId),a=this.getSeatByPlayerId(e.nextPlayerId),r=e.playedCards,n=e.remainCardsAmount,o=DDZPlayCardSetFactory.createCardSet(r);o.isEmpty()||(this.lastPlayedCardSet=o,this.lastPlayedCardSet.setPlayerId(e.playerId)),t===this.bottomPlayerModel.attribute.seat?(this.bottomPlayerModel.dropPlayedCards(r),this.bottomPlayerModel.setLatestPlayedCards(r),this.bottomPlayerModel.setHandCardsAmount(n),this.bottomPlayerModel.playPlayedCardsAudio(),this.playerPlayedCardsHandler(1)):t===this.leftPlayerModel.attribute.seat?(this.leftPlayerModel.dropPlayedCards(r),this.leftPlayerModel.setLatestPlayedCards(r),this.leftPlayerModel.setHandCardsAmount(n),this.leftPlayerModel.playPlayedCardsAudio(),this.playerPlayedCardsHandler(2)):t===this.rightPlayerModel.attribute.seat&&(this.rightPlayerModel.dropPlayedCards(r),this.rightPlayerModel.setLatestPlayedCards(r),this.rightPlayerModel.setHandCardsAmount(n),this.rightPlayerModel.playPlayedCardsAudio(),this.playerPlayedCardsHandler(3)),this.nextPlayCardPlayerHandler(a)},t.prototype.handleGameOver=function(e){for(var t=e.gameOverPlayerInformations,a=0,r=t;a<r.length;a++){var n=r[a],o=void 0;n.isWinner()&&(o=this.getWinnerCharacter(n.playerId),this.bottomPlayerModel.attribute.isWinner=this.bottomPlayerModel.characterEqualTo(o),this.leftPlayerModel.attribute.isWinner=this.leftPlayerModel.characterEqualTo(o),this.rightPlayerModel.attribute.isWinner=this.rightPlayerModel.characterEqualTo(o)),this.leftPlayerModel.isIdEqualTo(n.playerId)?(this.leftPlayerModel.handCardModel.setCards(n.remainCards),this.leftPlayerModel.attribute.score=0):this.rightPlayerModel.isIdEqualTo(n.playerId)?(this.rightPlayerModel.handCardModel.setCards(n.remainCards),this.rightPlayerModel.attribute.score=0):(this.bottomPlayerModel.handCardModel.setCards(n.remainCards),this.bottomPlayerModel.attribute.score=0)}this.isGameOver=!0,this.gameOverHandler()},t.prototype.handleForceGameOver=function(e){this.forceGameOverHandler(e.leftPlayerName)},t.prototype.handleStartGame=function(e){this.startGame(e)},t.prototype.handleRestartGame=function(e){this.dealCardsAgainHandler(),this.startGame(e)},t.prototype.handleServerDealCards=function(e){this.bottomPlayerModel.handCardModel.setCards(e.cards),this.dealCardsHandler()},t.prototype.handleConfirmLandlord=function(e){this.game.setLandlordCards(e.bottomCards),this.setLandlordId(e.landlord),this.bottomPlayerModel.attribute.isLandlord()&&this.bottomPlayerModel.addLandlordCards(this.game.landlordCards),this.setGamePhase(2),this.bottomPlayerModel.setInitialHandCardsAmount(),this.leftPlayerModel.setInitialHandCardsAmount(),this.rightPlayerModel.setInitialHandCardsAmount(),this.gameLandlordConfirmedHandler&&this.gameLandlordConfirmedHandler()},t.prototype.setLandlordId=function(e){this.game.setLandlordId(e),this.confirmPlayersCharactor(e)},t.prototype.startGame=function(e){this.isStarted=!0,this.setDefaultLandlordId(e.initLandlord),this.game.setMatchId(e.gameMatchId),this.setGamePhase(1)},t.prototype.confirmPlayersCharactor=function(e){this.bottomPlayerModel.confirmCharacterByLandlordId(e),this.isLeftPlayerExist()&&this.leftPlayerModel.confirmCharacterByLandlordId(e),this.isRightPlayerExist()&&this.rightPlayerModel.confirmCharacterByLandlordId(e)},t.prototype.createBottomPlayer=function(){this.bottomPlayerModel||(this.bottomPlayerModel=new DDZPlayerModel({id:UserModel.sharedInstance().attributeModel.id}),this.bottomPlayerModel.attribute.name=UserModel.sharedInstance().attributeModel.name,this.bottomPlayerModel.attribute.serviceId=UserModel.sharedInstance().attributeModel.serviceId,this.bottomPlayerModel.attribute.setBalanceAmount(UserModel.sharedInstance().attributeModel.getBalanceAmount()),this.bottomPlayerModel.attribute.gender=UserModel.sharedInstance().attributeModel.gender,this.bottomPlayerModel.attribute.seat=1,this.bottomPlayerModel.attribute.isReady=!0,this.showPlayerHandler&&this.showPlayerHandler(this.bottomPlayerModel))},t.prototype.createRightPlayer=function(e){e?(this.rightPlayerModel||(this.rightPlayerModel=new DDZPlayerModel({id:e.id}),this.rightPlayerModel.attribute.name=e.nickame,this.rightPlayerModel.attribute.serviceId=e.serviceId,this.rightPlayerModel.attribute.serviceId=e.serviceId,this.rightPlayerModel.attribute.setBalanceAmount(Number(e.balance)),this.rightPlayerModel.attribute.gender=e.gender,this.rightPlayerModel.attribute.seat=3),this.rightPlayerModel.attribute.isReady=e.isReady,this.showPlayerHandler&&this.showPlayerHandler(this.rightPlayerModel)):(this.rightPlayerModel=void 0,this.hidePlayerHandler&&this.hidePlayerHandler(3))},t.prototype.createLeftPlayer=function(e){e?(this.leftPlayerModel||(this.leftPlayerModel=new DDZPlayerModel({id:e.id}),this.leftPlayerModel.attribute.name=e.nickame,this.leftPlayerModel.attribute.serviceId=e.serviceId,this.leftPlayerModel.attribute.setBalanceAmount(Number(e.balance)),this.leftPlayerModel.attribute.gender=e.gender,this.leftPlayerModel.attribute.seat=2),this.leftPlayerModel.attribute.isReady=e.isReady,this.showPlayerHandler&&this.showPlayerHandler(this.leftPlayerModel)):(this.leftPlayerModel=void 0,this.hidePlayerHandler&&this.hidePlayerHandler(2))},t.prototype.setGamePhase=function(e){this.game.phase=e,this.setPlayersPhase(e)},t.prototype.setPlayersPhase=function(e){this.bottomPlayerModel.attribute.gamePhase=e,this.isLeftPlayerExist()&&(this.leftPlayerModel.attribute.gamePhase=e),this.isRightPlayerExist()&&(this.rightPlayerModel.attribute.gamePhase=e)},t.prototype.restorePlayCardGame=function(e){this.game.setLandlordCards(DDZGameState.Model.sharedInstance().room.bottomCards),this.setLandlordId(DDZGameState.Model.sharedInstance().room.confirmedLandlord);var t=DDZGameState.Model.sharedInstance().room.lastPlayedCards,a=DDZPlayCardSetFactory.createCardSet(t);a&&!a.isEmpty()&&(this.lastPlayedCardSet=a,this.lastPlayedCardSet.setPlayerId(DDZGameState.Model.sharedInstance().room.lastPlayedCardsPlayer)),this.bottomPlayerModel.restoreFromPlayCardGame(),this.playerPlayedCardsHandler(1),this.isLeftPlayerExist()&&this.leftPlayerModel.restoreFromPlayCardGame(),this.playerPlayedCardsHandler(2),this.isRightPlayerExist()&&this.rightPlayerModel.restoreFromPlayCardGame(),this.playerPlayedCardsHandler(3);var r=DDZGameState.Model.sharedInstance().room.activePlayerInformation.id,n=this.getSeatByPlayerId(r);e(n)},t.prototype.restoreBecomLandlordGame=function(e){this.game.setLandlordCards(DDZGameState.Model.sharedInstance().room.bottomCards),this.bottomPlayerModel.restoreFromBecomLandlordGame(),this.leftPlayerModel.restoreFromBecomLandlordGame(),this.rightPlayerModel.restoreFromBecomLandlordGame();var t=DDZGameState.Model.sharedInstance().room.activePlayerInformation.id,a=this.getSeatByPlayerId(t);e(a,DDZGameState.Model.sharedInstance().room.calledLandlordScore)},t.prototype.getBottomPlayerInformation=function(e){for(var t=0,a=e;t<a.length;t++){var r=a[t];if(this.bottomPlayerModel.isIdEqualTo(r.id))return r}},t.prototype.getPlayerInfoBySeatId=function(e,t){for(var a=0,r=t;a<r.length;a++){var n=r[a];if(n.seatId===e)return n}},t.prototype.getWinnerCharacter=function(e){return this.game.landlordId===e?1:2},t}(QPNetworkApi);__reflect(DDZGameModel.prototype,"DDZGameModel");var DDZPlayerAttribute=function(){function e(){}return e.prototype.setId=function(e){this.id=e},e.prototype.getDisplayId=function(){return this.serviceId},e.prototype.setBalanceAmount=function(e){this.balanceAmount=e},e.prototype.getBalanceAmount=function(){return this.balanceAmount},e.prototype.setIsAnonymous=function(e){this.isAnonymous=e},e.prototype.getIsAnonymous=function(){return this.isAnonymous},e.prototype.deleteAccount=function(){this.id=void 0},e.prototype.isLandlord=function(){return 1===this.character},e}();__reflect(DDZPlayerAttribute.prototype,"DDZPlayerAttribute",["IUserAttribute","IPlayerInGameAttribute"]);var DDZPlayerModel=function(e){function t(t){var a=e.call(this)||this;return a.attribute=new DDZPlayerAttribute,a.attribute.setId(t.id),a.handCardModel=new DDZHandCardModel,a}return __extends(t,e),t.prototype.reset=function(){this.handCardModel.setCards([]),this.attribute.gamePhase=0,this.attribute.character=2,this.attribute.isWinner=!1,this.attribute.handCardsAmount=0,this.attribute.lastPlayedCardSet=void 0,this.attribute.score=0,this.attribute.calledLandlordScore=-1,this.attribute.hasCalledLandlord=!1,this.attribute.isReady=!1},t.prototype.isIdEqualTo=function(e){return this.attribute.id===e},t.prototype.characterEqualTo=function(e){return this.attribute.character===e},t.prototype.hasCards=function(){return this.handCardModel.hasCards()},t.prototype.getCallLandlordSoundByPoint=function(e){if(0===e)return this.getNotCallLandlordSoundName();if(1===e)return this.getCallOnePointSoundName();if(2===e)return this.getCallTwoPointSoundName();if(3===e)return this.getCallThreePointSoundName();throw new Error("Fatal Error，你需要传一个分数进来，获取叫地主的音效")},t.prototype.setInitialHandCardsAmount=function(){this.setHandCardsAmount(this.attribute.isLandlord()?DDZConstant.DEFAULT_LANDLORD_CARDS_AMOUNT:DDZConstant.DEFAULT_FARMER_CARDS_AMOUNT)},t.prototype.confirmCharacterByLandlordId=function(e){this.isIdEqualTo(e)?this.attribute.character=1:this.attribute.character=2},t.prototype.setHandCardsAmount=function(e){this.attribute.handCardsAmount=e},t.prototype.countRemainCards=function(){var e=this.attribute.handCardsAmount;return 0>=e&&(e=0),e},t.prototype.callLandlord=function(e){var t={body:{score:e},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/become_landlord"};this.postReturnJson(t,function(){egret.log("call landlord success #######")},function(e){egret.log("call landlord failed #######")})},t.prototype.notCallLandlord=function(){var e={body:{score:0},header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/doudizhu/become_landlord"};this.postReturnJson(e,function(e){egret.log("not call landlord success ######")},function(e){egret.log("not call landlord failed ########")})},t.prototype.leaveRoom=function(e){var t={header:this.headerWithAuthorization(),url:QPApiConfig.Host+"/"+QPApiConfig.V1+"/room/leave"};this.postReturnJson(t,function(t){e&&e()},function(t){e&&e(t)})},t.prototype.addLandlordCards=function(e){this.handCardModel.addLandlordCards(e)},t.prototype.listHandCards=function(){return this.handCardModel.listCards()},t.prototype.listSelectedCards=function(){return this.handCardModel.listSelectedCards()},t.prototype.listAutoPlayCards=function(e){var t=this.handCardModel.findBiggerCardSetThanTarget(e);return t?t.cards:[]},t.prototype.cancelSelectedCards=function(){this.handCardModel.cancelSelectedCards()},t.prototype.restoreFromPlayCardGame=function(){var e=DDZGameState.Model.sharedInstance().listPlayedCardsForPlayer(this.attribute.id);this.setLatestPlayedCards(e),this.setCardsAndCardsAmount()},t.prototype.restoreFromBecomLandlordGame=function(){var e=DDZGameState.Model.sharedInstance().getPlayerInformationById(this.attribute.id);this.setHasCalledLandlord(e.hasCalledLandlord),this.setCalledLandlordScore(e.calledLandlordScore),this.setCardsAndCardsAmount()},t.prototype.isHaveBiggerCards=function(e){if(!e&&this.handCardModel.hasCards())return!0;if(e.isEmpty()&&this.handCardModel.hasCards())return!0;var t=this.handCardModel.findBiggerCardSetThanTarget(e);return e.reset(),t?!0:!1},t.prototype.setLatestPlayedCards=function(e){for(var t=0,a=e.length,r=0,n=e;r<n.length;r++){var o=n[r];o.showLandlordTag(this.attribute.isLandlord()),t===a-1&&(o.isLastOne=!0),t+=1}var i=DDZPlayCardSetFactory.createCardSet(e);this.attribute.lastPlayedCardSet=i},t.prototype.playPlayedCardsAudio=function(){1!==this.countRemainCards()||this.isJust1CardAudioPlayed?2!==this.countRemainCards()||this.isJust2CardsAudioPlayed?this.playCardSetAudio():this.playJust2CardsAudio():this.playJust1CardAudio()},t.prototype.listLastPlayedCards=function(){return this.attribute.lastPlayedCardSet.cards.sort(function(e,t){return t.index-e.index}),this.attribute.lastPlayedCardSet.cards},t.prototype.dropPlayedCards=function(e){this.handCardModel.dropPlayedCards(e)},t.prototype.setCardsAndCardsAmount=function(){for(var e=DDZGameState.Model.sharedInstance().listCardsForPlayer(this.attribute.id),t=0,a=e;t<a.length;t++){var r=a[t];r.showLandlordTag(this.attribute.isLandlord())}this.handCardModel.setCards(e),this.setHandCardsAmount(DDZGameState.Model.sharedInstance().countCardsForPlayer(this.attribute.id))},t.prototype.setCalledLandlordScore=function(e){this.attribute.calledLandlordScore=e},t.prototype.setHasCalledLandlord=function(e){this.attribute.hasCalledLandlord=e},t.prototype.playCardSetAudio=function(){var e=this.attribute.lastPlayedCardSet.getSoundEffectName();this.attribute.gender.isMale()&&(e="male_"+e),this.attribute.lastPlayedCardSet.isEmpty()||QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.SEND_CARD,1),QPAudioManager.sharedInstance().playEffectSound(e,1)},t.prototype.playJust1CardAudio=function(){var e="quick_wj1zpl_mp3";this.attribute.gender.isMale()&&(e="male_"+e),QPAudioManager.sharedInstance().playEffectSound(e,1),this.isJust1CardAudioPlayed=!0},t.prototype.playJust2CardsAudio=function(){var e="quick_wj2zpl_mp3";this.attribute.gender.isMale()&&(e="male_"+e),QPAudioManager.sharedInstance().playEffectSound(e,1),this.isJust2CardsAudioPlayed=!0},t.prototype.getNotCallLandlordSoundName=function(){return this.attribute.gender.isMale()?"male_grab_bu_jiao_mp3":"grab_bu_jiao_mp3"},t.prototype.getCallOnePointSoundName=function(){return this.attribute.gender.isMale()?"male_grab_1_point_mp3":"grab_1_point_mp3"},t.prototype.getCallTwoPointSoundName=function(){return this.attribute.gender.isMale()?"male_grab_2_point_mp3":"grab_2_point_mp3"},t.prototype.getCallThreePointSoundName=function(){return this.attribute.gender.isMale()?"male_grab_3_point_mp3":"grab_3_point_mp3"},t.CALL_LANDLORD_TIME=15,t.PLAY_CARD_TIME=25,t.NO_BIGGER_CARDS_TIME=10,t.OBVIOUS_NO_BIGGER_CARDS_TIME=4,t}(QPNetworkApi);__reflect(DDZPlayerModel.prototype,"DDZPlayerModel");var DDZCardAnalyzer=function(){function e(){}return e.setCards=function(t){e.classifiedCardObject=new Object;for(var a=0,r=t;a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n.value];o?o.addCard(n):(o=new DDZClassifiedCard(n.value),o.addCard(n),e.classifiedCardObject[n.value]=o)}e.cards=[].concat(t)},e.getCardsType=function(){var t=e.cards.length;if(0===t)return 1;if(1===t)return 2;if(2===t){var a=e.cards[0],r=e.cards[1];if(a.value>15&&15<r.value)return 15;if(a.isValueEqualTo(r))return 3}if(3===t&&e.cards[0].value===e.cards[2].value)return 4;if(4===t){var a=e.cards[0],r=e.cards[1],n=e.cards[2],o=e.cards[3];if(a.isValueEqualTo(r)&&r.isValueEqualTo(n)&&n.isValueEqualTo(o))return 14;if(a.isValueEqualTo(n)||r.isValueEqualTo(o))return 5}if(t>=5){if(e.isStraight())return 7;if(e.isTrioWithPair())return 6}if(t>=6){if(e.isConsecutivePair())return 8;if(e.isAirplane())return 9;if(e.isFourTakesTwo())return 12}if(t>=8){if(e.isAirplaneTakesSingles())return 10;if(e.isAirplaneTakesPairs())return 11;if(e.isFourTakesTwoPairs())return 13}return 0},e.getCardsValue=function(){var t=e.getCardsType();if(2===t)return e.cards[0].value;if(3===t)return e.cards[0].value;if(4===t)return e.cards[0].value;if(7===t)return e.getSmallestCard().value;if(8===t)return e.getSmallestCard().value;if(9===t)return e.getSmallestCard().value;if(14===t)return e.cards[0].value;if(15===t)return e.cards[0].value;if(5===t||6===t)for(var a=0,r=Object.keys(e.classifiedCardObject);a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n];if(o.isTrio())return o.value}if(10===t||11===t){for(var i=void 0,s=0,d=Object.keys(e.classifiedCardObject);s<d.length;s++){var n=d[s],o=e.classifiedCardObject[n];o.isTrio()&&(i?i.isBiggerThan(o)&&(i=o):i=o)}if(i)return i.value}if(12===t||13===t)for(var l=0,c=Object.keys(e.classifiedCardObject);l<c.length;l++){var n=c[l],o=e.classifiedCardObject[n];if(o.isBomb())return o.value}return 0},e.isStraight=function(){for(var t=[],a=0,r=Object.keys(e.classifiedCardObject);a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n];if(!o.isSingle())return!1;t.push(o)}var i=t.length;if(5>i||i>12)return!1;var s=t[0],d=t[i-1];return d.value>14?!1:d.value-s.value===i-1?!0:!1},e.getSmallestCard=function(){var t=e.cards[0],a=e.cards[e.cards.length-1];return t.value<a.value?t:a},e.isConsecutivePair=function(){for(var t=[],a=0,r=Object.keys(e.classifiedCardObject);a<r.length;a++){var n=r[a],o=e.classifiedCardObject[n];if(!o.isPair())return!1;t.push(o)}var i=t.length;if(3>i||i>10)return!1;var s=t[0],d=t[i-1];return 14<d.value?!1:d.value-s.value===i-1?!0:!1},e.isFourTakesTwo=function(){if(6!==e.cards.length)return!1;for(var t=0,a=Object.keys(e.classifiedCardObject);t<a.length;t++){var r=a[t],n=e.classifiedCardObject[r];if(n.isBomb())return!0}return!1},e.isFourTakesTwoPairs=function(){if(8!==e.cards.length)return!1;for(var t=!1,a=0,r=0,n=Object.keys(e.classifiedCardObject);r<n.length;r++){var o=n[r],i=e.classifiedCardObject[o];i.isBomb()&&(t=!0),i.isPair()&&(a+=1)}return t&&2===a?!0:!1},e.isTrioWithPair=function(){if(5!==e.cards.length)return!1;for(var t=!1,a=!1,r=0,n=Object.keys(e.classifiedCardObject);r<n.length;r++){var o=n[r],i=e.classifiedCardObject[o];i.isTrio()&&(t=!0),i.isPair()&&(a=!0)}return t&&a?!0:!1},e.isAirplane=function(){var t=e.cards.length;if(t%3!==0)return!1;for(var a=[],r=0,n=Object.keys(e.classifiedCardObject);r<n.length;r++){var o=n[r],i=e.classifiedCardObject[o];i.isTrio()&&a.push(i)}var s=a.length,d=t/3;if(2>s)return!1;if(d>s)return!1;var l=a[0],c=a[s-1];return 13<l.value||14<c.value?!1:c.value-l.value===s-1?!0:!1},e.isAirplaneTakesSingles=function(){var t=e.cards.length;if(8!==t&&12!==t&&16!==t&&20!==t)return!1;for(var a=[],r=[],n=0,o=Object.keys(e.classifiedCardObject);n<o.length;n++){var i=o[n],s=e.classifiedCardObject[i];s.isTrio()?a.push(s):r.push(s)}var d=a.length,l=t/4;if(2>d)return!1;if(l>d)return!1;var c=a[0],u=a[d-1];if(13<c.value||14<u.value)return!1;if(u.value-c.value!==d-1)return!1;for(var h=d,p=0,y=0,f=r;y<f.length;y++){var D=f[y];p+=D.countCards()}return p===h?!0:!1},e.isAirplaneTakesPairs=function(){var t=e.cards.length;if(10!==t&&15!==t&&20!==t)return!1;for(var a=[],r=[],n=0,o=Object.keys(e.classifiedCardObject);n<o.length;n++){var i=o[n],s=e.classifiedCardObject[i];s.isTrio()&&a.push(s),s.isPair()&&r.push(s)}var d=a.length,l=r.length,c=t/5;if(c>d)return!1;if(2>d)return!1;if(d!==l)return!1;var u=a[0],h=a[d-1];return 13<u.value||14<h.value?!1:h.value-u.value===d-1?!0:!1},e.cards=[],e}();__reflect(DDZCardAnalyzer.prototype,"DDZCardAnalyzer");var DDZClassifiedCard=function(){function e(e){this.value=18,this.cards=[],this.value=e}return e.prototype.reset=function(){this.cards=[]},e.prototype.isBiggerThan=function(e){return this.value>e.value},e.prototype.countCards=function(){return this.cards.length},e.prototype.addCard=function(e){this.cards.push(e)},e.prototype.isBlackJoker=function(){return 16===this.value},e.prototype.isRedJoker=function(){return 17===this.value},e.prototype.isSingle=function(){return 1===this.countCards()},e.prototype.isPair=function(){return 2===this.countCards()},e.prototype.isTrio=function(){return 3===this.countCards()},e.prototype.hasCards=function(){return this.countCards()>=1},e.prototype.isBomb=function(){return 4===this.countCards()},e}();__reflect(DDZClassifiedCard.prototype,"DDZClassifiedCard");var DDZDealCardModel=function(){function e(){this.cards=[],this.dealtCards=[],this.dealtCardCount=0
}return e.prototype.setCards=function(e){this.cards=e,this.reset();for(var t=e.length,a=0;t>a;a+=1){var r=new DDZRearCard;r.showLandlordTag(!1),this.rearCards.push(r)}},e.prototype.listRearCards=function(){return this.rearCards},e.prototype.isAllCardsDealt=function(){return this.dealtCards.length===this.cards.length},e.prototype.dealOneCard=function(){this.dealtCards.push(this.cards[this.dealtCardCount]),this.rearCards.shift(),this.dealtCardCount+=1},e.prototype.listCards=function(){return this.cards},e.prototype.listDealtCards=function(){return this.dealtCards},e.prototype.countDealtCards=function(){return this.dealtCards.length},e.prototype.reset=function(){this.dealtCardCount=0,this.dealtCards=[],this.rearCards=[]},e}();__reflect(DDZDealCardModel.prototype,"DDZDealCardModel");var DDZHandCardModel=function(){function e(){this.cards=[]}return e.prototype.setCards=function(e){0!==e.length&&(this.classifyCards(e),this.cards=[].concat(e),this.cards.sort(function(e,t){return t.index-e.index}))},e.prototype.listCards=function(){return this.markLastCard(),this.cards},e.prototype.hasCards=function(){return this.cards.length>0},e.prototype.isSelectedCardLegal=function(){DDZCardAnalyzer.setCards(this.listSelectedCards());var e=DDZCardAnalyzer.getCardsType();return 0===e?!1:1===e?!1:!0},e.prototype.listSelectedCards=function(){for(var e=[],t=0,a=this.cards;t<a.length;t++){var r=a[t];r.isSelect&&e.push(r)}return e},e.prototype.hasSelectedCards=function(){return 0!==this.listSelectedCards().length},e.prototype.cancelSelectedCards=function(){for(var e=0,t=this.cards;e<t.length;e++){var a=t[e];a.isSelect=!1}},e.prototype.dropPlayedCards=function(e){for(var t=e.length,a=0;t>a;a+=1)for(var r=e[a],n=this.cards.length-1;n>=0;n-=1){var o=this.cards[n];o.isExactlySameTo(r)&&this.cards.splice(n,1)}this.classifyCards(this.cards)},e.prototype.hint=function(e){var t=this.findBiggerCardSetThanTarget(e);if(t)for(var a=0,r=this.cards;a<r.length;a++)for(var n=r[a],o=0,i=t.cards;o<i.length;o++){var s=i[o];if(n.isSelect=n.isExactlySameTo(s),n.isSelect)break}},e.prototype.addLandlordCards=function(e){3===e.length&&(this.cards=this.cards.concat(e),this.cards.sort(function(e,t){return t.index-e.index}),this.cards.forEach(function(e){e.showLandlordTag(!0)}))},e.prototype.findBiggerCardSetThanTarget=function(e){if(this.isRemainCardsHuoJian())return DDZPlayCardSetFactory.createCardSet(this.cards);if(this.isRemainCardsBomb()&&e&&!e.isBomb()&&!e.isHuoJian())return DDZPlayCardSetFactory.createCardSet(this.cards);if(!e)return this.findSmallestCardSetInHand();if(!e.isHuoJian()){var t=e.listBiggerLegalCardSet(this.analyzedCardObject);return t||e.isBomb()||(t=this.findSmallestBomb(e)),t||(t=this.findHuoJian(e)),t}},e.prototype.isRemainCardsASet=function(){return 0===this.remainCardsType?!1:1===this.remainCardsType?!1:!0},e.prototype.isRemainCardsHuoJian=function(){return 15===this.remainCardsType},e.prototype.isRemainCardsBomb=function(){return 14===this.remainCardsType?!0:!1},e.prototype.getRemainCardsSet=function(){return DDZPlayCardSetFactory.createCardSet(this.cards)},e.prototype.findHuoJian=function(e){for(var t=[],a=0,r=Object.keys(this.analyzedCardObject);a<r.length;a++){var n=r[a],o=this.analyzedCardObject[n];(o.isBlackJoker()||o.isRedJoker())&&(t=t.concat(o.cards))}return 2===t.length?DDZPlayCardSetFactory.createCardSet(t):void 0},e.prototype.findSmallestBomb=function(e){for(var t=0,a=Object.keys(this.analyzedCardObject);t<a.length;t++){var r=a[t],n=this.analyzedCardObject[r];if(n.isBomb())return DDZPlayCardSetFactory.createCardSet(n.cards)}},e.prototype.findSmallestCardSetInHand=function(){if(this.isRemainCardsASet())return DDZPlayCardSetFactory.createCardSet(this.cards);for(var e=0,t=Object.keys(this.analyzedCardObject);e<t.length;e++){var a=t[e],r=this.analyzedCardObject[a];if(r.hasCards())return DDZPlayCardSetFactory.createCardSet(r.cards)}},e.prototype.classifyCards=function(e){this.analyzedCardObject=new Object;for(var t=0,a=e;t<a.length;t++){var r=a[t],n=this.analyzedCardObject[r.value];n?n.addCard(r):(n=new DDZClassifiedCard(r.value),n.addCard(r),this.analyzedCardObject[r.value]=n)}DDZCardAnalyzer.setCards(e),this.remainCardsType=DDZCardAnalyzer.getCardsType()},e.prototype.markLastCard=function(){this.hasCards()&&(this.cards[this.cards.length-1].isLastOne=!0)},e}();__reflect(DDZHandCardModel.prototype,"DDZHandCardModel");var DDZRearCard=function(e){function t(){return e.call(this,t.DefaultCode)||this}return __extends(t,e),t.prototype.getImageName=function(){return"poker_back@2x_png"},t.DefaultCode="3d",t}(DDZCard);__reflect(DDZRearCard.prototype,"DDZRearCard");var DDZPlayCardAirplaneSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.countCards()/3,a=this.findBiggerAirplaneCards(e,t);return 0!==a.length?DDZPlayCardSetFactory.createCardSet(a):void 0},t.prototype.getSoundEffectName=function(){return"poker_airplane_mp3"},t}(DDZPlayCardAirplaneTakes);__reflect(DDZPlayCardAirplaneSet.prototype,"DDZPlayCardAirplaneSet");var GameLaunchScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameLaunchSceneUI",t}return __extends(t,e),t.prototype.setDescriptionText=function(e){this.descriptionLabel.text=e+"..."},t.prototype.setProgress=function(e,t){this.progress.value=Math.floor(e/t*100),this.progress.labelFunction=function(e,t){return Math.ceil(e/t*100)+"%"}},t.prototype.checkHasPin=function(){var e=this,t={command:"query_pin"};window.postMessage(JSON.stringify(t),"*"),window.document.addEventListener("message",function(t){var a=JSON.parse(t.data);"query_pin"===a.command&&(a.payload.pin?(UserModel.sharedInstance().personalRoomModel.setPin(a.payload.pin),e.joinToPersonalRoom()):e.queryPlayerGameState())})},t.prototype.joinToPersonalRoom=function(){var e=this;this.setDescriptionText("正在加入房间");var t=UserModel.sharedInstance().actionDataFactory.makeJoinPersonalRoomData();UserModel.sharedInstance().actionModel.joinPersonalRoomByPin(t,function(e){UserModel.sharedInstance().personalRoomModel.setId(e.id),UserModel.sharedInstance().personalRoomModel.setPlayers(e.players);var t=new DDZGameModel(UserModel.sharedInstance().personalRoomModel.getId());t.addPlayers(UserModel.sharedInstance().personalRoomModel.getPlayers()),qp.SceneManager.sharedInstance().replaceScene(new DDZPlayGameScene(t))},function(t){e.handleError(t)})},t.prototype.createPersonalRoom=function(){var e=this;this.setDescriptionText("正在创建房间");var t=UserModel.sharedInstance().actionDataFactory.makeCreatePersonalRoomData();UserModel.sharedInstance().actionModel.createPersonalRoom(t,function(e){UserModel.sharedInstance().personalRoomModel.setPin(e.pin),UserModel.sharedInstance().personalRoomModel.setId(e.id),UserModel.sharedInstance().personalRoomModel.setPlayers(e.players);var t=new DDZGameModel(UserModel.sharedInstance().personalRoomModel.getId());t.addPlayers(UserModel.sharedInstance().personalRoomModel.getPlayers()),qp.SceneManager.sharedInstance().replaceScene(new DDZPlayGameScene(t))},function(t){e.handleError(t)})},t.prototype.queryPlayerGameState=function(){var e=this;this.setDescriptionText("正在查询游戏信息"),DDZGameState.Model.sharedInstance().fetch(function(t){DDZGameState.Model.sharedInstance().isInGame()||DDZGameState.Model.sharedInstance().isWaiting()?(t.room.pin&&UserModel.sharedInstance().personalRoomModel.setPin(t.room.pin),e.backToExistGame()):DDZGameState.Model.sharedInstance().isIdling()&&e.createPersonalRoom()},function(t){return egret.log("是否在等待中",DDZGameState.Model.sharedInstance().isWaiting()),t?void e.handleError(t):void 0})},t.prototype.backToExistGame=function(){var e={roomId:DDZGameState.Model.sharedInstance().room.id,baseScore:DDZGameState.Model.sharedInstance().room.baseScore,playerInformations:DDZGameState.Model.sharedInstance().room.playerInformations};this.goToPlayScene(e)},t.prototype.goToPlayScene=function(e){var t=new DDZGameModel(e.roomId);t.addPlayers(e.playerInformations),t.setBaseScore(e.baseScore),qp.SceneManager.sharedInstance().replaceScene(new DDZPlayGameScene(t))},t.prototype.handleError=function(e){QPAlert.sharedInstance().showOKButtonAt(this,e.message),QPAlert.sharedInstance().pressedOKHandler=function(){QPCrossPlatformCommunication.closeH5Game(),QPAlert.sharedInstance().pressedOKHandler=void 0}},t}(QPScene);__reflect(GameLaunchScene.prototype,"GameLaunchScene");var DDZPlayCardAirplaneTakesPairsSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.countCards()/5,a=this.findBiggerAirplaneCards(e,t);if(0!==a.length){for(var r=t,n=[],o=2*r,i=0,s=this.pairs;i<s.length;i++){var d=s[i];if(n.length<o&&(n=n.concat(d.cards)),n.length===o)return DDZPlayCardSetFactory.createCardSet(a.concat(n))}for(var l=a[0].value,c=a[a.length-1].value,u=0,h=this.trioes;u<h.length;u++){var p=h[u];if(n.length<o&&(p.value<l||c<p.value)&&(n=n.concat([p.cards[0],p.cards[1]])),n.length===o)return DDZPlayCardSetFactory.createCardSet(a.concat(n))}}},t.prototype.getSoundEffectName=function(){return"poker_airplane_mp3"},t}(DDZPlayCardAirplaneTakes);__reflect(DDZPlayCardAirplaneTakesPairsSet.prototype,"DDZPlayCardAirplaneTakesPairsSet");var DDZPlayCardAirplaneTakesSinglesSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.countCards()/4,a=this.findBiggerAirplaneCards(e,t);if(0!==a.length){for(var r=[],n=0,o=this.singles;n<o.length;n++){var i=o[n];if(r.length<t&&(r=r.concat(i.cards)),r.length===t)return DDZPlayCardSetFactory.createCardSet(a.concat(r))}for(var s=0,d=this.pairs;s<d.length;s++){var l=d[s];if(r.length<t&&(r=r.concat([l.cards[0]])),r.length<t&&(r=r.concat([l.cards[1]])),r.length===t)return DDZPlayCardSetFactory.createCardSet(a.concat(r))}for(var c=a[0].value,u=a[a.length-1].value,h=0,p=this.trioes;h<p.length;h++){var y=p[h];if((y.value<c||u<y.value)&&(r.length<t&&(r=r.concat([y.cards[0]])),r.length<t&&(r=r.concat([y.cards[1]])),r.length<t&&(r=r.concat([y.cards[2]]))),r.length===t)return DDZPlayCardSetFactory.createCardSet(a.concat(r))}}},t.prototype.getSoundEffectName=function(){return"poker_airplane_mp3"},t}(DDZPlayCardAirplaneTakes);__reflect(DDZPlayCardAirplaneTakesSinglesSet.prototype,"DDZPlayCardAirplaneTakesSinglesSet");var DDZPlayCardBombSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerBombCards(e);if(0!==t.length)return DDZPlayCardSetFactory.createCardSet(t)},t.prototype.getSoundEffectName=function(){return"poker_bomb_mp3"},t}(DDZPlayCardFourTakes);__reflect(DDZPlayCardBombSet.prototype,"DDZPlayCardBombSet");var DDZPlayCardConsecutivePairsSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=[],a=0,r=Object.keys(e);a<r.length;a++){var n=r[a],o=e[n];(o.isPair()||o.isTrio()||o.isBomb())&&t.push(o)}var i=t.length,s=this.countCards()/2;if(!(s>i)){for(var d=i-1,l=0;d>=l;l+=1){var c=l+s-1;if(c>d)return;var u=t[c];if(15<=u.value)return;var h=t[l];if(this.canBeBiggerConsetutive(h,u,s)){if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND&&l<=this.lastFoundIndex)continue;if(this.lastFoundIndex=l,d>c){var p=t[c+1];(p.value-u.value!==1||15<=p.value)&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND)}else c===d&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND);for(var y=t.slice(l,c+1),f=[],D=0,m=y;D<m.length;D++){var g=m[D];f=f.concat([g.cards[0],g.cards[1]])}return DDZPlayCardSetFactory.createCardSet(f)}}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var v=this.lastFoundIndex,C=this.lastFoundIndex+s-1;if(C>d)return;if(15<=t[C].value)return;if(t[C].value-t[v].value!==s-1)return;for(var P=t.slice(v,C+1),_=[],S=0,I=P;S<I.length;S++){var M=I[S];_=_.concat([M.cards[0],M.cards[1]])}return DDZPlayCardSetFactory.createCardSet(_)}}},t.prototype.getSoundEffectName=function(){return"poker_consecutive_pairs_mp3"},t}(DDZPlayCardSet);__reflect(DDZPlayCardConsecutivePairsSet.prototype,"DDZPlayCardConsecutivePairsSet");var DDZPlayCardEmptySet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=0,a=Object.keys(e);t<a.length;t++){var r=a[t],n=e[r];if(n.hasCards())return DDZPlayCardSetFactory.createCardSet(n.cards)}},t.prototype.getSoundEffectName=function(){return QPAudioSouce.getRandomBuYao()},t}(DDZPlayCardSet);__reflect(DDZPlayCardEmptySet.prototype,"DDZPlayCardEmptySet");var DDZPlayCardErrorSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){throw new Error("错误的牌型不应该找比它大的牌")},t.prototype.getSoundEffectName=function(){return""},t}(DDZPlayCardSet);__reflect(DDZPlayCardErrorSet.prototype,"DDZPlayCardErrorSet");var DDZConstant=function(){function e(){}return e.INDEX_NOT_FOUND=-1,e.DEFAULT_FARMER_CARDS_AMOUNT=17,e.DEFAULT_LANDLORD_CARDS_AMOUNT=20,e}();__reflect(DDZConstant.prototype,"DDZConstant");var DDZPlayCardFourWithTwoPairsSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerBombCards(e);if(0!==t.length){for(var a=[],r=4,n=0,o=this.pairs;n<o.length;n++){var i=o[n];if(a.length<r&&(a=a.concat(i.cards)),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var s=0,d=this.trioes;s<d.length;s++){var l=d[s];if(a.length<r&&(a=a.concat([l.cards[0],l.cards[1]])),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}}},t.prototype.getSoundEffectName=function(){return"poker_4_take_4_mp3"},t}(DDZPlayCardFourTakes);__reflect(DDZPlayCardFourWithTwoPairsSet.prototype,"DDZPlayCardFourWithTwoPairsSet");var DDZPlayCardFourTakesTwoSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerBombCards(e);if(0!==t.length){for(var a=[],r=2,n=0,o=this.singles;n<o.length;n++){var i=o[n];if(a.length<r&&!i.isBlackJoker()&&!i.isRedJoker())a.push(i.cards[0]);else if(a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var s=0,d=this.pairs;s<d.length;s++){var l=d[s];if(a.length<r&&a.push(l.cards[0]),a.length<r&&a.push(l.cards[1]),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var c=0,u=this.trioes;c<u.length;c++){var h=u[c];if(a.length<r&&a.push(h.cards[0]),a.length<r&&a.push(h.cards[1]),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}for(var p=0,y=this.attachedBombs;p<y.length;p++){var f=y[p];if(a.length<r&&a.push(f.cards[0]),a.length<r&&a.push(f.cards[1]),a.length===r)return DDZPlayCardSetFactory.createCardSet(t.concat(a))}}},t.prototype.getSoundEffectName=function(){return"poker_4_take_2_mp3"},t}(DDZPlayCardFourTakes);__reflect(DDZPlayCardFourTakesTwoSet.prototype,"DDZPlayCardFourTakesTwoSet");var DDZPlayCardHuoJianSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){},t.prototype.getSoundEffectName=function(){return"poker_huo_jian_mp3"},t}(DDZPlayCardSet);__reflect(DDZPlayCardHuoJianSet.prototype,"DDZPlayCardHuoJianSet");var DDZPlayCardPairSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=[],a=[],r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],i=e[o];i.isPair()&&this.value<i.value&&t.push(i),i.isTrio()&&this.value<i.value&&a.push(i)}var s=[];s=s.concat(t),s=s.concat(a);var d=s.length;if(1===d){var l=s[0];return DDZPlayCardSetFactory.createCardSet([l.cards[0],l.cards[1]])}for(var c=0;d>c;c+=1){var l=s[c];if(this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND)return this.lastFoundIndex=c,DDZPlayCardSetFactory.createCardSet([l.cards[0],l.cards[1]]);if(this.lastFoundIndex<c)return this.lastFoundIndex=c,c===d-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),DDZPlayCardSetFactory.createCardSet([l.cards[0],l.cards[1]])}},t.prototype.getSoundEffectName=function(){return 3===this.value?"poker_33_mp3":4===this.value?"poker_44_mp3":5===this.value?"poker_55_mp3":6===this.value?"poker_66_mp3":7===this.value?"poker_77_mp3":8===this.value?"poker_88_mp3":9===this.value?"poker_99_mp3":10===this.value?"poker_1010_mp3":11===this.value?"poker_JJ_mp3":12===this.value?"poker_QQ_mp3":13===this.value?"poker_KK_mp3":14===this.value?"poker_AA_mp3":15===this.value?"poker_22_mp3":""},t}(DDZPlayCardSet);__reflect(DDZPlayCardPairSet.prototype,"DDZPlayCardPairSet");var DDZCacheModel=function(){function e(){}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.removeItemForKey=function(e){egret.localStorage.removeItem(e)},e.prototype.setString=function(e,t){egret.localStorage.setItem(e,t)},e.prototype.stringForKey=function(e){return egret.localStorage.getItem(e)},e.prototype.setBoolean=function(e,t){t?egret.localStorage.setItem(e,"yes"):egret.localStorage.setItem(e,"no")},e.prototype.booleanForKey=function(e){var t=egret.localStorage.getItem(e);return"yes"===t?!0:!1},e}();__reflect(DDZCacheModel.prototype,"DDZCacheModel");var DDZPlayCardSetFactory=function(){function e(){}return e.createCardSet=function(e){if(e){var t=e.slice(0);DDZCardAnalyzer.setCards(t);var a,r=DDZCardAnalyzer.getCardsType(),n=DDZCardAnalyzer.getCardsValue();switch(r){case 2:a=new DDZPlayCardSingleSet(t);break;case 3:a=new DDZPlayCardPairSet(t);break;case 4:a=new DDZPlayCardTrioTakesNoneSet(t);break;case 5:a=new DDZPlayCardTrioTakesSingleSet(t);break;case 6:a=new DDZPlayCardTrioTakesPairSet(t);break;case 7:a=new DDZPlayCardStraightSet(t);break;case 8:a=new DDZPlayCardConsecutivePairsSet(t);break;case 9:a=new DDZPlayCardAirplaneSet(t);break;case 10:a=new DDZPlayCardAirplaneTakesSinglesSet(t);break;case 11:a=new DDZPlayCardAirplaneTakesPairsSet(t);break;case 12:a=new DDZPlayCardFourTakesTwoSet(t);break;case 13:a=new DDZPlayCardFourWithTwoPairsSet(t);break;case 14:a=new DDZPlayCardBombSet(t);break;case 15:a=new DDZPlayCardHuoJianSet(t);break;case 1:a=new DDZPlayCardEmptySet(t);break;default:a=new DDZPlayCardErrorSet(t)}return a.value=n,a.cardTypeName=r,a}},e}();__reflect(DDZPlayCardSetFactory.prototype,"DDZPlayCardSetFactory");var DDZPlayCardSingleSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=[],a=[],r=[],n=0,o=Object.keys(e);n<o.length;n++){var i=o[n],s=e[i];s.isSingle()&&this.value<s.value&&t.push(s),s.isPair()&&this.value<s.value&&a.push(s),s.isTrio()&&this.value<s.value&&r.push(s)}var d=[];d=d.concat(t),d=d.concat(a),d=d.concat(r);var l=d.length;if(1===l)return DDZPlayCardSetFactory.createCardSet([d[0].cards[0]]);for(var c=0;l>c;c+=1){var u=d[c];if(this.lastFoundIndex===DDZConstant.INDEX_NOT_FOUND)return this.lastFoundIndex=c,DDZPlayCardSetFactory.createCardSet([u.cards[0]]);if(this.lastFoundIndex<c)return this.lastFoundIndex=c,c===l-1&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND),DDZPlayCardSetFactory.createCardSet([u.cards[0]])}},t.prototype.getSoundEffectName=function(){return 3===this.value?"poker_3_mp3":4===this.value?"poker_4_mp3":5===this.value?"poker_5_mp3":6===this.value?"poker_6_mp3":7===this.value?"poker_7_mp3":8===this.value?"poker_8_mp3":9===this.value?"poker_9_mp3":10===this.value?"poker_10_mp3":11===this.value?"poker_J_mp3":12===this.value?"poker_Q_mp3":13===this.value?"poker_K_mp3":14===this.value?"poker_A_mp3":15===this.value?"poker_2_mp3":16===this.value?"poker_black_joker_mp3":17===this.value?"poker_red_joker_mp3":""},t}(DDZPlayCardSet);__reflect(DDZPlayCardSingleSet.prototype,"DDZPlayCardSingleSet");var DDZPlayCardStraightSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){for(var t=this.countCards(),a=[],r=0,n=Object.keys(e);r<n.length;r++){var o=n[r],i=e[o];a.push(i)}for(var s=a.length,d=s-1,l=0;d>=l;l+=1){var c=l+t-1;if(c>d)return;var u=a[c];if(15<=u.value)return;var h=a[l];if(this.canBeBiggerConsetutive(h,u,t)){if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND&&l<=this.lastFoundIndex)continue;if(this.lastFoundIndex=l,d>c){var p=a[c+1];(p.value-u.value!==1||15<=p.value)&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND)}else c===d&&(this.lastFoundIndex=DDZConstant.INDEX_NOT_FOUND);for(var y=a.slice(l,c+1),f=[],D=0,m=y;D<m.length;D++){var g=m[D];f=f.concat([g.cards[0]])}return DDZPlayCardSetFactory.createCardSet(f)}}if(this.lastFoundIndex!==DDZConstant.INDEX_NOT_FOUND){var v=this.lastFoundIndex,C=this.lastFoundIndex+t-1;if(C>=s)return;if(15<=a[C].value)return;if(a[C].value-a[v].value!==t-1)return;for(var P=a.slice(v,C+1),f=[],_=0,S=P;_<S.length;_++){var I=S[_];f=f.concat([I.cards[0]])}return DDZPlayCardSetFactory.createCardSet(f)}},t.prototype.getSoundEffectName=function(){return"poker_straight_mp3"},t}(DDZPlayCardSet);__reflect(DDZPlayCardStraightSet.prototype,"DDZPlayCardStraightSet");var DDZColor=function(){function e(){}return e.YELLOW=16571778,e.BROWN=10041347,e}();__reflect(DDZColor.prototype,"DDZColor");var DDZPlayCardTrioTakesNoneSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerTrioCards(e);if(0!==t.length)return DDZPlayCardSetFactory.createCardSet(t)},t.prototype.getSoundEffectName=function(){return 3===this.value?"poker_333_mp3":4===this.value?"poker_444_mp3":5===this.value?"poker_555_mp3":6===this.value?"poker_666_mp3":7===this.value?"poker_777_mp3":8===this.value?"poker_888_mp3":9===this.value?"poker_999_mp3":10===this.value?"poker_101010_mp3":11===this.value?"poker_JJJ_mp3":12===this.value?"poker_QQQ_mp3":13===this.value?"poker_KKK_mp3":14===this.value?"poker_AAA_mp3":15===this.value?"poker_222_mp3":""},t}(DDZPlayCardTrioTakes);__reflect(DDZPlayCardTrioTakesNoneSet.prototype,"DDZPlayCardTrioTakesNoneSet");var DDZPlayCardTrioTakesPairSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerTrioCards(e);if(0!==t.length){if(0!==this.pairs.length)return DDZPlayCardSetFactory.createCardSet(t.concat(this.pairs[0].cards));for(var a=0,r=this.trioes;a<r.length;a++){var n=r[a];if(n.value!==t[0].value)return DDZPlayCardSetFactory.createCardSet(t.concat([n.cards[0],n.cards[1]]))}}},t.prototype.getSoundEffectName=function(){return"poker_3_take_2_mp3"},t}(DDZPlayCardTrioTakes);__reflect(DDZPlayCardTrioTakesPairSet.prototype,"DDZPlayCardTrioTakesPairSet");var DDZPlayCardTrioTakesSingleSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.listBiggerLegalCardSet=function(e){var t=this.findBiggerTrioCards(e);if(0!==t.length){if(0!==this.singles.length)return DDZPlayCardSetFactory.createCardSet(t.concat(this.singles[0].cards));if(0!==this.pairs.length)return DDZPlayCardSetFactory.createCardSet(t.concat([this.pairs[0].cards[0]]));for(var a=0,r=this.trioes;a<r.length;a++){var n=r[a];if(n.value!==t[0].value)return DDZPlayCardSetFactory.createCardSet(t.concat([n.cards[0]]))}}},t.prototype.getSoundEffectName=function(){return"poker_3_take_1_mp3"},t}(DDZPlayCardTrioTakes);__reflect(DDZPlayCardTrioTakesSingleSet.prototype,"DDZPlayCardTrioTakesSingleSet");var DDZClockView=function(e){function t(){var t=e.call(this)||this;return t.remainTime=0,t.isTimerEnded=!1,t.skinName="DDZClockUI",t.hLayout=new eui.HorizontalLayout,t.hLayout.gap=0,t.hLayout.horizontalAlign=egret.HorizontalAlign.CENTER,t.hLayout.verticalAlign=egret.VerticalAlign.MIDDLE,t.hLayout.paddingBottom=9,t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.stopCountDown()},t.prototype.startCountDown=function(e){this.stopwatchTimer||(this.isTimerEnded=!1,this.remainTime=e,this.stopwatchLabel.text=this.remainTime.toString(),this.stopwatchTimer=new egret.Timer(1e3,0),this.stopwatchTimer.addEventListener(egret.TimerEvent.TIMER,this.timerCall,this),this.stopwatchTimer.start())},t.prototype.stopCountDown=function(){this.stopwatchTimer&&(this.isTimerEnded=!0,this.stopwatchTimer.stop(),this.stopwatchTimer.removeEventListener(egret.TimerEvent.TIMER,this.timerCall,this),this.stopwatchTimer=void 0)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.reset()},t.prototype.reset=function(){this.stopwatchLabel.text=""},t.prototype.timerCall=function(e){return this.isTimerEnded?void this.stopCountDown():(this.remainTime-=1,this.remainTime<1?(this.stopCountDown(),void(this.stopwatchFinishedHandler&&this.stopwatchFinishedHandler())):(this.stopwatchLabel.text=this.remainTime.toString(),void this.makeLabelShowInMiddle()))},t.prototype.makeLabelShowInMiddle=function(){9<this.remainTime&&this.remainTime<20?this.hLayout.paddingRight=5:this.hLayout.paddingRight=0,this.stopwatchLabelGroup.layout=this.hLayout},t}(QPLayer);__reflect(DDZClockView.prototype,"DDZClockView");var DDZGameOverLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZGameOverUI",t.continueButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressContinueButton,t),t}return __extends(t,e),t.prototype.onPressContinueButton=function(){this.pressedContinueGameHandler()},t}(QPLayer);__reflect(DDZGameOverLayer.prototype,"DDZGameOverLayer");var DDZLandlordCardsView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLandlordCardsUI",t.visible=!1,t}return __extends(t,e),t.prototype.setCards=function(e){3===e.length&&(this.cardOne.setImage(e[0].getImageName()),this.cardTwo.setImage(e[1].getImageName()),this.cardThree.setImage(e[2].getImageName()),this.show())},t.prototype.show=function(){this.y=-80,this.visible=!0,egret.Tween.get(this).to({y:0},300)},t.prototype.hide=function(){this.visible=!1},t}(QPLayer);__reflect(DDZLandlordCardsView.prototype,"DDZLandlordCardsView");var DDZMatchPlayerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameMatchPlayerUI",t}return __extends(t,e),t.prototype.showWaitForStartGame=function(){this.informationImage.source="img_wait_for_starting_png",this.show()},t.prototype.showMatchPlayer=function(){this.informationImage.source="img_matching_player_png",this.show()},t.prototype.hide=function(){this.visible=!1},t.prototype.show=function(){this.visible=!0},t}(QPLayer);__reflect(DDZMatchPlayerView.prototype,"DDZMatchPlayerView");var DDZPlayGameBottomToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameBottomToolbarUI",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.chatButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressChatButton,this)},t.prototype.onPressChatButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressChatButtonHandler()},t}(QPLayer);__reflect(DDZPlayGameBottomToolbar.prototype,"DDZPlayGameBottomToolbar");var DDZTopToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameTopToolbarUI",t.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBack,t),t.taskButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressTask,t),t.packageButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressPackage,t),t.settingsButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressSettings,t),t}return __extends(t,e),t.prototype.onPressBack=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBackHandler&&this.pressBackHandler()},t.prototype.onPressTask=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressTaskHandler&&this.pressTaskHandler()},t.prototype.onPressPackage=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressPackageHandler&&this.pressPackageHandler()},t.prototype.onPressSettings=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressSettingsHandler&&this.pressSettingsHandler()},t}(QPLayer);__reflect(DDZTopToolbar.prototype,"DDZTopToolbar");var InvitePlayerPopupLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="InvitePlayerPopupLayerUI",t}return __extends(t,e),t.prototype.show=function(){qp.SceneManager.sharedInstance().addChildLayer(this)},t.prototype.hide=function(){qp.SceneManager.sharedInstance().removeChildLayer(this)},t.prototype.setInvitationMessage=function(e){this.invitationMessageLabel.text=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.toWeChatButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toWeChat,this)},t.prototype.toWeChat=function(){var e=UserModel.sharedInstance().personalRoomModel.getPin(),t="您的好友在「来玩」等你哦!点击链接下载 "+QPApiConfig.DownloadHost+", 打开应用即可一起来玩, 房间号: ["+e+"] (复制该条消息打开游戏即可加入)",a={command:"save_to_clipboard",payload:t};window.postMessage(JSON.stringify(a),"*");var r={command:"to_wechat",payload:"weixin://"};window.postMessage(JSON.stringify(r),"*")},t}(QPPopupLayer);__reflect(InvitePlayerPopupLayer.prototype,"InvitePlayerPopupLayer");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,a){function r(r){t.call(a,r,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?r(n):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DDZCallLandlordButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZCallLandlordButtonsUI",t}return __extends(t,e),t.prototype.enableButtons=function(){this.buJiaoButton.enabled=!0,this.callOnePointButton.enabled=!0,this.callTwoPointButton.enabled=!0,this.callThreePointButton.enabled=!0},t.prototype.disableButtons=function(){this.buJiaoButton.enabled=!1,this.callOnePointButton.enabled=!1,this.callTwoPointButton.enabled=!1,this.callThreePointButton.enabled=!1},t.prototype.disableCallOnePointButton=function(){this.callOnePointButton.enabled=!1},t.prototype.disableCallTwoPointButton=function(){this.callTwoPointButton.enabled=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.buJiaoButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressBuJiaoButton,this),this.callOnePointButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressOnePointButton,this),this.callTwoPointButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressTwoPointButton,this),this.callThreePointButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressThreePointButton,this)},t.prototype.onPressBuJiaoButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.NOT_CALL_LANDLORD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressOnePointButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.CALL_ONE_POINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressTwoPointButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.CALL_TWO_POINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressThreePointButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disableButtons();var e=new DDZButtonEvent(DDZButtonEvent.CALL_THREE_POINT);DDZEventCenter.sharedInstance().dispatchEvent(e)
},t}(DDZBaseButtons);__reflect(DDZCallLandlordButtons.prototype,"DDZCallLandlordButtons");var DDZMustPlayCardButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZMustPlayCardButtonsUI",t}return __extends(t,e),t.prototype.disablePlayButton=function(){this.playButton.enabled=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.playButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressPlayButton,this),this.hintButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressHintButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListeners,this)},t.prototype.removeListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListeners,this)},t.prototype.enablePlayButton=function(){this.playButton.enabled=!0},t.prototype.onPressPlayButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.disablePlayButton();var e=new DDZButtonEvent(DDZButtonEvent.PLAY_CARD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressHintButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.HINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZMustPlayCardButtons.prototype,"DDZMustPlayCardButtons");var DDZNoBiggerCardsButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZNoBiggerCardsButtonsUI",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.noBiggerCardsButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressNoBiggerCardsButton,this)},t.prototype.onPressNoBiggerCardsButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.NOT_PLAY_CARD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZNoBiggerCardsButtons.prototype,"DDZNoBiggerCardsButtons");var DDZPlayCardButtons=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayCardButtonsUI",t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),this.addListeners()},t.prototype.onExit=function(){e.prototype.onExit.call(this),this.removeListeners()},t.prototype.disablePlayButton=function(){this.playButton.enabled=!1},t.prototype.addListeners=function(){this.notPlayButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressNotPlayButton,this),this.hintButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressHintButton,this),this.playButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressPlayButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this)},t.prototype.removeListeners=function(){DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.ENABLE_PLAY_CARD_BUTTON,this.enablePlayButton,this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.DISABLE_PLAY_CARD_BUTTON,this.disablePlayButton,this)},t.prototype.enablePlayButton=function(){this.playButton.enabled=!0},t.prototype.onPressNotPlayButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.NOT_PLAY_CARD);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressHintButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.HINT);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.onPressPlayButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.PLAY_CARD);this.disablePlayButton(),DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZBaseButtons);__reflect(DDZPlayCardButtons.prototype,"DDZPlayCardButtons");var DDZPlayGameButtonsContainer=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameButtonsContainerUI",t}return __extends(t,e),t.prototype.hideAllButtons=function(){this.callLandlordButtons.setVisible(!1),this.playCardButtons.setVisible(!1),this.mustPlayCardButtons.setVisible(!1),this.noBiggerCardsButtons.setVisible(!1),this.startGameButton.visible=!1},t.prototype.disableCallOnePointButton=function(){this.callLandlordButtons.disableCallOnePointButton()},t.prototype.disableCallTwoPointButton=function(){this.callLandlordButtons.disableCallTwoPointButton()},t.prototype.showCallLandlordButtons=function(){this.hideAllButtons(),this.callLandlordButtons.setVisible(!0),this.callLandlordButtons.enableButtons()},t.prototype.showPlayCardButtons=function(){this.hideAllButtons(),this.playCardButtons.setVisible(!0),this.playCardButtons.disablePlayButton()},t.prototype.showNoBiggerCardsButtons=function(){this.hideAllButtons(),this.noBiggerCardsButtons.setVisible(!0)},t.prototype.showMustPlayCardButtons=function(){this.hideAllButtons(),this.mustPlayCardButtons.setVisible(!0),this.mustPlayCardButtons.disablePlayButton()},t.prototype.showStartGameButton=function(){this.hideAllButtons(),this.startGameButton.visible=!0},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.hideAllButtons(),this.startGameButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressStartGameButton,this)},t.prototype.onPressStartGameButton=function(){var e=new DDZButtonEvent(DDZButtonEvent.START_GAME);DDZEventCenter.sharedInstance().dispatchEvent(e),this.hideAllButtons()},t}(QPLayer);__reflect(DDZPlayGameButtonsContainer.prototype,"DDZPlayGameButtonsContainer");var DDZBottomPlayerHandCardsView=function(e){function t(){var t=e.call(this)||this;return t.ANIMATION_CARD_TOP_LINE_INITIAL_X=325,t.ANIMATION_CARD_TOP_LINE_INITIAL_Y=270,t.ANIMATION_CARD_BOTTOM_LINE_INITIAL_X=325,t.ANIMATION_CARD_BOTTOM_LINE_INITIAL_Y=387,t.ANIMATION_CARD_HORIZONTAL_GAP=55,t.ANIMATION_CARD_SPEED=3.106,t.skinName="DDZBottomPlayerHandCardsUI",t.dealCardModel=new DDZDealCardModel,t}return __extends(t,e),t.prototype.dealCards=function(e){this.dealCardModel.setCards(e),this.rearCardListView.setCards(this.dealCardModel.listRearCards()),this.playDealCardsAnimation()},t.prototype.setCards=function(e){this.distributeCards(e)},t.prototype.showBottomCards=function(){this.bottomCardsGroup.visible=!0},t.prototype.hideBottomCards=function(){this.bottomCardsGroup.visible=!1},t.prototype.playHideBottomCardsAnimation=function(e){var t=this;egret.Tween.get(this.bottomCardsGroup).to({y:-150,scaleX:.4,scaleY:.4},200).call(function(){t.hideBottomCards(),e()})},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.rearCardOriginPosition=new egret.Point(this.rearCardView.x,this.rearCardView.y)},t.prototype.distributeCards=function(e){var t=e.length,a=e.slice(0,10);if(this.topHandCardListView.setCards(a),t>10){var r=e.slice(10);this.bottomHandCardListView.setCards(r)}else this.bottomHandCardListView.setCards([])},t.prototype.playDealCardsAnimation=function(){var e=this;if(this.dealCardModel.isAllCardsDealt())return this.distributeCards(this.dealCardModel.listCards()),this.dealCardAnimationDidFinishedHandler&&this.dealCardAnimationDidFinishedHandler(),this.rearCardView.visible=!1,void this.showBottomCards();this.rearCardView.visible=!0,this.dealCardModel.dealOneCard();var t=this.dealCardModel.countDealtCards(),a=this.ANIMATION_CARD_TOP_LINE_INITIAL_X,r=this.ANIMATION_CARD_TOP_LINE_INITIAL_Y;t>=10&&(a=this.ANIMATION_CARD_BOTTOM_LINE_INITIAL_X,r=this.ANIMATION_CARD_BOTTOM_LINE_INITIAL_Y);var n=Math.abs(this.rearCardOriginPosition.x-a),o=r-this.rearCardOriginPosition.y,i=Math.floor(Math.sqrt(n*n+o*o)),s=i/this.ANIMATION_CARD_SPEED;QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.SEND_CARD,1),egret.Tween.get(this.rearCardView).to({x:a,y:r},s).call(function(){e.rearCardListView.setCards(e.dealCardModel.listRearCards()),e.distributeCards(e.dealCardModel.listDealtCards()),e.rearCardView.x=e.rearCardOriginPosition.x,e.rearCardView.y=e.rearCardOriginPosition.y,e.playDealCardsAnimation()})},t}(QPLayer);__reflect(DDZBottomPlayerHandCardsView.prototype,"DDZBottomPlayerHandCardsView");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),QPResource.LaunchGameGroup.sharedInstance().loadCompleteHandler=this.loadLaunchGameGroupFinish.bind(this),QPResource.PlayGameGroup.sharedInstance().loadCompleteHandler=this.loadPlayGameGroupFinish.bind(this),QPResource.PlayGameGroup.sharedInstance().loadProgressHandler=this.loadResourceProgress.bind(this),QPResource.CommonImagesGroup.sharedInstance().loadCompleteHandler=this.loadCommonImagesGroupFinish.bind(this),QPResource.CommonMusicGroup.sharedInstance().loadCompleteHandler=this.loadCommonMusicGroupFinish.bind(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigFinish,this),RES.loadConfig("resource/default.res.json","resource/"),this.initUserModel()},t.prototype.initUserModel=function(){UserModel.sharedInstance().setInputtedAttributeModel(new InputtedAttributeModel),UserModel.sharedInstance().setActionDataFactory(new PhoneUserActionDataFactory),UserModel.sharedInstance().setAttributeModel(new PhoneUserAttributeModel),UserModel.sharedInstance().setPersonalRoomModel(new PersonalRoomModel)},t.prototype.addUserDataCommunicationListener=function(){var e=this,t={command:"query_user_data"};window.postMessage(JSON.stringify(t),"*"),window.postMessage(JSON.stringify({command:"query_screen_size"}),"*"),window.document.addEventListener("message",function(t){var a=JSON.parse(t.data);if("transform_user_data"===a.command){var r=JSON.parse(a.payload);e.gameLaunchScene.setDescriptionText("正在链接服务器..."),UserModel.sharedInstance().saveUserInformation(r),UserModel.sharedInstance().connectRealtimeGameService(function(t){t||e.gameLaunchScene.checkHasPin()})}else if("transform_screen_size"===a.command){var n=a.payload;Device.sharedInstance().setScreenWidth(n.width),Device.sharedInstance().setScreenHeight(n.height)}})},t.prototype.onLoadConfigFinish=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigFinish,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onLoadThemeFinish,this)},t.prototype.onLoadThemeFinish=function(){egret.ExternalInterface.call("RuntimeInterface","load resource complete"),this.isThemeLoadEnd=!0,QPResource.LaunchGameGroup.sharedInstance().load()},t.prototype.loadLaunchGameGroupFinish=function(e){this.gameLaunchScene=new GameLaunchScene,qp.SceneManager.sharedInstance().addRootStage(this),qp.SceneManager.sharedInstance().pushScene(this.gameLaunchScene),QPResource.PlayGameGroup.sharedInstance().load()},t.prototype.loadPlayGameGroupFinish=function(e){QPResource.PlayGameGroup.sharedInstance().isLoaded=!0,this.createScene(),QPResource.CommonMusicGroup.sharedInstance().load()},t.prototype.loadCommonMusicGroupFinish=function(e){QPResource.CommonMusicGroup.sharedInstance().isLoaded=!0,this.createScene(),QPResource.CommonImagesGroup.sharedInstance().load()},t.prototype.loadCommonImagesGroupFinish=function(e){QPResource.CommonImagesGroup.sharedInstance().isLoaded=!0,this.createScene()},t.prototype.createScene=function(){this.canCreateScene()&&(Device.sharedInstance().setWidth(Math.min(this.stage.width,this.stage.height)),Device.sharedInstance().setHeight(Math.max(this.stage.width,this.stage.height)),this.addUserDataCommunicationListener())},t.prototype.canCreateScene=function(){return this.isThemeLoadEnd&&QPResource.PlayGameGroup.sharedInstance().isLoaded&&QPResource.CommonImagesGroup.sharedInstance().isLoaded&&QPResource.CommonMusicGroup.sharedInstance().isLoaded?!0:!1},t.prototype.loadResourceProgress=function(e){this.gameLaunchScene.setProgress(e.itemsLoaded,e.itemsTotal)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DDZHandCardListView=function(e){function t(){var t=e.call(this)||this;return t.CardSpace=58,t.CardWidth=126,t.CardHeight=182,t.CardVerticalGap=-60,t.skinName="DDZCardListUI",t}return __extends(t,e),t.prototype.setCards=function(e){var t=e.length;this.cardList.dataProvider=new eui.ArrayCollection(e),10>=t?(this.width=this.CardWidth+(t-1)*this.CardSpace,this.height=this.CardHeight):(this.width=650,this.height=2*this.CardHeight+this.CardVerticalGap)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.cardList.allowMultipleSelection=!1,this.cardList.itemRenderer=DDZHandCardView;var t=new eui.TileLayout;t.horizontalGap=this.CardSpace-this.CardWidth,t.verticalGap=this.CardVerticalGap,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.cardList.layout=t},t}(DDZCardListView);__reflect(DDZHandCardListView.prototype,"DDZHandCardListView");var DDZPlayedCardListView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CardSpace=30,t.CardVerticalGap=-40,t.CardWidth=70,t.CardHeight=102,t}return __extends(t,e),t.prototype.setCards=function(e){var t=e.length;this.cardList.dataProvider=new eui.ArrayCollection(e),10>=t?(this.width=this.CardWidth+(t-1)*this.CardSpace,this.height=this.CardHeight):(this.width=350,this.height=2*this.CardHeight+this.CardVerticalGap)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.cardList.itemRenderer=DDZPlayedCardView;var t=new eui.TileLayout;t.horizontalGap=this.CardSpace-this.CardWidth,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalGap=this.CardVerticalGap,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.cardList.layout=t},t}(DDZCardListView);__reflect(DDZPlayedCardListView.prototype,"DDZPlayedCardListView");var DDZRearCardListView=function(e){function t(){var t=e.call(this)||this;return t.CardSpace=20,t.CardWidth=105,t.CardHeight=140,t.skinName="DDZCardListUI",t}return __extends(t,e),t.prototype.setCards=function(e){this.cardList.dataProvider=new eui.ArrayCollection(e),this.width=this.CardWidth+(e.length-1)*this.CardSpace},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.cardList.allowMultipleSelection=!1,this.cardList.itemRenderer=DDZRearCardView;var t=new eui.TileLayout;t.horizontalGap=-85,t.verticalGap=0,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.cardList.layout=t},t}(DDZCardListView);__reflect(DDZRearCardListView.prototype,"DDZRearCardListView");var DDZCoinWareHouse=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(DDZBaseWarehouse);__reflect(DDZCoinWareHouse.prototype,"DDZCoinWareHouse");var DDZDiamondWareHouse=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(DDZBaseWarehouse);__reflect(DDZDiamondWareHouse.prototype,"DDZDiamondWareHouse");var DDZHandCardView=function(e){function t(){var t=e.call(this)||this;return t.isTouchMovedExcuted=!1,t.skinName="DDZCardUI",t.touchChildren=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.touchMoved,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.removeListeners,t),t.addEventListener(egret.TouchEvent.TOUCH_END,t.touchEventEnd,t),DDZEventCenter.sharedInstance().addEventListener(DDZHandCardEvent.TOUCH_END,t.touchHandCardEnd,t),t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.isSelect?this.toSelectedPosition():this.toOriginPosition()},t.prototype.touchHandler=function(e){this.handleCardTouched()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.toOriginPosition()},t.prototype.removeListeners=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoved,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListeners,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEventEnd,this),DDZEventCenter.sharedInstance().removeEventListener(DDZHandCardEvent.TOUCH_END,this.touchHandCardEnd,this)},t.prototype.toOriginPosition=function(){this.contentGroup.y=t.ORIGIN_POS},t.prototype.toSelectedPosition=function(){this.contentGroup.y=t.SELECTED_POS},t.prototype.handleCardTouched=function(){this.data.isSelect=!this.data.isSelect,this.data.isSelect?this.toSelectedPosition():this.toOriginPosition();var e=new DDZHandCardEvent(DDZHandCardEvent.TOUCHED);DDZEventCenter.sharedInstance().dispatchEvent(e)},t.prototype.touchMoved=function(){this.isTouchMovedExcuted||(this.handleCardTouched(),this.isTouchMovedExcuted=!0)},t.prototype.touchEventEnd=function(){var e=new DDZHandCardEvent(DDZHandCardEvent.TOUCH_END);DDZEventCenter.sharedInstance().dispatchEvent(e),QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CHOOSE_CARD,1)},t.prototype.touchHandCardEnd=function(){this.isTouchMovedExcuted=!1},t.ORIGIN_POS=0,t.SELECTED_POS=-30,t}(DDZCardView);__reflect(DDZHandCardView.prototype,"DDZHandCardView");var DDZPlayedCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayedCardUI",t}return __extends(t,e),t.prototype.setImage=function(e){this.image.source="played_"+e},t}(DDZCardView);__reflect(DDZPlayedCardView.prototype,"DDZPlayedCardView");var DDZRearCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZRearCardUI",t}return __extends(t,e),t}(DDZBaseCardView);__reflect(DDZRearCardView.prototype,"DDZRearCardView");var DDZCardListLeftToRightAnimation=function(){function e(e){this.target=e.target}return e.prototype.play=function(){this.target.x=-200,egret.Tween.get(this.target).to({x:0},100)},e}();__reflect(DDZCardListLeftToRightAnimation.prototype,"DDZCardListLeftToRightAnimation",["DDZCardAnimation"]);var DDZCardListRightToLeftAnimation=function(){function e(e){this.target=e.target}return e.prototype.play=function(){this.target.x=200,egret.Tween.get(this.target).to({x:0},100)},e}();__reflect(DDZCardListRightToLeftAnimation.prototype,"DDZCardListRightToLeftAnimation",["DDZCardAnimation"]);var DDZLeaveGameAlertView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLeaveGameAlertViewUI",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.popup.pressExitHandler=this.leaveGame.bind(this),this.popup.pressCancelHandler=this.cancelLeaveGame.bind(this)},t.prototype.leaveGame=function(){this.leaveGameHandler&&this.leaveGameHandler()},t.prototype.cancelLeaveGame=function(){this.visible=!1},t}(QPLayer);__reflect(DDZLeaveGameAlertView.prototype,"DDZLeaveGameAlertView");var DDZLeaveGamePopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLeaveGamePopupUI",t.exitButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressExitButon,t),t.cancelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressCancelButton,t),t}return __extends(t,e),t.prototype.onPressExitButon=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressExitHandler&&this.pressExitHandler()},t.prototype.onPressCancelButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressCancelHandler&&this.pressCancelHandler()},t}(QPPopupLayer);__reflect(DDZLeaveGamePopup.prototype,"DDZLeaveGamePopup");var DDZActivePlayerSignView=function(e){function t(){var t=e.call(this)||this;return t.LeftPlayerRotation=0,t.RightPlayerRotation=90,t.BottomPlayerRotation=225,t.skinName="DDZActivePlayerSignUI",t}return __extends(t,e),t.prototype.hide=function(){this.activePlayerSign.visible=!1},t.prototype.pointToLeftPlayer=function(){this.activePlayerSign.visible=!0,egret.Tween.get(this.activePlayerSign).to({rotation:this.LeftPlayerRotation},500)},t.prototype.pointToRightPlayer=function(){this.activePlayerSign.visible=!0,egret.Tween.get(this.activePlayerSign).to({rotation:this.RightPlayerRotation},500)},t.prototype.pointToBottomPlayer=function(){this.activePlayerSign.visible=!0,egret.Tween.get(this.activePlayerSign).to({rotation:this.BottomPlayerRotation},500)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.activePlayerSign.visible=!1},t}(QPLayer);__reflect(DDZActivePlayerSignView.prototype,"DDZActivePlayerSignView");var DDZLeftPlayerGameInfoView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZLeftPlayerGameInfoUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.playerStateView.setItemAlign(0)},t}(DDZPlayerGameInfoBaseView);__reflect(DDZLeftPlayerGameInfoView.prototype,"DDZLeftPlayerGameInfoView");var DDZEmptyContentView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZEmptyContentViewUI",t}return __extends(t,e),t}(QPLayer);__reflect(DDZEmptyContentView.prototype,"DDZEmptyContentView");var DDZPlayerRemainCardView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayerRemainCardUI",t.hLayout=new eui.HorizontalLayout,t.hLayout.horizontalAlign=egret.HorizontalAlign.CENTER,t.hLayout.verticalAlign=egret.VerticalAlign.MIDDLE,t.hLayout.gap=0,t}return __extends(t,e),t.prototype.setAmount=function(e){this.amountLabel.text=String(e),e>9&&20>e?this.hLayout.paddingRight=5:this.hLayout.paddingRight=0,this.amountLabelGroup.layout=this.hLayout},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.reset()},t.prototype.reset=function(){this.amountLabel.text=""},t}(QPLayer);__reflect(DDZPlayerRemainCardView.prototype,"DDZPlayerRemainCardView");var DDZPlayerStateView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayerStateUI",t.hideAllState(),t}return __extends(t,e),t.prototype.showWaitForReady=function(){this.waitForReady.visible=!0},t.prototype.hideWaitForReady=function(){this.waitForReady.visible=!1},t.prototype.setItemAlign=function(e){0===e?(this.callOnePointImage.x=0,this.callTwoPointImage.x=0,this.callThreePointImage.x=0,this.notCallLandlordImg.x=0,this.addTimesImg.x=0,this.notAddTimesImg.x=0,this.notPlayImg.x=0):1===e&&(this.callOnePointImage.x=this.width-this.callOnePointImage.width,this.callTwoPointImage.x=this.width-this.callTwoPointImage.width,this.callThreePointImage.x=this.width-this.callThreePointImage.width,this.notCallLandlordImg.x=this.width-this.notCallLandlordImg.width,this.addTimesImg.x=this.width-this.addTimesImg.width,this.notAddTimesImg.x=this.width-this.notAddTimesImg.width,this.notPlayImg.x=this.width-this.notPlayImg.width)},t.prototype.hideAllState=function(){this.callOnePointImage.visible=!1,this.callTwoPointImage.visible=!1,this.callThreePointImage.visible=!1,this.notCallLandlordImg.visible=!1,this.addTimesImg.visible=!1,this.notAddTimesImg.visible=!1,this.notPlayImg.visible=!1},t.prototype.setState=function(e){switch(this.hideAllState(),e){case 1:this.callOnePointImage.visible=!0;break;case 2:this.callTwoPointImage.visible=!0;break;case 3:this.callThreePointImage.visible=!0;break;case 4:this.notCallLandlordImg.visible=!0;break;case 5:this.addTimesImg.visible=!0;break;case 7:this.notPlayImg.visible=!0;break;case 6:this.notAddTimesImg.visible=!0}},t}(QPLayer);__reflect(DDZPlayerStateView.prototype,"DDZPlayerStateView");var DDZPlayerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayerUI",t}return __extends(t,e),t.prototype.showLandlordSign=function(e){this.landlordHatImage.visible=e},t.prototype.setName=function(e){this.nameLabel.text=e},t.prototype.setScore=function(e){this.scoreLabel.text="积分："+e},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.landlordHatImage.visible=!1},t}(QPLayer);__reflect(DDZPlayerView.prototype,"DDZPlayerView");var DDZRightPlayerGameInfoView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZRightPlayerGameInfoUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.playerStateView.setItemAlign(1)},t}(DDZPlayerGameInfoBaseView);__reflect(DDZRightPlayerGameInfoView.prototype,"DDZRightPlayerGameInfoView");var DDZWarningLightView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZWarningLightUI",t}return __extends(t,e),t.prototype.show=function(){this.visible=!0,this.warningLightShine.gotoAndPlay("shine",-1)},t.prototype.hide=function(){this.visible=!1,this.warningLightShine.gotoAndStop("shine")},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=RES.getRes("warning_light_json"),a=RES.getRes("warning_light_png"),r=new egret.MovieClipDataFactory(t,a);this.warningLightShine=new egret.MovieClip(r.generateMovieClipData("shine")),this.contentGroup.addChild(this.warningLightShine),this.hide()},t}(QPLayer);__reflect(DDZWarningLightView.prototype,"DDZWarningLightView");var DDZPopupStore=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPopupStoreUI",t.storeModel=new DDZStoreModel,t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.PURCHASE_COIN,this.purchaseCoins,this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.PURCHASE_COIN,this.purchaseCoins,this)},t.prototype.createChildren=function(){var t=this;e.prototype.createChildren.call(this),this.tabbar.dataProvider=new eui.ArrayCollection([{upImageName:"btn_popup_store_type_coin@2x_png",downImageName:"btn_popup_store_type_coin_on@2x_png"},{upImageName:"btn_popup_store_type_diamond@2x_png",downImageName:"btn_popup_store_type_diamond_on@2x_png"}]),this.tabbar.itemRenderer=DDZPopupStoreTabbarItem,this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGoodTypeTabbarItemTap,this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCloseButton,this),this.storeModel.fetchCoinGoods(function(e){t.goodsListView.showGoodsListByType(0,e)})},t.prototype.onGoodTypeTabbarItemTap=function(e){var t=this;0===e.itemIndex?this.storeModel.fetchCoinGoods(function(e){t.goodsListView.showGoodsListByType(0,e)}):1===e.itemIndex&&this.storeModel.fetchDiamondGoods(function(e){t.goodsListView.showGoodsListByType(1,e)})},t.prototype.purchaseCoins=function(e){var t=this,a=new QPLoadingScene;a.show();var r={failed:function(e){a.hide(),QPAlert.sharedInstance().showAt(t,e.message)},purchasedSuccessfully:function(e){UserModel.sharedInstance().addBalance(1e4),a.hide(),QPAlert.sharedInstance().showAt(t,e.message),UserModel.sharedInstance().verifyIAPReceipt(e.receipt,function(e){return e?void egret.log(e.message):void egret.log("purchaseGoodsById purchasedSuccessfully ..................")})},purchasing:function(e){egret.log("purchasing goods...")}};this.storeModel.purchaseGoodsById(e.productId,r)},t.prototype.onPressCloseButton=function(){qp.SceneManager.sharedInstance().removeChildLayer(this)},t}(QPLayer);__reflect(DDZPopupStore.prototype,"DDZPopupStore");var DDZPopupStoreTabbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPopupStoreTabbarItemUI",t}return __extends(t,e),t.prototype.dataChanged=function(){this.upImage.source=this.data.upImageName,this.downImage.source=this.data.downImageName},t}(eui.ItemRenderer);__reflect(DDZPopupStoreTabbarItem.prototype,"DDZPopupStoreTabbarItem");var DDZPlayGameTopToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZPlayGameTopToolbarUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCloseButton,this),800<Device.sharedInstance().getScreenHeight()?this.closeButton.y=60:this.closeButton.y=20},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressCloseButtonHandler()},t}(QPLayer);__reflect(DDZPlayGameTopToolbar.prototype,"DDZPlayGameTopToolbar");var DDZSettingsScene=function(e){function t(t){var a=e.call(this)||this;return a.skinName="DDZSettingsUI",a.backgroundImage.source=t,a}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.popup.pressedCloseButtonHandler=this.closeScene.bind(this)},t.prototype.closeScene=function(){qp.SceneManager.sharedInstance().popScene()},t}(QPScene);__reflect(DDZSettingsScene.prototype,"DDZSettingsScene");var DDZSettingsModel=function(){function e(){QPAudioManager.sharedInstance().setBackgroundMusicVolume(e.MAX_MUSIC_VOLUME),QPAudioManager.sharedInstance().setSoundEffectVolume(e.MAX_SOUND_VOLUME),Device.sharedInstance().isLaunchedApp?(this.isMusicOn=DDZCacheModel.sharedInstance().booleanForKey(e.SAVE_MUSIC_STATE_KEY),this.isSoundOn=DDZCacheModel.sharedInstance().booleanForKey(e.SAVE_SOUND_STATE_KEY)):(this.isMusicOn=!0,this.saveMusicState(),this.isSoundOn=!0,this.saveSoundState())}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.switchMuisc=function(){if(this.isMusicOn=!this.isMusicOn,this.isMusicOn){var e=new DDZMusicEvent(DDZMusicEvent.PLAY_MUSIC_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(e)}else{var t=new DDZMusicEvent(DDZMusicEvent.STOP_MUSIC_EVENT);DDZEventCenter.sharedInstance().dispatchEvent(t)}this.saveMusicState()},e.prototype.switchSound=function(){this.isSoundOn=!this.isSoundOn,this.saveSoundState()},e.prototype.saveMusicState=function(){DDZCacheModel.sharedInstance().setBoolean(e.SAVE_MUSIC_STATE_KEY,this.isMusicOn)},e.prototype.saveSoundState=function(){DDZCacheModel.sharedInstance().setBoolean(e.SAVE_SOUND_STATE_KEY,this.isSoundOn)},e.MAX_MUSIC_VOLUME=100,e.MAX_SOUND_VOLUME=100,e.SAVE_MUSIC_STATE_KEY="DDZSettingsModel.music.state.key",e.SAVE_SOUND_STATE_KEY="DDZSettingsModel.sound.state.key",e}();__reflect(DDZSettingsModel.prototype,"DDZSettingsModel");var DDZSettingsPopup=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closeButton.pressHandler=this.onCloseButtonPressed.bind(this),this.musicSwitch.setTitle("音乐"),this.musicSwitch.setSelected(!DDZSettingsModel.sharedInstance().isMusicOn),this.soundSwitch.setTitle("音效"),this.soundSwitch.setSelected(!DDZSettingsModel.sharedInstance().isSoundOn),this.musicSwitch.switchChangedHandler=function(){DDZSettingsModel.sharedInstance().switchMuisc()},this.soundSwitch.switchChangedHandler=function(){DDZSettingsModel.sharedInstance().switchSound()}},t.prototype.onCloseButtonPressed=function(){this.pressedCloseButtonHandler&&this.pressedCloseButtonHandler()},t}(QPPopupLayer);__reflect(DDZSettingsPopup.prototype,"DDZSettingsPopup");var DDZSettingsSwitch=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZSettingsSwitchUI",t}return __extends(t,e),t.prototype.setTitle=function(e){this.titleLabel.text=e},t.prototype.setSelected=function(e){this["switch"].selected=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this["switch"].addEventListener(eui.UIEvent.CHANGE,this.switchChanged,this)
},t.prototype.switchChanged=function(){this.switchChangedHandler&&this.switchChangedHandler(),QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1)},t}(QPLayer);__reflect(DDZSettingsSwitch.prototype,"DDZSettingsSwitch");var DDZStoreScene=function(e){function t(t){var a=e.call(this)||this;return a.storeType=t||0,a.skinName="DDZStoreSceneUI",a.storeModel=new DDZStoreModel,a.topToolbar.pressBackButtonHandler=a.goBack.bind(a),a}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),DDZEventCenter.sharedInstance().addEventListener(DDZButtonEvent.PURCHASE_COIN,this.purchaseCoins,this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),DDZEventCenter.sharedInstance().removeEventListener(DDZButtonEvent.PURCHASE_COIN,this.purchaseCoins,this)},t.prototype.createChildren=function(){var t=this;e.prototype.createChildren.call(this),this.tabBar.itemRenderer=DDZStoreTabbarItem,this.tabBar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTappedTabbarItem,this),this.storeModel.fetchStoreTypes(function(e){t.tabBar.dataProvider=new eui.ArrayCollection(e),0===t.storeType?(t.tabBar.selectedIndex=0,t.showCoinGoods()):1===t.storeType&&(t.tabBar.selectedIndex=1,t.showDiamondGoods())})},t.prototype.purchaseCoins=function(e){var t=this,a=new QPLoadingScene;a.show();var r={failed:function(e){a.hide(),QPAlert.sharedInstance().showAt(t,e.message)},purchasedSuccessfully:function(e){a.hide(),UserModel.sharedInstance().addBalance(1e4),QPAlert.sharedInstance().showAt(t,e.message),UserModel.sharedInstance().verifyIAPReceipt(e.receipt,function(e){return e?void egret.log(e.message):void egret.log("purchaseGoodsById purchasedSuccessfully ..................")})},purchasing:function(e){egret.log("purchasing goods...")}};this.storeModel.purchaseGoodsById(e.productId,r)},t.prototype.onTappedTabbarItem=function(e){switch(QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),e.itemIndex){case 0:this.showCoinGoods();break;case 1:this.showDiamondGoods();break;case 2:this.showExchangeGoods();break;case 3:this.showPropsGoods()}},t.prototype.goBack=function(){qp.SceneManager.sharedInstance().popScene()},t.prototype.showCoinGoods=function(){var e=this;this.storeModel.fetchCoinGoods(function(t){e.goodsListView.showGoodsListByType(0,t)})},t.prototype.showDiamondGoods=function(){var e=this;this.storeModel.fetchDiamondGoods(function(t){e.goodsListView.showGoodsListByType(1,t)})},t.prototype.showExchangeGoods=function(){egret.log("showExchangeGoods...")},t.prototype.showPropsGoods=function(){egret.log("showPropsGoods....")},t}(QPScene);__reflect(DDZStoreScene.prototype,"DDZStoreScene");var DDZTabbar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setItems=function(e){this.tabbar.dataProvider=new eui.ArrayCollection(e)},t.prototype.setSelectedIndex=function(e){this.tabbar.selectedIndex=e},t}(QPLayer);__reflect(DDZTabbar.prototype,"DDZTabbar");var DDZIAPResponseType;!function(e){e[e.Purchasing=0]="Purchasing",e[e.PurchasedSuccessfully=1]="PurchasedSuccessfully"}(DDZIAPResponseType||(DDZIAPResponseType={}));var DDZIAPResponse=function(){function e(e){this.type=e.type,this.message=e.message,this.receipt=e.receipt}return e}();__reflect(DDZIAPResponse.prototype,"DDZIAPResponse");var DDZProduct=function(){function e(e){this.id=e.product_id,this.image=e.product_image,this.price=e.product_price,this.quantity=e.product_quantity}return e}();__reflect(DDZProduct.prototype,"DDZProduct");var testDiamonds=[{portraitImageName:"img_store_diamonds_1@2x_png",price:6,productId:DDZAppleIAPModel.PRODUCT_10_DIAMONDS_ID,quantity:10},{portraitImageName:"img_store_diamonds_2@2x_png",price:12,productId:DDZAppleIAPModel.PRODUCT_20_DIAMONDS_ID,quantity:20},{portraitImageName:"img_store_diamonds_3@2x_png",price:18,productId:DDZAppleIAPModel.PRODUCT_30_DIAMONDS_ID,quantity:30},{portraitImageName:"img_store_diamonds_4@2x_png",price:24,productId:DDZAppleIAPModel.PRODUCT_40_DIAMONDS_ID,quantity:40},{portraitImageName:"img_store_diamonds_5@2x_png",price:30,productId:DDZAppleIAPModel.PRODUCT_50_DIAMONDS_ID,quantity:50}],testStoreTypes=[{upImageName:"btn_store_coin@2x_png",downImageName:"btn_store_coin_on@2x_png"}],DDZStoreModel=function(e){function t(){var t=e.call(this)||this,a=RES.getRes("iap_id_config_json"),r=a.coin;return t.createCoinProducts(r),t}return __extends(t,e),t.prototype.purchaseGoodsById=function(e,t){return Device.sharedInstance().isiOS()?void DDZAppleIAPModel.sharedInstance().purchaseDiamondByProductId(e,function(e){e.type===DDZIAPResponseType.Purchasing?t.purchasing&&t.purchasing(e):e.type===DDZIAPResponseType.PurchasedSuccessfully&&t.purchasedSuccessfully&&t.purchasedSuccessfully(e)},function(e){t.failed&&t.failed(e)}):void(t.failed&&t.failed(new Error("抱歉，此平台不支持购买，请下载App购买")))},t.prototype.fetchCoinGoods=function(e,t){e(this.coinProducts)},t.prototype.fetchDiamondGoods=function(e,t){e([])},t.prototype.fetchStoreTypes=function(e,t){e(testStoreTypes)},t.prototype.createCoinProducts=function(e){this.coinProducts=[];for(var t=0,a=e;t<a.length;t++){var r=a[t],n=new DDZProduct(r);this.coinProducts.push(n)}},t}(QPNetworkApi);__reflect(DDZStoreModel.prototype,"DDZStoreModel");var DDZStoreTypeName=function(){function e(){}return e.COIN="金币",e.DIAMOND="钻石",e.EXCHANGE="兑换",e.PROPS="道具",e}();__reflect(DDZStoreTypeName.prototype,"DDZStoreTypeName");var DDZStoreCoinGoodView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.coinGroup.visible=!1},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.diamondPriceLabel.text=String(this.data.price)},t.prototype.onPurchaseButtonPressed=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.PURCHASE_COIN);e.productQuantity=this.data.quantity,e.productId=this.data.id,DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZStoreGoodView);__reflect(DDZStoreCoinGoodView.prototype,"DDZStoreCoinGoodView");var DDZStoreDiamondGoodView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.coinGroup.visible=!1},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.diamondPriceLabel.text=String(this.data.price)},t.prototype.onPurchaseButtonPressed=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZButtonEvent(DDZButtonEvent.PURCHASE_DIAMOND);e.productId=this.data.productId,e.productQuantity=this.data.quantity,DDZEventCenter.sharedInstance().dispatchEvent(e)},t}(DDZStoreGoodView);__reflect(DDZStoreDiamondGoodView.prototype,"DDZStoreDiamondGoodView");var DDZStoreGoodListView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZStoreGoodListUI",t}return __extends(t,e),t.prototype.showGoodsListByType=function(e,t){this.goodsList.dataProvider=new eui.ArrayCollection(t),0===e?this.goodsList.itemRenderer=DDZStoreCoinGoodView:1===e&&(this.goodsList.itemRenderer=DDZStoreDiamondGoodView)},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.goodsList.dataProvider=new eui.ArrayCollection([]),this.goodsList.itemRenderer=DDZStoreCoinGoodView},t}(QPLayer);__reflect(DDZStoreGoodListView.prototype,"DDZStoreGoodListView");var DDZTabbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTabbarItemUI",t}return __extends(t,e),t.prototype.dataChanged=function(){this.normalTitleLabel.text=this.data.title,this.selectedTitleLabel.text=this.data.title},t}(eui.ItemRenderer);__reflect(DDZTabbarItem.prototype,"DDZTabbarItem");var DDZStoreTabbarItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.upImage.source=this.data.upImageName,this.downImage.source=this.data.downImageName},t}(eui.ItemRenderer);__reflect(DDZStoreTabbarItem.prototype,"DDZStoreTabbarItem");var DDZStoreTopToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZStoreTopToolbarUI",t.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBackButton,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.coinWareHouse.setAmount(UserModel.sharedInstance().attributeModel.getBalanceAmount()),this.coinWareHouse.hideAddImage()},t.prototype.onPressBackButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBackButtonHandler&&this.pressBackButtonHandler()},t}(QPLayer);__reflect(DDZStoreTopToolbar.prototype,"DDZStoreTopToolbar");var DDZTaskPopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTaskPopupUI",t.taskActionModel=new DDZTaskActionModel,t}return __extends(t,e),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.closeButton.pressHandler=this.onPressCloseButton.bind(this),this.emptyContentView.visible=!1,this.contentScroller.viewport=this.contentList,this.taskActionModel.fetchTasks(function(e){t.taskActionModel.createTasks(e.tasks),t.leftTabbar.dataProvider=new eui.ArrayCollection(t.taskActionModel.listAllTaskNames()),t.leftTabbar.itemRenderer=DDZTaskTabbarItem,t.leftTabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onTapTaskTabbarAtIndex,t),t.leftTabbar.selectedIndex=0,t.showTaskContentAtIndex(0)},function(e){QPAlert.sharedInstance().showOKButtonAt(t.parent,e.message)})},t.prototype.onTapTaskTabbarAtIndex=function(e){this.showTaskContentAtIndex(e.itemIndex)},t.prototype.showTaskContentAtIndex=function(e){var t=this.taskActionModel.getTaskModelAtIndex(e);this.emptyContentView.visible=0===t.countSubTasks(),this.contentList.dataProvider=new eui.ArrayCollection(t.listSubTaskModels()),this.contentList.itemRenderer=DDZTaskItem,this.contentList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onPressTaskItem,this)},t.prototype.onPressTaskItem=function(e){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),QPAlert.sharedInstance().showAt(this.parent,"暂未开放此功能，敬请期待"),egret.log(e)},t.prototype.onPressCloseButton=function(){this.pressCloseButtonHandler&&this.pressCloseButtonHandler()},t}(QPPopupLayer);__reflect(DDZTaskPopup.prototype,"DDZTaskPopup");var DDZTaskScene=function(e){function t(t){var a=e.call(this)||this;return a.skinName="DDZTaskSceneUI",a.backgroundImage.source=t,a.popup.pressCloseButtonHandler=a.goBack.bind(a),a}return __extends(t,e),t.prototype.goBack=function(){qp.SceneManager.sharedInstance().popScene()},t}(QPScene);__reflect(DDZTaskScene.prototype,"DDZTaskScene");var TestDDZTaskActionModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.startTest=function(){this.testFetchTasks()},t.prototype.testFetchTasks=function(){var e=this;this.taskActionModel=new DDZTaskActionModel,this.taskActionModel.fetchTasks(function(t){var a=t.tasks;e.taskActionModel.createTasks(a),e.assertEquals("tasks amount expect to "+a.length,a.length,e.taskActionModel.countTasks());var r=a[0],n=e.taskActionModel.getTaskModelAtIndex(0);e.assertEquals("task name expect to "+r.name,r.name,n.name),e.assertEquals("task description expect to "+r.description,r.description,n.description),e.assertEquals("task startAt expect to "+r.start_at,r.start_at,n.startAt),e.assertEquals("task endAt expect to "+r.end_at,r.end_at,n.endAt);var o=r.sub_tasks,i=o[0],s=n.getSubTaskModelAtIndex(0);e.assertEquals("subTask amount expect to "+o.length,o.length,n.countSubTasks()),e.assertEquals("subTask name expect to "+i.name,i.name,s.name),e.assertEquals("subTask finishedAmount expect to "+i.finished_amount,i.finished_amount,s.finishedAmount),e.assertEquals("subTask totalAmount expect to "+i.total_amount,i.total_amount,s.totalAmount);var d=i.award;e.assertEquals("subTask award type expect to "+d.type,d.type,s.awardType),e.assertEquals("subTask award type expect to "+d.quantity,d.quantity,s.awardQuantity),e.assertEquals("subTask award type expect to "+d.description,d.description,s.awardDescription)},function(e){throw new Error("testFetchTasks fetchTasks error : "+e.message)})},t}(QPTestCase);__reflect(TestDDZTaskActionModel.prototype,"TestDDZTaskActionModel");var TestDDZTaskRealtimeMessageModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(QPTestCase);__reflect(TestDDZTaskRealtimeMessageModel.prototype,"TestDDZTaskRealtimeMessageModel");var DDZSubTaskModel=function(){function e(e){this.name=e.name,this.finishedAmount=e.finished_amount,this.totalAmount=e.total_amount,this.awardType=e.award.type,this.awardQuantity=e.award.quantity,this.awardDescription=e.award.description}return e}();__reflect(DDZSubTaskModel.prototype,"DDZSubTaskModel");var testTasks={tasks:[{name:"新手任务",description:"完成新手任务，有奖励哟，快去做任务吧",start_at:Date.now(),end_at:Date.now(),sub_tasks:[{name:"对局10次",finished_amount:0,total_amount:10,award:{type:"coin",quantity:2e3,description:""}},{name:"打出5个连对",finished_amount:3,total_amount:5,award:{type:"coin",quantity:3e3,description:""}}]},{name:"每天任务",description:"",start_at:Date.now(),end_at:Date.now(),sub_tasks:[{name:"当2次地主",finished_amount:1,total_amount:2,award:{type:"coin",quantity:200,description:""}},{name:"使用炸弹一次",finished_amount:0,total_amount:1,award:{type:"coin",quantity:200,description:""}},{name:"打两次飞机",finished_amount:2,total_amount:2,award:{type:"coin",quantity:600,description:""}}]}]},DDZTaskActionModel=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.fetchTasks=function(e,t){return void e(testTasks)},t.prototype.listAllTaskNames=function(){return this.tasks.map(function(e){return e.name})},t.prototype.createTasks=function(e){this.tasks=e.map(function(e){return new DDZTaskModel(e)})},t.prototype.countTasks=function(){return this.tasks.length},t.prototype.listTasks=function(){return this.tasks},t.prototype.getTaskModelAtIndex=function(e){return this.tasks[e]},t.prototype.mockTaskResponse=function(){var e=Mock.Random,t=Mock.mock({"ok|1":!0,result:{"tasks|4":[{name:e.email("task"),description:"我是任务介绍",start_at:e.datetime(),end_at:e.now(),"sub_tasks|1-3":[{name:"我是任务名字","finished_amount|0-3":0,"total_amount|3-5":5,award:{type:"coin","quantity|1000-100000":1e3,description:"我是奖励名字"}}]}]}});return t.result},t}(QPNetworkApi);__reflect(DDZTaskActionModel.prototype,"DDZTaskActionModel");var DDZTaskModel=function(){function e(e){this.name=e.name,this.description=e.description,this.startAt=e.start_at,this.endAt=e.end_at,this.subTaskModels=this.createSubTasks(e.sub_tasks)}return e.prototype.countSubTasks=function(){return this.subTaskModels.length},e.prototype.listSubTaskModels=function(){return this.subTaskModels},e.prototype.getSubTaskModelAtIndex=function(e){return this.subTaskModels[e]},e.prototype.createSubTasks=function(e){return e.map(function(e){return new DDZSubTaskModel(e)})},e}();__reflect(DDZTaskModel.prototype,"DDZTaskModel");var DDZTaskItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTaskItemUI",t.getAwardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressGetRewardButton,t),t.goButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressGoButton,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.titleLabel.text=this.data.name,this.awardQuantityLabel.text="x"+this.data.awardQuantity,egret.log("DDZTaskItem progressBar finished : "+this.data.finishedAmount+", total : "+this.data.totalAmount),this.progressBar.setProgress(this.data.finishedAmount,this.data.totalAmount)},t.prototype.onPressGetRewardButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1)},t.prototype.onPressGoButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1)},t}(eui.ItemRenderer);__reflect(DDZTaskItem.prototype,"DDZTaskItem");var DDZTaskProgressBar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTaskProgressBarUI",t}return __extends(t,e),t}(DDZBaseProgressBar);__reflect(DDZTaskProgressBar.prototype,"DDZTaskProgressBar");var DDZTaskTabbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTaskTabbarItemUI",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),egret.log("this.data is : "+this.data),this.titleLabel.text=this.data},t}(eui.ItemRenderer);__reflect(DDZTaskTabbarItem.prototype,"DDZTaskTabbarItem");var DDZUserInfoScene=function(e){function t(t,a){var r=e.call(this)||this;return r.skinName="DDZUserInfoSceneUI",r.userAttribute=a,r.backgroundImage.source=t,r.popup.pressCloseButtonHandler=r.goBack.bind(r),r.popup.pressSwitchAccountButtonHandler=r.switchAccount.bind(r),r.popup.pressBindPhoneButtonHandler=r.bindPhone.bind(r),r}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.popup.setUserInfo(this.userAttribute)},t.prototype.goBack=function(){qp.SceneManager.sharedInstance().popScene()},t.prototype.switchAccount=function(){},t.prototype.bindPhone=function(){qp.SceneManager.sharedInstance().pushScene(new DDZBindAccountScene)},t}(QPScene);__reflect(DDZUserInfoScene.prototype,"DDZUserInfoScene");var DDZBindAccountScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZBindAccountSceneUI",t.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBackButton,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.bindPhonePopup.pressBindHandler=this.bindAccount.bind(this),this.bindPhonePopup.pressGetVerificationCodeButtonHandler=this.getVerificationCode.bind(this)},t.prototype.getVerificationCode=function(e){var t=this;UserModel.sharedInstance().inputtedAttributeModel.setPhoneNumber(e);var a=UserModel.sharedInstance().actionDataFactory.makeSendVerificationCodeData();a.isLegal&&this.bindPhonePopup.disableSendVerificationCodeButton(),UserModel.sharedInstance().actionModel.sendVerificationCode(a,function(e){UserModel.sharedInstance().inputtedAttributeModel.setCountryCode("86"),UserModel.sharedInstance().attributeModel.setHashDigest(e.hash_digest),UserModel.sharedInstance().attributeModel.setExpireISOTime(e.expire_iso_time)},function(e){QPAlert.sharedInstance().showOKButtonAt(t,e.message)})},t.prototype.bindAccount=function(e,t,a){var r=this;UserModel.sharedInstance().inputtedAttributeModel.setPhoneNumber(e),UserModel.sharedInstance().inputtedAttributeModel.setPassword(t),UserModel.sharedInstance().inputtedAttributeModel.setVerificationCode(a);var n=new QPLoadingScene;n.show("正在发送请求");var o=UserModel.sharedInstance().actionDataFactory.makeBindPhoneData();UserModel.sharedInstance().actionModel.bindPhone(o,function(e){n.hide(),UserModel.sharedInstance().attributeModel.setHasBindPhoneNumber(!0),QPAlert.sharedInstance().showOKButtonAt(r,"手机号绑定成功"),QPAlert.sharedInstance().pressedOKHandler=function(){r.onPressBackButton()};var t=new DDZDataEvent(DDZDataEvent.UPDATE);DDZEventCenter.sharedInstance().dispatchEvent(t)},function(e){n.hide(),QPAlert.sharedInstance().showOKButtonAt(r,e.message)})},t.prototype.onPressBackButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),qp.SceneManager.sharedInstance().popScene()},t}(QPScene);__reflect(DDZBindAccountScene.prototype,"DDZBindAccountScene");var DDZBindAccountTextInput=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.TextInput);__reflect(DDZBindAccountTextInput.prototype,"DDZBindAccountTextInput");var DDZBindPhonePopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZBindPhonePopupUI",t.getVerificationCodeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressGetVerificationCodeButton,t),t.bindButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressBindButton,t),t}return __extends(t,e),t.prototype.onExit=function(){e.prototype.onExit.call(this),this.getVerificationCodeButton.stopCountDown()},t.prototype.disableSendVerificationCodeButton=function(){this.getVerificationCodeButton.disable()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.phoneInput.prompt="请输入电话号码",this.passwordInput.prompt="请输入长度为6-50位的密码",this.passwordInput.displayAsPassword=!0,this.verificationCodeInput.prompt="请输入验证码",this.descriptionLabel.text="为账号"+UserModel.sharedInstance().attributeModel.name+"绑定手机号"},t.prototype.onPressGetVerificationCodeButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressGetVerificationCodeButtonHandler(this.phoneInput.text)},t.prototype.onPressBindButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBindHandler(this.phoneInput.text,this.passwordInput.text,this.verificationCodeInput.text)},t}(QPPopupLayer);__reflect(DDZBindPhonePopup.prototype,"DDZBindPhonePopup");var DDZGetVerificationCodeButton=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.disable=function(){this.enabled=!1,this.labelDisplay.text="60s 重新获取",this.startCountDown()},t.prototype.stopCountDown=function(){this.stopwatch&&(this.labelDisplay.text="",this.stopwatch.stop(),this.stopwatch=void 0,this.enabled=!0)},t.prototype.startCountDown=function(){this.stopwatch||(this.stopwatch=new egret.Timer(1e3,0),this.stopwatch.addEventListener(egret.TimerEvent.TIMER,this.stopwatchFunction,this),this.remainStopwatchValue=t.STOP_WATCH_VALUE,this.stopwatch.start())},t.prototype.stopwatchFunction=function(){return this.remainStopwatchValue-=1,this.remainStopwatchValue<1?void this.stopCountDown():void(this.labelDisplay.text=this.remainStopwatchValue+"s 重新获取")},t.STOP_WATCH_VALUE=60,t}(eui.Button);__reflect(DDZGetVerificationCodeButton.prototype,"DDZGetVerificationCodeButton");var DDZUserInfoAvatar=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoAvatarUI",t}return __extends(t,e),t.prototype.setAvatar=function(e){this.avatarImage.source=e},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.avatarButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressedAvatarButton,this)},t.prototype.onPressedAvatarButton=function(){this.onPressedHandler&&this.onPressedHandler()},t}(QPLayer);__reflect(DDZUserInfoAvatar.prototype,"DDZUserInfoAvatar");var DDZUserInfoEditPopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoEditPopupUI",t}return __extends(t,e),t.prototype.setCurrentUserInfo=function(e){this.nameInput.text=e.name,this.maleRadioButton.selected=e.gender.isMale(),this.femaleRadioButton.selected=!e.gender.isMale()},t.prototype.getNameValue=function(){return this.nameInput.text},t.prototype.getGenderValue=function(){return this.maleRadioButton.selected?new GenderMale:this.femaleRadioButton.selected?new GenderFeMale:void 0},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.cancelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCancelButton,this),this.saveButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressSaveButton,this);var t=new eui.RadioButtonGroup;t.addEventListener(eui.UIEvent.CHANGE,this.radioChangedHandler,this),this.maleRadioButton.group=t,this.femaleRadioButton.group=t},t.prototype.radioChangedHandler=function(e){var t=e.target;egret.log(t.selectedValue)},t.prototype.onPressCancelButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressedCancelHandler()},t.prototype.onPressSaveButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressedSaveHandler()},t}(QPPopupLayer);__reflect(DDZUserInfoEditPopup.prototype,"DDZUserInfoEditPopup");var DDZUserInfoEditScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoEditSceneUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.popup.pressedCancelHandler=this.cancelEditUserInfo.bind(this),this.popup.pressedSaveHandler=this.saveEditUserInfo.bind(this),this.popup.setCurrentUserInfo(UserModel.sharedInstance().attributeModel)},t.prototype.cancelEditUserInfo=function(){qp.SceneManager.sharedInstance().removeChildLayer(this)},t.prototype.saveEditUserInfo=function(){var e=this,t={nickname:this.popup.getNameValue(),gender:this.popup.getGenderValue().name},a=new QPLoadingScene;a.show("正在修改信息"),UserModel.sharedInstance().modifyUserInformation(t,function(t){if(a.hide(),t)return void QPAlert.sharedInstance().showOKButtonAt(e,t.message);var r=new DDZDataEvent(DDZDataEvent.UPDATE);r.userAttribute=UserModel.sharedInstance().attributeModel,DDZEventCenter.sharedInstance().dispatchEvent(r),QPAlert.sharedInstance().showOKButtonAt(e,"您的信息已经成功更新。"),QPAlert.sharedInstance().pressedOKHandler=function(){qp.SceneManager.sharedInstance().removeChildLayer(e)}})},t}(QPLayer);__reflect(DDZUserInfoEditScene.prototype,"DDZUserInfoEditScene");var DDZUserInfoGameDataView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoGameDataViewUI",t}return __extends(t,e),t.prototype.setTitleText=function(e){this.titleLabel.text=e+"："},t.prototype.setValueText=function(e){this.valueLabel.text=e},t}(QPLayer);__reflect(DDZUserInfoGameDataView.prototype,"DDZUserInfoGameDataView");var DDZUserInfoGenderView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoGenderUI",t}return __extends(t,e),t.prototype.setGenderIcon=function(e){this.genderImage.source=e},t}(QPLayer);__reflect(DDZUserInfoGenderView.prototype,"DDZUserInfoGenderView");var DDZUserInfoNameInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoNameInputUI",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.addEventListener(egret.Event.CHANGE,this.onValueChanged,this),this.cleanButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCleanButton,this),this.cleanButton.visible=this.text&&""!==this.text},t.prototype.onValueChanged=function(e){this.cleanButton.visible=e.target.text&&""!==e.target.text},t.prototype.onPressCleanButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.text=""},t}(eui.TextInput);__reflect(DDZUserInfoNameInput.prototype,"DDZUserInfoNameInput");var DDZUserInfoPopup=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserInfoPopupUI",t}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),DDZEventCenter.sharedInstance().addEventListener(DDZDataEvent.UPDATE,this.receiveUserDataChangedEvent,this)},t.prototype.onExit=function(){e.prototype.onExit.call(this),DDZEventCenter.sharedInstance().removeEventListener(DDZDataEvent.UPDATE,this.receiveUserDataChangedEvent,this)},t.prototype.setUserInfo=function(e){this.nameLabel.text=e.name,this.genderView.setGenderIcon(e.gender.iconSource),this.idLabel.text="ID: "+e.getDisplayId(),this.totalGame.setValueText(String(e.totalGameAmount)),this.winningRate.setValueText(String(e.winningRate)),this.escapeRate.setValueText(String(e.escapeRate)),this.winningAmount.setValueText(String(e.winningGameAmount)),this.continueWinningAmount.setValueText(String(e.continuousWinningAmount))},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.closeButton.pressHandler=this.onPressCloseButton.bind(this),this.totalGame.setTitleText("总局数"),this.winningRate.setTitleText("胜率"),this.escapeRate.setTitleText("逃跑率"),this.winningAmount.setTitleText("胜利场"),this.continueWinningAmount.setTitleText("连胜")},t.prototype.receiveUserDataChangedEvent=function(e){e.userAttribute&&this.setUserInfo(e.userAttribute)},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressCloseButtonHandler&&this.pressCloseButtonHandler()},t.prototype.onPressEditUsernameButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1);var e=new DDZUserInfoEditScene;qp.SceneManager.sharedInstance().addChildLayer(e)},t.prototype.onPressSwitchAccountButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressSwitchAccountButtonHandler&&this.pressSwitchAccountButtonHandler()},t.prototype.onPressBindPhoneButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressBindPhoneButtonHandler&&this.pressBindPhoneButtonHandler()},t.prototype.onPressSignOutButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressSignOutButtonHandler&&this.pressSignOutButtonHandler()},t}(QPPopupLayer);__reflect(DDZUserInfoPopup.prototype,"DDZUserInfoPopup");var ApplicationUtil=function(){function e(){}return e.switchToOtherApp=function(e,t,a){egret.ExternalInterface.call("switchToOtherApp",e),egret.ExternalInterface.addCallback("switchSuccess",function(){t()}),egret.ExternalInterface.addCallback("switchError",function(e){a(new Error(e))})},e}();__reflect(ApplicationUtil.prototype,"ApplicationUtil");var Color=function(){function e(){}return e.TextGray=9868950,e.Red=15018281,e.Black=1513239,e}();__reflect(Color.prototype,"Color");var DDZPopupCloseButton=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCloseButton,this)},t.prototype.onPressCloseButton=function(){QPAudioManager.sharedInstance().playEffectSound(QPAudioSouce.CLICK_BUTTON,1),this.pressHandler&&this.pressHandler()},t}(eui.Component);__reflect(DDZPopupCloseButton.prototype,"DDZPopupCloseButton");var DEVICE_ID_KEY="user.device.id.local.save.key",DEVICE_IF_RUN_APP_KEY="user.device.if.run.app.save.key",Device=function(){function e(){var e=DDZCacheModel.sharedInstance().stringForKey(DEVICE_ID_KEY);e?this.id=e:(this.id=UUID.generate(),DDZCacheModel.sharedInstance().setString(DEVICE_ID_KEY,this.id));var t=DDZCacheModel.sharedInstance().booleanForKey(DEVICE_IF_RUN_APP_KEY);this.isLaunchedApp=t,t||DDZCacheModel.sharedInstance().setBoolean(DEVICE_IF_RUN_APP_KEY,!0)}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getWidth=function(){return this.width},e.prototype.setWidth=function(e){this.width=e},e.prototype.getHeight=function(){return this.height},e.prototype.setHeight=function(e){this.height=e},e.prototype.setScreenWidth=function(e){this.screenWidth=e},e.prototype.getScreenWidth=function(){return this.screenWidth},e.prototype.setScreenHeight=function(e){this.screenHeight=e},e.prototype.getScreenHeight=function(){return this.screenHeight},e.prototype.screenShoot=function(t){var a=new egret.RenderTexture,r=new egret.Rectangle(0,0,e.sharedInstance().width,e.sharedInstance().height);return a.drawToTexture(t,r),a},e.prototype.isNative=function(){return egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE},e.prototype.isiOS=function(){return"iOS"===egret.Capabilities.os},e.prototype.isWeb=function(){return egret.Capabilities.runtimeType===egret.RuntimeType.WEB},e.instance=void 0,e}();__reflect(Device.prototype,"Device");var PasteBoard=function(){function e(){}return e.write=function(e){egret.ExternalInterface.call("saveToPasteBoard",e)},e.getContent=function(e){egret.ExternalInterface.call("getPasteBoardContent",""),egret.ExternalInterface.addCallback("getPasteBoardContent",function(t){e(t)})},e}();__reflect(PasteBoard.prototype,"PasteBoard");var QPAlert=function(e){function t(){var t=e.call(this)||this;return t.skinName="QPAlertUI",t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.hide=function(){this.hideAllButtonGroups(),this.pressedCancelHandler=void 0,this.pressedOKHandler=void 0,this.titleLabel.text="",qp.SceneManager.sharedInstance().removeChildLayer(this)
},t.prototype.showAt=function(e,t,a){this.showOKButtonAt(e,t,a)},t.prototype.showOKButtonAt=function(e,t,a){this.okGroup.visible=!0,this.messageLabel.text=t,this.titleLabel.text=a,qp.SceneManager.sharedInstance().addChildLayer(this)},t.prototype.showCancelAndOkButtonAt=function(e,t,a){this.cancelAndOkGroup.visible=!0,this.messageLabel.text=t,this.titleLabel.text=a,qp.SceneManager.sharedInstance().addChildLayer(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addListeners()},t.prototype.addListeners=function(){this.okButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressOkButton,this),this.cancelAndOkGroupCancelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressCancelButton,this),this.cancelAndOkGroupOkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressOkButton,this)},t.prototype.onPressCancelButton=function(){this.pressedCancelHandler&&this.pressedCancelHandler(),this.hide()},t.prototype.onPressOkButton=function(){this.pressedOKHandler&&this.pressedOKHandler(),this.hide()},t.prototype.hideAllButtonGroups=function(){this.okGroup.visible=!1,this.cancelAndOkGroup.visible=!1},t.instance=void 0,t}(QPLayer);__reflect(QPAlert.prototype,"QPAlert");var DEFAULT_VOLUME="0.5",QPAudioManager=function(){function e(){this.MUSIC_START_TIME=0,this.backgroundMusics={},this.isBackgroundMusicPlaying=!1,this.backgroundSoundChannels={},this.soundEffects={},this.soundEffectChannels={},this.backgroundMusicVolume=-1,this.soundEffectVolume=-1}return e.sharedInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setBackgroundMusicVolume=function(e){this.backgroundMusicVolume=e/100;for(var t in this.backgroundSoundChannels)t&&(this.backgroundSoundChannels[t].volume=this.backgroundMusicVolume)},e.prototype.setSoundEffectVolume=function(e){this.soundEffectVolume=e/100;for(var t in this.soundEffectChannels)t&&(this.soundEffectChannels[t].volume=this.soundEffectVolume)},e.prototype.playBackgroundMusic=function(e,t){if(void 0===t&&(t=0),DDZSettingsModel.sharedInstance().isMusicOn&&e!==this.currentSoundFileSource){this.isBackgroundMusicPlaying&&this.stopPlayBackgroundMusic(),this.currentSoundFileSource=e;var a=RES.getRes(e);if(!a)return void egret.log("糟糕！！！！！ 资源文件"+e+"，读取失败，音乐不能播放");this.backgroundMusics[e]=a;var r=a.play(this.MUSIC_START_TIME,t);r.volume=this.backgroundMusicVolume<0?DEFAULT_VOLUME:this.backgroundMusicVolume,this.backgroundSoundChannels[a.hashCode.toString()]=r,this.isBackgroundMusicPlaying=!0}},e.prototype.getPlayingSoundFileSource=function(){return this.currentSoundFileSource},e.prototype.stopPlayBackgroundMusic=function(){for(var e in this.backgroundSoundChannels)e&&(this.backgroundSoundChannels[e].stop(),delete this.backgroundSoundChannels[e]);for(var t in this.backgroundMusics)t&&delete this.backgroundMusics[t];this.currentSoundFileSource=void 0,this.isBackgroundMusicPlaying=!1},e.prototype.playEffectSound=function(e,t){if(void 0===t&&(t=1),DDZSettingsModel.sharedInstance().isSoundOn){var a=RES.getRes(e);if(!a)return void egret.log("糟糕，音效文件"+e+"，读取失败，未能播放");this.soundEffects[e]=a;var r=a.play(this.MUSIC_START_TIME,t);r.volume=this.soundEffectVolume<0?DEFAULT_VOLUME:this.soundEffectVolume,this.soundEffectChannels[a.hashCode.toString()]=r}},e.prototype.stopPlayEffectSound=function(e){var t=this.soundEffects[e];if(t){var a=this.soundEffectChannels[t.hashCode.toString()];a.stop(),delete this.soundEffects[e],delete this.soundEffectChannels[t.hashCode.toString()]}},e}();__reflect(QPAudioManager.prototype,"QPAudioManager");var QPAudioSouce=function(){function e(){}return e.getRandomBuYao=function(){return Math.random()>.5?"voice_bu_yao_mp3":"voice_guo_mp3"},e.CLICK_BUTTON="btn_click_mp3",e.BU_JIAO="grab_bu_jiao_mp3",e.JIAO_DI_ZHU="grab_jiao_di_zhu_mp3",e.SEND_CARD="ddz_send_card_mp3",e.CHOOSE_CARD="ddz_choose_card_mp3",e}();__reflect(QPAudioSouce.prototype,"QPAudioSouce");var QPCrossPlatformCommunication=function(){function e(){}return e.closeH5Game=function(){var e={command:"close_webview"};window.postMessage(JSON.stringify(e),"*")},e}();__reflect(QPCrossPlatformCommunication.prototype,"QPCrossPlatformCommunication");var QPLoadingScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="QPLoadingUI",t}return __extends(t,e),t.prototype.show=function(e){this.messageLabel.text=e?e+"...":"努力加载中...",this.parent||(qp.SceneManager.sharedInstance().addChildLayer(this),this.startAnimation())},t.prototype.hide=function(){this.parent&&(this.loadingAnimationGroup.stop(),qp.SceneManager.sharedInstance().removeChildLayer(this))},t.prototype.createChildren=function(){e.prototype.createChildren.call(this);for(var t in this.loadingAnimationGroup.items)if(t){var a=this.loadingAnimationGroup.items[t];a&&(a.props={loop:!0})}},t.prototype.startAnimation=function(){this.parent&&this.loadingAnimationGroup.play()},t}(QPLayer);__reflect(QPLoadingScene.prototype,"QPLoadingScene");var DDZTransparentCover=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZTransparentCoverUI",t}return __extends(t,e),t}(QPLayer);__reflect(DDZTransparentCover.prototype,"DDZTransparentCover");var QPToast=function(e){function t(){var t=e.call(this)||this;return t.skinName="QPToastUI",t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.showAt=function(e,t){this.messageLabel.text=t,this.messageBackground.width=this.messageLabel.width+60,this.messageBackground.height=this.messageLabel.height+50,this.parent||e.addChild(this)},t.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},t.instance=void 0,t}(eui.Component);__reflect(QPToast.prototype,"QPToast");var UnderLineTextInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="UnderLineTextInputUI",t}return __extends(t,e),t}(eui.TextInput);__reflect(UnderLineTextInput.prototype,"UnderLineTextInput");var DDZUserCoinInfoView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserCoinInfoUI",t}return __extends(t,e),t.prototype.setCoin=function(e){this.coinLabel.text=String(e)},t}(QPLayer);__reflect(DDZUserCoinInfoView.prototype,"DDZUserCoinInfoView");var DDZUserDiamondInfoView=function(e){function t(){var t=e.call(this)||this;return t.skinName="DDZUserDiamondInfoUI",t}return __extends(t,e),t.prototype.setDiamond=function(e){this.diamondLabel.text=e},t}(QPLayer);__reflect(DDZUserDiamondInfoView.prototype,"DDZUserDiamondInfoView");var DDZButtonEvent=function(e){function t(t,a,r){return void 0===a&&(a=!1),void 0===r&&(r=!1),e.call(this,t,a,r)||this}return __extends(t,e),t.ENABLE_PLAY_CARD_BUTTON="event.enable.play.card.button",t.DISABLE_PLAY_CARD_BUTTON="event.disable.play.card.button",t.NOT_CALL_LANDLORD="event.press.not.call.landlord.button",t.CALL_ONE_POINT="event.press.call.one.point.button",t.CALL_TWO_POINT="event.press.call.two.point.button",t.CALL_THREE_POINT="event.press.call.three.point.button",t.NOT_PLAY_CARD="event.not.play.card",t.PLAY_CARD="event.must.play.card",t.HINT="event.hint",t.SHOW_CARDS_START_PLAY="event.show.cards.start.play",t.GAME_OVER_SHARE="event.game.over.share.button",t.CONTINUE_PLAY="event.continue.play",t.START_GAME="event.press.start.game.button",t.PURCHASE_DIAMOND="event.press.purchase.diamond.button",t.PURCHASE_COIN="event.press.purchase.coin.button",t}(egret.Event);__reflect(DDZButtonEvent.prototype,"DDZButtonEvent");var DDZDataEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.UPDATE="ddz.data.event.update",t}(egret.Event);__reflect(DDZDataEvent.prototype,"DDZDataEvent");var qp;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.sceneStack=new eui.ViewStack,t.scenes=[],t}return __extends(t,e),t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.addRootStage=function(e){this.rootStage=e,this.rootStage.addChild(this.sceneStack)},t.prototype.addChildLayer=function(e){if(!e)throw new Error("无法添加不存在的layer");this.rootStage.addChild(e),e.onEnter()},t.prototype.removeChildLayer=function(e){if(!e)throw new Error("无法移出不存在的scene");e.parent&&(e.onExit(),this.rootStage.removeChild(e),e=void 0)},t.prototype.pushScene=function(e){if(!e)throw new Error("你不能push一个不存在的scene");this.sceneStack.addChild(e),e.onEnter(),this.scenes.push(e),this.sceneStack.selectedIndex=this.sceneStack.length-1},t.prototype.popScene=function(){if(1<=this.scenes.length){var e=this.scenes.pop();e.onExit();var t=this.sceneStack.removeChild(e);this.sceneStack.selectedIndex=this.sceneStack.length-1,this.sceneStack.selectedIndex<0&&(this.sceneStack.selectedIndex=0),t=void 0}},t.prototype.replaceScene=function(e){if(!e)throw new Error("你不能replace一个不存在的scene");this.popScene(),this.pushScene(e)},t.instance=void 0,t}(egret.DisplayObjectContainer);e.SceneManager=t,__reflect(t.prototype,"qp.SceneManager")}(qp||(qp={})),String.prototype.countByte=function(){for(var e=0,t=0;t<this.length;t+=1){var a=this.charCodeAt(t);e+=128>a?1:2048>a?2:65536>a?3:1<<21>a?4:1<<26>a?5:1<<31>a?6:Number.NaN}return e},String.prototype.canBeUsername=function(){var e=/^[a-zA-Z0-9]+$/;return e.test(this)?!0:!1},String.prototype.isValidDate=function(){var e=/((^((1[8-9]\d{2})|([2-9]\d{3}))([-])(10|12|0?[13578])([-])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-])(11|0?[469])([-])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-])(0?2)([-])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-])(0?2)([-])(29)$)|(^([3579][26]00)([-])(0?2)([-])(29)$)|(^([1][89][0][48])([-])(0?2)([-])(29)$)|(^([2-9][0-9][0][48])([-])(0?2)([-])(29)$)|(^([1][89][2468][048])([-])(0?2)([-])(29)$)|(^([2-9][0-9][2468][048])([-])(0?2)([-])(29)$)|(^([1][89][13579][26])([-])(0?2)([-])(29)$)|(^([2-9][0-9][13579][26])([-])(0?2)([-])(29)$))/;return e.test(this)},String.prototype.canBePassword=function(){return this.length>=8},String.prototype.isValidPhoneNumber=function(){var e=/^[0-9]+$/;return e.test(this)&&this.length>=8?!0:!1},String.prototype.isValidVerificationCode=function(){var e=/^[0-9]+$/;return e.test(this)&&6===this.length?!0:!1};var QPResource;!function(e){var t=function(){function e(){}return e.LAUNCH_GAME="ddz_launch_game",e.HOME="ddz_home",e.COMMON_MUSIC="ddz_common_music",e.COMMON_IMAGE="ddz_common_image",e.OTHER_MUSIC="ddz_other_music",e.PLAY_GAME="ddz_play_game_image",e.SETTINGS="ddz_settings_image",e.USER_INFO="ddz_user_info_image",e}();e.GroupName=t,__reflect(t.prototype,"QPResource.GroupName");var a=function(){function e(){this.isLoaded=!1}return e.prototype.load=function(e){if(!e)throw new Error("不能加载不存在的Group");return this.isLoaded?void this.loadCompleteHandler(new RES.ResourceEvent(RES.ResourceEvent.GROUP_COMPLETE)):(this.addLoadGroupEvent(),void RES.loadGroup(e))},e.prototype.addLoadGroupEvent=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.removeLoadGroupEvent=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.onGroupLoadComplete=function(e){this.isLoaded=!0,this.removeLoadGroupEvent(),this.loadCompleteHandler&&this.loadCompleteHandler(e)},e.prototype.onGroupLoadError=function(e){this.isLoaded=!1,this.removeLoadGroupEvent(),this.loadCompleteHandler&&this.loadCompleteHandler(e)},e.prototype.onGroupProgress=function(e){this.loadProgressHandler&&this.loadProgressHandler(e)},e.prototype.onItemLoadError=function(e){throw new Error(e.resItem.url+"加载失败")},e}();e.GroupModel=a,__reflect(a.prototype,"QPResource.GroupModel");var r=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.LAUNCH_GAME)},a}(a);e.LaunchGameGroup=r,__reflect(r.prototype,"QPResource.LaunchGameGroup");var n=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.HOME)},a}(a);e.HomeGroup=n,__reflect(n.prototype,"QPResource.HomeGroup");var o=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.COMMON_MUSIC)},a}(a);e.CommonMusicGroup=o,__reflect(o.prototype,"QPResource.CommonMusicGroup");var i=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.OTHER_MUSIC)},a}(a);e.OtherMusicGroup=i,__reflect(i.prototype,"QPResource.OtherMusicGroup");var s=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.COMMON_IMAGE)},a}(a);e.CommonImagesGroup=s,__reflect(s.prototype,"QPResource.CommonImagesGroup");var d=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.PLAY_GAME)},a}(a);e.PlayGameGroup=d,__reflect(d.prototype,"QPResource.PlayGameGroup");var l=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.SETTINGS)},a}(a);e.SettingsGroup=l,__reflect(l.prototype,"QPResource.SettingsGroup");var c=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.sharedInstance=function(){return a.instance||(a.instance=new a),a.instance},a.prototype.load=function(){e.prototype.load.call(this,t.USER_INFO)},a}(a);e.UserInfoGroup=c,__reflect(c.prototype,"QPResource.UserInfoGroup")}(QPResource||(QPResource={}));var QPResource;!function(e){var t=function(){function t(){}return t.sharedInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isLoadedSuccessful?[2]:this.isLoading?[2]:(this.isLoading=!0,[4,this.loadSettingsImages()]);case 1:return e.sent(),[4,this.loadUserInfoImages()];case 2:return e.sent(),[4,this.loadOtherMusics()];case 3:return e.sent(),this.isLoading=!1,this.isLoadedSuccessful=!0,[2]}})})},t.prototype.getLoadGroupFailedError=function(){return new Error("游戏资源加载失败")},t.prototype.loadOtherMusics=function(){var t=this;return new Promise(function(a,r){e.OtherMusicGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.OtherMusicGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.OtherMusicGroup.sharedInstance().load()})},t.prototype.loadPlayGameImages=function(){var t=this;return new Promise(function(a,r){e.PlayGameGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.PlayGameGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.PlayGameGroup.sharedInstance().load()})},t.prototype.loadSettingsImages=function(){var t=this;return new Promise(function(a,r){e.SettingsGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.SettingsGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.SettingsGroup.sharedInstance().load()})},t.prototype.loadUserInfoImages=function(){var t=this;return new Promise(function(a,r){e.UserInfoGroup.sharedInstance().loadCompleteHandler=function(e){a(e)},e.UserInfoGroup.sharedInstance().loadFailedHandler=function(e){r(t.getLoadGroupFailedError())},e.UserInfoGroup.sharedInstance().load()})},t}();e.AsyncLoader=t,__reflect(t.prototype,"QPResource.AsyncLoader")}(QPResource||(QPResource={}));